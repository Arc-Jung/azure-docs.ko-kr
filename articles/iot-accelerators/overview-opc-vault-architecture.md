---
title: OPC 자격 증명 모음 아키텍처 | Microsoft Docs
description: OPC 자격 증명 모음 인증서 관리 서비스에 대한 아키텍처
author: mregen
ms.author: mregen
ms.date: 08/16/2019
ms.topic: overview
ms.service: industrial-iot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: 9331473402ddd22180df3b404824969360d48164
ms.sourcegitcommit: 4b8a69b920ade815d095236c16175124a6a34996
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/23/2019
ms.locfileid: "69995828"
---
# <a name="opc-vault-architecture"></a>OPC 자격 증명 모음 아키텍처

이 문서에서는 **OPC 자격 증명 모음 마이크로서비스** 및 **OPC 자격 증명 모음 IoT Edge 모듈**에 대해 개략적으로 설명합니다.

## <a name="overview"></a>개요

OPC UA 애플리케이션은 애플리케이션 인스턴스 인증서를 사용하여 애플리케이션 수준 보안을 제공합니다. 보안 연결은 애플리케이션 인증서에서 퍼블릭 키 및 프라이빗 키 쌍을 제공하는 비대칭 암호화를 사용하여 설정됩니다. 인증서는 자체적으로 서명하거나 CA(인증 기관)에서 서명할 수 있습니다.

OPC UA 애플리케이션에는 신뢰하는 애플리케이션을 나타내는 신뢰할 수 있는 인증서 목록이 있습니다. 이러한 인증서는 자체적으로 또는 CA에서 서명할 수 있거나, 루트 CA 또는 하위 CA 자체일 수 있습니다. 신뢰할 수 있는 인증서가 더 큰 인증서 체인의 일부인 경우 전체 인증서 체인의 유효성을 검사할 수 있으면 애플리케이션에서 신뢰 목록의 인증서에 연결된 모든 인증서를 신뢰합니다.

자체 서명된 인증서 신뢰와 CA 인증서 신뢰의 주요 차이점은 신뢰를 배포하고 유지 관리하는 데 필요한 설치 작업과 회사별 CA를 호스팅하기 위한 추가 작업에 있습니다. 

단일 클라이언트 애플리케이션을 사용하여 n개 서버에 대해 자체 서명된 인증서의 신뢰를 배포하려면, 모든 n개 서버 애플리케이션 인증서가 클라이언트 애플리케이션 신뢰 목록에 설치되어 있고 클라이언트 애플리케이션 인증서가 모든 서버 애플리케이션 신뢰 목록에 설치되어 있어야 합니다. 이러한 관리 작업은 상당히 부담스러우며, 인증서 수명을 고려하고 인증서를 갱신해야 하는 경우 훨씬 더 많은 작업이 추가됩니다.

회사별 CA를 사용하면 여러 서버 및 클라이언트에서 신뢰 관리를 크게 간소화할 수 있습니다. 이 경우 관리자는 사용되는 모든 클라이언트와 서버에 대해 CA 서명된 애플리케이션 인스턴스 인증서를 한 번 생성합니다. 또한 CA 인증서는 모든 서버와 클라이언트의 모든 애플리케이션 신뢰 목록에 설치됩니다. 이 방법을 사용하면 만료된 인증서만 갱신하고, 영향을 받는 애플리케이션에 대한 인증서는 교체해야 합니다.

Azure 산업용 IoT UA 인증서 관리 서비스는 OPC 자격 증명 모음 마이크로서비스를 기반으로 하는 OPC UA 애플리케이션의 회사별 CA를 관리하는 솔루션입니다.

OPC 자격 증명 모음은 보안 클라우드에서 회사별 CA를 호스팅할 수 있는 마이크로서비스를 제공하며, 하드웨어 보안 모듈, Cosmos DB 및 선택적으로 IoT Hub를 애플리케이션 저장소로 사용하여 Azure Key Vault를 통해 Azure AD 보안 서비스를 지원합니다.

OPC 자격 증명 모음 마이크로서비스는 OT 개인 요청에서 애플리케이션 인증서에 서명하고 서명 권한이 Azure Key Vault에 있는 보안 관리자 및 승인자가 이러한 요청을 승인하거나 거부하는 역할 기반 워크플로를 지원하도록 설계되었습니다.

기존 OPC UA GDS 기반 OT 솔루션과의 호환성을 위해 이 서비스에는 사양의 12부에 따라 *OPC UA 글로벌 검색 서버 및 인증서 관리* 인터페이스를 구현하여 인증서와 신뢰 목록을 배포하는 OPC 자격 증명 모음 마이크로서비스에서 지원하는 에지 모듈에 대한 지원이 포함됩니다. 그러나 이 GDS 서버 인터페이스는 아직 널리 사용되지 않고 기능(읽기 권한자 역할)이 제한되어 있다고 알려져 있습니다. [요청 시 고객 요청에 대한 환경이 향상됩니다(*)](#yet-unsupported-features).

## <a name="architecture"></a>아키텍처

이 아키텍처는 공장 네트워크용 OPC 자격 증명 모음 IoT Edge 모듈과 워크플로를 제어하는 웹 샘플 UX를 갖춘 OPC 자격 증명 모음 마이크로서비스를 기반으로 합니다.

![OPC 자격 증명 모음 아키텍처](media/overview-opc-vault-architecture/opc-vault.png)

## <a name="opc-vault-microservice"></a>OPC 자격 증명 모음 마이크로서비스

OPC 자격 증명 모음 마이크로서비스는 OPC UA 애플리케이션용 회사별 CA를 배포하고 관리하는 워크플로를 구현하기 위해 다음과 같은 인터페이스로 구성됩니다.

### <a name="application"></a>애플리케이션 
- "OPC UA 애플리케이션"은 서버, 클라이언트 또는 둘 다일 수 있습니다. 이 경우 OPC 자격 증명 모음은 애플리케이션 등록 기관으로 사용됩니다. 
- 애플리케이션을 등록, 업데이트 및 등록 취소하는 기본 작업 외에도 검색 식을 사용하여 애플리케이션을 찾고 쿼리하는 인터페이스도 있습니다. 
- 요청을 처리하고 모든 OPC UA 관련 확장으로 서명된 인증서를 발급하기 위해 인증서 요청은 유효한 애플리케이션을 참조해야 합니다. 
- 애플리케이션 서비스는 고객 구성에 따라 CosmosDB 데이터베이스 또는 [OpcTwin 디바이스 레지스트리(*)](#yet-unsupported-features)를 통해 지원됩니다.

### <a name="certificate-group"></a>인증서 그룹
- 인증서 그룹은 인증서에 서명하기 위한 프라이빗 키를 포함하여 루트 CA 또는 하위 CA 인증서를 저장하는 엔터티입니다. 
- RSA 키 길이, SHA-2 해시 길이 및 수명은 발급자 CA와 서명된 애플리케이션 인증서 모두에 대해 구성할 수 있습니다. 
- 나중에 https, 사용자 또는 ECC 알고리즘 인증서 그룹을 사용하여 확장할 수 있도록 단일 서비스에서 여러 그룹을 호스팅할 수 있습니다[(*)](#yet-unsupported-features). 
- CA 인증서는 FIPS 140-2 수준 2 HSM(하드웨어 보안 모듈)을 통해 지원되는 Azure Key Vault에 저장됩니다. 서명은 Azure AD 보안 Key Vault 작업을 통해 수행되므로 프라이빗 키가 보안 스토리지에서 유지됩니다. 
- CA 인증서는 시간이 지남에 따라 갱신할 수 있으며, Key Vault에서 기록하므로 안전한 스토리지에서 계속 유지할 수 있습니다. 
- 각 CA 인증서에 대한 해지 목록도 비밀로 Key Vault에 저장됩니다. 애플리케이션 등록이 취소되면 관리자가 CRL에서 해당 애플리케이션 인증서도 해지합니다.
- 일괄 처리 및 단일 인증서 해지가 지원됩니다.

### <a name="certificate-request"></a>인증서 요청
인증서 요청은 OPC UA 애플리케이션에 대한 "CSR"(인증서 서명 요청)을 사용하여 새 키 쌍 또는 서명된 인증서를 생성하는 워크플로를 구현합니다. 
- 요청은 주체 또는 CSR과 같은 정보 및 OPC UA 애플리케이션에 대한 참조와 함께 데이터베이스에 저장됩니다. 
- 서비스의 비즈니스 논리는 애플리케이션 데이터베이스에 저장된 정보와 비교하여 요청의 유효성을 검사합니다. 예를 들어 데이터베이스의 애플리케이션 URI는 CSR의 애플리케이션 URI와 일치해야 합니다.
- 서명 권한(승인자 역할)이 있는 보안 관리자는 요청을 승인하거나 거부합니다. 요청이 승인되면 새 키 쌍 및/또는 서명된 인증서가 생성됩니다. 새 프라이빗 키는 KeyVault에 안전하게 저장되고, 새 서명된 퍼블릭 인증서는 인증서 요청 데이터베이스에 저장됩니다.
- 요청이 승인되거나 해지될 때까지 요청자는 요청 상태를 폴링할 수 있습니다. 요청이 승인되면 프라이빗 키와 인증서를 다운로드하여 OPC UA 애플리케이션의 인증서 저장소에 설치할 수 있습니다.
- 요청자는 이제 요청 데이터베이스에서 불필요한 정보를 삭제하는 요청을 수락할 수 있습니다. 

서명된 인증서의 수명 동안 애플리케이션이 삭제되거나 키가 손상될 수 있습니다. 이 경우 CA 관리자는 다음을 수행할 수 있습니다.
- 애플리케이션을 삭제합니다. 그러면 보류 중인 인증서 및 승인된 인증서에 대한 애플리케이션의 모든 요청도 동시에 삭제됩니다. 
- 또 다른 옵션은 키만 갱신되거나 손상된 경우 단일 인증서 요청만 삭제하는 것입니다.
- 손상된 승인됨 및 수락됨 인증서 요청은 이제 삭제됨으로 표시됩니다.
- 관리자는 발급자 CA CRL의 갱신을 정기적으로 실행할 수 있습니다. 갱신 시 모든 삭제된 인증서 요청이 해지되고, 인증서 일련 번호가 CRL 해지 목록에 추가됩니다. 해지된 인증서 요청은 해지됨으로 표시됩니다.
- 긴급한 경우 단일 인증서 요청도 해지할 수 있습니다.
- 마지막으로 업데이트된 CRL은 참여하는 OPC UA 클라이언트 및 서버에 배포할 수 있습니다.

OPC 자격 증명 모음 마이크로서비스 API에 대한 자세한 내용은 마이크로서비스의 swagger 설명서를 참조하세요.

## <a name="opc-vault-iot-edge-module"></a>OPC 자격 증명 모음 IoT Edge 모듈
공장 네트워크 글로벌 검색 서버를 지원하기 위해 OPC 자격 증명 모음 모듈을 에지에 배포하거나, 로컬 .Net Core 애플리케이션으로 실행하거나, Docker 컨테이너에서 시작할 수 있습니다. 현재 OPC UA .Net Standard 스택에서 Auth2 인증을 지원하지 않음에 따라 OPC UA GDS 표준 인터페이스를 사용하여 에지 모듈에서 마이크로서비스로 가장할 수 없으므로 OPC 자격 증명 모음 에지 모듈의 기능은 읽기 권한자 역할로 제한됩니다. 이 시점에서는 작성자, 관리자 또는 승인자 역할이 필요하지 않은 작업만 허용됩니다[(*)](#yet-unsupported-features). 

## <a name="yet-unsupported-features"></a>아직 지원되지 않는 기능

**(*)** 는 아직 지원되지 않습니다.

## <a name="next-steps"></a>다음 단계

이제 OPC 자격 증명 모음 아키텍처에 대해 알아보았으므로 여기서 추천되는 단계는 다음과 같습니다.

> [!div class="nextstepaction"]
> [OPC 자격 증명 모음 빌드 및 배포](howto-opc-vault-deploy.md)
