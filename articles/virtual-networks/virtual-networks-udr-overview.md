<properties 
   pageTitle="사용자 정의 경로 및 IP 전달 개요"
   description="UDR(사용자 정의 경로) 및 IP 전달 개요"
   services="virtual-networks"
   documentationCenter="na"
   authors="telmosampaio"
   manager="adinah"
   editor="tysonn" /> <tags 
   ms.service="virtual-networks"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/22/2015"
   ms.author="telmos" />

# 사용자 정의 경로 및 IP 전달
Azure에서는 경로 테이블을 사용하여 각 패킷의 대상에 따라 IP 트래픽을 전달하는 방법을 결정합니다. Azure에서는 가상 네트워크 설정에 따라 기본 경로 테이블을 제공하지만 해당 테이블에 사용자 지정 경로를 추가해야 할 수도 있습니다. 경로 테이블에 사용자 지정 항목이 필요한 가장 일반적인 경우는 Azure 환경에서 가상 어플라이언스를 사용하는 경우입니다. 아래 그림에 나와 있는 시나리오를 살펴보겠습니다. 프런트 엔드 서브넷에서 시작되어 중간 계층 이하의 서브넷으로 전달되는 모든 트래픽이 가상 방화벽 어플라이언스를 통과하는지 확인하려는 경우를 가정해 보겠습니다. 어플라이언스를 가상 네트워크에 추가하고 다른 서브넷에 연결하는 것만으로는 이 기능이 제공되지 않습니다. 서브넷에 적용된 라우팅 테이블을 변경하여 패킷이 가상 방화벽 어플라이언스로 전달되도록 해야 합니다.

Azure 가상 네트워크와 인터넷 간의 트래픽을 제어하기 위해 가상 NAT 어플라이언스를 구현한 경우도 마찬가지입니다. 가상 어플라이언스를 사용하려면 인터넷으로 전달되는 모든 트래픽이 가상 어플라이언스로 전달되도록 지정하는 경로를 만들어야 합니다.

## 라우팅
패킷은 물리적 네트워크의 각 노드에 정의된 경로 테이블을 기반으로 TCP/IP 네트워크를 통해 라우팅됩니다. 경로 테이블은 대상 IP 주소에 따라 패킷을 전달할 위치를 결정하는 데 사용되는 개별 경로의 컬렉션입니다. 경로는 다음으로 구성됩니다.

- **주소 접두사**. 경로가 적용되는 대상 CIDR(예: 10.1.0.0/16)입니다.
- **다음 홉 유형**. 패킷을 전송해야 하는 대상 Azure 홉의 유형입니다. 가능한 값은 다음과 같습니다.
	- **로컬**. 로컬 가상 네트워크를 나타냅니다. 예를 들어 10.1.0.0/16 및 10.2.0.0/16의 두 서브넷이 같은 가상 네트워크에 있는 경우 경로 테이블의 각 서브넷에 대한 경로는 다음 홉 값이 *로컬*로 설정됩니다.
	- **VPN 게이트웨이**. Azure S2S VPN 게이트웨이를 나타냅니다. 
	- **인터넷**. Azure 인프라에서 제공하는 기본 인터넷 게이트웨이를 나타냅니다. 
	- **가상 어플라이언스**. Azure 가상 네트워크에 추가한 가상 어플라이언스를 나타냅니다.
	- **NULL**. 블랙 홀을 나타냅니다. 블랙 홀로 전달된 패킷은 아무 곳에도 전달되지 않습니다.
- **다음 홉 값**. 다음 홉 값에는 패킷을 전달해야 하는 IP 주소가 포함됩니다. 다음 홉 값은 다음 홉 유형이 *가상 어플라이언스*인 경로에서만 허용됩니다.

## 기본 경로
가상 네트워크에 생성된 모든 서브넷은 다음 기본 경로 규칙을 포함하는 경로 테이블에 자동으로 연결됩니다. - **로컬 VNet 규칙**: 이 규칙은 가상 네트워크의 모든 서브넷에 대해 자동으로 만들어집니다. VNet의 VM이 서로 직접 연결되고 중간 다음 홉이 없음을 나타냅니다. - **온-프레미스 규칙**: 이 규칙은 온-프레미스 주소 범위로 전달되는 모든 트래픽에 적용되며, VPN 게이트웨이를 다음 홉 대상으로 사용합니다. - **인터넷 규칙**: 이 규칙은 공용 인터넷으로 전달되는 모든 트래픽을 처리하며, 인프라 인터넷 게이트웨이를 인터넷으로 전달되는 모든 트래픽에 대한 다음 홉으로 사용합니다.

## BGP 경로
온-프레미스 네트워크와 Azure 간에 ExpressRoute 연결이 있는 경우 BGP를 사용하도록 설정하여 온-프레미스 네트워크에서 Azure로 경로를 전파할 수 있습니다. 이러한 BGP 경로는 각 Azure 서브넷의 사용자 정의 경로 및 기본 경로와 동일한 방식으로 사용됩니다. 자세한 내용은 [ExpressRoute 소개](../expressroute-introduction)를 참조하세요.

[AZURE.IMPORTANT]VPN 게이트웨이를 다음 홉으로 사용하는 서브넷 0.0.0.0/0에 대한 사용자 정의 경로를 만들어 온-프레미스 네트워크를 통한 강제 터널링을 사용하도록 Azure 환경을 구성할 수 있습니다. 그러나 이 구성은 VPN 게이트웨이를 사용하는 경우에만 작동하고 ExpressRoute를 사용하는 경우에는 작동하지 않습니다. ExpressRoute의 경우 강제 터널링은 BGP를 통해 구성됩니다.

## 사용자 정의 경로
Azure 환경에서는 위에서 지정한 기본 경로를 볼 수 없으며, 대부분의 환경에는 이러한 경로만 있으면 됩니다. 그러나 다음과 같은 특정한 경우에는 경로 테이블을 만들고 하나 이상의 경로를 추가해야 할 수 있습니다.

- 온-프레미스 네트워크를 통해 인터넷으로 강제 터널링하는 경우
- Azure 환경에서 가상 어플라이언스를 사용하는 경우
- 
위 시나리오에서는 경로 테이블을 만들어 사용자 정의 경로를 추가해야 합니다. 여러 경로 테이블을 만들 수 있으며, 동일한 경로 테이블을 하나 이상의 서브넷에 연결할 수 있습니다. 또한 각 서브넷은 단일 경로 테이블에만 연결할 수 있습니다. 서브넷의 모든 VM 및 클라우드 서비스는 해당 서브넷에 연결된 경로 테이블을 사용합니다.

경로 테이블이 서브넷에 연결될 때까지 서브넷은 기본 경로에 의존합니다. 연결이 설정되면 사용자 정의 경로 및 기본 경로 간에 LPM(가장 긴 접두사 일치)을 기반으로 라우팅이 수행됩니다. LPM 일치가 동일한 경로가 두 개 이상 있으면 다음 순서대로 해당 원점에 따라 경로가 선택됩니다.

1. 사용자 정의 경로
1. BGP 경로(ExpressRoute를 사용하는 경우)
1. 기본 경로

[AZURE.IMPORTANT]사용자 정의 경로는 Azure VM 및 클라우드 서비스에만 적용됩니다. 예를 들어 온-프레미스 네트워크와 Azure 간에 방화벽 가상 어플라이언스를 추가하려면 온-프레미스 주소 공간으로 이동하는 모든 트래픽을 가상 어플라이언스로 전달하는 Azure 경로 테이블에 대한 사용자 정의 경로를 만들어야 합니다. 그러나 온-프레미스 주소 공간에서 들어오는 트래픽은 가상 어플라이언스를 우회하여 VPN 게이트웨이 또는 ExpressRoute 회로를 통해 Azure 환경으로 직접 이동합니다.

## IP 전달
위에서 설명한 것처럼 사용자 정의 경로를 만드는 주된 이유 중 하나는 트래픽을 가상 어플라이언스로 전달하기 위한 것입니다. 가상 어플라이언스는 방화벽이나 NAT 장치와 같이 네트워크 트래픽을 처리하는 데 사용되는 응용 프로그램을 실행하는 VM일 뿐입니다.

이 가상 어플라이언스 VM은 주소가 자신으로 지정되지 않은 들어오는 트래픽을 받을 수 있어야 합니다. VM이 다른 대상으로 주소가 지정된 트래픽을 받을 수 있도록 하려면 해당 VM에서 IP 전달을 사용하도록 설정해야 합니다.

## 참고 항목

[Azure에서 경로를 만들고 IP 전달을 사용하도록 설정하는 방법](../virtual-networks-udr-how-to)

[ILIP(인스턴스 수준 공용 IP)](../virtual-networks-instance-level-public-ip)

[가상 네트워크 개요](https://msdn.microsoft.com/library/azure/jj156007.aspx)

<!--HONumber=52-->
 