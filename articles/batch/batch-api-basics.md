<properties
	pageTitle="Azure 배치 기능 개요 | Microsoft Azure"
	description="개발자의 관점에서 배치 서비스와 해당 API에 대한 기능을 알아봅니다."
	services="batch"
	documentationCenter=".net"
	authors="yidingzhou"
	manager="timlt"
	editor=""/>

<tags
	ms.service="batch"
	ms.devlang="multiple"
	ms.topic="get-started-article"
	ms.tgt_pltfrm="na"
	ms.workload="big-compute"
	ms.date="01/21/2016"
	ms.author="yidingz;v-marsma"/>

# Azure 배치 기능 개요

이 문서에서는 Azure 배치 서비스의 핵심 API 기능에 대한 기본 개요를 제공합니다. 분산 컴퓨팅 솔루션을 개발할 때 [Batch REST][batch_rest_api] API를 사용하든 [Batch .NET][batch_net_api] API를 사용하든 상관없이 대부분 아래 설명된 엔터티와 기능을 사용하게 됩니다.

> [AZURE.TIP] 배치에 대한 보다 수준 높은 기술 개요는 [Azure 배치 기본 사항](batch-technical-overview.md)을 참조하세요.

## <a name="workflow"></a>배치 서비스의 워크플로

배치 서비스에서 개발된 거의 모든 분산 컴퓨팅 시나리오에는 일반적으로 다음과 같은 상위 수준 워크플로가 사용됩니다.

1. 분산 컴퓨팅 시나리오에서 사용할 *데이터 파일*을 [Azure 저장소][azure_storage] 계정에 업로드합니다. 이러한 파일은 배치 서비스에서 액세스할 수 있도록 저장소 계정에 있어야 합니다. 이러한 파일은 태스크가 실행될 때 [계산 노드](#computenode)에 다운로드됩니다.

2. 저장소 계정에 종속 *이진 파일*을 업로드합니다. 이러한 이진 파일에는 태스크 및 종속 어셈블리에서 실행되는 프로그램이 포함됩니다. 이러한 파일은 태스크에서 계산 노드에 다운로드할 수 있도록 저장소 계정에서도 액세스할 수 있어야 합니다.

3. 계산 노드 [풀](#pool)을 만듭니다. 풀을 만들 때 사용할 [계산 노드의 크기][cloud_service_sizes]를 지정합니다. 태스크가 실행될 때 이 풀의 노드가 할당됩니다.

4. [작업](#job)을 만듭니다. 작업을 사용하여 컬렉션 태스크를 관리할 수 있습니다.

5. 작업에 [태스크](#task)를 추가합니다. 각 태스크는 사용자가 업로드한 프로그램을 사용하여 저장소 계정에 업로드한 데이터 파일의 정보를 처리합니다.

6. 작업 진행 상황을 모니터링하고 결과를 검색합니다.

> [AZURE.NOTE] 배치 서비스를 사용하려면 [배치 계정](batch-account-create-portal.md)이 필요하며, 거의 모든 솔루션에서 파일 저장 및 검색에 [Azure 저장소][azure_storage] 계정을 사용합니다.

아래 섹션에서는 위 워크플로에 설명된 각 리소스와 분산 컴퓨팅 시나리오를 지원하는 배치의 다른 많은 기능을 알아봅니다.

## <a name="resource"></a>배치 서비스의 리소스

Azure 배치 서비스를 사용하는 경우 다음 리소스를 활용할 수 있습니다.

- [계정](#account)

- [계산 노드](#computenode)

- [풀](#pool)

- [작업](#job)

- [Task](#task)

	- [시작 태스크](#starttask)

	- [작업 관리자 태스크](#jobmanagertask)

	- [작업 준비 및 해제 태스크](#jobpreprelease)

	- [다중 인스턴스 작업](#multiinstance)

- [JobSchedule](#jobschedule)

### <a name="account"></a>계정

배치 계정은 배치 서비스 내에서 고유 하게 식별되는 엔터티입니다. 모든 처리는 배치 계정과 연결됩니다. 배치 서비스를 사용하여 작업을 수행하는 경우 계정 이름 및 계정 키가 필요합니다. 배치 계정을 만들려면 [Azure 포털에서 Azure 배치 계정 만들기 및 관리](batch-account-create-portal.md)를 확인하세요.

### <a name="computenode"></a>계산 노드

계산 노드는 응용 프로그램의 특정 워크로드를 전담하는 Azure 가상 컴퓨터입니다. 노드의 크기에 따라 노드에 할당되는 CPU 코어 수, 메모리 용량 및 로컬 파일 시스템 크기가 결정됩니다. 노드는 A0을 제외하고 [클라우드 서비스 노드 크기][cloud_service_sizes] 중 하나일 수 있습니다.

노드는 실행 파일(.exe), 명령(.cmd) 파일, 배치(.bat) 파일, PowerShell 스크립트 등의 실행 파일 및 스크립트를 실행할 수 있습니다. 또한 노드에는 다음과 같은 특성이 있습니다.

- 표준 **폴더 구조** 및 해당 경로를 자세히 설명하는 연관된 **환경 변수**가 각 계산 노드에 생성됩니다. 자세한 내용은 아래의 [파일 및 디렉터리](#files)를 참조하세요.
- 태스크에서 참조할 수 있는 **환경 변수**
- 액세스를 제어하도록 구성된 **방화벽** 설정
- 디버깅 등을 위해 계산 노드에 **원격 액세스**해야 하는 경우 RDP 파일을 가져온 다음 *원격 데스크톱*을 통해 노드에 액세스하는 데 사용할 수 있습니다.

### <a name="pool"></a>풀

풀은 응용 프로그램이 실행되는 노드 컬렉션입니다. 사용자가 풀을 만들 수도 있고, 완료할 작업을 지정한 경우에는 배치 서비스에서 자동으로 풀을 만듭니다. 응용 프로그램 요구 사항을 충족하는 풀을 만들고 관리할 수 있으며, 풀은 해당 풀을 만든 배치 계정에서만 사용할 수 있습니다. 하나의 배치 계정에는 둘 이상의 풀이 있을 수 있습니다.

Azure 배치 풀은 코어 Azure 계산 플랫폼을 기반으로 합니다. 배치 풀은 대규모 할당, 응용 프로그램, 데이터 설치, 상태 모니터링 및 풀 내의 유연한 계산 노드 수 조정(크기 조정) 기능을 제공합니다.

풀에 추가된 모든 노드에는 고유 이름 및 IP 주소가 할당됩니다. 노드가 풀에서 제거되면 운영 체제 또는 파일에 적용된 모든 변경 내용이 손실되며, 해당 이름 및 IP 주소가 나중에 사용할 수 있도록 해제됩니다. 노드가 풀에서 제거되면 수명이 끝납니다.

풀에 포함된 노드 간 통신을 허용하도록 풀을 구성할 수 있습니다. 내부 풀 통신이 필요하면 배치 서비스는 풀의 각 노드에서 1100보다 큰 포트를 허용합니다. 풀에 있는 각 노드는 이 포트 범위로 들어오는 연결 및 풀의 다른 노드에서 들어오는 연결만 허용합니다. 응용 프로그램에 노드 간 통신이 필요하지 않은 경우 배치 서비스는 잠재적으로 여러 다른 클러스터 및 데이터 센터의 많은 노드를 풀에 할당하여 병렬 처리 능력을 증가시킬 수 있습니다.

풀을 만들 때는 다음과 같은 특성을 지정할 수 있습니다.

- 풀에 포함된 **노드의 크기**
	- 노드에서 실행할 응용 프로그램의 특성 및 요구 사항을 고려하여 적절한 노드 크기를 선택해야 합니다. 노드 크기는 일반적으로 한 번에 하나의 태스크가 노드에서 실행되는 것으로 가정하여 선택됩니다. 응용 프로그램이 다중 스레드되었는지 여부 및 응용 프로그램에서 소비하는 메모리 양과 같은 측면을 고려하면 가장 적절하고 비용 효과적인 노드 크기를 결정하는 데 도움이 됩니다. 여러 태스크를 할당하고 여러 응용 프로그램 인스턴스를 병렬로 실행할 수 있으며, 이 경우 일반적으로 더 큰 노드가 선택됩니다. 자세한 내용은 아래의 "태스크 일정 정책"을 참조하세요.
	- 풀에 포함된 모든 노드의 크기가 같아야 합니다. 다른 시스템 요구 사항 및/또는 다른 부하 수준으로 다른 응용 프로그램을 실행하려는 경우 별도의 풀을 만들어야 합니다.
	- A0을 제외하고 모든 [클라우드 서비스 노드 크기][cloud_service_sizes]를 풀에 구성할 수 있습니다.

- 노드에서 실행되는 **운영 체제 제품군** 및 **버전**
	- 클라우드 서비스 내의 작업자 역할과 마찬가지로 *OS 제품군* 및 *OS 버전*을 지정할 수 있습니다(작업자 역할에 대한 자세한 내용은 *Azure에서 제공하는 계산 호스팅 옵션*의 [클라우드 서비스에 대한 설명][about_cloud_services] 섹션 참조).
	- OS 제품군은 OS와 함께 설치되는 .NET 버전도 결정합니다.
	- 작업자 역할과 마찬가지로, OS 버전에 대해 `*`를 지정하는 것이 좋습니다. 그러면 노드가 자동으로 업그레이드되며 새로 릴리스된 버전을 사용하는 데 필요한 조정 작업이 없습니다. 특정 OS 버전 선택의 기본 사용 사례는 버전을 업데이트하기 전에 이전 버전과의 호환성 테스트를 수행할 수 있게 하여 응용 프로그램 호환성을 유지하는 것입니다. 유효성이 검사되고 나면 풀의 OS 버전을 업데이트하고 새 OS 이미지를 설치할 수 있습니다. 실행 중인 태스크는 모두 중단되고 다시 큐에 대기됩니다.

- 풀에 사용할 수 있어야 하는 **노드 개수 목표**

- 풀에 대한 **크기 조정 정책**
	- 노드 수 외에 풀에 대한 [자동 크기 조정 수식](batch-automatic-scaling.md)을 지정할 수도 있습니다. 배치 서비스는 수식을 실행하여 사용자가 지정할 수 있는 여러 풀, 작업 및 태스크에 따라 풀 내의 노드 수를 조정합니다.

- **작업 일정** 정책
	- [노드당 최대 작업](batch-parallel-node-tasks.md) 구성은 풀 내의 각 노드에서 병렬로 실행할 수 있는 최대 태스크 수를 결정합니다.
	- 기본 구성은 계산 노드에서 한 번에 하나의 태스크를 실행하는 것이지만 노드에서 동시에 두 개 이상의 태스크를 실행하는 것이 효과적인 시나리오도 있습니다. 한 가지 예로, 응용 프로그램이 I/O를 대기해야 하는 경우 노드 사용률을 높이기 위한 시나리오를 들 수 있습니다. 둘 이상의 응용 프로그램을 동시에 실행하면 CPU 사용률이 증가합니다. 또 다른 예는 풀의 노드 수를 줄이는 것입니다. 이렇게 하면 대용량 참조 데이터 집합에 필요한 데이터 전송량을 줄일 수 있습니다. 응용 프로그램에 A1 노드 크기가 충분한 경우 대신 A4 노드 크기를 선택하고 각각 코어를 사용하는 8개의 병렬 태스크에 대해 풀을 구성할 수 있습니다.
	- "채우기 유형"을 지정할 수도 있습니다. 이는 태스크를 풀의 다른 노드에 할당하기 전에 배치에서 태스크를 모든 노드에 균등하게 분산시킬지 또는 각 노드를 최대 태스크 수로 패키지할지를 결정합니다.

- 풀에 포함된 노드의 **통신 상태**
	- 풀의 노드 간에 통신을 허용하도록 풀을 구성할 수 있습니다. 이 구성에 따라 기본 네트워크 인프라가 결정됩니다. 이는 클러스터 내의 노드 배치에도 영향을 줍니다.
	- 대부분의 시나리오에서는 태스크가 독립적으로 작동하고 다른 태스크와 통신할 필요가 없지만, 태스크가 통신해야 하는 일부 응용 프로그램도 있습니다.

- 풀에 포함된 노드의 **시작 태스크**
	- 계산 노드가 풀에 연결될 때마다, 그리고 노드가 다시 시작될 때마다 실행되는 *시작 태스크*를 지정할 수 있습니다. 이는 종종 노드에서 실행 중인 태스크에서 사용할 응용 프로그램을 설치하는 데 사용됩니다.

### <a name="job"></a>작업

작업은 태스크의 컬렉션이며, 풀의 계산 노드에 수행된 계산 방식을 지정합니다.

- 작업은 작업이 실행되는 **풀**을 지정합니다. 풀은 이전에 생성되어 많은 작업에서 사용되는 기존 풀일 수 있습니다. 또는 작업 일정과 연결된 각 작업이나 작업 일정과 연결된 모든 작업에 대해 요청 시 풀을 만들 수도 있습니다.
- 선택적 **작업 우선 순위**를 지정할 수 있습니다. 현재 진행 중인 다른 작업보다 높은 우선 순위로 작업을 제출하면 높은 우선 순위 작업의 태스크가 낮은 우선 순위 작업 태스크보다 먼저 큐에 삽입됩니다. 이미 실행 중인 낮은 우선 순위 태스크는 선취되지 않습니다.
- 작업 **제약 조건**은 작업에 대한 특정 제한을 지정합니다.
	- 작업에 대해 **최대 벽시계 시간**을 설정할 수 있습니다. 지정된 최대 벽시계 시간보다 오랫동안 작업이 실행되면 작업 및 연결된 모든 태스크가 종료됩니다.
	- Azure 배치는 실패한 태스크를 검색하고 태스크를 다시 시도할 수 있습니다. 태스크가 항상 다시 시도되거나 다시 시도되지 않도록 지정하는 것을 포함하여 **태스크 다시 시도 최대 횟수**를 제약 조건으로 지정할 수 있습니다. 태스크 다시 시도는 태스크가 다시 실행되기 위해 다시 큐에 대기되는 것을 의미합니다.
- 클라이언트 응용 프로그램에서 작업에 태스크를 추가하거나, [작업 관리자 태스크](#jobmanagertask)를 지정할 수 있습니다. 작업 관리자 태스크는 배치 API를 사용하며, 풀 내의 계산 노드 중 하나에서 태스크를 실행하여 작업에 필요한 태스크를 만드는 데 필요한 정보를 포함합니다. 작업 관리자 태스크는 배치에서 특별히 처리되며, 작업이 생성되는 즉시 큐에 대기되고 실패할 경우 다시 시작됩니다. 작업 관리자 태스크는 작업이 인스턴스화되기 전에 태스크를 정의할 수 있는 유일한 방법이므로 작업 스케줄에서 만든 작업에 대해 필요합니다. 작업 관리자 작업에 대한 자세한 내용은 아래에 나와 있습니다.


### <a name="task"></a>태스크

태스크는 작업과 연결되고 노드에서 실행되는 계산의 단위입니다. 태스크는 실행을 위해 노드에 할당되거나, 노드를 사용할 수 있을 때까지 큐에 대기됩니다. 태스크는 다음 리소스를 사용합니다.

- 태스크의 **명령줄**에 지정된 응용 프로그램

- 처리할 데이터를 포함하는 **리소스 파일**. 이러한 파일은 Azure 저장소 계정의 Blob 저장소에서 노드로 자동으로 복사됩니다. 자세한 내용은 아래의 [파일 및 디렉터리](#files)를 참조하세요.

- 응용 프로그램에 필요한 **환경 변수**. 자세한 내용은 아래의 [태스크에 대한 환경 설정](#environment)을 참조하세요.

- 계산이 수행되어야 하는 **제약 조건**. 예를 들어 태스크가 실행되도록 할당된 최대 시간, 태스크가 실패한 경우 다시 시도되는 최대 횟수 및 작업 디렉터리에 파일을 보관하는 최대 시간이 여기에 해당합니다.

노드에서 계산을 수행하도록 정의하는 태스크 외에 다음과 같은 특수한 태스크도 배치 서비스에서 제공됩니다.

- [시작 태스크](#starttask)
- [작업 관리자 태스크](#jobmanagertask)
- [작업 준비 및 해제 태스크](#jobmanagertask)
- [다중 인스턴스 작업](#multiinstance)

#### <a name="starttask"></a>시작 태스크

**시작 태스크**를 풀과 연결하여 해당 노드의 운영 체제를 구성할 수 있습니다. 소프트웨어 설치 및 백그라운드 프로세스 시작은 시작 태스크가 수행할 수 있는 일부 동작입니다. 시작 태스크는 노드가 풀에 처음 추가된 경우를 포함하여 풀에 남아 있는 한, 노드가 시작될 때마다 실행됩니다. 시작 태스크의 주요 이점은 계산 노드를 구성하고 작업 태스크 실행에 필요한 응용 프로그램을 설치하는 데 필요한 모든 정보를 포함하고 있다는 것입니다. 따라서 풀의 노드 수를 늘리려면 새 목표 노드 수를 지정하기만 하면 됩니다. 새 노드를 구성하고 태스크를 적용하도록 준비하는 데 필요한 모든 정보가 배치에 이미 있습니다.

모든 배치 태스크와 마찬가지로, 실행할 **명령줄** 외에 [Azure 저장소][azure_storage]의 **리소스 파일** 목록을 지정할 수 있습니다. Azure 배치는 먼저 Azure 저장소에서 파일을 복사한 다음 명령줄을 실행합니다. 풀 시작 태스크의 경우 일반적으로 파일 목록에 응용 프로그램 패키지 또는 파일이 포함되지만, 계산 노드에서 실행되는 모든 태스크에 사용할 참조 데이터가 포함될 수도 있습니다. 예를 들어 시작 태스크의 명령줄에서 PowerShell 스크립트를 실행하거나 `robocopy` 작업을 수행하여 응용 프로그램 파일을 "공유" 폴더에 복사한 다음 MSI 또는 `setup.exe`를 실행할 수 있습니다.

일반적으로 배치 서비스에서 시작 태스크가 완료되기를 기다린 후 노드에 태스크를 할당할 준비가 되었다고 간주하는 것이 좋지만 이는 구성 가능합니다.

계산 노드에서 시작 태스크가 실패하면 노드 상태가 실패를 반영하여 업데이트되고 노드에 태스크를 할당할 수 없습니다. 저장소에서 해당 리소스 파일을 복사하는 동안 문제가 발생하거나 해당 명령줄에서 실행된 프로세스에서 0이 아닌 종료 코드를 반환하면 시작 태스크가 실패할 수 있습니다.

#### <a name="jobmanagertask"></a>작업 관리자 태스크

**작업 관리자 태스크**는 일반적으로 작업 실행을 제어 및/또는 모니터링하는 데 사용됩니다. 예를 들어 작업에 대한 태스크 만들기 및 제출, 실행할 추가 태스크 결정, 작업이 완료된 시점 확인 등에 사용됩니다. 작업 관리자 태스크는 이러한 작업으로 제한되지 않으며, 작업에 필요한 모든 동작을 수행할 수 있는 완전한 태스크입니다. 예를 들어 작업 관리자 태스크는 매개 변수로 지정된 파일을 다운로드하고, 해당 파일의 내용을 분석하고, 이러한 내용에 따라 추가 태스크를 제출할 수 있습니다.

작업 관리자 태스크는 다른 모든 작업이 시작되기 전에 시작되며, 다음과 같은 기능을 제공합니다.

- 작업이 만들어질 때 배치 서비스에서 태스크로 자동으로 제출됩니다.

- 작업의 다른 태스크보다 먼저 실행되도록 예약됩니다.

- 풀 크기를 줄일 경우 연결된 해당 노드가 풀에서 마지막으로 제거됩니다.

- 해당 종료는 작업의 모든 태스크에 대한 종료에 연결될 수 있습니다.

- 작업 관리자 태스크는 다시 시작해야 할 경우 가장 높은 우선 순위가 지정됩니다. 유휴 노드를 사용할 수 없는 경우 배치 서비스는 풀에서 실행 중인 다른 태스크 중 하나를 종료하여 작업 관리자 태스크를 실행할 공간을 확보할 수 있습니다.

- 작업의 작업 관리자 태스크는 다른 작업의 태스크보다 우선 순위가 높지 않습니다. 작업 간에는 작업 수준 우선 순위만 준수됩니다.

#### <a name="jobpreprelease"></a>작업 준비 및 해제 태스크

배치에서는 사전 작업 실행 설정을 위한 작업 준비 태스크 및 사후 작업 유지 관리 또는 정리를 위한 작업 해제 태스크를 제공합니다.

- **작업 준비 태스크** - 작업 준비 태스크는 다른 모든 작업 태스크가 실행되기 전에 태스크를 실행하도록 예약된 모든 계산 노드에서 실행됩니다. 예를 들어 작업 준비 태스크를 사용하여 모든 태스크에서 공유하는 데이터를 복사할 수 있지만 작업에 고유해야 합니다.
- **작업 해제 태스크** - 작업이 완료된 경우 하나 이상의 태스크를 실행한 풀의 각 노드에서 작업 해제 태스크가 실행됩니다. 예를 들어 작업 해제 태스크를 사용하여 작업 준비 태스크에서 복사한 데이터를 삭제하거나, 진단 로드 데이터를 압축 및 업로드할 수 있습니다.

작업 준비 태스크와 작업 해제 태스크 모두 태스크가 호출될 때 실행할 명령줄을 지정하고, 파일 다운로드, 관리자 권한 실행, 사용자 지정 환경 변수, 최대 실행 기간, 다시 시도 횟수 및 파일 보존 시간과 같은 기능을 제공할 수 있습니다.

작업 준비 및 해제 태스크에 대한 자세한 내용은 [Azure 배치 계산 노드에서 작업 준비 및 완료 태스크 실행](batch-job-prep-release.md)을 참조하세요.

#### <a name="multiinstance"></a>다중 인스턴스 작업

[다중 인스턴스 작업](batch-mpi.md)은 둘 이상의 계산 노드에서 동시에 실행될 수 있도록 구성된 작업입니다. 다중 인스턴스 작업과 함께 컴퓨터 노드 그룹에 함께 할당되어야 하는 MPI(Message Passing Interface)와 같은 고성능 컴퓨팅 시나리오를 사용하여 단일 워크로드를 처리할 수 있습니다.

Batch .NET 라이브러리를 사용하여 일괄 처리에서 MPI 작업 실행에 대한 자세한 내용은 [다중 인스턴스 작업을 사용하여 Azure 배치에서 MPI(Message Passing Interface) 응용 프로그램 실행](batch-mpi.md)을 확인합니다.

### <a name="jobschedule"></a>예약된 작업

작업 일정을 사용하여 배치 서비스 내에서 되풀이되는 작업을 만들 수 있습니다. 작업 일정은 작업을 실행할 시간을 지정하며, 실행할 작업에 대한 사양을 포함합니다. 작업 일정에서는 일정의 기간(일정이 적용되는 시점 및 기간) 및 해당 기간 동안 작업을 만들어야 하는 빈도에 대한 사양을 지정할 수 있습니다.

## <a name="files"></a>파일 및 디렉터리

각 태스크에는 태스크에 의해 실행되는 프로그램, 태스크에 의해 처리되는 데이터 및 태스크가 수행한 처리의 출력을 저장하기 위한 0개 이상의 파일 및 디렉터리가 만들어지는 작업 디렉터리가 있습니다. 이러한 파일 및 디렉터리는 한 작업을 실행하는 동안 다른 태스크에서 사용될 수 있습니다. 노드의 모든 작업, 파일 및 디렉터리는 단일 사용자 계정에 의해 소유됩니다.

배치 서비스는 노드의 파일 시스템 일부를 “루트 디렉터리”로 노출합니다. 루트 디렉터리는 `%AZ_BATCH_NODE_ROOT_DIR%` 환경 변수를 통해 태스크에 사용될 수 있습니다. 환경 변수 사용에 대한 자세한 내용은 [태스크에 대한 환경 설정](#environment)을 참조하세요.

![계산 노드 디렉터리 구조][1]

루트 디렉터리는 다음과 같은 디렉터리 구조를 포함합니다.

- **공유** – 이 위치는 작업에 상관없이 노드에서 실행되는 모든 태스크에 대한 공유 디렉터리입니다. 노드에서 공유 디렉터리는 `%AZ_BATCH_NODE_SHARED_DIR%`을 통해 액세스합니다. 이 디렉터리는 노드에서 실행되는 모든 태스크에 대한 읽기/쓰기 액세스를 제공합니다. 태스크는 이 디렉터리에서 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있습니다.

- **시작** - 이 위치는 시작 태스크에서 작업 디렉터리로 사용됩니다. 시작 태스크를 시작하기 위해 배치 서비스에서 다운로드한 모든 파일도 이 디렉터리 아래에 저장됩니다. 노드에서 시작 디렉터리는 `%AZ_BATCH_NODE_START_DIR%`을 통해 사용할 수 있습니다. 시작 태스크는 이 디렉터리 아래에서 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있으며 이 디렉터리는 시작 태스크가 운영 체제를 구성하는 데 사용할 수 있습니다.

- **태스크** - 노드에서 실행되는 각 태스크에 대해 `%AZ_BATCH_TASK_DIR%`을 통해 액세스할 수 있는 디렉터리가 만들어집니다. 각 태스크 디렉터리 내에서 배치 서비스는 `%AZ_BATCH_TASK_WORKING_DIR%` 환경 변수에 의해 고유 경로가 지정되는 작업 디렉터리(`wd`)를 만듭니다. 이 디렉터리는 태스크에 대한 읽기/쓰기 액세스를 제공합니다. 이 디렉터리 아래에서 태스크는 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있으며 이 디렉터리는 태스크에 대해 지정된 *RetentionTime* 제약 조건에 따라 유지됩니다.
  - `stdout.txt` 및 `stderr.txt` - 이러한 파일은 태스크를 실행하는 동안 태스크 폴더에 기록됩니다.

풀에서 노드가 제거되면 노드에 저장된 모든 파일이 제거됩니다.

## <a name="lifetime"></a>풀 및 계산 노드 수명

Azure 배치 솔루션을 디자인할 때 디자인 결정은 풀을 만드는 방법 및 시기와 해당 풀 내의 계산 노드를 사용 가능한 상태로 유지할 기간을 고려하여 이루어져야 합니다.

하나의 극단적인 예로, 작업이 제출될 때 각 작업에 대해 풀을 만들고 태스크 실행이 완료되는 즉시 해당 노드를 제거할 수 있습니다. 이 경우 노드가 반드시 필요할 때만 할당되고 유휴 상태가 되는 즉시 종료되므로 사용률이 극대화됩니다. 이는 작업에서 노드가 할당되기를 기다려야 한다는 의미는 아니지만 노드가 개별적으로 사용 가능하고, 할당되고, 시작 태스크가 완료되는 즉시 노드에 태스크가 예약되는 것에 주의해야 합니다. 즉, 배치는 사용 가능한 모든 노드의 최대 사용률을 보장하기 위해 태스크를 할당하기 전에 풀 내의 모든 노드가 사용 가능할 때까지 기다리지 *않습니다*.

또 다른 극단적인 예로, 작업을 즉시 시작하는 것이 우선 순위가 가장 높은 경우 미리 풀을 만들고 작업이 제출되기 전에 해당 노드를 사용할 수 있습니다. 이 시나리오에서는 작업 태스크를 즉시 시작할 수 있지만, 노드가 유휴 상태로 태스크가 할당되기를 기다릴 수 있습니다.

일반적으로 가변적이지만 지속적인 부하를 처리하는 사용되는 통합 접근 방식은 여러 작업이 제출되는 하나의 풀을 사용하되 부하에 따라 노드 수를 확장하거나 축소하는 것입니다(아래 *응용 프로그램 크기 조정* 참조). 이는 현재 부하에 따라 사후 대응적으로 수행하거나 부하를 예측할 수 있는 경우 사전 대응적으로 수행할 수 있습니다.

## <a name="scaling"></a>응용 프로그램 크기 조정

[자동 크기 조정](batch-automatic-scaling.md)을 사용하면 필요한 계산을 수용하도록 응용 프로그램을 자동으로 쉽게 확장하거나 축소할 수 있습니다. 현재 워크로드 및 리소스 사용량 통계에 따라 풀의 노드 수를 동적으로 조정할 수 있습니다. 이를 통해 필요한 리소스만 사용하여 전반적인 응용 프로그램 실행 비용을 절감할 수 있습니다. 풀이 만들어질 때 크기 조정 설정을 지정할 수 있고 언제든지 이 구성을 업데이트할 수 있습니다.

노드 수를 자동으로 줄이는 경우 현재 실행 중인 태스크를 고려해야 합니다. 노드를 즉시 제거하기 위해 실행 중인 태스크를 중지할지 여부나 노드가 제거되기 전에 태스크를 완료할 수 있도록 허용할지 여부를 결정하는 할당 취소 정책을 지정합니다. 작업을 마칠 때 목표 노드 수를 0으로 설정하지만 실행 중인 태스크를 완료할 수 있도록 허용하면 사용률이 극대화됩니다.

일련의 크기 조정 수식을 지정하여 응용 프로그램의 자동 크기 조정을 지정합니다. 다음 크기 조정 간격에 대해 풀에 있는 노드의 목표 수를 확인하는 데 이러한 수식을 사용할 수 있습니다. 예를 들어 작업에서 실행을 예약할 많은 태스크를 제출해야 할 수 있습니다. 현재 보류 중인 태스크 수 및 이러한 태스크의 완료율에 따라 풀의 크기(노드 수)를 지정하는 크기 조정 수식을 풀에 할당할 수 있습니다. 배치 서비스는 수식을 정기적으로 계산하고 워크로드에 따라 풀 크기를 조정합니다.

크기 조정 수식은 다음 메트릭을 기반으로 할 수 있습니다.

- **시간 메트릭** - 지정된 시간 동안 5분 간격으로 수집되는 통계를 기반으로 합니다.

- **리소스 메트릭** - CPU 사용량, 대역폭 사용량, 메모리 사용량 및 노드 수를 기반으로 합니다.

- **태스크 메트릭** - 활성, 보류 중 및 완료됨과 같은 태스크 상태를 기반으로 합니다.

자동으로 응용 프로그램 크기를 조정하는 방법에 대한 자세한 내용은 [Azure 배치 풀에서 자동으로 계산 노드 크기 조정](batch-automatic-scaling.md)을 참조하세요.

> [AZURE.TIP]
 자주 필요하지는 않지만, 풀에서 제거할 개별 노드를 지정할 수 있습니다. 예를 들어 신뢰할 수 없는 것으로 의심되는 노드가 있는 경우 풀에서 제거하여 추가 태스크가 할당되는 것을 방지할 수 있습니다.

## <a name="cert"></a>인증서를 사용한 보안

일반적으로 태스크에 대한 중요한 정보(예: [Azure 저장소 계정][azure_storage]의 키)를 암호화하거나 암호를 해독할 때는 인증서를 사용해야 합니다. 이를 지원하기 위해 노드에 인증서를 설치할 수 있습니다. 암호화된 암호는 명령줄 매개 변수를 통해 태스크에 전달되거나 태스크 리소스 중 하나에 포함되며 암호를 해독하는 데 설치된 인증서를 사용할 수 있습니다.

[인증서 추가][rest_add_cert] 작업(Batch REST API) 또는 [CertificateOperations.CreateCertificate][net_create_cert] 메서드(Batch .NET API)를 사용하여 배치 계정에 인증서를 추가할 수 있습니다. 그런 다음 인증서를 기존 풀이나 새 풀에 연결할 수 있습니다. 인증서가 풀에 연결되면 배치 서비스가 풀의 각 노드에 인증서를 설치합니다. 배치 서비스는 노드가 시작되면 시작 태스크 및 작업 관리자 태스크를 포함하여 모든 태스크를 시작하기 전에 해당 인증서를 설치합니다.

## <a name="scheduling"></a>예약 우선 순위

배치에서 만드는 작업에 우선 순위를 할당할 수 있습니다. 배치 서비스는 작업의 우선 순위 값을 사용하여 계정 내의 작업 예약 순서를 결정합니다. 우선 순위 값의 범위는 -1000에서 1000까지이며 -1000이 가장 낮은 우선 순위를, 1000이 가장 높은 우선 순위를 나타냅니다. [작업 속성 업데이트][rest_update_job] 작업(Batch REST API)을 사용하거나 [CloudJob.Priority][net_cloudjob_priority] 속성(Batch .NET API)을 수정하여 작업의 우선 순위를 업데이트할 수 있습니다.

동일한 계정 내에서 우선 순위가 높은 작업은 우선 순위가 낮은 작업보다 먼저 예약됩니다. 하나의 계정에서 우선 순위가 더 높은 작업이 다른 계정에서 우선 순위가 더 낮은 다른 작업보다 먼저 예약되는 것은 아닙니다.

풀 간의 예약 작업은 서로 별개입니다. 여러 다른 풀이 있을 때 연결된 풀에 유휴 노드가 부족한 경우 우선 순위가 높은 작업이 먼저 예약된다고 보장할 수 없습니다. 동일한 풀에서는 우선 순위가 같은 작업이 예약될 기회가 동일합니다.

## <a name="environment"></a>태스크에 대한 환경 설정

배치 작업 내에서 실행되는 각 태스크는 배치 서비스에 의해 설정된 환경 변수(시스템 정의, 아래 표 참조)와 사용자 정의 환경 변수 모두에 액세스할 수 있습니다. 계산 노드에서 태스크에 의해 실행되는 응용 프로그램 및 스크립트는 노드에서 실행되는 동안 이러한 환경 변수에 액세스할 수 있습니다.

사용자 정의 환경 변수는 [작업에 태스크 추가][rest_add_task] 작업(Batch REST API)을 사용하거나, 작업에 태스크를 추가할 때 [CloudTask.EnvironmentSettings][net_cloudtask_env] 속성(Batch .NET API)을 수정하여 설정합니다.

태스크의 환경 변수(시스템 정의 및 사용자 정의)를 가져오려면 [태스크에 대한 정보 가져오기][rest_get_task_info] 작업(Batch REST API)을 사용하거나 [CloudTask.EnvironmentSettings][net_cloudtask_env] 속성(Batch .NET API)에 액세스합니다. 앞서 설명했듯이, 계산 노드에서 실행되는 프로세스는 친숙한 `%VARIABLE_NAME%` 구문 등을 사용하여 모든 환경 변수에 액세스할 수도 있습니다.

작업 내에 예약된 모든 태스크에 대해 배치 서비스에서 설정되는 시스템 정의 환경 변수 집합은 다음과 같습니다.

| 환경 변수 이름 | 설명 |
|---------------------------------|--------------------------------------------------------------------------|
| `AZ_BATCH_ACCOUNT_NAME` | 태스크가 속한 계정의 이름 |
| `AZ_BATCH_JOB_ID` | 태스크가 속한 작업의 ID |
| `AZ_BATCH_JOB_PREP_DIR` | 노드의 작업 준비 태스크 디렉터리 전체 경로 |
| `AZ_BATCH_JOB_PREP_WORKING_DIR` | 노드의 작업 준비 태스크 작업 디렉터리 전체 경로 |
| `AZ_BATCH_NODE_ID` | 태스크가 실행되는 노드의 ID |
| `AZ_BATCH_NODE_ROOT_DIR` | 노드의 루트 디렉터리 전체 경로 |
| `AZ_BATCH_NODE_SHARED_DIR` | 노드의 공유 디렉터리 전체 경로 |
| `AZ_BATCH_NODE_STARTUP_DIR` | 노드의 계산 노드 시작 태스크 디렉터리 전체 경로 |
| `AZ_BATCH_POOL_ID` | 태스크가 실행되는 풀의 ID |
| `AZ_BATCH_TASK_DIR` | 노드의 태스크 디렉터리 전체 경로 |
| `AZ_BATCH_TASK_ID` | 현재 태스크의 ID |
| `AZ_BATCH_TASK_WORKING_DIR` | 노드의 태스크 작업 디렉터리 전체 경로 |

>[AZURE.NOTE] 위 시스템 정의 변수는 덮어쓸 수 없습니다. 읽기 전용입니다.

## <a name="errorhandling"></a>오류 처리

배치 솔루션 내에서 태스크 오류와 응용 프로그램 오류를 모두 처리해야 할 수 있습니다.

### 태스크 오류 처리
태스크 오류는 다음 범주로 분류됩니다.

- **예약 오류**
	- 태스크에 대해 지정된 파일의 전송이 어떤 이유로든 실패한 경우 해당 태스크에 대해 “예약 오류”가 설정됩니다.
	- 예약 오류는 파일이 이동되었거나, 저장소 계정을 더 이상 사용할 수 없거나, 노드에 파일을 복사하지 못하도록 하는 다른 문제가 발생했기 때문에 발생할 수 있습니다.
- **응용 프로그램 오류**
	- 태스크의 명령줄에서 지정된 프로세스도 실패할 수 있습니다. 태스크가 실행한 프로세스에서 0이 아닌 종료 코드가 반환되면 프로세스가 실패한 것으로 간주됩니다.
	- 응용 프로그램 오류의 경우 지정된 횟수까지 자동으로 태스크를 다시 시도하도록 배치를 구성할 수 있습니다.
- **제약 조건 오류**
	- 작업 또는 태스크의 최대 실행 기간을 지정하는 제약 조건(*maxWallClockTime*)을 지정할 수 있습니다. 이 기능은 “응답이 없는” 태스크를 종료하는 데 유용할 수 있습니다.
	- 최대 기간을 초과하면 태스크가 *완료됨*으로 표시되지만 종료 코드가 `0xC000013A`로 설정되고 *schedulingError* 필드가 `{ category:"ServerError", code="TaskEnded"}`로 표시됩니다.

### 응용 프로그램 오류 디버그

실행하는 동안 응용 프로그램에서 문제를 해결하는 데 사용할 수 있는 진단 출력을 생성할 수 있습니다. 위의 [파일 및 디렉터리](#files)에서 설명했듯이, 배치 서비스는 계산 노드의 태스크 디렉터리에 있는 `stdout.txt` 및 `stderr.txt` 파일로 stdout 및 stderr 출력을 보냅니다. Batch .NET API에서 [ComputeNode.GetNodeFile][net_getfile_node] 및 [CloudTask.GetNodeFile][net_getfile_task]을 사용하면 문제 해결을 위해 이러한 파일 및 다른 파일을 검색할 수 있습니다.

*원격 데스크톱*을 사용하여 계산 노드에 로그인하면 훨씬 광범위한 디버그를 수행할 수 있습니다. [노드에서 원격 데스크톱 프로토콜 파일을 가져오거나][rest_rdp](Batch REST API), [ComputeNode.GetRDPFile][net_rdp] 메서드(Batch .NET API)를 원격 로그인에 사용할 수 있습니다.

>[AZURE.NOTE] RDP를 통해 노드에 연결하려면 먼저 해당 노드에서 사용자를 만들어야 합니다. Batch REST API에서 [노드에 사용자 계정을 추가][rest_create_user]하거나, Batch .NET에서 [ComputeNode.CreateComputeNodeUser][net_create_user] 메서드를 사용합니다.

### 태스크 실패 또는 중단에 대한 조정

간혹 태스크가 실패하거나 중단될 수 있습니다. 태스크 응용 프로그램 자체가 실패하거나, 태스크를 실행 중인 노드가 다시 부팅되거나, 풀의 할당 취소 정책이 태스크가 완료되기를 기다리지 않고 즉시 노드를 제거하도록 설정된 상태에서 크기 조정 작업 중에 풀에서 노드가 제거되었을 수 있습니다. 어떤 경우든지 태스크는 다른 노드에서 실행되도록 배치에 의해 자동으로 큐에 다시 대기할 수 있습니다.

일시적인 문제로 인해 태스크가 응답하지 않거나 실행하는 데 너무 오래 걸릴 수도 있습니다. 태스크에 대해 최대 실행 시간을 설정할 수 있으며, 초과할 경우 배치가 태스크 응용 프로그램을 중단합니다.

### "잘못된" 노드에 대한 조정

풀의 각 노드에는 고유 ID가 지정되며, 태스크가 실행되는 노드는 태스크 메타데이터에 포함됩니다. 특정 노드에서 태스크가 실패한 경우 배치 클라이언트 응용 프로그램에서 이를 확인할 수 있으며, 의심되는 노드를 풀에서 삭제할 수 있습니다. 삭제된 노드에서 실행 중인 태스크가 있는 경우 이러한 태스크는 다른 노드에서 실행되도록 자동으로 큐에 다시 대기됩니다.

## 다음 단계

- [.NET용 Azure 배치 라이브러리 시작](batch-dotnet-get-started.md)의 단계에 따라 첫 번째 배치 응용 프로그램을 만듭니다.
- 배치 솔루션을 개발하는 동안 사용할 [Batch Explorer][batch_explorer_project] 샘플 프로젝트를 다운로드하여 빌드합니다. Batch Explorer를 사용하여 다음과 같은 작업을 수행할 수 있습니다.
  - 배치 계정 내에서 풀, 작업 및 태스크 모니터링 및 조작
  - 노드에서 `stdout.txt`, `stderr.txt` 및 기타 파일 다운로드
  - 노드에서 사용자를 만들고 원격 로그인을 위한 RDP 파일 다운로드

[1]: ./media/batch-api-basics/node-folder-structure.png

[about_cloud_services]: https://azure.microsoft.com/documentation/articles/fundamentals-application-models/#tell-me-about-cloud-services
[azure_storage]: https://azure.microsoft.com/services/storage/
[batch_explorer_project]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/BatchExplorer
[cloud_service_sizes]: https://azure.microsoft.com/documentation/articles/cloud-services-sizes-specs/
[msmpi]: https://msdn.microsoft.com/library/bb524831.aspx

[batch_net_api]: https://msdn.microsoft.com/library/azure/mt348682.aspx
[net_cloudjob_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.jobmanagertask.aspx
[net_cloudjob_priority]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.priority.aspx
[net_cloudpool_starttask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.starttask.aspx
[net_cloudtask_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.environmentsettings.aspx
[net_create_cert]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.certificateoperations.createcertificate.aspx
[net_create_user]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.createcomputenodeuser.aspx
[net_getfile_node]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getnodefile.aspx
[net_getfile_task]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.getnodefile.aspx
[net_multiinstancesettings]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.multiinstancesettings.aspx
[net_rdp]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getrdpfile.aspx

[batch_rest_api]: https://msdn.microsoft.com/library/azure/Dn820158.aspx
[rest_add_job]: https://msdn.microsoft.com/library/azure/mt282178.aspx
[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx
[rest_add_cert]: https://msdn.microsoft.com/library/azure/dn820169.aspx
[rest_add_task]: https://msdn.microsoft.com/library/azure/dn820105.aspx
[rest_create_user]: https://msdn.microsoft.com/library/azure/dn820137.aspx
[rest_get_task_info]: https://msdn.microsoft.com/library/azure/dn820133.aspx
[rest_multiinstance]: https://msdn.microsoft.com/ko-KR/library/azure/mt637905.aspx
[rest_multiinstancesettings]: https://msdn.microsoft.com/library/azure/dn820105.aspx#multiInstanceSettings
[rest_update_job]: https://msdn.microsoft.com/library/azure/dn820162.aspx
[rest_rdp]: https://msdn.microsoft.com/library/azure/dn820120.aspx

<!---HONumber=AcomDC_0224_2016-->