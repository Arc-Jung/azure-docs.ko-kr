<properties 
	pageTitle="Azure 배치에 대한 API 기본 사항" 
	description="개발자에게 Azure 일괄 처리 API 및 일괄 처리 서비스를 소개하는 개념" 
	services="batch" 
	documentationCenter=".net" 
	authors="yidingzhou" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="batch" 
	ms.devlang="multiple" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="big-compute" 
	ms.date="03/19/2015" 
	ms.author="yidingz"/>

<!--The next line, with one pound sign at the beginning, is the page title-->
# Azure 배치에 대한 API 기본 사항

Azure 배치 서비스는 확장 가능한 분산 계산을 위한 작업 예약 프레임워크를 제공합니다. 이 배치 서비스는 Azure에서 여러 클러스터 및 데이터 센터에 위치한 가상 컴퓨터 집합을 유지 관리합니다. 이 배치 서비스는 요청 시에 또는 이러한 지정된 VM 컬렉션에 대해 특정 시간에 실행되도록 예약된 하나 이상의 프로그램을 실행하여 분산 계산을 수행합니다. 배치 서비스는 리소스 요구 사항, 사양 및 사용자가 제공한 제약 조건에 따라 계산 태스크가 실행되도록 이러한 VM을 관리합니다.

배치 서비스를 사용하면 계산 리소스의 큐 대기, 예약, 할당 및 관리를 위한 코드를 작성할 필요가 없습니다. 이 서비스를 사용하면 기본 플랫폼에서 진행되는 작업 예약 및 리소스 관리의 복잡성에 대해 걱정하지 않고 특정 응용 프로그램에 집중할 수 있습니다. 또한 배치 서비스를 통해 이러한 작업의 위치 뿐 아니라 처리해야 하는 데이터에 대한 액세스도 최적화할 수 있습니다.

다음은 배치 서비스를 사용할 때 가능한 일부 시나리오입니다.

- 계산이 많은 병렬 처리

- 파일의 일별 정리

- 일괄 처리

## <a name="resource"></a> 일괄 처리 서비스의 리소스

배치 서비스를 사용하는 경우 다음 리소스를 활용할 수 있습니다.

- [계정](#account)

- [가상 컴퓨터 작업](#taskvm)

- [풀](#pool)

- [작업 항목](#workitem)

- [작업](#job)

- [Task](#task)

	- [작업 시작](#starttask)
	
	- [작업 ManagerTask](#jobmanagertask)

### <a name="account"></a>계정

배치 계정은 배치 서비스 내에서 고유 하게 식별되는 엔터티입니다. 모든 처리는 배치 계정을 통해 수행됩니다. 배치 서비스를 사용하여 작업을 수행할 때 계정의 이름 및 키가 필요합니다. 일괄 처리 계정을 만들려면의 일괄 처리 계정 섹션을 참조 [Azure 일괄 처리 개요][].


### <a name="taskvm"></a>가상 컴퓨터 작업

TVM(태스크용 가상 컴퓨터)은 응용 프로그램의 특정 작업을 전담하는 Azure VM입니다. TVM의 크기에 따라 TVM에 할당되는 CPU 코어 수, 메모리 용량 및 로컬 파일 시스템 크기가 결정됩니다. 설명한 대로 TVM 작은, 대형 또는 extralarge 가상 컴퓨터 수 [가상 컴퓨터와 Azure 클라우드 서비스 크기](http://msdn.microsoft.com/library/dn197896.aspx).

TVM이 실행할 수 있는 프로그램의 종류에는 실행 파일(.exe), 명령 파일(.cmd), 배치 파일(.bat) 및 스크립트 파일이 포함됩니다. 또한 TVM에는 다음과 같은 특성이 있습니다.

- 작업별와 공유 되는 파일 시스템 폴더입니다. 폴더 구조 및 환경 변수는 각 풀 VM에 만들어집니다. 응용 프로그램 및 작업을 더한 각 작업에 대 한 폴더 간에 공유 되는 데이터에 대 한 "공유" 폴더와 함께 다음 폴더 구조가 만들어집니다.

![][1]

- 태스크별 폴더에 기록되는 Stdout.txt 및 stderr.txt 파일

- 처리를 위한 환경 변수

- 액세스를 제어하도록 구성된 방화벽 설정

>VM 액세스
>
>VM에 대 한 액세스를 같은 디버깅 해야하는 경우에 사용할 수 있는 다음 원격 데스크톱을 통해 VM에 액세스 하려면 RDP 파일을 가져올 수 있습니다.


### <a name="pool"></a>풀

풀은 응용 프로그램이 실행되는 TVM 컬렉션입니다. 사용자가 풀을 만들 수도 있고, 완료할 작업을 지정한 경우에는 배치 서비스에서 자동으로 풀을 만듭니다. 응용 프로그램의 요구를 충족하는 풀을 만들고 관리할 수 있습니다. 풀은 풀이 생성된 배치 계정을 통해서만 사용할 수 있습니다. 하나의 배치 계정에는 둘 이상의 풀이 있을 수 있습니다.

일괄 처리 풀 azure 핵심 Azure 계산 플랫폼; 기반으로 구축 일괄 처리 풀 대규모 할당, 응용 프로그램 및 데이터 설치, 데이터 이동, 상태 모니터링 및 VM의의 유연한 크기 조정을 제공 합니다.

풀에 추가된 모든 TVM에는 고유 이름 및 연결된 IP 주소가 할당됩니다. TVM이 풀에서 제거되면 운영 체제에 대해 수행된 변경 내용, 모든 해당 로컬 파일, 해당 이름 및 해당 IP 주소가 손실됩니다. TVM이 풀에서 제거되면 수명이 끝납니다.

풀에 포함된 TVM 간 통신을 허용하도록 풀을 구성할 수 있습니다. 내부 풀 통신이 필요하면 배치 서비스는 풀의 각 TVM에서 1100보다 큰 포트를 허용합니다. 풀에 있는 각 TVM은 이 포트 범위로 들어오는 연결만 허용하고 풀의 다른 TVM에서 들어오는 연결은 제한하도록 구성됩니다. 응용 프로그램에 TVM 간 통신이 필요하지 않으면 배치 서비스는 풀에 여러 다른 클러스터 또는 데이터 센터에 포함된 많은 수의 TVM을 잠재적으로 할당하여 더 많은 병렬 처리를 가능하게 할 수 있습니다.

풀을 만들 때는 다음과 같은 특성을 지정할 수 있습니다.

-  **Vm 크기** 풀에 있습니다.
	- 적절 한 VM 크기는 특징 및 응용 프로그램 또는 VM에 사용할 수 있을 것은 응용 프로그램의 요구 사항에 따라 선택 해야 합니다. 일반적으로 VM 크기가 선택 됩니다 하나 이상의 태스크 VM;에서 한번에 실행 될 가정 하 고 예: 응용 프로그램의 멀티 스레드 인지 여부 및 필요한 메모리 양을 가장 적합 하 고 비용 효율적인 VM 크기를 결정 합니다. 여러 태스크가 할당 될 수 이며 일반적으로 선택 될 더 큰 VM이 경우에서 병렬로 실행 되 고 여러 응용 프로그램 인스턴스가-"VM 당 최대 작업"에서 아래를 참조 하십시오. 
	- 모든 VM의 풀의 크기가 동일 해야 합니다. 다른 응용 프로그램은 다른 시스템 요구 사항 및/또는 다른 부하로 실행 되도록 하는 경우 별도 풀 생성 해야 합니다.
	- A0 제외 하 고는 풀에 대 한 모든 클라우드 서비스 VM 크기를 구성할 수 있습니다.

- 운영 체제 제품군 및 Vm에서 실행 되는 버전입니다.
	- 작업자 역할의 경우와 마찬가지로 OS 제품군 및 OS 버전 구성할 수 있습니다.
	- OS 제품군 OS와 설치 된 버전의.NET 결정 합니다.
	- 작업자 역할을 갖는 OS 버전에 대 한는 것이 좋습니다 처럼 "*" 하는 VM은 자동으로 업그레이드 하 고 있을 수 있습니다 새 버전을 준비 하는데 필요한 작업이 없으면 사용할 수 있습니다. 특정 운영 체제 버전을 선택 하는 것에 대 한 기본 사용 사례 업데이트할 버전을 허용 하기 전에 수행 되어야 하는 테스트 하는 이전 버전과 호환성을 허용 하 여 응용 프로그램 호환성을 유지 하는 것입니다. 유효성 검사를 풀에 대 한 운영 체제 버전을 업데이트할 수 있습니다 하 고 새 OS 이미지 설치 – 실행 중인 모든 태스크를 중단 하 고 다시 큐에 대기 됩니다.

- 풀에 사용할 수 있는 Vm의 대상 번호입니다.

- 풀에 대한 크기 조정 정책 Vm의 수, 외에도 각 풀에 대 한 자동 크기 조정 수식을 지정할 수도 있습니다. 일괄 처리 서비스 풀 및 작업 항목 통계를 기반으로 VM의 수를 조정 하는 수식은 실행 됩니다.

- 일정 구성
	- VM 풀에서 언제 든 지 실행 되도록 한 작업에 대 한 기본 구성은 되지만 시나리오는 VM에서 동시에 실행할 수는 둘 이상의 작업 하는 것이 효과적입니다. 한 가지 예는 응용 프로그램에 I/O; 기다릴 경우 VM 사용률을 높이 둘 이상의 응용 프로그램을 실행 하면 CPU 사용률을 증가 합니다. 풀;에 VM의 수를 줄이는 다른 예는 이 큰 참조 데이터 집합에 필요한 데이터 복사본의 양을 줄일 수 있습니다. 응용 프로그램에 대 한 올바른 크기는 A1 보호 된다는 A4 선택 될 수는 코어를 소비 각 한번에 최대 8 작업 실행 되도록 설정 구성을 그리고 합니다.
	- "VM 당 최대 작업" 구성 병렬로 실행할 수 있는 작업의 최대 수를 결정 합니다.
	- "Fill 정책" 지정할 수도 있습니다 VM의 첫 페이지 또는 여부 작업에 걸쳐 VM의 모든 일괄 처리 채울지 여부를 결정 합니다.
 
- 풀에 Vm의 통신 상태입니다.
 	- 시나리오의 큰 부분에서 작업 독립적으로 작동 하 고, 다른 작업을 통신할 필요가 없습니다 하지만 일부 응용 프로그램 작업 (예: 응용 프로그램 MPI를 사용 하 여) 통신에 있습니다.
	- VM의 기본 네트워크 인프라 및 영향 이라는 측면 배치를 구성 하는데 사용 되는 VM의, 통신할 수 있는지 여부를 제어 하는 구성 방법이 있습니다.

- 풀에 포함된 TVM의 시작 태스크

풀을 만들 때 풀을 연결해야 하는 저장소 계정을 지정할 수 있습니다. 배치 서비스는 더 나은 네트워크 연결 및 대역폭 용량을 갖는 데이터 센터의 TVM을 지정된 저장소 계정에 할당합니다. 이를 통해 작업 중에 데이터에 보다 효과적으로 액세스할 수 있습니다.

### <a name="workitem"></a>작업 항목

작업 항목은 풀의 TVM에 대해 계산이 수행되는 방식을 지정합니다.

- 작업 항목 연결 된 하나 이상의 작업을 가질 수 있습니다. 선택적 일정 있으며이 경우에서 일정의 각 항목에 대해 하나의 작업이 만들어집니다 작업 항목에 대해 지정할 수 있습니다. 주문형 작업에 대 한 일정 없음 지정 된 작업을 즉시 생성 됩니다.
- 작업 항목 작업 실행할 수는 풀을 지정 합니다. 풀 existing, 여러 작업 항목에서 사용 되는 풀을 이미 만든 수는 있지만 작업 항목과 관련 된 각 작업 또는 작업 항목과 관련 된 모든 작업에 대 한 풀을 만들 또는 있습니다.
- 선택적인 우선순위를 지정할 수 있습니다. 진행 중인 다른 작업 항목 보다 우선순위가 높은 작업 항목을 제출 하는 경우 더 높은 우선순위 작업 항목 작업 보다 낮은 우선순위 작업 항목 작업 큐에 삽입 가져옵니다. 이미 실행 중인 우선순위가 낮은 작업은 중지 되지 않습니다.
- 연결 된 작업 또는 작업에 적용 된 제약 조건은 지정할 수 있습니다.
	- 작업에 대 한 최대 wallclock 시간을 설정할 수 있습니다. 지정 된 최대 wallclock 시간 보다 오랫동안 실행 되는 작업 하는 경우 다음 작업 및 관련 된 모든 작업은 종료 됩니다.
	- Azure 일괄 처리는 실패 하 고 작업을 다시 시도 하는 작업을 검색할 수 있습니다. 제약 조건으로 작업 다시 보내기 시도의 최대 수를 지정할 수 있습니다 기본적 하는 작업은 항상 지정 하는 등 다시 시도 또는 다시 시도 하지 않습니다. 작업은 다시 큐에 대기 하 고 다시 실행 됩니다 의미는 작업을 다시 시도 합니다.
- 다른 방식으로 작업 항목을 생성 되었지만 작업 관리자 작업을 지정할 수도 있습니다 클라이언트에서 작업 항목 작업에 대해 실행할 작업을 지정할 수 있습니다. 작업 관리자 작업 일괄 처리 API를 사용 하 고 풀 VM의 중 하나에서 실행 중인 태스크와 작업에 필요한 작업을 만드는 코드를 포함 합니다. 작업 관리자 작업은 일괄 처리에서 특별히 처리 –는 작업이 만들어지고 어떤 이유로 든 실패할 경우 다시 시작 되는 즉시 대기 합니다. 작업 관리자는 작업 되 고 인스턴스화되기 전에 작업을 정의 하는 유일한 방법은 있기 때문에 연결된 된 일정으로 작업 항목 필요 합니다.

### <a name="job"></a>작업

작업은 실행 중인 작업 항목의 인스턴스이며 태스크 컬렉션으로 구성됩니다. 배치 서비스는 작업 항목의 구성에 따라 작업을 인스턴스화합니다. 작업은 작업 항목과 연결된 풀의 TVM을 사용합니다.

### <a name="task"></a>작업

태스크는 작업과 연결되고 TVM에서 실행되는 계산의 단위입니다. 작업 실행에 대 한 VM에 할당 된 또는 VM 무료 수 있을 때까지 큐에 대기 됩니다. 태스크는 다음 리소스를 사용합니다.

- 작업 항목에 지정된 프로그램

- 처리할 데이터를 포함하는 리소스 파일. 이러한 파일은 Blob 저장소에서 TVM으로 자동으로 복사됩니다. 자세한 내용은 파일 및 디렉터리를 참조하세요.

- 프로그램에 필요한 환경 설정. 자세한 내용은 태스크에 대한 환경 설정을 참조하세요.

- 계산이 수행되어야 하는 제약 조건. 예를 들어 태스크가 실행되도록 할당된 최대 시간, 태스크가 실패한 경우 다시 시도되는 최대 횟수 및 작업 디렉터리에 파일을 보관하는 최대 시간이 여기에 해당합니다.

TVM에서 계산을 수행하도록 정의할 수 있는 태스크 외에도 배치 서비스에서 제공하는 다음과 같은 특수한 태스크를 사용할 수 있습니다.

- [작업 시작](#starttask)

- [작업 관리자 작업](#jobmanagertask)

#### <a name="starttask"></a>작업 시작

풀에서 풀과 시작 작업을 연결 하 여 Vm의 운영 체제를 구성할 수 있습니다. 소프트웨어 설치 및 백그라운드 프로세스 시작은 시작 태스크가 수행할 수 있는 일부 동작입니다. 시작 작업에 대 한 풀에 남아으로 VM을 시작할 때마다 실행 됩니다.

로 모든 일괄 처리 작업으로 Azure 저장소에 파일의 목록을 지정할 수 있습니다 일괄 처리에 의해 실행 되는 명령줄 외에도 합니다. Azure 일괄 처리 먼저 Azure 저장소에서 파일을 복사 하 고 명령줄을 실행 합니다. 풀 시작 태스크에 대 한 파일 목록에는 일반적으로 응용 프로그램 파일 또는 패키지를 포함 하지만 풀 VM의에서 실행 되는 모든 작업에 의해 사용 될 참조 데이터가 포함 될 수도 있습니다. 명령줄에서 "공유" 폴더에 응용 프로그램 파일을 복사할 PowerShell 스크립트 또는 robocopy 등을 수행할 수 있습니다. MSI를 실행할 수도 없습니다.

일반적으로 것이 좋습니다 일괄 처리를 완료 한 다음 작업을 할당할 준비가 VM을 고려 하는 시작 작업에 대 한 대기 이지만 구성 가능 합니다.

그런 다음 VM 풀에 대 한 시작 작업 실패 하면 VM의 상태가 실패를 반영 하도록 업데이트 됩니다 고 VM에 대 한 작업을 할당할 수 없습니다. 시작 작업은 시작 작업에 대해 지정 된 파일을 복사 하는 문제가 또는 시작 작업 프로세스 0이 아닌 값을 반환 하는 경우 실패할 수 있습니다.

VM의 구성 및 응용 프로그램을 설치 하는데 필요한 모든 정보가 선언 된 팩트 풀의 VM 수를 늘리면 새는 필요한 번호를 지정 하는 것으로 간단한 임을 의미합니다 일괄 처리에 VM의 구성 및 작업을 허용 하도록 준비 하는데 필요한 모든 정보가 있습니다.

시작 작업은 풀 추가 작업에 대 한 요청 본문에는 JSON 섹션을 추가 하 여 정의 됩니다. 다음 예제는 시작 태스크의 기본 정의를 보여 줍니다.

	{
		“commandLine”:”mypoolsetup.exe”,
		“resourceFiles”:
		[
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”mypoolsetup.exe”
			},
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp2.exe”
			}
		],
		“maxTaskRetryCount”:0
	}

C# 인터페이스는 다음과 같습니다.

	ICloudPool pool = pm.CreatePool(poolName, targetDedicated: 3, vmSize: "small", osFamily: "3");
	pool.StartTask = new StartTask();
	pool.StartTask.CommandLine = "mypoolsetup.exe";
	pool.StartTask.ResourceFiles = new List<IResourceFile>();
	pool.StartTask.ResourceFiles.Add(new ResourceFile("http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d", "mypoolsetup.exe"));
	pool.Commit();


#### <a name="jobmanagertask"></a>작업 관리자 작업

작업 관리자 태스크는 다른 모든 작업이 시작되기 전에 시작됩니다. 작업 관리자 태스크는 다음과 같은 이점을 제공합니다.

- 작업이 만들어질 때 배치 서비스가 자동으로 생성합니다.

- 작업의 다른 태스크보다 먼저 진행되도록 예약됩니다.

- 풀 크기를 줄일 경우 연결된 해당 TVM이 풀에서 마지막으로 제거됩니다.

- 다시 시작해야 할 경우 가장 높은 우선 순위가 지정됩니다. 유휴 TVM을 사용할 수 없는 경우 배치 서비스는 풀에서 실행 중인 태스크 중 하나를 종료하여 실행을 위한 공간을 확보할 수 있습니다.

- 해당 종료는 작업의 모든 태스크에 대한 종료에 연결될 수 있습니다.

작업의 작업 관리자 태스크는 다른 작업의 태스크보다 우선 순위가 높지 않습니다. 작업 간에는 작업 수준 우선 순위만 준수됩니다. 작업 관리자 태스크는 작업 항목 추가 작업을 위한 요청 본문에 XML 섹션을 추가하여 정의합니다. 다음 예제는 작업 관리자 태스크의 기본 정의를 보여 줍니다.

	{
		“name”:”jmTask”,
		“commandLine”:”myapp1.exe”,
		“resourceFiles”:
		[
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp1.exe”
			},
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp2.exe”
			}
		],
		“taskConstraints”:
		{
			“maxWallClockTime”:”PT1H”,
			“maxTaskRetryCount”:0,
			“retentionTime”:”PT1H”
		},
		“killJobOnCompletion”:true,
		“runElevated”:false,
		“runExclusive”:true
	}




## <a name="workflow"></a>일괄 처리 서비스의 워크플로

배치 서비스를 사용하려면 배치 계정이 필요하고, 서비스의 여러 리소스를 사용하여 계산을 예약합니다. 배치 서비스에서 분산 컴퓨팅 시나리오를 만들 경우 다음과 같은 기본 워크플로를 사용합니다.

1. Azure 저장소 계정에 분산된 컴퓨팅 시나리오에서 사용 하 여 원하는 파일을 업로드 합니다. 이러한 파일은 배치 서비스에서 액세스할 수 있도록 저장소 계정에 있어야 합니다. 배치 서비스는 해당 파일을 태스크가 실행될 때 TVM에 로드합니다.

2. 저장소 계정에 종속 된 이진 파일을 업로드 합니다. 이진 파일에는 태스크 및 종속 어셈블리에서 실행되는 프로그램이 포함됩니다. 이러한 파일은 저장소에서 액세스할 수는 있어야 하며 TVM에 로드됩니다.

3. TVMs의 풀을 만듭니다. 풀이 만들어질 때 사용할 태스크용 가상 컴퓨터의 크기를 할당할 수 있습니다. 태스크가 실행될 때 이 풀에서 TVM에 태스크가 할당됩니다.

4. 작업 항목을 만듭니다. 작업 항목을 만들 때 작업이 자동으로 만들어집니다. 작업 항목을 사용하여 태스크 작업을 관리할 수 있습니다.

5.는 작업 항목을 태스크를 추가 합니다. 각 태스크는 사용자가 업로드한 프로그램을 사용하여 업로드된 파일의 정보를 처리합니다.

6. 출력의 결과 모니터링 합니다.

## <a name="files"></a>파일 및 디렉터리

각 태스크에는 태스크에 의해 실행되는 프로그램, 태스크에 의해 처리되는 데이터 및 태스크가 수행한 처리의 출력을 저장하기 위한 0개 이상의 디렉터리 및 파일이 만들어지는 작업 디렉터리가 있습니다. 이러한 디렉터리 및 파일은 한 작업을 실행하는 동안 다른 태스크에서 사용될 수 있습니다. TVM의 모든 작업, 파일 및 디렉터리는 단일 사용자 계정에 의해 소유됩니다.

배치 서비스는 TVM의 파일 시스템 일부를 루트 디렉터리로 노출합니다. TVM의 루트 디렉터리는 WATASK_TVM_ROOT_DIR 환경 변수를 통해 작업에 사용할 수 있습니다. 환경 변수 사용에 대한 자세한 내용은 태스크에 대한 환경 설정을 참조하세요.

루트 디렉터리에는 다음과 같은 하위 디렉터리가 포함됩니다.

- **작업** –이 위치는 모든 파일이 저장 되는 위치는 TVM에서 실행 되는 작업에 속하는 합니다. 각 작업에 대 한 일괄 처리 서비스는 %WATASK_TVM_ROOT_DIR%/tasks/workitemName/jobName/taskName/ 형태로 고유 경로와 작업 디렉터리를 만듭니다. 이 디렉터리는 태스크에 대한 읽기/쓰기 액세스를 제공합니다. 이 디렉터리 아래에서 태스크는 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있으며 이 디렉터리는 태스크에 대해 지정된 RetentionTime 제약 조건에 따라 유지됩니다.

- **공유** –이 위치는 모든 계정에서 작업에 대 한 공유 디렉터리입니다. TVM, 공유 디렉터리 WATASK_TVM_ROOT_DIR%/shared %는 합니다. 이 디렉터리는 태스크에 대한 읽기/쓰기 액세스를 제공합니다. 태스크는 이 디렉터리 아래에서 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있습니다.

- **시작** –이 위치는 시작 작업에 의해 작업 디렉터리로 사용 됩니다. 시작 태스크를 시작하기 위해 배치 서비스에서 다운로드한 모든 파일도 이 디렉터리 아래에 저장됩니다. TVM, 시작 디렉터리 WATASK_TVM_ROOT_DIR%/start %는 합니다. 태스크는 이 디렉터리 아래에서 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있으며 이 디렉터리는 시작 태스크가 운영 체제를 구성하는 데 사용할 수 있습니다.

풀에서 TVM이 제거되면 TVM에 저장된 모든 파일이 제거됩니다.

## <a name="lifetime"></a>풀 및 VM 수명

기본적인 설계 의사 결정 풀 생성 시점 이며 기간 VM의 사용 가능한 유지 됩니다.

한쪽 끝에 풀을 만들 수 각 작업에 대 한 작업을 제출 하 고 VM의 실행을 완료 하는 작업으로 제거 합니다. 반드시 필요한 때에 VM의를 할당 하 고 종료 되 면 즉시 유휴 사용률을 극대화 되이 있습니다. VM의 중요 한 것 처럼 개별적으로 사용할 수 있는 작업 VM의를 예약할 수는 없지만 할당 되도록 할당 되 고 시작 작업이 완료 된;에 대 한 작업 대기 해야 함을 의미지 않습니다. 즉, 사용률이 저하를 초래 하는 대로 모든 VM의 풀에서 사용할 수 있는 때까지 일괄 처리는 기다리지 않습니다.

시작 작업이 있는 경우 실행이 즉시는 우선순위 풀을 만들어야 하 고 VM의 작업을 제출 하기 전에 사용할 수 있습니다. 작업을 즉시 시작할 수 있지만 VM의 부하에 따라 작업을 기다리는 유휴 상태가 될 수 있습니다.

이 있으면 가변적인 양의 부하 지속적으로 하는 것을 여러 작업에 제출 될 눈금 위로 또는 아래로; 부하에 따라 VM의 수가 있지만 풀에 대 한 하나의 공통 무늬 반응성이 뛰어난 방식 또는 프로 적극적으로 수행할 수 있습니다 경우 부하를 예측할 수 있습니다.

## <a name="scaling"></a>응용 프로그램 크기 조정

응용 프로그램은 필요한 계산을 수용하도록 자동으로 쉽게 확장 또는 축소될 수 있습니다. 현재 작업 부하 및 리소스 사용량 통계에 따라 풀의 TVM 수를 동적으로 조정할 수 있습니다. 또한 자동으로 크기가 조정되도록 구성하여 전반적인 응용 프로그램 실행 비용을 최적화할 수 있습니다. 풀이 만들어질 때 크기 조정 설정을 지정할 수 있고 언제든지 구성을 업데이트할 수 있습니다.

VM의 수가 감소, 실행 중인 VM의 고려해 야 하는 태스크가 있을 수 있습니다. 할당 취소 정책에는 VM을 즉시 또는 작업 수는 VM의 제거 되기 전에 완료 있는지 여부를 제거 하려면 실행 중인 작업은 중지 여부를 결정 하는 지정 됩니다. 설정까지 아래로 VM의 대상 수는 작업의 끝에 0 하지만 사용률을 극대화 하 되, 완료 작업을 실행 하 고 허용 합니다.

일련의 크기 조정 수식을 사용하여 응용 프로그램의 자동 크기 조정을 지정합니다. 다음 크기 조정 간격에 대해 풀에 있는 TVM의 수를 확인하는 데 수식을 사용할 수 있습니다. 예를 들어 풀에서 예약할 많은 수의 태스크를 제출해야 합니다. 보류 중인 작업의 현재 수 및 작업의 완료율에 따라 풀의 크기를 지정하는 크기 조정 수식을 풀에 할당할 수 있습니다. 배치 서비스는 수식을 정기적으로 계산하고 작업에 따라 풀 크기를 조정합니다.

수식은 다음 메트릭을 기반으로 할 수 있습니다.

- **시간 메트릭으로** – 지정된 된 수의 시간에 5 분 마다 수집 된 통계를 기반으로 합니다.

- **리소스 메트릭** – CPU 사용량, 대역폭 사용량, 메모리 사용량 및 TVMs의 수에 기반 합니다.

- **메트릭 작업** – 보류, 활성, 등의 작업의 상태를 기반으로 하며 완료 합니다.

응용 프로그램의 자동 크기 조정에 대한 자세한 내용은 태스크용 가상 컴퓨터의 자동 크기 조정 구성을 참조하세요.

>VM의 삭제
>
>종종 필요 하지 하지만 개별 VM의 풀에서 제거를 지정 하는 것이 불가능 합니다. VM 작지 않은지 의심 되는 경우 신뢰할 수 있는 것 제거할 수 있습니다, 예.

## <a name="cert"></a>응용 프로그램에 대 한 인증서

일반적으로 비밀 정보를 암호화할 때는 인증서를 사용해야 합니다. TVM에 인증서를 설치할 수 있습니다. 암호화된 비밀은 명령줄 매개 변수에서 태스크에 전달되거나 리소스 중 하나에 포함되며 암호를 해독하는 데 설치된 인증서를 사용할 수 있습니다. 비밀 정보의 예로는 저장소 계정에 대한 키가 있습니다.

인증서 추가 작업을 사용하여 배치 계정에 인증서를 추가할 수 있습니다. 그런 다음 인증서를 기존 풀이나 새 풀에 연결할 수 있습니다. 인증서가 풀에 연결되면 배치 서비스가 풀의 각 TVM에 인증서를 설치합니다. 배치 서비스는 TVM이 시작되면 시작 태스크 및 작업 관리자 태스크를 포함하는 태스크를 시작하기 전에 해당 인증서를 설치합니다.

## <a name="scheduling"></a>예약 우선순위

작업 항목을 만들 때 우선 순위를 할당할 수 있습니다. 작업 항목의 각 작업은 이러한 우선 순위로 만들어집니다. 배치 서비스는 작업의 우선 순위 값을 사용하여 계정 내의 작업 예약 순서를 결정합니다. 우선 순위 값의 범위는-1000에서 1000까지이며 -1000이 가장 낮은 우선 순위를, 1000이 가장 높은 우선 순위를 나타냅니다. 작업 업데이트 작업을 사용하여 작업의 우선 순위를 업데이트할 수 있습니다.

동일한 계정 내에서 우선 순위가 높은 작업은 우선 순위가 낮은 작업보다 먼저 예약됩니다. 하나의 계정에서 우선 순위가 더 높은 작업이 다른 계정에서 우선 순위가 더 낮은 다른 작업보다 먼저 예약되는 것은 아닙니다.

다른 풀의 예약 작업은 서로 별개입니다. 여러 다른 풀이 있을 때 연결된 풀에 유휴 TVM이 부족한 경우 우선 순위가 높은 작업이 먼저 예약된다고 보장할 수 없습니다. 동일한 풀에서는 우선 순위가 같은 작업이 예약될 기회가 동일합니다.

## <a name="environment"></a>작업에 대 한 환경 설정

태스크 컨텍스트에서 사용할 수 있는 환경 설정을 지정할 수 있습니다. 시작 태스크 및 하나의 작업에서 실행되는 태스크에 대한 환경 설정은 태스크 추가 또는 태스크 업데이트 작업의 요청 본문에 XML 섹션을 추가하여 정의합니다.

다음 예제는 환경 설정의 정의를 보여 줍니다.

배치 서비스는 작업에서 예약 된 모든 태스크에 대해 특정 환경 변수 집합을 설정합니다. 다음 표에는 배치 서비스가 모든 태스크에 대해 설정하는 환경 변수가 나와 있습니다.

<table>
  <tr>
   <th>환경 변수 이름
   </th>
   <th>
   설명
   </th>
  </tr>
 <tr>
  <td>
  WATASK_ ACCOUNT_NAME
  </td>
  <td>
  태스크가 속한 계정의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_WORKITEM_NAME
  </td>
  <td >태스크가 속한 작업 항목의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_JOB_NAME
  </td>
  <td >태스크가 속한 작업의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TASK_NAME
  </td>
  <td >현재 태스크의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_POOL_NAME
  </td>
  <td >태스크가 실행되는 풀의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TVM_NAME
  </td>
  <td >태스크가 실행되는 TVM의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TVM_ROOT_DIR
  </td>
  <td >TVM의 루트 디렉터리 전체 경로
  </td>
 </tr>
 <tr>
  <td>
  WATASK_PORTRANGE_LOW WATASK_PORTRANGE_HIGH
</td>
<td>
  내부 풀 통신을 사용되도록 설정된 경우 태스크가 통신에 사용할 수 있는 포트 범위(경계값 포함)입니다.
</td>
</table>

**참고**

이러한 시스템 정의 변수는 덮어쓸 수 없습니다.

태스크 가져오기 작업을 사용하여 환경 설정 값을 검색할 수 있습니다.

## <a name="errorhandling"></a>오류 처리

###작업 오류 처리
작업 실패는 다음과 같은 범주로 분류 됩니다.

- 오류를 예약 합니다.
	- 파일 작업에 대해 지정 된 경우에 하나 이상의 파일 복사본 실패할 수 있습니다. 파일을 이동 때문일 수 없습니다, 그리고 저장소 계정은 더이상 사용할 수 있는 등입니다.
	- "일정 오류"이 경우 작업에 대해 설정 됩니다.
- 응용 프로그램 오류:
	- 명령줄에 지정 된 작업 프로세스도 실패할 수 있습니다. 프로세스는 0이 아닌 종료 코드가 반환 되는 경우 실패 한 것으로 간주 됩니다.
	- 응용 프로그램 오류에 대 한 자동으로 지정 된 횟수 만큼까지 작업을 다시 시도 하는 일괄 처리를 구성 하는 것이 같습니다. 
- 제약 조건이 실패:
	- 제약 조건에 대 한 작업을 실행할 수는 최대 기간을 지정할 수 있습니다. 이 중지 되는 작업을 종료 하는 데 유용할 수 있습니다.
	- 시간의 최대 크기를 초과 했습니다 다음 작업을 완료로 표시 되지만로 표시 된 종료 코드는 `0xC000013A` 로 표시 됩니다 schedulingError 필드 및 `{ category:“ServerError”, code=“TaskEnded”}`합니다.

###응용 프로그램 오류를 디버깅합니다.

응용 프로그램 문제를 해결 하는데 사용할 수 있는 진단 유틸리티를 생성할 수 있습니다. Stdout 및 stderr 파일 또는 사용자 지정 파일에 출력에 종종 응용 프로그램 정보를 기록 합니다. 이러한 경우에는 API는 작업 또는 VM을 지정 하 여 파일을 가져올 제공 됩니다.

풀 VM에 로그인 하는 것도 가능 합니다. API는 VM을 사용할 수 있는 다음에 대 한 RDP 파일을 반환 합니다. VM에 로그인 합니다.

###작업 오류 및 문제에 대 한 출장

작업에 실패할 수 있습니다 하거나 다음과 같은 이유로 인해 중단 될입니다. 작업 응용 프로그램 자체에 실패할 수 있습니다, 작업이 실행 되는 VM 재부팅 가져옵니다 또는 VM 작업이 완료 되기를 기다리지 않고 즉시 VM을 제거 하도록 설정 할당 취소가 정책을 사용 하 여 풀 크기가 조정 하 여 제거 됩니다. 모든 경우에 자동으로 다시 대기할 수 일괄 처리에 의해 작업과 다른 VM에서 실행 합니다.

발생 한 작업을 중지 하거나 실행 하는데 너무 오래 걸릴에 간헐적인 문제에 대 한도 가능 합니다. 작업에 대 한 설정 및 임계값이 초과 일괄 처리 작업 응용 프로그램을 중단 될 경우 최대 실행 시간 될 수 있습니다. 현재,이 경우에 대 한 수는 자동 다시 큐 없지만 경우 새 작업을 제출할 수 있는 클라이언트 감지 될 수 있습니다.

###"Bad" VM에 대 한 출장

각 VM 풀의 고유 이름 및 작업 메타 데이터에 포함 하는 작업이 실행 되는 VM에 제공 됩니다. 경우는 어떤 이유로 인해 작업에 실패 하는 VM이 클라이언트와 의심 되는 풀에서 삭제 된 VM에서 확인할 수 있습니다. 작업이 삭제 된 VM에서 실행 중인 경우 다음이 자동으로 다시 큐에 대기 되며 다른 VM에서 실행 합니다.


<!--Image references-->
[1]: ./media/batch-api-basics/batch-api-basics-01.png

[Azure 일괄 처리 개요]: batch-technical-overview.md

<!---HONumber=GIT-SubDir-->