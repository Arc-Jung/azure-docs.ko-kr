---
title: Azure Cosmos DB의 일관성 수준
description: Azure Cosmos DB에는 최종 일관성, 가용성 및 대기 시간을 절충하여 조정하는 데 유용한 5가지 일관성 수준이 있습니다.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/12/2020
ms.openlocfilehash: 742ff2e6cff4569b5b7eeb131cd4394277b6c3cd
ms.sourcegitcommit: 3bdeb546890a740384a8ef383cf915e84bd7e91e
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/30/2020
ms.locfileid: "93100459"
---
# <a name="consistency-levels-in-azure-cosmos-db"></a>Azure Cosmos DB의 일관성 수준
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

고가용성, 짧은 대기 시간 또는 둘 다에 대해 복제를 사용 하는 분산 데이터베이스는 [PACLC 정리](https://en.wikipedia.org/wiki/PACELC_theorem)에 정의 된 대로 읽기 일관성, 가용성, 대기 시간 및 처리량 간에 기본적인 균형을 유지 해야 합니다. 강력한 일관성 모델의 선형화 가능성는 데이터 프로그래밍의 골드 표준입니다. 그러나 데이터를 큰 거리에 복제 하 고 커밋하는 것으로 인해 더 높은 쓰기 대기 시간 으로부터 깊은 가격을 추가 합니다. 또한 모든 지역에서 데이터를 복제 하 고 커밋할 수 없기 때문에 성능이 크게 저하 될 수 있습니다 (오류 중). 최종 일관성은 고가용성과 향상 된 성능을 제공 하지만 모든 지역에서 데이터가 완전히 일치 하지 않을 수 있기 때문에 응용 프로그램을 프로그래밍 하는 것이 더 어려워집니다.

현재 시중에서 제공 되는 대부분의 상업적으로 사용할 수 있는 배포 된 NoSQL 데이터베이스는 강력 하 고 결과적 일관성만 제공 합니다. Azure Cosmos DB는 잘 정의 된 5 가지 수준을 제공 합니다. 가장 강력한 수준에서 가장 약한 수준, 즉

- *강력*
- *제한 된 부실*
- *세션*
- *일관적인 접두사*
- *최종적인*

각 수준은 가용성 및 성능 절충을 제공 합니다. 다음 이미지는 다양 한 일관성 수준을 스펙트럼으로 보여 줍니다.

:::image type="content" source="./media/consistency-levels/five-consistency-levels.png" alt-text="스펙트럼으로 일관성" border="false" :::

일관성 수준은 지역에 구애 받지 않으며 읽기 및 쓰기가 처리 되는 지역, Azure Cosmos 계정에 연결 된 지역 수 또는 계정이 단일 또는 다중 쓰기 지역으로 구성 되었는지 여부에 관계 없이 모든 작업에 대해 보장 됩니다.

## <a name="consistency-levels-and-azure-cosmos-db-apis"></a>일관성 수준 및 Azure Cosmos DB API

Azure Cosmos DB는 널리 사용 되는 데이터베이스에 대 한 유선 프로토콜 호환 Api를 기본적으로 지원 합니다. 여기에는 MongoDB, Apache Cassandra, Gremlin 및 Azure Table storage가 포함 됩니다. Gremlin API 및 Table API를 사용 하는 경우 Azure Cosmos 계정에 구성 된 기본 일관성 수준이 사용 됩니다. Cassandra API 또는 MongoDB API와 Azure Cosmos DB의 일관성 수준 간의 일관성 수준 매핑에 대 한 자세한 내용은 [Cassandra API 일관성 매핑](cassandra-consistency.md) 및 [Api를 위한 api](mongodb-consistency.md)를 참조 하십시오.

## <a name="scope-of-the-read-consistency"></a>읽기 일관성 범위

읽기 일관성은 논리적 파티션 내에서 범위가 지정 된 단일 읽기 작업에 적용 됩니다. 읽기 작업은 원격 클라이언트 또는 저장 프로시저에서 실행할 수 있습니다.

## <a name="configure-the-default-consistency-level"></a>기본 일관성 수준 구성

언제든지 Azure Cosmos 계정의 기본 일관성 수준을 구성할 수 있습니다. 계정에 구성 된 기본 일관성 수준은 해당 계정의 모든 Azure Cosmos 데이터베이스 및 컨테이너에 적용 됩니다. 컨테이너 또는 데이터베이스에 대해 실행된 모든 읽기 및 쿼리는 기본적으로 지정된 일관성 수준을 사용합니다. 자세히 알아보려면 [기본 일관성 수준을 구성](how-to-manage-consistency.md#configure-the-default-consistency-level)하는 방법을 참조하세요. 특정 요청에 대 한 기본 일관성 수준을 재정의할 수도 있습니다. 자세한 내용은 [기본 일관성 수준을 재정의](how-to-manage-consistency.md?#override-the-default-consistency-level) 하는 방법 문서를 참조 하세요.

## <a name="guarantees-associated-with-consistency-levels"></a>일관성 수준과 연결된 보장

Azure Cosmos DB는 읽기 요청의 100%가 선택한 일관성 수준에 대 한 일관성 보장을 충족 하도록 보장 합니다. TLA + 사양 언어를 사용 하 Azure Cosmos DB에서 5 가지 일관성 수준에 대 한 정확한 정의는 [Azure-Cosmos](https://github.com/Azure/azure-cosmos-tla) GitHub 리포지토리에서 제공 됩니다.

5가지 일관성 수준의 의미 체계는 여기에 설명되어 있습니다.

- **Strong** : 강력한 일관성은 선형화 가능성 보장을 제공 합니다. 선형화 가능성은 요청을 동시에 처리 하는 것을 의미 합니다. 읽기를 통해 항목의 최신 커밋된 버전 반환이 보장됩니다. 클라이언트는 커밋되지 않은 쓰기 또는 부분 쓰기를 볼 수 없습니다. 사용자는 항상 최신 커밋 쓰기의 읽기가 보장됩니다.

  다음 그림은 악기 노트와의 강력한 일관성을 보여 줍니다. "미국 서 부 2" 지역에 데이터를 쓴 후 다른 지역의 데이터를 읽으면 최신 값을 얻게 됩니다.

  :::image type="content" source="media/consistency-levels/strong-consistency.gif" alt-text="스펙트럼으로 일관성" 외부의 총 글로벌 주문을 제공 합니다. 클라이언트에서 쓰기를 허용 하는 지역 내에서 읽기 작업을 수행 하는 경우, 제한 된 부실 일관성을 통해 제공 되는 보장은 강력한 일관성을 통해 보장 되는 것과 동일 합니다. 이러한 시간 또는 업데이트에 대 한 부실 기간이 더 가까운 경우, 서비스는 복제를 통해 일관성 보장을 파악 하 고 사용할 수 있도록 새 쓰기를 제한 합니다.

부실 기간 내에서 제한 된 부실은 다음과 같은 일관성을 보장 합니다.

- 단일 쓰기 지역이 있는 계정에 대해 동일한 지역의 클라이언트에 대 한 일관성 = 강함
- 단일 쓰기 지역이 있는 계정에 대해 서로 다른 지역의 클라이언트에 대 한 일관성 = 일관적인 접두사
- 여러 쓰기 지역이 있는 계정에 대해 단일 지역에 쓰는 클라이언트의 일관성 = 일치 하는 접두사
- 여러 쓰기 지역이 있는 계정에 대해 다른 지역에 쓰는 클라이언트의 일관성 = 최종

  제한 된 부실은 일반적으로 낮은 쓰기 대기 시간을 예상 하지만 총 글로벌 주문 보증이 필요한 전 세계적으로 분산 된 응용 프로그램에 의해 선택 됩니다. 제한 된 부실은 그룹 공동 작업 및 공유, 주식 시세, 게시-구독/큐 등을 갖춘 응용 프로그램에 적합 합니다. 다음 그림은 음악 메모와의 제한 된 부실 일관성을 보여 줍니다. "미국 서 부 2" 지역에 데이터를 쓴 후 "미국 동부 2" 및 "오스트레일리아 동부" 지역은 구성 된 최대 지연 시간 또는 최대 작업을 기반으로 작성 된 값을 읽습니다.

  :::image type="content" source="media/consistency-levels/bounded-staleness-consistency.gif" alt-text="스펙트럼으로 일관성" 세션을 가정 하거나 여러 작성기에 대해 세션 토큰을 공유 하는 것으로 가정 합니다.

쓰기를 수행 하는 세션 외부의 클라이언트는 다음과 같은 보증을 확인할 수 있습니다.

- 단일 쓰기 지역이 있는 계정에 대해 동일한 지역의 클라이언트에 대 한 일관성 = 일관적인 접두사
- 단일 쓰기 지역이 있는 계정에 대해 서로 다른 지역의 클라이언트에 대 한 일관성 = 일관적인 접두사
- 여러 쓰기 지역이 있는 계정에 대해 단일 지역에 쓰는 클라이언트의 일관성 = 일치 하는 접두사
- 여러 쓰기 지역이 있는 계정에 대 한 여러 지역에 쓰는 클라이언트의 일관성 = 최종

  세션 일관성은 단일 지역 뿐만 아니라 전 세계적으로 분산 된 응용 프로그램 모두에서 가장 널리 사용 되는 일관성 수준입니다. 최종 일관성과 유사 하 게 쓰기 대기 시간, 가용성 및 읽기 처리량을 제공 하지만, 사용자의 컨텍스트에서 작동 하도록 작성 된 응용 프로그램의 요구에 맞는 일관성 보장도 제공 합니다. 다음 그림은 악기 노트와의 세션 일관성을 보여 줍니다. "미국 서 부 2 작성기" 및 "미국 서 부 2 판독기"는 동일한 세션 (세션 A)을 사용 하 고 있으므로 동일한 데이터를 동시에 읽을 수 있습니다. "오스트레일리아 동부" 지역은 "세션 B"를 사용 하는 반면 나중에 쓰기와 동일한 순서로 데이터를 받습니다.

  :::image type="content" source="media/consistency-levels/session-consistency.gif" alt-text="스펙트럼으로 일관성":::

- **일관적인 접두사** : 반환 되는 업데이트에는 간격이 없는 모든 업데이트의 일부 접두사가 포함 됩니다. 일관 된 접두사 일관성 수준에 따라 읽기가 잘못 된 쓰기를 표시 하지 않습니다.

쓰기를 순서 대로 수행 `A, B, C` 하는 경우 클라이언트는, 또는 중 하나를 볼 `A` `A,B` `A,B,C` 뿐만 아니라 또는와 같이 순서가 잘못 된 순열은 표시 하지 않습니다 `A,C` `B,A,C` . 일관 된 접두사는 최종 일관성과 비교할 수 있는 쓰기 대기 시간, 가용성 및 읽기 처리량을 제공 하지만 순서가 중요 한 시나리오의 요구 사항에 적합 한 주문 보장도 제공 합니다.

다음은 일관 된 접두사에 대 한 일관성 보장입니다.

- 단일 쓰기 지역이 있는 계정에 대해 동일한 지역의 클라이언트에 대 한 일관성 = 일관적인 접두사
- 단일 쓰기 지역이 있는 계정에 대해 서로 다른 지역의 클라이언트에 대 한 일관성 = 일관적인 접두사
- 여러 쓰기 지역이 있는 계정에 대해 단일 지역에 쓰는 클라이언트의 일관성 = 일관적인 접두사
- 여러 쓰기 지역이 있는 계정에 대 한 여러 지역에 쓰는 클라이언트의 일관성 = 최종

다음 그림은 음악 메모와의 일관성 접두사 일관성을 보여 줍니다. 모든 지역에서 읽기는 순서가 잘못 된 쓰기를 표시 하지 않습니다.

  :::image type="content" source="media/consistency-levels/consistent-prefix.gif" alt-text="스펙트럼으로 일관성":::

- **최종** : 읽기에 대 한 순서가 보장 되지 않습니다. 추가 쓰기가 없으면 복제본이 결과적으로 수렴합니다.  
최종 일관성은 클라이언트에서 이전에 읽은 값 보다 오래 된 값을 읽을 수 있기 때문에 가장 약한 형태의 일관성입니다. 최종 일관성은 응용 프로그램에서 순서를 보장 하지 않아도 되는 경우에 적합 합니다. 예를 들면, 좋아요, 좋아요 또는 비 스레드된 주석의 개수가 포함 됩니다. 다음 그림은 악기 노트와의 최종 일관성을 보여 줍니다.

  :::image type="content" source="media/consistency-levels/eventual-consistency.gif" alt-text="스펙트럼으로 일관성":::

## <a name="consistency-guarantees-in-practice"></a>실제 일관성 보증

실제로 더 강력한 일관성을 보장 하는 경우가 많습니다. 새로 고침 및 요청하는 데이터베이스의 상태 순서에 해당하는 읽기 작업에 대한 일관성 보장입니다. 읽기 일관성은 쓰기/업데이트 작업의 순서 지정 및 전파에 연결됩니다.  

데이터베이스에 대 한 쓰기 작업이 없는 경우 **최종** , **세션** 또는 **일관 된 접두사** 일관성 수준에 대 한 읽기 작업은 강력한 일관성 수준의 읽기 작업과 동일한 결과를 얻을 수 있습니다.

Azure Cosmos 계정이 강력한 일관성 이외의 일관성 수준으로 구성 된 경우에는 PBS ( *확률적 한정 된 부실* ) 메트릭을 살펴보면 클라이언트에서 작업에 대해 강력 하 고 일관 된 읽기를 수행할 수 있는 확률을 확인할 수 있습니다. 이 메트릭은 Azure Portal에서 노출됩니다. 자세히 알아보려면 [PBS(확률적 제한된 부실) 메트릭 모니터링](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric)을 참조하세요.

확률적 제한된 부실은 최종이 어떻게 최종 일관성인지 보여줍니다. 이 메트릭은 현재 Azure Cosmos 계정에 구성 된 일관성 수준 보다 더 강력한 일관성을 얻을 수 있는 빈도에 대 한 정보를 제공 합니다. 즉, 쓰기 및 읽기 영역 조합에 대한 강력한 일관성 읽기를 가져오는 확률(밀리초로 제한됨)을 확인할 수 있습니다.

## <a name="consistency-levels-and-latency"></a>일관성 수준 및 대기 시간

모든 일관성 수준에 대한 읽기 대기 시간은 항상 99번째 백분위 수에서 10밀리초 미만을 보장합니다. 50 번째 백분위 수의 평균 읽기 대기 시간은 일반적으로 4 밀리초 보다 낮습니다.

모든 일관성 수준에 대 한 쓰기 대기 시간은 99 번째 백분위 수에서 항상 10 밀리초 미만으로 보장 됩니다. 50번째 백분위 수의 평균 쓰기 대기 시간은 일반적으로 5밀리초 이하입니다. 여러 Azure 지역에 걸쳐 있으며 강력한 일관성을 사용하여 구성된 Azure Cosmos 계정은 이 보장의 예외입니다.

### <a name="write-latency-and-strong-consistency"></a>쓰기 대기 시간 및 강력한 일관성

둘 이상의 지역에서 강력한 일관성을 사용 하 여 구성 된 Azure Cosmos 계정에 대 한 쓰기 대기 시간은 두 개의 가장 큰 영역 사이에 두 번 왕복 시간 (RTT)과 99 번째 백분위 수의 10 밀리초와 같습니다. 강력한 일관성은 계정 내의 모든 지역에 커밋 되었는지 확인 한 후에만 작업을 완료 하므로, 지역 간 높은 네트워크 RTT는 Cosmos DB 요청에 대해 더 높은 대기 시간으로 변환 됩니다.

정확한 RTT 대기 시간은 광속 거리와 Azure 네트워킹 토폴로지의 함수입니다. Azure 네트워킹은 두 Azure 지역 간의 RTT에 대 한 대기 시간 Sla를 제공 하지 않지만 [azure 네트워크 왕복 대기 시간 통계](../networking/azure-network-latency.md)를 게시 합니다. Azure Cosmos 계정의 경우 Azure Portal에 복제 대기 시간이 표시됩니다. Azure Portal (메트릭 블레이드로 이동, 일관성 탭 선택)를 사용 하 여 Azure Cosmos 계정과 연결 된 다양 한 지역 간 복제 대기 시간을 모니터링할 수 있습니다.

> [!IMPORTANT]
> 최대 쓰기 대기 시간으로 인해 5000 8000 마일 이상으로 확장 된 지역 계정에 대 한 강력한 일관성은 기본적으로 차단 됩니다. 이 기능을 사용 하도록 설정 하려면 지원 담당자에 게 문의 하세요.

## <a name="consistency-levels-and-throughput"></a>일관성 수준 및 처리량

- 강력 하 고 제한 된 부실의 경우 일관성을 보장 하기 위해 4 개의 복제본 집합 (소주주 쿼럼)에 있는 두 개의 복제본에 대해 읽기가 수행 됩니다. 세션, 일관 된 접두사 및 최종은 단일 복제본 읽기를 수행 합니다. 따라서 동일한 수의 요청 단위에 대해 강력 하 고 제한 된 부실의 읽기 처리량은 다른 일관성 수준의 절반입니다.

- 지정된 쓰기 작업 유형(예: 삽입, 바꾸기, upsert, 삭제 등)의 경우 요청 단위에 대한 쓰기 처리량은 모든 일관성 수준에서 동일합니다.

|**일관성 수준**|**쿼럼 읽기**|**쿼럼 쓰기**|
|--|--|--|
|**강력**|로컬 소주주|전역 과반수|
|**제한 된 부실**|로컬 소주주|로컬 과반수|
|**세션**|단일 복제본 (세션 토큰 사용)|로컬 과반수|
|**일관적인 접두사**|단일 복제본|로컬 과반수|
|**최종적인**|단일 복제본|로컬 과반수|

> [!NOTE]
> 로컬 소주주 읽기에 대 한 읽기/쓰기 비용은 두 개의 복제본에서 강력 하 고 제한 된 부실의 일관성을 보장 하기 위해 읽기 때문에 두 배의 일관성 수준에 대 한 읽기 작업을 수행 합니다.

## <a name="consistency-levels-and-data-durability"></a><a id="rto"></a>일관성 수준 및 데이터 내구성

전 세계적으로 분산된 데이터베이스 환경에서 지역 전체 가동 중단이 발생할 경우, 일관성 수준과 데이터 내구성 사이에 직접적인 관계가 있습니다. 비즈니스 연속성 계획을 개발할 때는 중단 이벤트가 발생한 후 애플리케이션이 완전히 복구되기까지 허용되는 최대 시간을 이해해야 합니다. 응용 프로그램을 완전히 복구 하는 데 필요한 시간을 **RTO** ( **복구 시간 목표** ) 라고 합니다. 또한 중단 이벤트가 발생한 후 복구될 때 애플리케이션에서 손실을 허용할 수 있는 최근 데이터 업데이트의 최대 기간도 이해해야 합니다. 손실 될 수 있는 업데이트 기간을 **RPO** ( **복구 지점 목표** ) 라고 합니다.

다음 표에서는 지역 전체의 중단이 발생 한 경우 일관성 모델과 데이터 내구성 간의 관계를 정의 합니다. 분산 된 시스템에서는 [정리](https://en.wikipedia.org/wiki/CAP_theorem)로 인해 분산 된 데이터베이스에 RPO 및 RTO가 0 인 분산 데이터베이스를 사용할 수 없습니다.

|**개 지역**|**복제 모드**|**일관성 수준**|**RPO**|**RTO**|
|---------|---------|---------|---------|---------|
|1|단일 또는 여러 쓰기 지역|일관성 수준|< 240분|< 1주|
|>1|단일 쓰기 지역|세션, 일관된 접두사, 최종|< 15분|< 15분|
|>1|단일 쓰기 지역|제한된 부실|*K*  &  *T*|< 15분|
|>1|단일 쓰기 지역|강력|0|< 15분|
|>1|여러 쓰기 지역|세션, 일관된 접두사, 최종|< 15분|0|
|>1|여러 쓰기 지역|제한된 부실|*K*  &  *T*|0|

*K* = 항목의 *"K"* 버전 (즉, 업데이트) 수입니다.

*T* = 마지막 업데이트 이후의 시간 간격 *"t"* 입니다.

단일 지역 계정의 경우 *K* 및 *T* 의 최소값은 10 개의 쓰기 작업 또는 5 초입니다. 다중 지역 계정의 경우 최소 값 *K* 및 *T* 는 10만 쓰기 작업 또는 300 초입니다. 이는 제한 된 부실을 사용할 때 데이터의 최소 RPO를 정의 합니다.

## <a name="strong-consistency-and-multiple-write-regions"></a>강력한 일관성 및 여러 쓰기 지역

여러 쓰기 지역으로 구성 된 Cosmos 계정은 분산 시스템이 0 및 RTO 0의 RPO를 제공할 수 없으므로 강력한 일관성을 위해 구성할 수 없습니다. 또한 모든 지역에 대 한 쓰기는 복제 되 고 계정 내의 모든 구성 된 지역에 커밋되기 때문에 여러 쓰기 지역에서 강력한 일관성을 사용 하는 경우 쓰기 대기 시간 이점이 없습니다. 이로 인해 단일 쓰기 지역 계정으로 쓰기 대기 시간이 동일 하 게 됩니다.

## <a name="additional-reading"></a>추가 자료

일관성 개념에 대해 자세히 알아보려면 다음 문서를 참조하세요.

- [Azure Cosmos DB에서 제공하는 5가지 일관성 수준에 대한 고급 TLA+ 사양](https://github.com/Azure/azure-cosmos-tla)
- [Doug Terry에서 야구 (비디오)를 통해 복제 된 데이터 일관성을 설명 합니다.](https://www.youtube.com/watch?v=gluIh8zd26I)
- [Doug Terry에서 야구 (백서)를 통해 복제 된 데이터 일관성을 설명 했습니다.](https://www.microsoft.com/research/publication/replicated-data-consistency-explained-through-baseball/)
- [약하게 일관된 복제 데이터에 대한 세션 보장](https://dl.acm.org/citation.cfm?id=383631)
- [최신 분산 데이터베이스 시스템 디자인의 일관성 절충: CAP는 스토리의 일부일 뿐입니다.](https://www.computer.org/csdl/magazine/co/2012/02/mco2012020037/13rRUxjyX7k)
- [Probabilistic Bounded Staleness (PBS) for Practical Partial Quorums](https://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
- [최종 일관성 - 재고되었습니다.](https://www.allthingsdistributed.com/2008/12/eventually_consistent.html)

## <a name="next-steps"></a>다음 단계

Azure Cosmos DB의 일관성 수준에 대한 자세한 내용은 다음 문서를 참조하세요.

- [기본 일관성 수준 구성](how-to-manage-consistency.md#configure-the-default-consistency-level)
- [기본 일관성 수준 재정의](how-to-manage-consistency.md#override-the-default-consistency-level)
- [Azure Cosmos DB SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_3/)