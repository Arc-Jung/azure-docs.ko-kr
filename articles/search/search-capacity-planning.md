---
title: 쿼리 및 인덱스 워크로드에 대한 용량 조정
titleSuffix: Azure Cognitive Search
description: Azure Cognitive Search에서 파티션 및 복제본 컴퓨터 리소스를 조정하여 각 리소스의 요금이 청구 가능한 검색 단위로 책정됩니다.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/14/2020
ms.openlocfilehash: e2ba5301b81b1a6f5de696ab4587cd8ff43e3c68
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/27/2020
ms.locfileid: "77462567"
---
# <a name="adjust-capacity-in-azure-cognitive-search"></a>Azure 인지 검색에서 용량 조정

[검색 서비스를 프로비저닝하고](search-create-service-portal.md) 특정 가격 책정 계층에서 잠그기 전에 서비스의 복제본 및 파티션의 역할과 리소스 수요급증및 급락을 수용하기 위해 서비스를 조정하는 방법을 이해하는 데 몇 분 정도 걸릴 수 있습니다.

용량은 [선택한 계층의](search-sku-tier.md) 기능(계층은 하드웨어 특성을 결정함) 및 투영된 워크로드에 필요한 복제본 및 파티션 조합입니다. 계층 및 조정 크기에 따라 용량을 추가하거나 줄이는 데 15분에서 몇 시간까지 걸릴 수 있습니다. 

복제본 및 파티션의 할당을 수정할 때Azure 포털을 사용하는 것이 좋습니다. 포털은 계층의 최대 한도 미만으로 유지되는 허용 가능한 조합에 대한 제한을 적용합니다. 그러나 스크립트 기반 또는 코드 기반 프로비저닝 접근 방식이 필요한 경우 [Azure PowerShell](search-manage-powershell.md) 또는 [관리 REST API는](https://docs.microsoft.com/rest/api/searchmanagement/services) 대체 솔루션입니다.

## <a name="terminology-replicas-and-partitions"></a>용어: 복제본 및 파티션

|||
|-|-|
|*파티션을* | 읽기/쓰기 작업(예: 인덱스를 다시 작성하거나 새로 고치는 경우)을 위한 인덱스 스토리지 및 I/O를 제공합니다. 각 파티션에는 총 인덱스의 공유가 있습니다. 세 개의 파티션을 할당하면 인덱스가 세 부분으로 나뉩니다. |
|*복제본* | 검색 서비스의 인스턴스로 쿼리 작업을 부하 분산하는 데 주로 사용됩니다. 각 복제본은 인덱스의 복사본 하나입니다. 세 개의 복제본을 할당하는 경우 쿼리 요청을 처리하는 데 사용할 수 있는 인덱스 복사본 3개가 있습니다.|

## <a name="when-to-add-nodes"></a>노드를 추가하는 경우

처음에 서비스는 하나의 파티션과 하나의 복제본으로 구성된 최소한의 리소스 수준을 할당합니다. 

단일 서비스에는 모든 워크로드(인덱싱 및 쿼리)를 처리할 만큼 충분한 리소스가 있어야 합니다. 두 워크로드는 백그라운드에서 실행되지 않습니다. 쿼리 요청이 자연스럽게 덜 빈번한 시간에 대해 인덱싱을 예약할 수 있지만 서비스는 다른 작업보다 우선 순위를 지정하지 않습니다. 또한 일정량의 중복성은 서비스 또는 노드가 내부적으로 업데이트될 때 쿼리 성능을 원활하게 합니다.

일반적으로 검색 응용 프로그램은 특히 서비스 작업이 쿼리 워크로드에 편향되어 있는 경우 파티션보다 더 많은 복제본이 필요한 경향이 있습니다. [고가용성](#HA) 섹션에 그 이유가 설명되어 있습니다.

복제본이나 파티션을 더 추가하면 서비스 실행 비용이 증가합니다. [가격 계산기를](https://azure.microsoft.com/pricing/calculator/) 확인하여 노드를 추가하는 데 따른 청구 의미를 이해해야 합니다. [아래 차트는](#chart) 특정 구성에 필요한 검색 단위 수를 상호 참조하는 데 도움이 될 수 있습니다.

## <a name="how-to-allocate-replicas-and-partitions"></a>복제본 및 파티션을 할당하는 방법

1. [Azure Portal](https://portal.azure.com/) 에 로그인하고 검색 서비스를 선택합니다.

1. **설정에서** **배율** 페이지를 열어 복제본 및 파티션을 수정합니다. 

   다음 스크린샷은 하나의 복제본 및 파티션으로 프로비전된 표준 서비스를 보여 주며, 아래수의 수식은 사용 중인 검색 단위 수(1)를 나타냅니다. 단가가 $100(실제 가격이 아님)인 경우 이 서비스를 실행하는 월별 비용은 평균 $100입니다.

   ![현재 값을 표시하는 배율 페이지](media/search-capacity-planning/1-initial-values.png "현재 값을 표시하는 배율 페이지")

1. 슬라이더를 사용하여 파티션 수를 늘리거나 줄입니다. 아래수의 수식은 사용 중인 검색 단위 수를 나타냅니다.

   이 예제에서는 각각 두 개의 복제본과 파티션으로 용량을 두 배로 늘렸습니다. 검색 단위 수를 확인합니다. 청구 수식에 파티션(2 x 2)을 곱한 복제본이기 때문에 이제 4개가 됩니다. 용량을 두 배로 늘리면 서비스 실행 비용이 두 배 이상 늘어날 수 있습니다. 검색 단위 비용이 $100이면 새 월별 청구서는 이제 $400가 됩니다.

   각 계층의 현재 단위 비용에 대한 [가격 책정 페이지를](https://azure.microsoft.com/pricing/details/search/)방문하십시오.

   ![복제본 및 파티션 추가](media/search-capacity-planning/2-add-2-each.png "복제본 및 파티션 추가")

1. 변경 내용을 확인하려면 **저장을** 클릭합니다.

   ![규모 및 청구 변경 사항 확인](media/search-capacity-planning/3-save-confirm.png "규모 및 청구 변경 사항 확인")

   용량 변경을 완료하는 데 몇 시간이 걸립니다. 프로세스가 시작되고 복제본 및 파티션 조정에 대한 실시간 모니터링이 없는 후에는 취소할 수 없습니다. 그러나 변경 이 진행 되는 동안 다음 메시지가 표시 됩니다.

   ![포털의 상태 메시지](media/search-capacity-planning/4-updating.png "포털의 상태 메시지")

> [!NOTE]
> 서비스를 프로비전한 후에는 상위 계층으로 업그레이드할 수 없습니다. 새 계층에서 검색 서비스를 만들고 인덱스를 다시 로드해야 합니다. 서비스 프로비저닝에 대한 [도움말은 포털에서 Azure Cognitive Search 서비스 만들기를](search-create-service-portal.md) 참조하십시오.
>
> 또한 파티션과 복제본은 서비스에서 독점적으로 내부적으로 관리됩니다. 프로세서 선호도 또는 특정 노드에 워크로드를 할당하는 개념은 없습니다.
>

<a id="chart"></a>

## <a name="partition-and-replica-combinations"></a>파티션 및 복제본 조합

기본 서비스는 정확히 한 개의 파티션과 최대 세 개의 복제본을 가질 수 있으며 최대 세 개의 SU로 제한됩니다. 유일하게 조정할 수 있는 리소스는 복제본입니다. 쿼리에서 고가용성을 위해 최소 두 개의 복제본이 필요합니다.

모든 표준 및 저장소 최적화검색 서비스는 36-SU 제한에 따라 다음과 같은 복제본 및 파티션 조합을 가정할 수 있습니다. 

|   | **파티션 1개** | **파티션 2개** | **파티션 3개** | **파티션 4개** | **파티션 6개** | **파티션 12개** |
| --- | --- | --- | --- | --- | --- | --- |
| **복제본 1개** |1 SU |2 SU |3 SU |4 SU |6 SU |12 SU |
| **복제본 2개** |2 SU |4 SU |6 SU |8 SU |12 SU |24 SU |
| **복제본 3개** |3 SU |6 SU |9 SU |12 SU |18 SU |36 SU |
| **복제본 4개** |4 SU |8 SU |12 SU |16 SU |24 SU |해당 없음 |
| **복제본 5개** |5 SU |10 SU |15 SU |20 SU |30 SU |해당 없음 |
| **복제본 6개** |6 SU |12 SU |18 SU |24 SU |36 SU |해당 없음 |
| **복제본 12개** |12 SU |24 SU |36 SU |해당 없음 |해당 없음 |해당 없음 |

SU, 가격 책정 및 용량에 대해서는 Azure Websites에 자세히 설명되어 있습니다. 자세한 내용은 [가격 정보](https://azure.microsoft.com/pricing/details/search/)를 참조하세요.

> [!NOTE]
> 복제본 및 파티션 수는 12를 고르게 나눌 수 있는 값입니다(특히 1, 2, 3, 4, 6, 12). 이는 Azure Cognitive Search가 각 인덱스를 12개의 샤드로 미리 분할하여 모든 파티션에 동일한 부분으로 분산될 수 있기 때문입니다. 예를 들어, 서비스에 파티션이 세 개 있는 상태에서 인덱스를 하나 만들 경우 각 파티션에는 분할된 인덱스가 4개가 포함됩니다. Azure Cognitive Search가 인덱스를 샤드하는 방식은 향후 릴리스에서 변경될 수 있는 구현 세부 정보입니다. 지금은 그 숫자가 12이지만 이후에 12가 아닌 값으로 바뀔 수도 있습니다.
>

<a id="HA"></a>

## <a name="high-availability"></a>고가용성

확장이 쉽고 비교적 빠르기 때문에, 일반적으로 파티션 하나와 복제본 한두 개로 시작한 후 쿼리 볼륨이 커지면 확장하는 것이 좋습니다. 쿼리 작업은 복제본에서 주로 실행됩니다. 고가용성이나 처리량이 더 필요한 경우에는 추가 복제본이 필요할 가능성이 높습니다.

고가용성을 위한 일반적인 권장 사항은 다음과 같습니다.

* 읽기 전용 작업(쿼리)의 고가용성을 위한 복제본 두 개

* 읽기/쓰기 워크로드의 고가용성을 위한 복제본 세 개 이상(개별 문서가 추가, 업데이트 또는 삭제됨에 따라 쿼리 및 인덱싱)

Azure Cognitive Search에 대한 서비스 수준 계약(SLA)은 문서 추가, 업데이트 또는 삭제로 구성된 쿼리 작업 및 인덱스 업데이트를 대상으로 합니다.

기본 계층은 하나의 파티션과 세 개의 복제본에 우선합니다. 인덱싱 및 쿼리 처리량 모두에 대한 수요 변동에 즉시 응답하기 위한 유연성이 필요한 경우 표준 계층 중 하나를 사용하는 것이 좋습니다.  저장소 요구 사항이 쿼리 처리량보다 훨씬 빠르게 증가하고 있는 경우 저장소 최적화 계층 중 하나를 고려하십시오.

## <a name="disaster-recovery"></a>재해 복구

현재, 재해 복구를 위한 기본 제공 메커니즘은 없습니다. 파티션이나 복제본을 제거하는 것은 재해 복구 목표를 달성하기 위한 전략으로 올바르지 않습니다. 가장 일반적인 방법은 다른 지역에서 두 번째 검색 서비스를 설정하여 서비스 수준에서 중복성을 추가하는 것입니다. 인덱스를 다시 작성하는 동안 가용성과 마찬가지로 리디렉션 또는 장애 조치 논리를 사용자 코드에서 가져와야 합니다.

## <a name="estimate-replicas"></a>복제본 추정

프로덕션 서비스에서SLA를 위해 세 개의 복제본을 할당해야 합니다. 쿼리 성능이 저하되는 경우 더 큰 쿼리 워크로드를 지원하고 여러 복제본에 대한 요청의 균형을 로드하기 위해 인덱스의 추가 복사본을 온라인 상태로 만들도록 복제본을 추가할 수 있습니다.

쿼리 부하를 수용하는 데 필요한 복제본 수에 대한 지침은 제공하지 않습니다. 쿼리 성능은 쿼리 및 경쟁 워크로드의 복잡성에 따라 달라집니다. 복제본을 추가하면 성능이 확실히 증가되지만 결과가 반드시 비례하지 않습니다. 복제본을 세 개 추가한다고 해서 처리량이 3배가 되는 것은 아닙니다.

솔루션의 QPS 예측에 대한 지침은 [성능에 대한 확장](search-performance-optimization.md)및 쿼리 [모니터링을 참조하세요.](search-monitor-queries.md)

## <a name="estimate-partitions"></a>파티션 추정

[선택한 계층은](search-sku-tier.md) 파티션 크기와 속도를 결정하며 각 계층은 다양한 시나리오에 맞는 특성 집합을 중심으로 최적화됩니다. 고급 계층을 선택하는 경우 S1로 이동하는 경우보다 파티션 수가 적을 수 있습니다. 자체 주도 테스트를 통해 답해야 할 질문 중 하나는 더 크고 비용이 많이 드는 파티션이 하위 계층에서 프로비저닝된 서비스에서 두 개의 저렴한 파티션보다 더 나은 성능을 제공하는지 여부입니다.

거의 실시간으로 진행되는 데이터 새로 고침을 필요로 하는 검색 애플리케이션은 복제본보다 비례적으로 더 많은 파티션이 필요합니다. 파티션을 추가하면 많은 수의 컴퓨팅 리소스로 읽기/쓰기 작업이 분산됩니다. 또한 추가 인덱스와 문서를 저장하기 위한 더 많은 디스크 공간이 보장됩니다.

인덱스가 클수록 쿼리하는 데 더 오래 걸립니다. 따라서 파티션을 증분 방식으로 증가시킬 때마다 더 작지만 비례적으로 복제본도 늘려야 합니다. 쿼리의 복잡성과 쿼리 용량은 쿼리 실행이 얼마나 빠르게 진행되는지에 영향을 줍니다.

## <a name="next-steps"></a>다음 단계

> [!div class="nextstepaction"]
> [Azure 인지 검색에 대한 가격 책정 계층 선택](search-sku-tier.md)