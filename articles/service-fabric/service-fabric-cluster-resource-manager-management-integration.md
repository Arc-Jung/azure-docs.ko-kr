<properties
   pageTitle="서비스 패브릭 클러스터 리소스 관리자 - 관리 통합 | Microsoft Azure"
   description="클러스터 리소스 관리자과 서비스 패브릭 관리 간에 통합 지점의 개요입니다."
   services="service-fabric"
   documentationCenter=".net"
   authors="masnider"
   manager="timlt"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="03/10/2016"
   ms.author="masnider"/>


# 클러스터 리소스 관리자와 서비스 패브릭 클러스터 관리 통합
리소스 관리자는 관리 작업(예: 응용 프로그램 업그레이드)을 처리하는 서비스 패브릭의 주요 구성 요소가 아니지만 관련이 있습니다. 리소스 관리자가 관리에 도움이 되는 첫 번째 방법은 잘못이 발생할 때 리소스 관리 및 분산 측면과 서비스 패브릭 상태 하위 시스템을 통한 변경에서 클러스터와 내부 서비스의 필요한 상태를 추적하는 것입니다. 통합의 다른 부분은 업그레이드의 작동 방법과 관련이 있습니다. 구체적으로 리소스 관리자의 작동 방식에 대한 일부 사항이 업그레이드 중에 변경되고 일부 특별한 동작이 호출됩니다. 아래에서 두 가지 모두에 대해 알아보겠습니다.

## 상태 통합
리소스 관리자는 지속적으로 서비스에 대해 정의한 규칙을 추적하고 해당 규칙을 충족할 수 없는 경우 상태 경고 및 오류를 내보냅니다. 예를 들어, 노드가 용량이 초과된 상태이고 리소스 관리자가 상황을 수정할 수 없는 경우 노드 용량 초과를 나타내고 메트릭에 대한 상태 경고를 내보냅니다.

리소스 관리자가 상태 경고를 발생시키는 또 다른 예제는 배치 제약 조건을 정의(예: "NodeColor == 블루")하고 리소스 관리자가 해당 제약 조건의 위반을 감지한 경우입니다. 리소스 관리자가 적용하는 기본 제약 조건(예: 오류 및 업그레이드 도메인 배포) 뿐만 아니라 사용자 지정 제약 조건에 이 작업을 수행합니다. 이러한 상태 보고서의 예를 들면 다음과 같습니다. 이 경우에 오류의 문자열로 인해 발생할 수 있는 것처럼 해당 파티션의 복제본이 일시적으로 너무 적은 장애 도메인에 압축되기 때문에 상태 보고서는 시스템 서비스의 파티션 중 하나에 대한 것입니다.

```posh
PS C:\Users\User > Get-WindowsFabricPartitionHealth -PartitionId '00000000-0000-0000-0000-000000000001'


PartitionId           : 00000000-0000-0000-0000-000000000001
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='System.PLB', Property='ReplicaConstraintViolation_FaultDomain', HealthState='Warning', ConsiderWarningAsError=false.

ReplicaHealthStates   :
                        ReplicaId             : 130766528804733380
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577821
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528854889931
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577822
                        AggregatedHealthState : Ok

                        ReplicaId             : 130837073190680024
                        AggregatedHealthState : Ok

HealthEvents          :
                        SourceId              : System.PLB
                        Property              : ReplicaConstraintViolation_FaultDomain
                        HealthState           : Warning
                        SequenceNumber        : 130837100116930204
                        SentAt                : 8/10/2015 7:53:31 PM
                        ReceivedAt            : 8/10/2015 7:53:33 PM
                        TTL                   : 00:01:05
                        Description           : The Load Balancer has detected a Constraint Violation for this Replica: fabric:/System/FailoverManagerService Secondary Partition 00000000-0000-0000-0000-000000000001 is
                        violating the Constraint: FaultDomain Details: Node -- 3d1a4a68b2592f55125328cd0f8ed477  Policy -- Packing
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : Ok->Warning = 8/10/2015 7:13:02 PM, LastError = 1/1/0001 12:00:00 AM
```

상태 메시지는 다음과 같은 사항을 알려줍니다.

1.	모든 복제본은 자체로 정상입니다(서비스 패브릭의 첫 번째 우선 순위임)
2.	장애 도메인 배포 제약 조건은 현재 위반되었습니다(특정 장애 도메인에 이 파티션에 대한 복제본이 있어야 하는 것 보다 많음을 의미함)
3.	위반의 원인이 되는 복제본을 포함하는 노드(해당 노드 ID: 3d1a4a68b2592f55125328cd0f8ed477)
4.	이 모두가 발생한 때(2015년 8월 10일 오후 7:13:02) 오류가 발생하여 살펴봐야 한다는 것을 알 수 있도록 프로덕션에서 발생하는 경고로서 유용한 데이터입니다. 예를 들어 이 경우에 리소스 관리자가 장애 도메인에 복제본을 압축하는 것 이외의 선택이 없다고 여긴 이유를 알아낼 수 있는지 확인하려고 합니다. 다른 장애 도메인 노드의 모든 노드가 중지되고 충분한 다른 예비 도메인이 없었기 때문이었을 수 있습니다. 또는 충분한 도메인이 다른 장애 도메인에 있는 노드가 무효화되게 만든 다른 작업을 수행하고 있는 경우이었을 수 있습니다(예: 서비스의 InvalidDomain 정책).

그러나 서비스를 만들거나 리소스 관리자가 일부 서비스를 배치할 수 있는 위치를 찾으려고 시도함에도 불구하고 해결할 수 있는 방법이 없어 보입니다. 여러 가지 이유가 있을 수 있지만 일반적으로 다음 두 가지 조건 중 하나로 인한 것입니다.

1.	일부 일시적 조건 때문에 서비스 인스턴스 또는 복제본을 올바르게 배치할 수 없습니다.
2.	서비스의 요구 사항은 해당 요구 사항을 충족시킬 수 없는 방법으로 잘못 구성되어 있습니다.

이러한 각 조건에서 진행 상황 및 서비스를 배치할 수 없는 이유를 확인할 수 있는 정보를 제공하는 리소스 관리자의 상태 보고서가 표시됩니다. 이 프로세스는 "제약 조건 제거 시퀀스"라고 합니다. 이 프로세스를 실행하는 동안 서비스에 영향을 주는 구성된 제약 조건을 안내하고 제거한 항목을 확인합니다. 따라서 항목을 배치할 수 없는 경우 제거된 노드 및 원인을 확인할 수 있습니다. 이러한 상태 보고서에서 확인할 수 있는 다양한 제약 조건 및 상태 보고서가 검사하는 항목을 살펴보겠습니다. 대부분의 경우 기본적으로 제약 조건이 소프트나 최적화 수준이기 때문에(이전에 설명한 것처럼) 이러한 제약 조건이 제거한 노드가 표시되지 않습니다. 대칭 이동하거나 어려운 제약 조건으로 다루어지는 경우 확인할 수 있으므로 완전성을 위해 다음에 표시합니다.

-	ReplicaExclusionStatic 및 ReplicaExclusionDynamic – 검색하는 동안 두 개의 복제본을 노드에 배치해야 한다고 결정하였음을 나타내는 내부 제약 조건입니다(허용되지 않음). ReplicaExclusionStatic 및 ReplicaExclusionDynamic은 거의 동일한 규칙입니다. ReplicaExclusionDynamic 제약 조건은 "유일하게 제안된 솔루션이 이미 여기에 복제본을 배치했기 때문에 이 복제본을 여기에 배치할 수 없습니다"라고 합니다. 제안된 충돌이 아닌 실제 충돌임을 나타내는 ReplicaExclusionStatic 제외 목록과 달리 노드에 복제본이 이미 있습니다. 혼란스러운가요? 예. 문제가 됩니까? 아니요. ReplicaExclusionStatic 또는 ReplicaExclusionDynamic 제약 조건이 포함된 제약 조건 제거 시퀀스가 표시되는 경우 리소스 관리자는 모든 복제본을 배치할 충분한 노드가 없다고 여깁니다. 추가 제약 조건은 일반적으로 처음부터 노드가 너무 적었다는 점을 알려줍니다.
-	PlacementConstraint: 이 메시지가 표시되는 경우 서비스의 배치 제약 조건에 일치하지 않는 일부 노드를 제거했음을 의미합니다. 현재 구성된 배치 제약 조건을 이 메시지의 일부분으로 추적합니다.
-	NodeCapacity: 이 제약 조건이 표시되면 이 방법이 노드의 용량을 초과할 수 있기 때문에 복제본을 표시된 노드에 배치할 수 없었다는 의미입니다.
-	선호도: 이 제약 조건은 선호도 제약 조건을 위반하기 때문에 영향을 받는 노드에 복제본을 배치할 수 없었다는 것을 나타냅니다.
-	FaultDomain & UpgradeDomain: 이 제약 조건은 표시된 노드에 복제본을 배치하여 특정 오류 또는 업그레이드 도메인에서 압축이 일어나는 경우 노드를 제거합니다.
-	PreferredLocation: 일반적으로 이 제약 조건을 확인하면 기본적으로 최적화되었기 때문에 솔루션에서 노드를 제거하게 됩니다. 또한 기본 설정된 위치 제약 조건은 일반적으로 업그레이드 중에만 제공되지만(업그레이드를 시작할 때 원래 위치에 그대로 다시 복제본을 이동하는 데 사용되는 경우) 가능합니다.

## 업그레이드
또한 리소스 관리자는 응용 프로그램 및 클러스터 업그레이드 중에 업그레이드가 원활하도록 할 뿐만 아니라 클러스터의 규칙 및 성능이 손상되지 않도록 도움을 줍니다.

### 규칙 적용 유지
알고 있어야 하는 중요한 점은 배치 제약 조건과 같은 사항의 엄격한 제어가 업그레이드하는 동안 계속 적용된다는 것입니다. 언급하지 않아도 당연하지만 명시적으로 밝혀둡니다. 긍정적인 면은 해당 특정 워크로드가 업그레이드하는 동안에 발생하(지 않)는 특정 노드에서 실행되지 않도록 하려는 경우 이를 확인할 수 있다는 점입니다. 환경이 매우 제한된 경우 패치를 적용하기 위해 중지되어야 한다면 서비스를 적용할 위치에 몇 가지 옵션만 있기 때문에 업그레이드하는 데 시간이 오래 걸릴 수 있습니다.

### 스마트 대체
업그레이드를 시작할 때 리소스 관리자는 클러스터의 현재 정렬에 대한 스냅숏을 만들고 업그레이드가 완료되면 해당 상태로 작업을 반환하려고 합니다. 이 원인은 간단합니다. 우선 업그레이드의 일환으로 각 서비스에 대한 몇 가지 변환이 필요합니다(영향을 받은 노드에서 벗어나서 다시 들어옴). 다음으로 업그레이드 자체가 클러스터의 레이아웃에 크게 영향을 주지 않도록 합니다. 업그레이드하기 전에 클러스터가 잘 정렬된 경우 이후에도 잘 정렬됩니다.

### 이탈 감소
업그레이드하는 동안 발생하는 다른 작업은 리소스 관리자가 업그레이드된 엔터티에 대한 부하 분산을 해제하는 것입니다. 따라서 두 개의 응용 프로그램 인스턴스를 가지고 그 중 하나에서 업그레이드를 시작하면 해당 응용 프로그램 인스턴스에 대한 부하 분산이 일시 중지되지만 다른 응용 프로그램 인스턴스에는 영향을 주지 않습니다. 반응 부하 분산 방지는 리소스 관리자가 업그레이드에 응답하지 않도록 방지합니다.(“이런! 빈 노드입니다. 모든 종류의 항목으로 채우는 것이 좋습니다.”) 그리고 업그레이드가 완료된 후에 서비스가 노드로 다시 이동해야 하는 경우 실행을 취소한 클러스터의 서비스에 대한 추가 이동이 결과적으로 많이 발생합니다. 문제가 되는 업그레이드가 클러스터 업그레이드인 경우 전체 클러스터는 업그레이드의 기간 동안 부하 분산을 위해 일시 중지됩니다(제약 조건 검사 – 규칙이 적용되도록 함 – 활성 상태로 유지).

### 관대한 규칙
업그레이드 하는 동안 발생하는 한 가지 문제는 일반적으로 클러스터가 전체적으로 다소 제한되거나 가득 찬 경우라도 업그레이드를 완료하려 할 경우입니다. 이 작업을 수행하는 방법에 대해 이미 알아보았지만 업그레이드하는 동안 클러스터를 통해 업그레이드를 실행하고 워크로드를 다른 위치를 이동할 때 클러스터의 5-20%가 한 번에 중지되는 경우 더욱 중요합니다. 이 경우에 앞서 언급한 버퍼링된 용량의 개념이 실제로 발휘됩니다. 버퍼링된 용량이 정상적인 작업 중에 적용되는 동안 리소스 관리자는 업그레이드 중에 전체 용량을 가득 채우게 됩니다.

## 다음 단계
- 처음부터 시작 및 [서비스 패브릭 클러스터 리소스 관리자 소개](service-fabric-cluster-resource-manager-introduction.md)

<!---HONumber=AcomDC_0316_2016-->