<properties
   pageTitle="서비스 패브릭 클러스터 업그레이드 | Microsoft Azure"
   description="인증서 업그레이드를 포함하고 응용 프로그램 포트, OS 패치 등을 추가하는 서비스 패브릭 클러스터를 실행하는 패브릭 코드 및/또는 구성을 업그레이드합니다. 업그레이드를 수행할 때 예상할 수 있는 것은 무엇입니까?"
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="11/23/2015"
   ms.author="chackdan"/>

# 서비스 패브릭 클러스터 업그레이드

서비스 패브릭 클러스터는 개인이 소유하지만 Microsoft에서 부분적으로 관리하는 리소스입니다. 이 문서는 자동으로 관리되는 것과 스스로 구성할 수 있는 것을 설명합니다.

## 자동으로 관리되는 클러스터 구성

Microsoft는 클러스터에서 실행하는 패브릭 코드 및 구성을 유지 관리하고 필요한 기준으로 소프트웨어에 자동 모니터링된 업그레이드를 수행합니다. 이러한 업그레이드는 코드, 구성 또는 둘 모두가 될 수 있습니다. 응용 프로그램이 이러한 업그레이드로 인해 영향이 없거나 최소한의 영향이 있는지 확인하기 위해 세 단계로 업그레이드를 수행합니다.

### 1단계: 모든 클러스터 상태 정책을 사용하여 업그레이드 수행

이 단계 동안 업그레이드는 한 번에 하나의 업그레이드 도메인을 진행하고 클러스터에서 실행 중이던 응용 프로그램은 가동 중지 시간 없이 계속 실행합니다. 클러스터 상태 정책(노드 상태 및 클러스터에서 실행 중인 모든 응용 프로그램의 상태 조합)은 업그레이드의 기간을 준수합니다.

클러스터 상태 정책이 충족되지 않는 경우 업그레이드가 롤백되고 수정 작업으로 클러스터 업그레이드를 롤백해야 했다는 전자 메일이 구독 소유자에게 보내지고 다른 n일 내에 2단계를 실행합니다. n은 변수입니다. 인프라 이유로 인해 실패한 업그레이드를 배제하도록 동일한 업그레이드를 몇 번 더 실행하기 위해 노력하고 전자 메일이 전송된 날짜에서 n일 후 2단계로 진행합니다.

클러스터 상태 정책이 충족하는 경우 업그레이드가 성공한 것으로 간주하고 완료로 표시됩니다. 이는 초기 또는 이 단계의 업그레이드 다시 실행 중 발생할 수 있습니다. 성공적 실행에 대한 전자 메일 확인은 없습니다. (너무 많은 전자 메일을 전송하지 않도록 하며 전자 메일 수신은 정상에 대한 예외로 보여야 합니다. 클러스터 업그레이드가 응용 프로그램 가용성에 영향을 주지 않고 진행되기를 예상합니다.)

클러스터에 대한 사용자 지정 상태 정책을 설정하는 방법에 대한 자세한 내용은 [클러스터 업그레이드 및 상태 매개 변수](service-fabric-cluster-health-parameters.md)를 참조하세요.

### 2단계: 기본 상태 정책만을 사용하여 업그레이드 수행

상태 정책은 업그레이드 시작 시 정상 상태가 업그레이드 프로세스의 기간 동안 동일하게 유지되는 응용 프로그램의 수 방식으로 설정됩니다. 1단계와 마찬가지로 이 단계 동안 업그레이드는 한 번에 하나의 업그레이드 도메인을 진행하고 클러스터에서 실행 중이던 응용 프로그램은 가동 중지 시간 없이 계속 실행합니다. 클러스터 상태 정책(노드 상태 및 클러스터에서 실행 중인 모든 응용 프로그램의 상태 조합)은 업그레이드의 기간을 준수합니다.

적용되는 클러스터 상태 정책이 충족되지 않는 경우 업그레이드가 롤백되고 수정 작업으로 클러스터 업그레이드를 롤백해야 했다는 전자 메일이 구독 소유자에게 보내지고 다른 n일 내에 3단계를 실행합니다. n은 변수입니다.

인프라 이유로 인해 실패한 업그레이드를 배제하도록 동일한 업그레이드를 몇 번 더 실행하기 위해 노력합니다. 미리 알림 전자 메일은 n일이 끝나기 몇 일 전에 전송됩니다. 전자 메일이 전송된 날짜에서 n일 후 3단계로 진행합니다. 2단계에서 전송한 전자 메일은 심각하게 받아들여져야 하며 수정 작업이 수행되어야 합니다.

클러스터 상태 정책이 충족하는 경우 업그레이드가 성공한 것으로 간주하고 완료로 표시됩니다. 이는 초기 또는 이 단계의 업그레이드 다시 실행 중 발생할 수 있습니다. 성공적 실행에 대한 전자 메일 확인은 없습니다.

### 3단계: 까다로운 상태 정책을 사용하여 업그레이드 수행

이러한 상태 정책은 응용 프로그램의 상태보다 업그레이드 완료에 맞춰집니다. 이 단계에서 매우 적은 클러스터 업그레이드가 끝납니다. 클러스터가 이 단계에서 끝나는 경우 응용 프로그램이 비정상이 되고/되거나 가용성이 손실될 수 있습니다.

다른 두 단계와 마찬가지로 3단계 업그레이드는 한 번에 하나의 업그레이드 도메인을 진행합니다.

적용되는 클러스터 상태 정책이 충족되지 않는 경우 업그레이드가 롤백되고 인프라 이유로 인해 실패한 업그레이드를 배제하도록 동일한 업그레이드를 몇 번 더 실행하기 위해 노력하며 클러스터가 고정된 후 지원 및/또는 업그레이드를 더 이상 받지 않습니다.

이 정보가 포함된 전자 메일이 수정 작업으로 구독 소유자에게 전송됩니다. 클러스터가 3단계가 실패한 상태에 빠지는 것을 기대하지 않습니다.

클러스터 상태 정책이 충족하는 경우 업그레이드가 성공한 것으로 간주하고 완료로 표시됩니다. 이는 초기 또는 이 단계의 업그레이드 다시 실행 중 발생할 수 있습니다. 성공적 실행에 대한 전자 메일 확인은 없습니다.

## 사용자가 제어하는 클러스터 구성

라이브 클러스터에서 변경할 수 있는 구성은 다음과 같습니다.

### 인증서

포털에서 또는 servicefabric.cluster 리소스의 PUT 명령 발급을 통해 손쉽게 주 또는 보조 인증서를 업데이트할 수 있습니다.

![CertificateUpgrade][CertificateUpgrade]

**참고** 클러스터 리소스에 사용할 인증서를 식별하려면 먼저 다음 단계를 완료해야 합니다. 다른 방법으로는 새 인증서가 사용되지 않습니다. 1) keyvault에 새 인증서를 업로드합니다. 지침은 [서비스 패브릭 보안](service-fabric-cluster-security.md)을 참조하세요(이 문서의 2단계부터 시작). 2) 인증서가 배포되도록 클러스터를 구성하는 모든 가상 컴퓨터를 업데이트합니다. 작업 방법은 [이 블로그 게시물](http://blogs.technet.com/b/kv/archive/2015/07/14/vm_2d00_certificates.aspx)을 참조하세요.

### 응용 프로그램 포트

노드 형식에 연결된 부하 분산 장치 리소스 속성을 변경하여 이렇게 할 수 있습니다. 포털 또는 ARM PowerShell을 직접 사용할 수 있습니다.

노드 형식에서 모든 VM의 새 포트를 열려면 다음을 수행해야 합니다.

1. **적절한 부하 분산 장치에 새 프로브 추가**

    포털을 사용하여 클러스터를 배포한 경우 부하 분산 장치는 각 노드 형식에 대해 "loadBalancer 0", "loadBalancer-1" 등으로 이름이 지정됩니다. 부하 분산 장치 이름은 리소스 그룹(RG)에만 고유하므로 주어진 RG 아래에 대해 검색하는 것이 가장 좋습니다.

    ![AddingProbes][AddingProbes]


2. **부하 분산 장치에 새 규칙 추가**

    동일한 부하 분산 장치에 이전 단계에서 만든 프로브를 사용하여 새 규칙을 추가합니다.

    ![AddingLBRules][AddingLBRules]


### 배치 속성

  각 노드 형식의 경우 사용하려는 사용자 지정 배치 속성을 응용 프로그램에 추가할 수 있습니다. NodeType은 명시적으로 추가하지 않고 사용할 수 있는 기본 속성입니다.

  >[AZURE.NOTE]배치 속성 사용에 대한 세부 정보는 [배치 제약 조건 설명서](service-fabric-placement-constraint.md)를 참조하세요.

### 용량 메트릭

각 노드 형식의 경우 부하를 보고하도록 사용하려는 사용자 용량 메트릭을 응용 프로그램에 추가할 수 있습니다. 로드 보고를 위한 용량 메트릭 사용에 대한 세부 정보는 [동적 로드 보고 개요](service-fabric-resource-balancer-dynamic-load-reporting.md)를 참조하세요.

### 클러스터를 구성하는 가상 컴퓨터에 OS 패치 적용
들어오는 기능입니다. VM에 패치해야 할 의무가 있습니다. 한 번에 하나의 VM에 이를 수행하여 한 번에 둘 이상의 VM이 작동 중지되지 않도록 해야 합니다.

### 클러스터를 구성하는 가상 컴퓨터의 새 것으로 OS 업그레이드
사용 중인 OS 이미지를 업그레이드해야 하는 경우 한 번에 하나의 VM에 이 작업을 수행하고 이 업그레이드에 대한 책임을 져야 합니다. 자동화가 없습니다.


## 다음 단계

- [클러스터를 확장 및 축소](service-fabric-cluster-scale-up-down.md)하는 방법 알아보기
- [응용 프로그램 업그레이드](service-fabric-application-upgrade.md)에 대해 알아보기

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes.png
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png

<!---HONumber=AcomDC_1210_2015-->