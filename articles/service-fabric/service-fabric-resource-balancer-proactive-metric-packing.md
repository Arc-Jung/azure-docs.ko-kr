<properties
   pageTitle="사전 메트릭 압축 | Microsoft Azure"
   description="리소스 분산 장치에서 사전 메트릭 압축 사용에 대한 개요"
   services="service-fabric"
   documentationCenter=".net"
   authors="GaugeField"
   manager="timlt"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="09/03/2015"
   ms.author="masnider"/>

# 사전 메트릭 압축

Service 서비스 패브릭 리소스 분산 장치의 일반 구성은 모든 노드의 모든 메트릭당 사용률을 동일하게 맞추는 것이 목표입니다. 리소스 분산 장치는 새 서비스 요청이 도착하면 서비스 위치를 찾는 역할도 수행합니다. 새 서비스 복제본(모든 서비스 파티션의 모든 복제본)을 배치할 공간이 부족한 경우, 리소스 분산 장치는 기존 워크로드를 다른 곳으로 이동하여 공간 생성을 시도합니다. 이것은 지극히 정상적이지만 클러스터가 가득 찬 정도와 워크로드 조각화 수준에 따라서 시간이 걸릴 수 있습니다.

예를 들어 클러스터가 제대로 활용되는 상황에서 고객이 기본 부하가 큰 서비스(예: 하나 이상의 메트릭에 대해 최대 노드 용량 사용)를 새로 추가하고자 한다면 리소스 분산 장치는 새 서비스를 배치하기 위해 여러 복제본을 이동해야 할 수 있습니다. 또한, 크기가 크고 상태를 저장하는 서비스는 데이터를 복사해야 하기 때문에 필요한 이동을 수행하는데 어느 정도 시간이 걸릴 수 있습니다. 이러한 두 가지 사안 때문에 새 서비스를 만드는 시간이 길어질 수 있습니다. 일반적으로 서비스는 간혹 생성 시간이 길어져도 허용하는 반면 일부 워크로드는 이를 허용하지 않고 최대한 빨리 생성되기를 원합니다. 정상 상태에서 리소스 분산 장치는 새 워크로드에 충분한 공간이 제공될 가능성을 높이기 위해 클러스터를 “조각 모음”해야 합니다.

사전 매트릭 압축(조각 모음이라고도 함) 메커니즘은 리소스 분산 장치에서 분산 단계의 일부로 실행됩니다. 분산 과정에서 워크로드를 분배하지 않고 워크로드를 더 적은 노드에 압축하여 서비스 생성 시간을 최소화하는 것이 그 목적입니다. 조각 모음을 위한 메트릭이 구성되면 리소스 분산 장치는 부하 분산에 사용되는 최소 평균 표준 편차가 아닌 최대 평균 표준 편차 달성을 목표로 합니다.

리소스 분산 장치는 최대 편차로 최대한 많은 노드를 비워두면서 일부 노드에 가능한 한 많은 서비스를 배치하려고 시도합니다. 그 외에도 새 서비스 배치의 기본적인 제약 중 하나는 복제본을 동일한 업그레이드 도메인이나 장애 도메인에 배치할 수 없다는 것입니다. 새 서비스를 신속하게 추가할 수 있게 되는 것을 목표로 하기 때문에 리소스 분산 관리자는 업그레이드 도메인 및 장애 도메인 사이 부하 분산에 최소 표준 편차를 목표로 해야 합니다(업그레이드 도메인/장애 도메인 당 서비스 부하의 합계). 그 결과 업그레이드 도메인/장애 도메인당 사용 가능한 공간이 동일하게 될 것입니다. 조각 모음은 선호도, 배치 제약 조건, 노드 메트릭 용량과 같은 시스템 내의 다른 모든 제약 조건을 따릅니다.

## 리소스 분산 장치 클러스터 구성
클러스터 매니페스트 내에서 다음 구성 값은 리소스 분산 장치 하에서 메트릭 압축 기능의 전반적인 동작을 정의합니다.

### DefragmentationMetrics

조각 모음 메트릭은 리소스 분산 장치에서 사전 압축/조각 모음에 대해 고려해야 하는 메트릭입니다. 구성된 모든 메트릭이 이 목록에 지정되어야 합니다(활동 및 분산 임계값 목록과 마찬가지). 메트릭이 “true” 값으로 지정되어 있으면 조각 모음 메트릭으로 처리됩니다. 값이 “false”이면(또는 메트릭이 이 목록에 지정되지 않으면) 해당 메트릭은 조각 모음에서 제외됩니다.

``` xml
<FabricSettings>
  <Section Name="DefragmentationMetrics">
    <Parameter Name="MetricName1" Value="true"/>
    <Parameter Name="MetricName2" Value="false"/>
  </Section>
</FabricSettings>
```

### BalacingThreshholds

분산 임계값은 리소스 분산 장치에서 분산 단계(메트릭 압축 논리를 구현하는)를 실행하기 전에 조각화된 클러스터가 특정 메트릭과 관련하여 어떻게 될지를 결정합니다. 메트릭이 조각 모음 메트릭으로 간주되는 경우 분산 임계값은 리소스 분산 장치가 클러스터 조각 모음을 시작하기 전까지 허용하는 업그레이드 도메인 또는 장애 도메인당 최대 사용 노드와 최소 사용 노드 사이의 최소 비율입니다. 업그레이드 도메인 또는 장애 도메인에서 이 비율이 임계값보다 작으면 조각 모음 단계가 시작됩니다.

다음 그림은 주어진 메트릭에 대한 분산 임계값이 10인 두 가지 예를 보여줍니다.

![분산 임계값의 예][Image1]

이런 경우 노드 "사용률"은 노드 용량에 의해 결정되는 노드의 크기를 고려하지 않고 지정된 메트릭에 대해 노드에 현재 보고되는 절대 사용량만을 고려합니다.

메트릭이 지정되지 않으면 기본값은 1입니다. 이 경우 클러스터가 모든 업그레이드 도메인과 모든 장애 도메인에 빈 노드를 하나 이상 확보할 때까지 조각 모음이 수행됩니다.

값 0은 해당 메트릭이 조각 모음 메트릭이든 아니든 관계없이 분산 단계에서 이 메트릭을 고려하지 않겠다는 의미입니다.

아래의 코드 예제는 메트릭에 대한 분산 임계값이 클러스터 매니페스트 내의 FabricSettings 요소를 통해 메트릭마다 구성되는 것을 보여줍니다.

``` xml
<FabricSettings>
  <Section Name="MetricBalancingThresholds">
    <Parameter Name="MetricName" Value="10"/>
  </Section>
</FabricSettings>
```

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## 다음 단계

자세한 내용은 [리소스 분산 장치 아키텍처](service-fabric-resource-balancer-architecture.md)를 참조하세요.

[Image1]: media/service-fabric-resource-balancer-proactive-metric-packing/PMP.png

<!---HONumber=AcomDC_1223_2015-->