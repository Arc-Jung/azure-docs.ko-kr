---
title: Azure IoT Hub 장치 프로 비전 서비스의 다시 구축 장치
description: DPS (장치 프로 비전 서비스) 인스턴스로 장치를 다시 구축 하는 방법 및이 작업을 수행 해야 하는 이유를 알아봅니다.
author: wesmc7777
ms.author: wesmc
ms.date: 04/04/2019
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
ms.openlocfilehash: 0ded494debab19daa15a953715b1ab7b0b10ad18
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/02/2020
ms.locfileid: "74974907"
---
# <a name="how-to-reprovision-devices"></a>디바이스를 다시 프로비전하는 방법

IoT 솔루션의 수명 주기 동안 IoT 허브 간에 디바이스를 이동하는 것이 일반적입니다. 이러한 이동의 이유에는 다음과 같은 시나리오가 포함될 수 있습니다.

* **지리적 위치**: 디바이스가 위치 간에 이동함에 따라 디바이스를 각 위치에 가까운 IoT 허브로 마이그레이션하게 되면 네트워크 대기 시간이 향상됩니다.

* **다중 테넌트**: 디바이스는 동일한 IoT 솔루션 내에서 사용할 수 있지만 새 고객 또는 고객 사이트에 다시 할당하거나 임대할 수 있습니다. 이러한 새 고객은 별도의 IoT 허브를 사용하여 서비스를 제공받을 수 있습니다.

* **솔루션 변경**: 디바이스는 새롭거나 업데이트된 IoT 솔루션으로 이동할 수 있습니다. 디바이스를 이렇게 다시 할당하는 경우 디바이스에서 다른 백 엔드 구성 요소에 연결된 새 IoT 허브와 통신해야 할 도 있습니다. 

* **격리**: 솔루션 변경과 비슷합니다. 제대로 작동하지 않거나 손상되었거나 오래된 디바이스는 IoT 허브에 다시 할당할 수 있습니다. IoT 허브에서는 이러한 모든 디바이스를 업데이트하여 규정 준수 상태로 다시 되돌릴 수 있습니다. 디바이스가 정상적으로 작동하면 해당 주 허브로 다시 마이그레이션됩니다.

다시 프로 비전에 대 한 보다 자세한 개요는 [장치 다시 프로 비전 개념 IoT Hub](concepts-device-reprovision.md)을 참조 하세요.


## <a name="configure-the-enrollment-allocation-policy"></a>등록 할당 정책 구성

할당 정책은 등록과 관련된 디바이스를 다시 프로비전한 후 IoT 허브에 할당하는 방법을 결정합니다.

디바이스 등록에 대한 할당 정책을 구성하는 단계는 다음과 같습니다.

1. [Azure Portal](https://portal.azure.com)에 로그인하고, Device Provisioning Service 인스턴스로 이동합니다.

2. **등록 관리**를 클릭하고, 다시 프로비전하도록 구성하려는 등록 그룹 또는 개별 등록을 클릭합니다. 

3. **허브에 디바이스를 할당할 방법 선택** 아래에서 다음 할당 정책 중 하나를 선택합니다.

    * **최저 대기 시간**: 디바이스와 IoT Hub 간에 최저 대기 시간으로 통신할 수 있는 연결된 IoT Hub에 디바이스를 할당합니다. 이 정책을 사용하면 디바이스가 위치에 따라 가장 가까운 IoT 허브와 통신할 수 있습니다. 
    
    * **동일 가중 배포**: 연결된 각 IoT 허브에 할당된 할당 가중치에 따라 연결된 IoT 허브 전체에 디바이스를 배포합니다. 이 정책을 사용하면 연결된 허브에 설정된 할당 가중치에 따라 이러한 허브 그룹 전체에서 디바이스의 부하를 분산할 수 있습니다. 디바이스를 단 하나의 IoT Hub에 프로비전하려면 이 설정을 사용하는 것이 좋습니다. 이 설정은 기본값입니다. 
    
    * **정적 구성**: 이 정책을 사용하려면 프로비전할 디바이스에 대한 등록 항목에 원하는 IoT 허브가 나열되아야 합니다. 이 정책을 사용하면 디바이스를 할당하려는 단일 특정 IoT 허브를 지정할 수 있습니다.

4. **이 그룹을 할당할 수 있는 IoT 허브 선택** 아래에서 할당 정책에 포함할 연결된 IoT 허브를 선택합니다. 필요에 따라 **새 IoT Hub 연결** 단추를 사용하여 연결된 새 Iot 허브를 추가합니다.

    **최저 대기 시간** 할당 정책을 사용하면 선택한 허브가 대기 시간 평가에 포함되어 디바이스 할당에 가장 가까운 허브를 결정합니다.

    **동일 가중 배포** 할당 정책을 사용하면 구성된 할당 가중치와 현재 디바이스 로드에 따라 선택한 허브 전체에서 디바이스의 부하가 분산됩니다.

    **정적 구성** 할당 정책을 사용하면 디바이스가 할당할 IoT 허브를 선택합니다.

4. **저장**을 클릭하거나 다음 섹션으로 계속 진행하여 다시 프로비전 정책을 설정합니다.

    ![등록 할당 정책 선택](./media/how-to-reprovision/enrollment-allocation-policy.png)



## <a name="set-the-reprovisioning-policy"></a>다시 프로비전 정책 설정

1. [Azure Portal](https://portal.azure.com)에 로그인하고, Device Provisioning Service 인스턴스로 이동합니다.

2. **등록 관리**를 클릭하고, 다시 프로비전하도록 구성하려는 등록 그룹 또는 개별 등록을 클릭합니다.

3. **다른 IoT 허브로 다시 프로비전할 때 디바이스 데이터를 처리할 방법 선택** 아래에서 다음 다시 프로비전 정책 중 하나를 선택합니다.

    * **다시 프로비전 및 데이터 마이그레이션**: 이 정책은 등록 항목과 연결된 디바이스가 새 프로비전 요청을 제출하면 작업을 수행합니다. 등록 항목 구성에 따라 디바이스가 다른 IoT 허브에 다시 할당될 수 있습니다. 디바이스에서 IoT 허브가 변경되면 초기 IoT 허브에 대한 디바이스 등록이 제거됩니다. 초기 IoT 허브의 모든 디바이스 상태 정보는 새 IoT 허브로 마이그레이션됩니다. 마이그레이션 중에는 디바이스가 **할당 중**으로 보고됩니다.

    * **다시 프로비전 및 초기 구성으로 다시 설정**: 이 정책은 등록 항목과 연결된 디바이스에서 새 프로비전 요청을 제출하면 작업을 수행합니다. 등록 항목 구성에 따라 디바이스가 다른 IoT 허브에 다시 할당될 수 있습니다. 디바이스에서 IoT 허브가 변경되면 초기 IoT 허브에 대한 디바이스 등록이 제거됩니다. 디바이스가 프로비전되었을 때 프로비전 서비스 인스턴스 받은 초기 구성 데이터는 새 IoT 허브에 제공됩니다. 마이그레이션하는 동안 장치의 상태는 **할당**중으로 보고 됩니다.

4. **저장**을 클릭하여 변경 내용에 따라 디바이스의 다시 프로비전을 사용하도록 설정합니다.

    ![등록 할당 정책 선택](./media/how-to-reprovision/reprovisioning-policy.png)



## <a name="send-a-provisioning-request-from-the-device"></a>디바이스에서 프로비전 요청 보내기

이전 섹션에서 변경한 구성에 따라 디바이스를 다시 프로비전하려면 해당 디바이스에서 다시 프로비전을 요청해야 합니다. 

디바이스에서 프로비전 요청을 제출하는 빈도는 시나리오에 따라 다릅니다. 그러나 다시 부팅할 때 디바이스에서 프로비전 서비스 인스턴스에 프로비전 요청을 보내고, 요청 시 프로비전을 수동으로 트리거하는 [메서드](../iot-hub/iot-hub-devguide-direct-methods.md)를 지원하도록 프로그래밍하는 것이 좋습니다. 또한 [desired 속성](../iot-hub/iot-hub-devguide-device-twins.md#desired-property-example)을 설정하여 프로비전을 트리거할 수도 있습니다. 

등록 항목에 대한 다시 프로비전 정책은 디바이스 프로비저닝 서비스 인스턴스에서 이러한 프로비전 요청을 처리하는 방식과 다시 프로비전 중에 디바이스 상태 데이터를 마이그레이션해야 하는지 여부를 결정합니다. 개별 등록 및 등록 그룹에 대해 동일하ㄴ 정책을 사용할 수 있습니다.

부팅 시퀀스 중에 디바이스에서 프로비전 요청을 보내는 코드의 예제는 [시뮬레이션된 디바이스 자동 프로비전](quick-create-simulated-device.md)을 참조하세요.


## <a name="next-steps"></a>다음 단계

- 다시 프로 비전에 대 한 자세한 내용은 [IoT Hub Device 다시 프로 비전 개념](concepts-device-reprovision.md) 을 참조 하세요. 
- 프로 비전 해제에 대 한 자세한 내용은 [이전에 자동 프로 비전 된 장치의 프로 비전](how-to-unprovision-devices.md) 을 해제 하는 방법 











