---
title: Azure Firewall 규칙 처리 논리
description: Azure Firewall에는 NAT 규칙, 네트워크 규칙 및 애플리케이션 규칙이 있습니다. 규칙은 규칙 유형에 따라 처리됩니다.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: article
ms.date: 04/10/2020
ms.author: victorh
ms.openlocfilehash: 93677b3e473ab825665fed5590ac345a8cfcc300
ms.sourcegitcommit: fb23286d4769442631079c7ed5da1ed14afdd5fc
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/10/2020
ms.locfileid: "81113444"
---
# <a name="azure-firewall-rule-processing-logic"></a>Azure Firewall 규칙 처리 논리
Azure 방화벽에서 NAT 규칙, 네트워크 규칙 및 응용 프로그램 규칙을 구성할 수 있습니다. 규칙 컬렉션은 우선 순위의 규칙 유형에 따라 처리되며 숫자가 100에서 65,000으로 낮아집니다. 규칙 컬렉션 이름에는 문자, 숫자, 밑줄, 마침표 또는 하이픈만 있을 수 있습니다. 문자 또는 숫자로 시작하여 문자, 숫자 또는 밑줄로 끝나야 합니다. 최대 이름 길이는 80자입니다.

처음에 규칙 컬렉션 우선 순위 번호를 100개(100, 200, 300 등)로 간격을 두는 것이 가장 좋습니다.

> [!NOTE]
> 위협 인텔리전스 기반 필터링을 사용하도록 설정하면 이러한 규칙이 가장 우선 순위가 높으며 항상 먼저 처리됩니다. 위협 인텔리전스 필터링은 구성된 규칙이 처리되기 전에 트래픽을 거부할 수 있습니다. 자세한 내용은 [Azure 방화벽 위협 인텔리전스 기반 필터링](threat-intel.md)을 참조하십시오.

## <a name="outbound-connectivity"></a>아웃바운드 연결

### <a name="network-rules-and-applications-rules"></a>네트워크 규칙 및 애플리케이션 규칙

네트워크 규칙 및 응용 프로그램 규칙을 구성하면 네트워크 규칙이 응용 프로그램 규칙 보다 우선 순위로 적용됩니다. 규칙은 종료됩니다. 따라서 네트워크 규칙에서 일치하는 규칙이 발견되면 다른 규칙이 처리되지 않습니다.  네트워크 규칙일치가 없고 프로토콜이 HTTP, HTTPS 또는 MSSQL인 경우 패킷은 응용 프로그램 규칙에 의해 우선 순위로 평가됩니다. 여전히 일치하는 일치하지 않는 경우 패킷은 [인프라 규칙 컬렉션에](infrastructure-fqdns.md)대해 평가됩니다. 여전히 일치하는 항목이 없으면 패킷이 기본적으로 거부됩니다.

## <a name="inbound-connectivity"></a>인바운드 연결

### <a name="nat-rules"></a>NAT 규칙

인바운드 인터넷 연결은 [자습서: Azure 포털을 사용하여 Azure 방화벽 DNAT를 사용하여 인바운드 트래픽을 필터링하는 자습서에](tutorial-firewall-dnat.md)설명된 대로 대상 네트워크 주소 변환(DNAT)을 구성하여 활성화할 수 있습니다. NAT 규칙은 네트워크 규칙보다 우선 순위에 적용됩니다. 일치 항목이 발견되면 변환된 트래픽을 허용하도록 암시적인 해당 네트워크 규칙이 추가됩니다. 변환된 트래픽을 일치시키는 거부 규칙을 사용하여 네트워크 규칙 컬렉션을 명시적으로 추가함으로써 이 동작을 재정의할 수 있습니다.

인바운드 연결에는 응용 프로그램 규칙이 적용되지 않습니다. 따라서 인바운드 HTTP/S 트래픽을 필터링하려면 WAF(웹 응용 프로그램 방화벽)를 사용해야 합니다. 자세한 내용은 [Azure 웹 응용 프로그램 방화벽이란 무엇입니까?](../web-application-firewall/overview.md)

## <a name="examples"></a>예

다음 예제는 이러한 규칙 조합 중 일부의 결과를 보여 준다.

### <a name="example-1"></a>예 1

일치하는 네트워크 규칙으로 인해 google.com 연결은 허용됩니다.

**네트워크 규칙**

- 작업: 허용


|name  |프로토콜  |소스 형식  |원본  |대상 형식  |대상 주소  |대상 포트|
|---------|---------|---------|---------|----------|----------|--------|
|허용 웹     |TCP|IP 주소|*|IP 주소|*|80,443

**응용 프로그램 규칙**

- 작업: 거부

|name  |소스 형식  |원본  |프로토콜:포트|대상 FQDNs|
|---------|---------|---------|---------|----------|----------|
|거부 - 구글     |IP 주소|*|http:80,https:443|google.com

**결과**

패킷이 *허용 웹* 네트워크 규칙과 일치하기 때문에 google.com 연결은 허용됩니다. 이 시점에서 규칙 처리가 중지됩니다.

### <a name="example-2"></a>예제 2

우선 순위가 높은 *Deny* 네트워크 규칙 컬렉션이 차단되므로 SSH 트래픽이 거부됩니다.

**네트워크 규칙 컬렉션 1**

- 이름: 허용 컬렉션
- 우선 순위: 200
- 작업: 허용

|name  |프로토콜  |소스 형식  |원본  |대상 형식  |대상 주소  |대상 포트|
|---------|---------|---------|---------|----------|----------|--------|
|허용-SSH     |TCP|IP 주소|*|IP 주소|*|22

**네트워크 규칙 컬렉션 2**

- 이름: 거부 컬렉션
- 우선 순위: 100
- 작업: 거부

|name  |프로토콜  |소스 형식  |원본  |대상 형식  |대상 주소  |대상 포트|
|---------|---------|---------|---------|----------|----------|--------|
|데니-SSH     |TCP|IP 주소|*|IP 주소|*|22

**결과**

우선 순위가 높은 네트워크 규칙 컬렉션이 차단되므로 SSH 연결이 거부됩니다. 이 시점에서 규칙 처리가 중지됩니다.

## <a name="rule-changes"></a>규칙 변경

이전에 허용된 트래픽을 거부하도록 규칙을 변경하면 관련 기존 세션이 삭제됩니다.

## <a name="next-steps"></a>다음 단계

- [Azure Azure Firewall을 배포 및 구성](tutorial-firewall-deploy-portal.md)하는 방법에 대해 알아봅니다.