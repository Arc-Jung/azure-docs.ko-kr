---
title: Azure Firewall 규칙 처리 논리
description: Azure Firewall에는 NAT 규칙, 네트워크 규칙 및 애플리케이션 규칙이 있습니다. 규칙은 규칙 유형에 따라 처리됩니다.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: article
ms.date: 04/10/2020
ms.author: victorh
ms.openlocfilehash: 93677b3e473ab825665fed5590ac345a8cfcc300
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/28/2020
ms.locfileid: "81113444"
---
# <a name="azure-firewall-rule-processing-logic"></a>Azure Firewall 규칙 처리 논리
Azure 방화벽에서 NAT 규칙, 네트워크 규칙 및 응용 프로그램 규칙을 구성할 수 있습니다. 규칙 컬렉션은 우선 순위 순서 대로 규칙 형식에 따라 처리 되 고 더 낮은 숫자는 100에서 65000 사이입니다. 규칙 컬렉션 이름에는 문자, 숫자, 밑줄, 마침표 또는 하이픈만 사용할 수 있습니다. 문자 또는 숫자로 시작 하 고 문자, 숫자 또는 밑줄로 끝나야 합니다. 최대 이름 길이는 80 자입니다.

처음에는 규칙 컬렉션 우선 순위 번호를 100 증가값 (100, 200, 300 등)으로 설정 하는 것이 가장 좋습니다. 따라서 필요한 경우 규칙 컬렉션을 추가할 수 있는 공간이 생깁니다.

> [!NOTE]
> 위협 인텔리전스 기반 필터링을 사용 하는 경우 해당 규칙은 우선 순위가 가장 높고 항상 먼저 처리 됩니다. 위협 인텔리전스 필터링은 구성 된 규칙이 처리 되기 전에 트래픽을 거부할 수 있습니다. 자세한 내용은 [Azure 방화벽 위협 인텔리전스 기반 필터링](threat-intel.md)을 참조 하세요.

## <a name="outbound-connectivity"></a>아웃 바운드 연결

### <a name="network-rules-and-applications-rules"></a>네트워크 규칙 및 애플리케이션 규칙

네트워크 규칙 및 응용 프로그램 규칙을 구성 하는 경우 네트워크 규칙이 응용 프로그램 규칙 앞에 우선 순위 순서 대로 적용 됩니다. 규칙은 종료됩니다. 따라서 네트워크 규칙에 일치 하는 항목이 있으면 다른 규칙이 처리 되지 않습니다.  네트워크 규칙 일치가 없고 프로토콜이 HTTP, HTTPS 또는 MSSQL 인 경우 해당 패킷은 우선 순위 대로 응용 프로그램 규칙에 의해 평가 됩니다. 그래도 일치 하는 항목이 없으면 [인프라 규칙 컬렉션](infrastructure-fqdns.md)에 대해 패킷이 평가 됩니다. 여전히 일치하는 항목이 없으면 패킷이 기본적으로 거부됩니다.

## <a name="inbound-connectivity"></a>인바운드 연결

### <a name="nat-rules"></a>NAT 규칙

[자습서: Azure Portal을 사용 하 여 Azure 방화벽 dnat 인바운드 트래픽 필터링](tutorial-firewall-dnat.md)에서 설명한 대로 대상 네트워크 주소 변환 (dnat)을 구성 하 여 인바운드 인터넷 연결을 사용 하도록 설정할 수 있습니다. NAT 규칙은 네트워크 규칙 이전 우선 순위로 적용 됩니다. 일치 항목이 발견되면 변환된 트래픽을 허용하도록 암시적인 해당 네트워크 규칙이 추가됩니다. 변환된 트래픽을 일치시키는 거부 규칙을 사용하여 네트워크 규칙 컬렉션을 명시적으로 추가함으로써 이 동작을 재정의할 수 있습니다.

인바운드 연결에는 응용 프로그램 규칙이 적용 되지 않습니다. 따라서 인바운드 HTTP/S 트래픽을 필터링 하려면 WAF (웹 응용 프로그램 방화벽)를 사용 해야 합니다. 자세한 내용은 [Azure 웹 응용 프로그램 방화벽 이란?](../web-application-firewall/overview.md) 을 참조 하세요.

## <a name="examples"></a>예

다음 예에서는 이러한 규칙 조합 중 일부에 대 한 결과를 보여 줍니다.

### <a name="example-1"></a>예 1

네트워크 규칙 일치 때문에 google.com에 대 한 연결이 허용 됩니다.

**네트워크 규칙**

- 작업: 허용


|name  |프로토콜  |소스 형식  |원본  |대상 형식  |대상 주소  |대상 포트|
|---------|---------|---------|---------|----------|----------|--------|
|허용-웹     |TCP|IP 주소|*|IP 주소|*|80,443

**응용 프로그램 규칙**

- 작업: 거부

|name  |소스 형식  |원본  |프로토콜: 포트|대상 Fqdn|
|---------|---------|---------|---------|----------|----------|
|거부-google     |IP 주소|*|http: 80, https: 443|google.com

**결과**

패킷이 *허용-웹* 네트워크 규칙과 일치 하기 때문에 google.com에 대 한 연결이 허용 됩니다. 이 시점에서 규칙 처리를 중지 합니다.

### <a name="example-2"></a>예제 2

높은 우선 순위의 *거부* 네트워크 규칙 컬렉션은이를 차단 하므로 SSH 트래픽이 거부 됩니다.

**네트워크 규칙 컬렉션 1**

- 이름: 허용-컬렉션
- 우선 순위: 200
- 작업: 허용

|name  |프로토콜  |소스 형식  |원본  |대상 형식  |대상 주소  |대상 포트|
|---------|---------|---------|---------|----------|----------|--------|
|허용-SSH     |TCP|IP 주소|*|IP 주소|*|22

**네트워크 규칙 컬렉션 2**

- 이름: Deny-컬렉션
- 우선 순위: 100
- 작업: 거부

|name  |프로토콜  |소스 형식  |원본  |대상 형식  |대상 주소  |대상 포트|
|---------|---------|---------|---------|----------|----------|--------|
|Deny-SSH     |TCP|IP 주소|*|IP 주소|*|22

**결과**

우선 순위가 높은 네트워크 규칙 컬렉션에서 차단 하므로 SSH 연결이 거부 됩니다. 이 시점에서 규칙 처리를 중지 합니다.

## <a name="rule-changes"></a>규칙 변경

이전에 허용 된 트래픽을 거부 하는 규칙을 변경 하면 관련 된 모든 기존 세션이 삭제 됩니다.

## <a name="next-steps"></a>다음 단계

- [Azure Azure Firewall을 배포 및 구성](tutorial-firewall-deploy-portal.md)하는 방법에 대해 알아봅니다.