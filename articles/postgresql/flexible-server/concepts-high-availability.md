---
title: Azure Database for PostgreSQL 유연한 서버 (미리 보기)를 사용 하 여 영역 중복 고가용성 개요
description: Azure Database for PostgreSQL 유연한 서버를 사용 하 여 영역 중복 고가용성의 개념에 대해 알아봅니다.
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: c0d9b6042ae695caa73d926653f237b756bf4971
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/19/2021
ms.locfileid: "94366726"
---
# <a name="high-availability-concepts-in-azure-database-for-postgresql---flexible-server"></a>Azure Database for PostgreSQL 유연한 서버에서 고가용성 개념

> [!IMPORTANT]
> Azure Database for PostgreSQL - 유연한 서버는 미리 보기로 제공됨

Azure Database for PostgreSQL 유연한 서버는 **영역 중복** 서버 배포를 사용 하 여 자동 장애 조치 (failover) 기능이 있는 고가용성 구성을 제공 합니다. 영역 중복 구성으로 배포하는 경우 유동 서버는 다른 가용성 영역에서 대기 복제본을 자동으로 프로비저닝하고 관리합니다. PostgreSQL 스트리밍 복제를 사용 하 여 **동기** 모드의 대기 복제본 서버에 데이터를 복제 합니다. 

영역 중복 구성을 사용 하면 사용자가 시작한 크기 조정 계산 작업과 같이 계획 된 이벤트 중에 데이터 손실이 발생 하지 않는 자동 장애 조치 (failover) 기능과 기본 하드웨어 및 소프트웨어 오류, 네트워크 오류, 가용성 영역 오류 등의 계획 되지 않은 이벤트 에서도 자동 장애 조치 (failover) 기능이 제공 됩니다 

:::image type="content" source="./media/business-continuity/concepts-zone-redundant-high-availability-architecture.png" alt-text="영역 중복 고가용성"::: 

## <a name="zone-redundant-high-availability-architecture"></a>영역 중복 고가용성 아키텍처

지역 및 가용성 영역을 선택하여 기본 데이터베이스 서버를 배포할 수 있습니다. 대기 복제본 서버는 컴퓨팅 계층, 컴퓨팅 크기, 스토리지 크기 및 네트워크 구성을 포함하여 주 서버와 동일한 구성으로 다른 가용성 영역에 프로비저닝됩니다. 트랜잭션 로그는 PostgreSQL 스트리밍 복제를 사용 하 여 동기 모드에서 대기 복제본으로 복제 됩니다. 자동 백업은 주 데이터베이스 서버에서 정기적으로 수행 되지만 트랜잭션 로그는 대기 복제본에서 백업 저장소에 지속적으로 보관 됩니다. 

고가용성 구성의 상태는 포털에서 지속적으로 모니터링 되 고 보고 됩니다. 영역 중복 고가용성 상태는 아래에 나열 되어 있습니다.

| **Status** | **설명** |
| ------- | ------ |
| <b> 도중 | 새 대기 서버를 만드는 과정에서 |
| <b> 데이터 복제 | 대기를 만든 후에는 주 복제본을 사용 하 여이를 catch 합니다. |
| <b> 정상 | 복제가 안정적인 상태 이며 정상 상태입니다. |
| <b> 장애 조치 (Failover) | 데이터베이스 서버가 대기로 장애 조치 (failover) 하는 중입니다. |
| <b> 대기 제거 | 대기 서버를 삭제 하는 중입니다. | 
| <b> 사용 안 함 | 영역 중복 고가용성을 사용할 수 없습니다.  |

## <a name="steady-state-operations"></a>안정적인 상태 작업

PostgreSQL client 응용 프로그램은 DB 서버 이름을 사용 하 여 주 서버에 연결 됩니다. 응용 프로그램 읽기는 주 서버에서 직접 제공 되는 반면, 커밋 및 쓰기는 주 서버와 대기 복제본 모두에서 데이터가 유지 된 후에만 응용 프로그램에 확인 됩니다. 이러한 추가 왕복 요구 사항으로 인해 응용 프로그램은 쓰기 및 커밋에 대 한 대기 시간을 높일 수 있습니다. 포털에서 고가용성의 상태를 모니터링할 수 있습니다.

:::image type="content" source="./media/business-continuity/concepts-high-availability-steady-state.png" alt-text="영역 중복 고가용성-안정적인 상태"::: 

1. 클라이언트는 유연한 서버에 연결 하 여 쓰기 작업을 수행 합니다.
2. 변경 내용은 대기 사이트에 복제 됩니다.
3. 주 복제본이 승인을 받습니다.
4. 쓰기/커밋이 승인 됩니다.

## <a name="failover-process---planned-downtimes"></a>장애 조치 (failover) 프로세스-계획 된 가동 중지 시간

계획 된 가동 중지 시간 이벤트에는 Azure 예약 된 정기 소프트웨어 업데이트 및 부 버전 업그레이드가 포함 됩니다. 고가용성으로 구성 된 경우 응용 프로그램이 주 서버에 계속 액세스 하는 동안 이러한 작업이 먼저 대기 복제본에 적용 됩니다. 대기 복제본이 업데이트 되 면 주 서버 연결이 중단 되 고 장애 조치 (failover)가 트리거되어 대기 복제본을 동일한 데이터베이스 서버 이름을 사용 하는 주 복제본으로 활성화 합니다. 클라이언트 응용 프로그램은 새 주 서버에 동일한 데이터베이스 서버 이름을 사용 하 여 다시 연결 하 고 해당 작업을 다시 시작할 수 있습니다. 새 대기 서버가 이전 주 복제본과 동일한 영역에 설정 됩니다. 

규모 계산 또는 확장 저장소와 같은 다른 사용자 시작 작업의 경우 변경 내용이 먼저 대기 상태에 적용 된 다음 주 복제본에 적용 됩니다. 현재 연결은 대기 모드로 장애 조치 (failover) 되지 않으므로 작업이 주 서버에서 수행 되는 동안 가동 중지 시간이 발생 합니다.

### <a name="reducing-planned-downtime-with-managed-maintenance-window"></a>관리 되는 유지 관리 기간으로 계획 된 가동 중지 시간 감소

 기본 설정의 하루에 30 분 기간을 선택 하 여 Azure에서 시작 된 유지 관리 작업을 예약 하 여 데이터베이스의 활동이 부족할 것으로 예상할 수 있습니다. 패치 또는 부 버전 업그레이드와 같은 Azure 유지 관리 작업은 해당 기간 동안 발생 합니다.  고가용성으로 구성 된 유연한 서버의 경우 이러한 유지 관리 작업은 먼저 대기 복제본에서 수행 된 다음 활성화 됩니다. 그러면 응용 프로그램은 새로운 주 서버에 다시 연결 하 고 새 대기를 프로 비전 하는 동안 작업을 다시 시작 합니다.

## <a name="failover-process---unplanned-downtimes"></a>장애 조치 (failover) 프로세스-계획 되지 않은 가동 중지 시간

계획 되지 않은 중단에는 소프트웨어 버그 또는 인프라 구성 요소 오류가 포함 되어 데이터베이스의 가용성에 영향을 줍니다. 모니터링 시스템에서 서버를 사용할 수 없는 경우 대기 복제본에 대 한 복제가 중단 되 고 주 데이터베이스 서버가 되도록 대기 복제본이 활성화 됩니다. 클라이언트는 동일한 연결 문자열을 사용 하 여 데이터베이스 서버에 다시 연결 하 고 해당 작업을 다시 시작할 수 있습니다. 전반적인 장애 조치 (failover) 시간에는 60-120s을 사용 해야 합니다. 그러나 장애 조치 (failover) 시 주 데이터베이스 서버의 활동 (예: 큰 트랜잭션 및 복구 시간)에 따라 장애 조치 (failover)가 더 오래 걸릴 수 있습니다.

:::image type="content" source="./media/business-continuity/concepts-high-availability-failover-state.png" alt-text="영역 중복 고가용성-장애 조치 (failover)"::: 

1. 주 데이터베이스 서버가 다운 되 고 클라이언트가 데이터베이스 연결을 잃게 됩니다. 
2. 대기 서버가 새 주 서버가 되도록 활성화 됩니다. 클라이언트는 동일한 연결 문자열을 사용 하 여 새 주 서버에 연결 합니다. 클라이언트 응용 프로그램을 주 데이터베이스 서버와 같은 영역에 두면 대기 시간이 줄어들고 성능이 향상 됩니다.
3. 대기 서버가 이전 주 서버와 동일한 영역에 설정 되 고 스트리밍 복제가 시작 됩니다. 
4. 안정적인 상태 복제가 설정 되 면 클라이언트 응용 프로그램이 커밋되고 쓰기는 두 사이트 모두에서 데이터가 유지 된 후에 승인 됩니다.

## <a name="point-in-time-restore"></a>지정 시간 복원 

고가용성으로 구성 된 유연한 서버는 최신 상태로 유지 하기 위해 실시간으로 데이터를 대기 서버에 복제 합니다. 주 서버의 모든 사용자 오류 (예: 실수로 테이블 삭제 또는 잘못 된 데이터 업데이트)는 대기 복제본에 정확 하 게 복제 됩니다. 따라서 대기를 사용 하 여 이러한 논리 오류를 복구할 수 없습니다. 이러한 오류를 복구 하려면 백업에서 지정 시간 복원을 수행 해야 합니다.  유연한 서버의 지정 시간 복원 기능을 사용 하 여 오류가 발생 하기 전의 시간으로 복원할 수 있습니다. 고가용성으로 구성 된 데이터베이스의 경우 새 데이터베이스 서버는 사용자가 제공 하는 이름을 사용 하는 단일 영역 유연한 서버로 복원 됩니다. 그런 다음 데이터베이스 서버에서 개체를 내보내 프로덕션 데이터베이스 서버로 가져올 수 있습니다. 마찬가지로, 테스트 및 개발 목적으로 데이터베이스 서버를 복제 하거나 다른 목적으로 복원 하려는 경우 지정 시간 복원을 수행할 수 있습니다.

## <a name="zone-redundant-high-availability---features"></a>영역 중복 고가용성-기능

-   대기 복제본은 vCores, storage, 네트워크 설정 (VNET, 방화벽) 등을 포함 하 여 주 서버와 동일한 정확한 VM 구성으로 배포 됩니다.

-   기존 데이터베이스 서버에 대 한 고가용성을 추가할 수 있습니다.

-   고가용성을 사용 하지 않도록 설정 하 여 대기 복제본을 제거할 수 있습니다.

-   주 데이터베이스 서버에 대 한 가용성 영역을 선택할 수 있습니다.

-   주 데이터베이스 서버와 대기 데이터베이스 서버를 모두 중지, 시작 및 다시 시작할 수 있습니다.

-   자동 백업은 주 데이터베이스 서버에서 수행 되 고 영역 중복 저장소에 저장 됩니다.

-   클라이언트는 항상 주 데이터베이스 서버에 연결 합니다.

-   서버를 다시 시작 하 여 정적 서버 매개 변수 변경을 선택 하는 기능
  
-   사소한 버전 업그레이드와 같은 정기 유지 관리 작업은 먼저 대기 상태에서 수행 되며 서비스는 장애 조치 (failover)를 통해 가동 중지 시간을 줄입니다.  

## <a name="zone-redundant-high-availability---limitations"></a>영역 중복 고가용성-제한 사항

-   높은 가용성은 삼 계층의 안정 된 계산 계층에서 지원 되지 않습니다.
-   고가용성은 여러 영역을 사용할 수 있는 지역 에서만 지원 됩니다.
-   다른 가용성 영역에 대 한 동기 복제로 인해 응용 프로그램은 높은 쓰기 및 커밋 대기 시간을 경험할 수 있습니다.

-   읽기 쿼리에는 대기 복제본을 사용할 수 없습니다.

-   주 서버의 작업 및 작업에 따라 장애 조치 (failover) 프로세스가 120 초 보다 오래 걸릴 수 있습니다.

-   주 데이터베이스 서버를 다시 시작 하면 대기 복제본도 다시 시작 됩니다. 

-   추가 읽기 복제본 구성은 지원 되지 않습니다.

-   관리 되는 유지 관리 기간 동안에는 고객 시작 관리 작업을 예약할 수 없습니다.

-   확장 컴퓨팅 및 확장 스토리지와 같은 계획된 이벤트는 먼저 대기 서버에서 발생한 다음 주 서버에서 발생합니다. 이러한 계획 된 작업에 대해 서버는 장애 조치 (failover) 되지 않습니다. 

-  HA로 구성 된 유연한 서버를 사용 하 여 논리적 디코딩 또는 논리적 복제를 구성 하는 경우 대기 서버에 대 한 장애 조치 (failover) 시에는 논리 복제 슬롯이 대기 서버로 복사 되지 않습니다.  

## <a name="next-steps"></a>다음 단계

-   [비즈니스 연속성](./concepts-business-continuity.md) 에 대 한 자세한 정보
-   [고가용성을 관리](./how-to-manage-high-availability-portal.md) 하는 방법 알아보기
-   [백업 및 복구](./concepts-backup-restore.md) 에 대 한 자세한 정보