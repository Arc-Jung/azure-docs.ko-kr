---
title: 배포 열 선택 - 하이퍼스케일(Citus) - PostgreSQL용 Azure 데이터베이스
description: PostgreSQL용 Azure 데이터베이스에서 일반적인 하이퍼스케일 시나리오에서 배포 열을 선택하는 방법을 알아봅니다.
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: 8ced9767d81affceef851820ee587f4f3dd24deb
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/27/2020
ms.locfileid: "74975672"
---
# <a name="choose-distribution-columns-in-azure-database-for-postgresql--hyperscale-citus"></a>PostgreSQL - 하이퍼스케일(Citus)에 대한 Azure 데이터베이스의 배포 열을 선택합니다.

각 테이블의 배포 열을 선택하는 것은 가장 중요한 모델링 결정 중 하나입니다. PostgreSQL용 Azure 데이터베이스 - 하이퍼스케일(Citus)은 행의 분포 열 값을 기준으로 샤드에 행을 저장합니다.

올바른 선택 그룹은 동일한 물리적 노드에서 관련 데이터를 함께 그룹화하므로 쿼리가 빠르게 되고 모든 SQL 기능에 대한 지원이 추가됩니다. 잘못된 선택으로 인해 시스템이 느리게 실행되고 노드 전체의 모든 SQL 기능을 지원하지 않습니다.

이 문서에서는 가장 일반적인 두 가지 하이퍼스케일(Citus) 시나리오에 대한 배포 열 팁을 제공합니다.

### <a name="multi-tenant-apps"></a>다중 테넌트 앱

다중 테넌트 아키텍처는 계층적 데이터베이스 모델링의 형태를 사용하여 서버 그룹의 노드 간에 쿼리를 배포합니다. 데이터 계층의 맨 위를 *테넌트 ID라고* 하며 각 테이블의 열에 저장해야 합니다.

하이퍼스케일(Citus)은 쿼리를 검사하여 관련된 테넌트 ID를 확인하고 일치하는 테이블 샤드를 찾습니다. 쿼리를 샤드를 포함하는 단일 작업자 노드로 라우팅합니다. 동일한 노드에 배치된 모든 관련 데이터로 쿼리를 실행하는 것을 코로케이션이라고 합니다.

다음 다이어그램은 다중 테넌트 데이터 모델의 코로케이션을 보여 줍니다. 여기에는 에 의해 `account_id`분산된 두 개의 테이블인 거래처 및 캠페인이 포함되어 있습니다. 그늘진 상자는 샤드를 나타냅니다. 녹색 샤드는 한 작업자 노드에 함께 저장되고 파란색 샤드는 다른 작업자 노드에 저장됩니다. 두 테이블이 동일한 계정\_ID로 제한될 때 계정과 캠페인 간의 조인 쿼리에 필요한 모든 데이터가 한 노드에 함께 있는 지 확인합니다.

![다중 테넌트 코로케이션](media/concepts-hyperscale-choosing-distribution-column/multi-tenant-colocation.png)

이 디자인을 사용자 고유의 스키마에 적용하려면 응용 프로그램에서 테넌트를 구성하는 요소를 식별합니다. 일반적인 인스턴스에는 회사, 거래처, 조직 또는 고객이 포함됩니다. 열 이름은 `company_id` 또는 `customer_id`. 각 쿼리를 검사하고 동일한 테넌트 ID를 가진 행에 관련된 모든 테이블을 제한하는 추가 WHERE 절이 있는 경우 작동합니까?
다중 테넌트 모델의 쿼리는 테넌트에 대한 범위가 조정됩니다. 예를 들어 판매 또는 인벤토리에 대한 쿼리는 특정 저장소 내에서 범위가 조정됩니다.

#### <a name="best-practices"></a>모범 사례

-   **공통 테넌트\_ID 열로 분산 테이블을 분할합니다.** 예를 들어 테넌트가 회사인 SaaS 응용\_프로그램에서 테넌트 ID는 회사\_ID일 수 있습니다.
-   **작은 테넌트 간 테이블을 참조 테이블로 변환합니다.** 여러 테넌트에서 작은 정보 테이블을 공유하는 경우 참조 테이블로 배포합니다.
-   **테넌트\_ID별로 모든 응용 프로그램 쿼리를 필터링할 수 있습니다.** 각 쿼리는 한 번에 하나의 테넌트에 대한 정보를 요청해야 합니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대한 예제는 [다중 테넌트 자습서를](./tutorial-design-database-hyperscale-multi-tenant.md) 참조하십시오.

### <a name="real-time-apps"></a>실시간 앱

다중 테넌트 아키텍처는 계층 구조를 도입하고 데이터 코로케이션을 사용하여 테넌트당 쿼리를 라우팅합니다. 반면, 실시간 아키텍처는 데이터의 특정 분포 속성에 의존하여 매우 병렬 처리를 달성합니다.

"엔터티 ID"를 실시간 모델의 배포 열용어로 사용합니다. 일반적인 엔터티는 사용자, 호스트 또는 장치입니다.

실시간 쿼리는 일반적으로 날짜 또는 범주별로 그룹화된 숫자 집계를 요청합니다. 하이퍼스케일(Citus)은 부분 결과를 위해 이러한 쿼리를 각 샤드에 전송하고 코디네이터 노드에서 최종 답변을 어셈블합니다. 쿼리는 가능한 한 많은 노드가 기여할 때, 그리고 단일 노드가 불균형한 양의 작업을 수행해야 하는 경우 가장 빠르게 실행됩니다.

#### <a name="best-practices"></a>모범 사례

-   **카디널리티가 높은 열을 분포 열로 선택합니다.** 비교를 위해 새 값, 유료 및 배송 된 값이있는 주문 테이블의 상태 필드는 배포 열을 잘못 선택하지 않습니다. 데이터를 보유할 수 있는 샤드 의 수와 데이터를 처리할 수 있는 노드 수를 제한하는 몇 가지 값만 가정합니다. 카디널리티가 높은 열 중에서 그룹 별 절이나 조인 키로 자주 사용되는 열을 선택하는 것도 좋습니다.
-   **분포가 균일한 열을 선택합니다.** 특정 공통 값으로 왜곡된 열에 테이블을 배포하는 경우 테이블의 데이터가 특정 샤드에 누적되는 경향이 있습니다. 이러한 샤드를 보유하는 노드는 다른 노드보다 더 많은 작업을 수행하게 됩니다.
-   **공통 열에 팩트 및 차원 테이블을 배포합니다.**
    팩트 테이블에는 하나의 배포 키만 있을 수 있습니다. 다른 키에 조인하는 테이블은 팩트 테이블과 함께 배치되지 않습니다. 조인 빈도 및 조인 행의 크기에 따라 하나의 차원을 선택하여 공동 배치합니다.
-   **일부 차원 테이블을 참조 테이블로 변경합니다.** 차원 테이블을 팩트 테이블과 나란히 배치할 수 없는 경우 치수 테이블의 복사본을 참조 테이블 의 형태로 모든 노드에 배포하여 쿼리 성능을 향상시킬 수 있습니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대한 예제는 [실시간 대시보드 자습서를](./tutorial-design-database-hyperscale-realtime.md) 참조하십시오.

### <a name="time-series-data"></a>타임시리즈 데이터

시간계 워크로드에서 응용 프로그램은 이전 정보를 보관하는 동안 최근 정보를 쿼리합니다.

하이퍼스케일(Citus)에서 타임시리즈 정보를 모델링할 때 가장 일반적인 실수는 타임스탬프 자체를 분포 열로 사용하는 것입니다. 시간을 기반으로 하는 해시 분포는 샤드에서 함께 시간 범위를 유지하는 대신 무작위로 다른 샤드에 시간을 분배합니다. 시간을 포함하는 쿼리는 일반적으로 가장 최근의 데이터(예: 시간 범위)를 참조합니다. 이러한 유형의 해시 분포는 네트워크 오버헤드로 이어집니다.

#### <a name="best-practices"></a>모범 사례

-   **타임스탬프를 배포 열로 선택하지 마십시오.** 다른 배포 열을 선택합니다. 다중 테넌트 앱에서 테넌트 ID를 사용하거나 실시간 앱에서 엔터티 ID를 사용합니다.
-   **대신 시간 동안 PostgreSQL 테이블 분할을 사용합니다.** 테이블 분할을 사용하여 시간 정렬된 큰 데이터 테이블을 서로 다른 시간 범위를 포함하는 각 테이블이 있는 여러 상속된 테이블로 분할합니다. 하이퍼스케일(Citus)에서 포스트그레스 분할 테이블을 배포하면 상속된 테이블에 대한 샤드가 만들어집니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대한 예제는 [시간계 자습서를](https://aka.ms/hyperscale-tutorial-timeseries) 참조하십시오.

## <a name="next-steps"></a>다음 단계
- 분산 데이터 간의 [코로케이션이](concepts-hyperscale-colocation.md) 쿼리를 빠르게 실행하는 데 어떻게 도움이 되는지 알아봅니다.
