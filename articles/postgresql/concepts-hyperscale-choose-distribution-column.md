---
title: Azure Database for PostgreSQL-Hyperscale (Citus)에서 배포 열 선택
description: Azure Database for PostgreSQL의 일반적인 하이퍼 확장 시나리오에서 배포 열을 선택 하는 방법에 대해 알아봅니다.
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: a61c52773c4c6036a76d7b233988c713c1da861f
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/04/2019
ms.locfileid: "73482864"
---
# <a name="choose-distribution-columns-in-azure-database-for-postgresql--hyperscale-citus"></a>Azure Database for PostgreSQL-Hyperscale (Citus)에서 배포 열 선택

각 테이블의 배포 열을 선택 하는 것은 가장 중요 한 모델링 결정 중 하나입니다. Azure Database for PostgreSQL – Hyperscale (Citus)은 행의 분포 열 값을 기준으로 분할에 행을 저장 합니다.

적절 한 선택은 같은 실제 노드에서 관련 데이터를 함께 그룹화 하 여 쿼리를 빠르게 수행 하 고 모든 SQL 기능에 대 한 지원을 추가 합니다. 잘못 된 항목을 선택 하면 시스템이 느리게 실행 되 고 노드에서 모든 SQL 기능을 지원 하지 않습니다.

이 문서에서는 가장 일반적인 두 가지 Citus (Hyperscale) 시나리오에 대 한 배포 열 팁을 제공 합니다.

### <a name="multi-tenant-apps"></a>다중 테넌트 앱

다중 테 넌 트 아키텍처는 계층적 데이터베이스 모델링의 형태를 사용 하 여 서버 그룹의 노드 간에 쿼리를 분산 합니다. 데이터 계층의 맨 위를 *테 넌 트 ID* 라고 하며 각 테이블의 열에 저장 해야 합니다.

Citus (hyperscale)는 쿼리를 검사 하 여 관련 된 테 넌 트 ID를 확인 하 고 일치 하는 테이블 분할 된 테이블을 찾습니다. 분할 된 데이터베이스가 포함 된 단일 작업자 노드로 쿼리를 라우팅합니다. 동일한 노드에 배치 된 모든 관련 데이터를 사용 하 여 쿼리를 실행 하는 것을 공동 위치 라고 합니다.

다음 다이어그램에서는 다중 테 넌 트 데이터 모델의 공동 위치를 보여 줍니다. 여기에는 각각 `account_id`에 의해 배포 되는 두 테이블, 계정 및 캠페인이 포함 되어 있습니다. 음영 처리 된 상자는 분할를 나타냅니다. 녹색 분할는 하나의 작업자 노드에 함께 저장 되 고, blue 분할는 다른 작업자 노드에 저장 됩니다. 두 테이블이 동일한 계정\_id로 제한 되는 경우 계정 및 캠페인 간 조인 쿼리는 하나의 노드에서 필요한 모든 데이터를 포함 하는 방법을 확인 합니다.

![다중 테 넌 트 공동 배치](media/concepts-hyperscale-choosing-distribution-column/multi-tenant-colocation.png)

이 디자인을 자체 스키마에 적용 하려면 응용 프로그램에서 테 넌 트를 구성 하는 항목을 식별 합니다. 일반적인 인스턴스에는 회사, 계정, 조직 또는 고객이 포함 됩니다. 열 이름은 `company_id` 또는 `customer_id`와 같이 나타납니다. 동일한 테 넌 트 ID를 사용 하 여 행과 관련 된 모든 테이블을 제한 하는 추가 WHERE 절이 있는 경우 각 쿼리를 검사 하 고 사용자에 게 문의 합니다.
다중 테 넌 트 모델의 쿼리 범위는 테 넌 트로 지정 됩니다. 예를 들어 판매 또는 인벤토리에 대 한 쿼리는 특정 저장소 내에서 범위가 지정 됩니다.

#### <a name="best-practices"></a>모범 사례

-   **공용 테 넌 트\_id 열을 기준으로 분산 테이블을 분할 합니다.** 예를 들어 테 넌 트가 회사인 SaaS 응용 프로그램에서 테 넌 트\_id는 회사\_id 일 수 있습니다.
-   **작은 교차 테 넌 트 테이블을 참조 테이블로 변환 합니다.** 여러 테 넌 트가 작은 정보 테이블을 공유 하는 경우 참조 테이블로 배포 합니다.
-   **모든 테 넌 트\_id로 모든 응용 프로그램 쿼리를 제한 합니다.** 각 쿼리는 한 번에 하나의 테 넌 트에 대 한 정보를 요청 해야 합니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대 한 예제는 [다중 테 넌 트 자습서](./tutorial-design-database-hyperscale-multi-tenant.md) 를 참조 하세요.

### <a name="real-time-apps"></a>실시간 앱

다중 테 넌 트 아키텍처는 계층 구조를 도입 하 고 데이터 공동 배치를 사용 하 여 테 넌 트 당 쿼리를 라우팅합니다. 이와 대조적으로 실시간 아키텍처는 병렬 처리를 위해 데이터의 특정 배포 속성에 따라 달라 집니다.

실시간 모델에서 배포 열에 대 한 용어로 "엔터티 ID"를 사용 합니다. 일반적인 엔터티는 사용자, 호스트 또는 장치입니다.

실시간 쿼리는 일반적으로 날짜 또는 범주별로 그룹화 된 숫자 집계를 요청 합니다. Citus (hyperscale)는 이러한 쿼리를 각 분할 된 부분 결과에 대해 전송 하 고 코디네이터 노드에 최종 답변을 어셈블합니다. 가능한 한 많은 노드가 제공 될 때 그리고 단일 노드가 불균형 작업을 수행 해야 하는 경우 쿼리가 가장 빠르게 실행 됩니다.

#### <a name="best-practices"></a>모범 사례

-   **높은 카디널리티를 배포 열로 사용 하는 열을 선택 합니다.** 비교를 위해 새 값, 유료 및 배송 값을 포함 하는 주문 테이블의 상태 필드는 배포 열을 선택 하는 데 적합 하지 않습니다. 데이터를 보관할 수 있는 분할 수와이를 처리할 수 있는 노드 수를 제한 하는 몇 개의 값만 가정 합니다. 카디널리티가 높은 열 중에는 group by 절에 자주 사용 되거나 조인 키로 자주 사용 되는 열을 선택 하는 것도 좋습니다.
-   **균등 분포를 사용 하 여 열을 선택 합니다.** 특정 공통 값에 맞게 열에 테이블을 배포 하는 경우 테이블의 데이터는 특정 분할 누적 되는 경향이 있습니다. 이러한 분할를 보유 하는 노드는 다른 노드 보다 더 많은 작업을 수행 합니다.
-   **공통 열에 팩트 및 차원 테이블을 배포 합니다.**
    팩트 테이블에는 배포 키가 하나만 있을 수 있습니다. 다른 키에 조인 되는 테이블은 팩트 테이블에 공동 배치 되지 않습니다. 조인 되는 빈도 및 조인 하는 행의 크기에 따라 공동 배치할 차원을 하나 선택 합니다.
-   **일부 차원 테이블을 참조 테이블로 변경 합니다.** 팩트 테이블과 차원 테이블을 공동 배치 수 없는 경우에는 차원 테이블의 복사본을 참조 테이블 형식의 모든 노드에 분산 하 여 쿼리 성능을 향상 시킬 수 있습니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대 한 예제는 [실시간 대시보드 자습서](./tutorial-design-database-hyperscale-realtime.md) 를 참조 하세요.

### <a name="time-series-data"></a>시계열 데이터

시계열 작업에서 응용 프로그램은 이전 정보를 보관 하는 동안 최근 정보를 쿼리 합니다.

Citus (Hyperscale)에서 시계열 정보를 모델링 하는 가장 일반적인 실수는 타임 스탬프 자체를 배포 열로 사용 하는 것입니다. 시간 분배 시간을 기반으로 하는 해시 분포는 분할에서 시간 범위를 함께 유지 하는 대신 다양 한 분할에 임의로 보입니다. 시간을 포함 하는 쿼리는 일반적으로 가장 최근 데이터와 같은 시간 범위를 참조 합니다. 이러한 종류의 해시 배포는 네트워크 오버 헤드를 초래 합니다.

#### <a name="best-practices"></a>모범 사례

-   **배포 열로 타임 스탬프를 선택 하지 마세요.** 다른 배포 열을 선택 하십시오. 다중 테 넌 트 앱에서 테 넌 트 ID를 사용 하거나 실시간 앱에서 엔터티 ID를 사용 합니다.
-   **대신 PostgreSQL 테이블 분할을 사용 합니다.** 테이블 분할을 사용 하 여 다양 한 시간 범위를 포함 하는 각 테이블에 대해 많은 시간 정렬 된 데이터 테이블을 여러 개의 상속 된 테이블로 나눌 수 있습니다. Citus (Hyperscale)에서 Postgres-분할 된 테이블을 배포 하면 상속 된 테이블에 대 한 분할가 만들어집니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대 한 예제는 [시계열 자습서](https://aka.ms/hyperscale-tutorial-timeseries) 를 참조 하세요.

## <a name="next-steps"></a>다음 단계
- 분산 데이터 간의 [공동 위치가](concepts-hyperscale-colocation.md) 쿼리를 빠르게 실행 하는 방법을 알아봅니다.
