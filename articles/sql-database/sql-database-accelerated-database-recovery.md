---
title: 가속 데이터베이스 복구 - Azure SQL Database | Microsoft Docs
description: Azure SQL Database는 신속하고 일관적인 데이터베이스 복구, 즉각적인 트랜잭션 롤백, 단일 데이터베이스/탄력적 풀/Azure SQL Data Warehouse에 대한 적극적인 로그 잘림을 제공하는 새 기능을 포함하고 있습니다.
ms.service: sql-database
ms.subservice: ''
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: CarlRabeler
ms.author: carlrab
ms.reviewer: ''
manager: craigg
ms.date: 10/11/2018
ms.openlocfilehash: 49ef31996cb9c55ed244202a85e123faf52fbd2a
ms.sourcegitcommit: ccdea744097d1ad196b605ffae2d09141d9c0bd9
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/23/2018
ms.locfileid: "49649785"
---
# <a name="accelerated-database-recovery-preview"></a>가속 데이터베이스 복구(미리 보기)

**ADR(가속 데이터베이스 복구)** 은 SQL 데이터베이스 엔진 복구 프로세스를 다시 설계하여 특히 장기 실행 트랜잭션이 있는 경우 데이터베이스 가용성을 크게 향상하는 새로운 SQL 데이터베이스 엔진 기능입니다. ADR은 현재 단일 데이터베이스, 탄력적 풀, Azure SQL Data Warehouse에 사용할 수 있습니다. ADR의 주요 이점은 다음과 같습니다.

- **빠르고 일관적인 데이터베이스 복구**

  ADR을 사용하면 장기 실행 트랜잭션이 전체 복구 시간에 영향을 주지 않으므로 시스템의 활성 트랜잭션 수 또는 크기에 관계없이 빠르고 일관적인 데이터베이스 복구가 가능합니다.

- **즉각적인 트랜잭션 롤백**

  ADR을 사용하면 트랜잭션이 활성화된 시간 또는 수행된 업데이트 수에 관계없이 트랜잭션이 즉시 롤백됩니다.

- **적극적인 로그 잘림**

  ADR을 사용하면 활성 장기 실행 트랜잭션이 있더라도 트랜잭션 로그가 적극적으로 잘리므로 제어 범위를 벗어나 확장되지 않습니다.

## <a name="the-current-database-recovery-process"></a>현재 데이터베이스 복구 프로세스

SQL Server의 데이터베이스 복구는 [ARIES](https://people.eecs.berkeley.edu/~brewer/cs262/Aries.pdf) 복구 모델을 따르며 세 단계로 구성됩니다. 다음 다이어그램에 그림이 나와 있으며 그 뒤에 자세한 설명이 이어집니다.

![현재 복구 프로세스](./media/sql-database-accelerated-database-recovery/current-recovery-process.png)

- **분석 단계**

  마지막으로 성공한 검사점(또는 가장 오래된 페이지 LSN)의 시작부터 끝까지 트랜잭션 로그를 정방향 검사하여 SQL 서버가 중지될 때 각 트랜잭션의 상태를 확인합니다.

- **다시 실행 단계**

  가장 오래된 커밋되지 않은 트랜잭션부터 끝까지 트랜잭션 로그를 정방향 검사하고 모든 작업을 다시 실행하여 크래시 당시의 상태로 데이터베이스를 되돌립니다.

- **실행 취소 단계**

  크래시 당시 활성 상태였던 각 트랜잭션에 대해 로그를 역방향으로 트래버스하고, 이 트랜잭션이 수행한 작업을 실행 취소합니다.

이 디자인에 따라, SQL 데이터베이스 엔진이 예기치 않은 다시 시작에서 복구하는 데 걸리는 시간은 크래시 당시 시스템에서 가장 오래된 활성 트랜잭션의 크기에 거의 비례합니다. 복구하려면 모든 불완전 트랜잭션을 롤백해야 합니다. 필요한 시간은 트랜잭션에서 수행한 작업 및 트랜잭션이 활성 상태였던 시간에 비례합니다. 따라서 장기 실행 트랜잭션(예: 대량 삽입 작업 또는 큰 테이블에 대한 인덱스 빌드 작업)이 있으면 SQL Server 복구 프로세스가 오래 걸릴 수 있습니다.

또한 이 디자인을 기반으로 대형 트랜잭션을 취소/롤백하는 경우 위에서 설명한 것과 동일한 복구 실행 취소 단계를 사용하므로 시간이 오래 걸릴 수 있습니다.

뿐만 아니라 장기 실행 트랜잭션이 있으면 SQL 데이터베이스 엔진이 트랜잭션 로그를 자를 수 없습니다. 복구 및 롤백 프로세스에 해당 로그 레코드가 필요하기 때문입니다. 이 SQL 데이터베이스 엔진 디자인의 결과로, 일부 고객은 트랜잭션 로그의 크기가 매우 큰 커지고 엄청난 양의 로그 공간이 사용되는 문제에 직면합니다.

## <a name="the-accelerated-database-recovery-process"></a>가속 데이터베이스 복구 프로세스

ADR은 다음과 같이 SQL 데이터베이스 엔진 복구 프로세스를 완전히 다시 디자인하여 위의 문제를 해결합니다.

- 가장 오래된 활성 트랜잭션의 시작 부분에서/으로 로그를 검색하지 않도록 방지하여 일정한/즉각적인 프로세스를 만듭니다. ADR을 사용하면 마지막으로 성공한 검사점(또는 가장 오래된 더티 페이지 LSN(로그 시퀀스 번호))의 트랜잭션 로그만 처리됩니다. 결과적으로 복구 시간이 장기 실행 트랜잭션의 영향을 받지 않습니다.
- 전체 트랜잭션에 대한 로그를 처리할 필요가 없으므로 필요한 트랜잭션 로그 공간이 최소화됩니다. 결과적으로 검사점 및 백업이 발생할 때 트랜잭션 로그를 적극적으로 자를 수 있습니다.

간략하게 살펴보자면, ADR은 모든 물리적 데이터베이스 수정의 버전을 관리하고 논리 작업만 실행 취소하여 빠른 데이터베이스 복구를 달성하며, 논리 작업은 제한적이고 거의 즉시 실행 취소할 수 있습니다. 크래시 당시 활성 상태였던 트랜잭션은 중단된 것으로 표시되며, 따라서 이러한 트랜잭션을 통해 생성된 버전을 동시 사용자 쿼리에서 무시할 수 있습니다.

ADR 복구 프로세스는 현재 복구 프로세스와 동일한 세 단계로 구성됩니다. 이러한 단계가 ADR에서 작동하는 원리는 다음 다이어그램에 표시되어 있으며, 그 뒤에 자세한 설명이 이어집니다.

![ADR 복구 프로세스](./media/sql-database-accelerated-database-recovery/adr-recovery-process.png)

- **분석 단계**

  이 프로세스는 오늘과 동일하게 유지되며 sLog를 다시 구성하고 버전이 지정되지 않은 작업의 로그 레코드를 복사하는 과정이 추가됩니다.
- **다시 실행** 단계

  두 단계(P)로 나뉩니다.
  - 1단계

      sLog(마지막 검사점까지 커밋되지 않은 가장 오래된 트랜잭션)에서 다시 실행합니다. 다시 실행은 sLog에서 몇 가지 레코드만 처리하면 되는 빠른 작업입니다.
  - 2단계

     트랜잭션 로그에서 다시 실행은 마지막 검사점(커밋되지 않은 가장 오래된 트랜잭션 대신)에서 시작됩니다.
- **실행 취소 단계**

   ADR을 사용한 실행 취소 단계는 sLog를 사용하여 논리적 되돌리기로 버전이 지정되지 않은 작업 및 PVS(지속형 버전 저장소)를 실행 취소함으로써 행 수준 버전 기반 실행 취소를 수행하여 거의 즉시 완료됩니다.

## <a name="adr-recovery-components"></a>ADR 복구 구성 요소

ADR의 네 가지 주요 구성 요소는 다음과 같습니다.

- **PVS(지속형 버전 저장소)**

  지속형 버전 저장소는 기존의 `tempdb` 버전 저장소 대신 데이터베이스 자체에서 생성된 행 버전을 유지하는 새로운 SQL 데이터베이스 엔진 메커니즘입니다. PVS는 리소스 격리를 지원할 뿐 아니라 읽기 가능 보조 복제본의 가용성을 향상합니다.

- **논리적 되돌리기**

  논리적 되돌리기는 행 수준 버전 기반 실행 취소를 수행하는 비동기 프로세스로, 버전이 지정된 모든 작업에 대한 인스턴트 트랜잭션 롤백 및 실행 취소를 제공합니다.

  - 중단된 모든 트랜잭션 추적
  - PVS를 사용하여 모든 사용자 트랜잭션에 대한 롤백 수행
  - 트랜잭션 중단 직후 모든 잠금 해제

- **sLog**

  sLog는 버전이 지정되지 않은 작업(예: 메타데이터 캐시 무효화, 잠금 획득 등)에 대한 로그 레코드를 저장하는 보조 메모리 내 로그 스트림입니다. sLog의 특징은 다음과 같습니다.

  - 낮은 볼륨 및 인-메모리입니다.
  - 검사점 프로세스 중에 직렬화되어 디스크에 유지됩니다.
  - 트랜잭션이 커밋되면 정기적으로 잘립니다.
  - 버전이 지정되지 않은 작업만 처리하여 다시 실행 및 실행 취소 속도를 높입니다.  
  - 필요한 로그 레코드만 보존하여 적극적인 트랜잭션 로그 자르기를 지원합니다.

- **클리너**

  클리너는 정기적으로 깨어나서 필요 없는 페이지 버전을 정리하는 비동기 프로세스입니다.

## <a name="who-should-consider-accelerated-database-recovery"></a>가속 데이터베이스 복구를 고려해야 하는 사람

다음과 같은 고객은 ADR 사용을 고려해야 합니다.

- 장기 실행 트랜잭션이 있는 워크로드를 가진 고객
- 활성 트랜잭션 때문에 트랜잭션 로그가 엄청나게 커지는 것을 목격한 고객  
- SQL Server 장기 실행 복구(예: 예기치 않은 SQL Server 다시 시작 또는 수동 트랜잭션 롤백) 때문에 데이터베이스를 장기간 사용할 수 없었던 고객

## <a name="to-enable-adr-during-this-preview-period"></a>이 미리 보기 기간에 ADR을 사용하려면

이 기능의 미리 보기 기간에 [adr@microsoft.com](mailto:adr@microsoft.com)으로 이메일을 보내 ADR(가속 데이터베이스 복구)에 대해 자세히 알아보고 사용해 보세요. 이메일에 논리 서버의 이름을 포함해 주세요(단일 데이터베이스인 경우 탄력적 풀 및 Azure Data Warehouse). 이 기능은 미리 보기이므로 테스트 서버가 비-프로덕션 서버여야 합니다.
