---
title: "Azure SQL 데이터 동기화에 대한 모범 사례 | Microsoft Docs"
description: "Azure SQL 데이터 동기화의 구성 및 실행에 대한 모범 사례를 알아봅니다."
services: sql-database
ms.date: 11/13/2017
ms.topic: article
ms.service: sql-database
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.openlocfilehash: 7d9529fc8acd9347b0505b1c578febc1c2219b37
ms.sourcegitcommit: 732e5df390dea94c363fc99b9d781e64cb75e220
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/14/2017
---
# <a name="best-practices-for-sql-data-sync-preview"></a>SQL 데이터 동기화(미리 보기)에 대한 모범 사례 

이 문서에서는 SQL 데이터 동기화(미리 보기)에 대한 모범 사례를 설명합니다.

SQL 데이터 동기화의 개요는 [Azure SQL 데이터 동기화를 사용하여 여러 클라우드 및 온-프레미스 데이터베이스의 데이터 동기화(미리 보기)](sql-database-sync-data.md)를 참조하세요.

## <a name="security-and-reliability"></a> 보안 및 안정성

### <a name="client-agent"></a>클라이언트 에이전트

-   네트워크 서비스 액세스 권한을 가진 최소 권한 계정을 사용하여 클라이언트 에이전트를 설치합니다.

-   클라이언트 에이전트는 온-프레미스 SQL Server 컴퓨터와는 별개의 컴퓨터에 설치되는 것이 좋습니다.

-   둘 이상의 에이전트로 온-프레미스 데이터베이스를 등록하지 마십시오.

-   서로 다른 동기화 그룹에 대한 서로 다른 테이블을 동기화하는 경우도 해당.

-   여러 클라이언트 에이전트로 온-프레미스 데이터베이스를 등록하면 동기화 그룹 중 하나를 삭제하는 경우 문제가 발생합니다.

### <a name="database-accounts-with-least-required-privilege"></a>최소 필요 권한이 있는 데이터베이스 계정

-   **동기화 설정의 경우**. 테이블 만들기/변경, 데이터베이스 변경, 프로시저 만들기, 스키마 선택/변경, 사용자 정의 형식 만들기.

-   **진행 중인 동기화의 경우**. 동기화에 선택된 테이블 및 동기화 메타데이터에서 선택/삽입/업데이트/삭제 및 테이블 추적, 서비스에서 생성된 저장 프로시저에 대한 실행 권한, 사용자 정의 테이블 형식에 대한 실행 권한.

-   **프로비전 해제의 경우**. 동기화 중 테이블 부분에서 변경, 동기화 메타데이터 테이블에서 선택/삭제, 동기화 추적 테이블, 저장 프로시저 및 사용자 정의 형식에서 제어.

**동기화 그룹의 데이터베이스에 대한 하나의 자격 증명만 있는 경우 이 정보를 어떻게 사용해야 할까요?**

-   자격 증명을 다른 단계로 변경합니다(예를 들어 설정에는 *자격 증명1*, 진행 중에는 *자격 증명2*).

-   자격 증명의 권한을 변경합니다(즉, 동기화를 설정한 후 사용 권한을 변경).

## <a name="setup"></a>설정

### <a name="database-considerations-and-constraints"></a> 데이터베이스 고려 사항 및 제약 조건

#### <a name="sql-database-instance-size"></a>SQL Database 인스턴스 크기

새 SQL Database 인스턴스를 만들 때 항상 배포한 데이터베이스보다 크도록 최대 크기를 설정합니다. 최대 크기를 배포된 데이터베이스보다 크게 설정하지 않으면 동기화에 실패합니다. 크기는 자동으로 확장되지 않으므로 데이터베이스를 만든 후에 ALTER DATABASE를 사용하여 데이터베이스 크기를 늘릴 수 있습니다. SQL Database 인스턴스 크기 제한을 넘지 않도록 해야 합니다.

> [!IMPORTANT]
> SQL 데이터 동기화는 각 데이터베이스와 함께 추가 메타데이터를 저장합니다. 필요한 공간을 계산할 때 이 메타데이터를 고려를 해야 합니다. 추가된 오버 헤드의 양은 테이블의 너비(예: 테이블이 좁으면 더 많은 오버 헤드가 필요) 및 트래픽 양에 따라 결정됩니다.

### <a name="table-considerations-and-constraints"></a> 테이블 고려 사항 및 제약 조건

#### <a name="selecting-tables"></a>테이블 선택

데이터베이스의 모든 테이블이 동기화 그룹에 포함될 필요는 없습니다. 어떤 테이블을 동기화 그룹에 포함시키거나 제외(또는 다른 동기화 그룹에 포함)시킬 것인지는 효율성 및 비용에 영향을 줄 수 있습니다. 비즈니스에서 요구하는 동기화 그룹의 테이블 및 종속되어 있는 테이블만 동기화 그룹에 포함합니다.

#### <a name="primary-keys"></a>기본 키

동기화 그룹의 각 테이블에는 기본 키가 있어야 합니다. SQL 데이터 동기화(미리 보기) 서비스는 기본 키가 없는 테이블을 동기화할 수 없습니다.

프로덕션으로 롤링하기 전에 초기 및 진행 중인 동기화 성능을 테스트합니다.

### <a name="provisioning-destination-databases"></a> 대상 데이터베이스 프로비전

SQL 데이터 동기화(미리 보기) 미리 보기는 기본 데이터베이스 자동 프로비전을 제공합니다.

이 섹션에서는 SQL 데이터 동기화(미리 보기)의 프로비전에 대한 제한 사항을 설명합니다.

#### <a name="auto-provisioning-limitations"></a>자동 프로비전 제한 사항

다음은 SQL 데이터 동기화(미리 보기) 자동 프로비전에 대한 제한 사항입니다.

-   선택한 열만 대상 테이블에 생성됩니다.
따라서 일부 열이 동기화 그룹의 일부가 아닌 경우 해당 열은 대상 테이블에서 프로비전되지 않습니다.

-   인덱스는 선택한 열에 대해서만 생성됩니다.
원본 테이블 인덱스에 동기화 그룹의 일부가 아닌 열이 있으면 해당 인덱스는 대상 테이블에서 프로비전되지 않습니다.

-   XML 유형 열의 인덱스는 프로비전되지 않습니다.

-   CHECK 제약 조건은 프로비전되지 않습니다.

-   원본 테이블의 기존 트리거는 프로비전되지 않습니다.

-   뷰 및 저장 프로시저는 대상 데이터베이스에 생성되지 않습니다.

#### <a name="recommendations"></a>권장 사항

-   서비스를 시도하는 경우에만 자동 프로비전 기능을 사용합니다.

-   프로덕션의 경우 데이터베이스 스키마를 프로비전해야 합니다.

### <a name="locate-hub"></a> 허브 데이터베이스를 찾을 수 있는 위치

#### <a name="enterprise-to-cloud-scenario"></a>엔터프라이즈-클라우드 시나리오

대기 시간을 최소화하기 위해 허브 데이터베이스를 동기화 그룹의 데이터베이스 트래픽이 가장 집중된 곳과 가까운 곳에 배치합니다.

#### <a name="cloud-to-cloud-scenario"></a>클라우드 간 시나리오

-   동기화 그룹에 있는 모든 데이터베이스가 한 데이터 센터에 있는 경우 허브는 동일한 데이터 센터에 있어야 합니다. 이 구성은 대기 시간 및 데이터 센터 간의 데이터 전송 비용을 줄입니다.

-   동기화 그룹의 데이터베이스가 여러 데이터 센터에 있는 경우 허브는 대부분의 데이터베이스 및 데이터베이스 트래픽과 동일한 데이터 센터에 있어야 합니다.

#### <a name="mixed-scenarios"></a>혼합 시나리오

더 복잡한 동기화 그룹 구성에는 앞에서 설명한 지침을 적용합니다.

## <a name="sync"></a>동기화

### <a name="avoid-a-slow-and-costly-initial-synchronization"></a> 느리고 비용이 많이 드는 초기 동기화 방지

이 섹션에서는 동기화 그룹의 초기 동기화 및 필요 시간에 비해 느리고 비용이 많이 드는 초기 동기화를 피하기 위해 할 수 있는 조치에 대해 설명합니다.

#### <a name="how-initial-synchronization-works"></a>초기 동기화의 작동 방식

동기화 그룹을 만들 때 단 하나의 데이터베이스에 있는 데이터부터 시작합니다. 여러 데이터베이스에 데이터가 있으면 SQL 데이터 동기화(미리 보기)는 해결이 필요한 충돌로 인해 각 행을 처리합니다. 이 충돌 해결로 인해 초기 동기화는 데이터베이스 크기에 따라 며칠에서 수개월까지 천천히 진행됩니다.

또한 데이터베이스가 여러 데이터 센터에 있는 경우 각 행이 서로 다른 데이터 센터 간에 이동해야 하므로 초기 동기화의 비용이 필요 이상으로 높아집니다.

#### <a name="recommendation"></a>권장 사항

가능한 동기화 그룹 중 단 하나의 데이터베이스에 있는 데이터부터 시작합니다.

### <a name="design-to-avoid-synchronization-loops"></a> 동기화 루프 방지를 위한 디자인

동기화 루프는 한 데이터베이스의 각 변경 내용이 동기화 그룹의 데이터베이스를 통해 순환적으로 무한히 복제되도록 동기화 그룹 내에 순환 참조가 있는 경우에 발생합니다. 성능이 저하되고 비용이 크게 높아질 수 있기 때문에 동기화 루프를 방지하려고 합니다.

### <a name="handling-changes-that-fail-to-propagate"></a> 전파되지 않는 변경 내용 처리

#### <a name="reasons-that-changes-fail-to-propagate"></a>변경 내용이 전파되지 않는 이유

많은 이유로 인해 변경 내용이 전파되지 않을 수 있습니다. 일부 원인은 다음과 같습니다.

-   스키마/데이터 형식이 호환되지 않는 경우.

-   null이 아닌 열에 null을 삽입하려고 하는 경우.

-   외래 키 제약 조건을 위반하는 경우.

#### <a name="what-happens-when-changes-fail-to-propagate"></a>변경 내용이 전파되지 않으면 어떻게 될까요?

-   동기화 그룹에 경고 상태가 표시됩니다.

-   세부 정보는 포털 UI 로그 뷰어에 표시됩니다.

-   문제를 45일 내 해결하지 않으면 데이터베이스가 만료됩니다.

> [!NOTE]
> 이러한 변경 내용은 전파되지 않습니다. 복구하는 유일한 방법은 동기화 그룹을 다시 만드는 것입니다.

#### <a name="recommendation"></a>권장 사항

포털 및 로그 인터페이스를 통해 동기화 그룹 및 데이터베이스 상태를 정기적으로 모니터링합니다.


## <a name="maintenance"></a>유지 관리

### <a name="avoid-out-of-date-databases-and-sync-groups"></a> 만료된 데이터베이스 및 동기화 그룹 방지

동기화 그룹 내 동기화 그룹 또는 데이터베이스가 만료 상태가 될 수 있습니다. 동기화 그룹의 상태가 “만료”인 경우 작동이 중지됩니다. 데이터베이스의 상태가 “만료”인 경우 데이터가 손실될 수 있습니다. 이러한 상황은 복구하기 보다 미연에 방지하는 것이 좋습니다.

#### <a name="avoid-out-of-date-databases"></a>만료된 데이터베이스 방지

데이터베이스의 상태는 45일 이상 오프라인일 경우 만료로 설정됩니다. 데이터베이스가 45일 이상 오프라인되지 않도록 하여 데이터베이스가 만료 상태가 되는 것을 방지합니다.

#### <a name="avoid-out-of-date-sync-groups"></a>만료된 동기화 그룹 방지

동기화 그룹의 상태는 동기화 그룹 내 임의의 변경 내용이 45일 이상 동안 동기화 그룹의 나머지 부분으로 전파되지 못하는 경우 만료로 설정됩니다. 정기적으로 동기화 그룹의 기록 로그를 확인하여 동기화 그룹이 만료 상태가 되는 것을 방지합니다. 모든 충돌을 해결하고 변경 내용이 동기화 그룹 데이터베이스 전체에 성공적으로 전파됨을 확인합니다.

동기화 그룹이 변경 내용 적용에 실패할 수도 있는 원인에는 다음이 포함됩니다.

-   테이블 간 스키마 비호환성.

-   테이블 간 데이터 비호환성.

-   null 값을 허용하지 않는 열에 null 값이 있는 행 삽입.

-   외래 키 제약 조건을 위반하는 값이 있는 행 업데이트.

다음을 수행하여 만료된 동기화 그룹을 방지할 수 있습니다.

-   실패한 행에 포함된 값을 허용하도록 스키마를 업데이트합니다.

-   실패한 행에 들어 있는 값을 포함하도록 외래 키를 업데이트합니다.

-   대상 데이터베이스의 스키마 또는 외래 키와 호환되도록 실패한 행의 데이터 값을 업데이트합니다.

### <a name="avoid-deprovisioning-issues"></a> 프로비전 해제 문제 방지

특정 상황에서는 클라이언트 에이전트로 데이터베이스의 등록을 취소하면 동기화에 실패할 수 있습니다.

#### <a name="scenario"></a>시나리오

1. 로컬 에이전트 1과 연결되는 SQL Database 인스턴스 및 온-프레미스 SQL Server 데이터베이스를 사용하여 동기화 그룹 A를 만들었습니다.

2. 동일한 온-프레미스 데이터베이스가 로컬 에이전트 2(이 에이전트는 어떠한 동기화 그룹에도 연결되지 않음)로 등록됩니다.

3. 온-프레미스 데이터베이스를 로컬 에이전트 2에서 등록 취소하면 추적/메타 테이블이 온-프레미스 데이터베이스의 동기화 그룹에서 제거됩니다.

4. 이제, “데이터베이스가 동기화에 대해 프로비전되지 않거나 동기화 구성 테이블에 대한 사용 권한이 없으므로 현재 작업을 완료할 수 없습니다.”라는 오류와 함께 동기화 그룹 A 작업에 실패합니다.

#### <a name="solution"></a>해결 방법

이러한 상황을 처음부터 방지하려면 데이터베이스를 둘 이상의 에이전트로 등록하지 말아야 합니다.

이 상황을 복구하려면 다음을 수행합니다.

1. 데이터베이스가 속한 각 동기화 그룹에서 데이터베이스를 제거합니다.

2. 데이터베이스를 방금 제거한 각 동기화 그룹에 다시 추가합니다.

3. 영향을 받는 각 동기화 그룹(데이터베이스를 프로비전)을 배포합니다.

### <a name="modifying-your-sync-group"></a> 동기화 그룹 수정

데이터베이스를 동기화 그룹에서 제거한 다음, 변경 내용 중 하나가 먼저 배포되기 전에는 동기화 그룹을 편집하지 마십시오.

먼저 데이터베이스를 동기화 그룹에서 제거합니다. 그런 다음 변경 내용을 배포하고 프로비전 해제가 완료될 때까지 기다립니다. 이 작업이 완료되면 동기화 그룹을 편집하고 변경 내용을 배포할 수 있습니다.

데이터베이스를 제거한 다음, 변경 내용 중 하나가 먼저 배포되기 전에 동기화 그룹을 편집하려고 하면 해당 작업 또는 다른 작업이 실패하고 포털 인터페이스가 불일치 상태가 될 수도 있습니다. 이 경우 페이지를 새로 고쳐서 올바른 상태로 복원할 수 있습니다.

## <a name="next-steps"></a>다음 단계
SQL 데이터 동기화에 대한 자세한 내용은 다음을 참조하세요.

-   [Azure SQL 데이터 동기화를 사용하여 여러 클라우드 및 온-프레미스 데이터베이스의 데이터 동기화](sql-database-sync-data.md)
-   [Azure SQL 데이터 동기화 설정](sql-database-get-started-sql-data-sync.md)
-   [OMS Log Analytics를 사용하여 Azure SQL 데이터 동기화 모니터링](sql-database-sync-monitor-oms.md)
-   [Azure SQL 데이터 동기화 문제 해결](sql-database-troubleshoot-data-sync.md)

-   SQL Data Sync 구성 방법을 보여주는 전체 PowerShell 예제:
    -   [PowerShell을 사용하여 여러 Azure SQL Database 간 동기화](scripts/sql-database-sync-data-between-sql-databases.md)
    -   [PowerShell을 사용하여 Azure SQL Database와 SQL Server 온-프레미스 데이터베이스 간 동기화](scripts/sql-database-sync-data-between-azure-onprem.md)

-   [SQL 데이터 동기화 REST API 설명서 다운로드](https://github.com/Microsoft/sql-server-samples/raw/master/samples/features/sql-data-sync/Data_Sync_Preview_REST_API.pdf?raw=true)

SQL Database에 대한 자세한 내용은 다음을 참조하세요.

-   [SQL Database 개요](sql-database-technical-overview.md)
-   [데이터베이스 수명 주기 관리](https://msdn.microsoft.com/library/jj907294.aspx)
