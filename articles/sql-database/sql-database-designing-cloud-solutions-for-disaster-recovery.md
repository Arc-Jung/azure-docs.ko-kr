<properties
   pageTitle="클라우드 재해 복구 솔루션 - SQL 데이터베이스 활성 지역 복제 | Microsoft Azure"
   description="Azure SQL 데이터베이스의 앱 데이터 백업에 대한 지역에서 복제를 사용하여 무중단 업무 방식 계획에 대한 클라우드 재해 복구 솔루션을 디자인하는 방법을 알아봅니다."
   keywords="클라우드 재해 복구, 재해 복구 솔루션, 앱 데이터 백업, 지역에서 복제, 무중단 업무 방식 계획"
   services="sql-database"
   documentationCenter=""
   authors="anosov1960"
   manager="jhubbard"
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-management"
   ms.date="04/25/2016"
   ms.author="sashan"/>

# SQL 데이터베이스에서 활성 지역 복제를 사용하여 클라우드 재해 복구를 위한 응용 프로그램 설계


> [AZURE.NOTE] [Active Geo-Replication](sql-database-geo-replication-overview.md)는 현재 모든 계층의 모든 데이터베이스에 대해 제공됩니다.



SQL 데이터베이스에서 [지역에서 복제](sql-database-geo-replication-overview.md)를 사용하여 데이터베이스 응용 프로그램을 지역적 실패 및 치명적인 중단에 대해 복원력 있게 설계하는 방법을 알아봅니다. 무중단 업무 방식 계획을 위해서는 응용 프로그램 배포 토폴로지, 대상으로 하는 서비스 수준 계약, 트래픽 대기 시간 및 비용을 고려합니다. 이 문서에서 일반적인 응용 프로그램 패턴을 살펴보고 각 옵션의 이점 및 장단점을 설명합니다.

## 디자인 패턴 1: 함께 배치된 데이터베이스와 클라우드 재해 복구에 대한 활성-수동 배포

이 옵션은 다음 특성을 가진 응용 프로그램에 가장 적합합니다.

+ 단일 Azure 지역의 활성 인스턴스
+ 데이터에 대한 읽기-쓰기(RW) 액세스의 강력한 종속성
+ 응용 프로그램 논리와 데이터베이스 간의 영역 간 연결은 대기 시간 및 트래픽 비용으로 인해 허용되지 않음    

이 경우 응용 프로그램 배포 토폴로지는 모든 응용 프로그램 구성 요소가 영향을 받고 하나의 단위로 장애 조치 해야 할 때 지역 재해를 처리하기 위해 최적화됩니다. 지리적 중복성을 위해 응용 프로그램 논리와 데이터베이스 모두는 다른 지역에 복제되지만 정상 조건에서는 응용 프로그램 작업에 사용되지 않습니다. 보조 지역의 응용 프로그램은 보조 데이터베이스에 대해 SQL 연결 문자열을 사용하도록 구성되어야 합니다. 트래픽 관리자는 [장애 조치 라우팅 메서드](../traffic-manager/traffic-manager-configure-failover-routing-method.md)를 사용하도록 설정됩니다.

> [AZURE.NOTE] [Azure traffic manager](.. /traffic-manager/traffic-manager-overview.md)은 이 문서에서 설명 용도로만 사용됩니다. 장애 조치(failover) 라우팅 메서드를 지원하는 모든 부하 분산 솔루션을 사용할 수 있습니다.

기본 응용 프로그램 인스턴스 외에도 주기적인 T-SQL 읽기 전용(RO) 명령을 실행하여 주 데이터베이스를 모니터링하는 작은 [작업자 역할 응용 프로그램](cloud-services-choose-me.md#tellmecs) 배포를 고려해야 합니다. 자동으로 장애 조치(failover)를 트리거하거나 응용 프로그램의 관리 콘솔에서 경고를 생성하는 데(또는 두 작업을 모두 수행하는 데) 사용할 수 있습니다. 지역 전반의 작동 중단에 모니터링이 영향을 받지 않도록 하려면 각 지역에 모니터링 응용 프로그램 인스턴스를 배포하고 다른 지역의 데이터베이스에 연결해야 할 뿐만 아니라 보조 지역의 인스턴스를 활성 상태로 유지해야 합니다.

> [AZURE.NOTE] 모니터링 응용 프로그램은 주 및 보조 데이터베이스 모두에 활성 및 프로브여야 합니다. 후자를 사용하여 응용 프로그램이 보호되지 않는 경우 보조 지역 및 경고에서 실패를 감지할 수 있습니다.

다음 다이어그램은 작동 중단 전의 이 구성을 보여 줍니다.

![SQL 데이터베이스 지역에서 복제 구성 클라우드 재해 복구](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

기본 지역에서 작동 중단 후 모니터링 응용 프로그램은 주 데이터베이스가 액세스할 수 없는 것을 감지하고 경고를 등록합니다. 응용 프로그램 SLA에 따라 데이터베이스 작동 중단을 선언하기 전에 실패해야 할 연속 모니터링 프로브 횟수를 결정할 수 있습니다. 응용 프로그램 끝점 및 데이터베이스의 조정된 장애 조치를 달성하려면 다음 단계를 수행하는 모니터링 응용 프로그램이 있어야 합니다.

1. [기본 끝점의 상태를 업데이트](https://msdn.microsoft.com/library/hh758250.aspx)하여 끝점 장애 조치(failover)를 트리거합니다.
2. 보조 데이터베이스를 호출하여 [데이터베이스 장애 조치(failover)를 시작](sql-database-geo-replication-portal.md)합니다.

장애 조치 후 응용 프로그램은 보조 지역에서 사용자 요청을 처리하지만 주 데이터베이스는 이제 보조 지역에 있으므로 데이터베이스와 함께 배치 상태로 유지됩니다. 다음 다이어그램에서 확인할 수 있습니다. 모든 다이어그램에 실선은 활성 연결을 나타내고 점선은 일시 중단된 연결을 나타내며 중지 기호는 동작 트리거를 나타냅니다.


![지역에서 복제: 보조 데이터베이스로 장애 조치(failover) 앱 데이터 백업](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

보조 지역에서 작동 중단 문제가 발생하는 경우 주 데이터베이스와 보조 데이터베이스 간 복제 링크는 일시 중단되고 모니터링 응용 프로그램에서 주 데이터베이스가 노출되는 경고를 등록합니다. 응용 프로그램의 성능에 영향을 미치지 않지만 노출되도록 작동하므로 높은 위험 수준에서 두 지역 모두 연속적으로 실패합니다.

> [AZURE.NOTE] 단일 DR 영역을 사용한 배포 구성이 좋습니다. 대부분의 Azure 지역은 두 지역이 있기 때문입니다. 이러한 구성은 두 영역의 치명적인 오류로부터 응용 프로그램을 보호하지 않습니다. 이러한 발생 가능성이 없는 실패 시 [지리적 복원 작업](sql-database-disaster-recovery.md#recovery-using-geo-restore)을 사용하여 세 번째 지역에서 데이터베이스를 복구할 수 있습니다.

작동 중단이 완화되면 보조 데이터베이스가 주 데이터베이스와 자동으로 동기화됩니다. 동기화하는 동안 주 데이터베이스의 성능은 동기화되어야 하는 데이터의 양에 따라 약간 영향을 받을 수 있습니다. 다음 다이어그램은 보조 지역의 작동 중단을 보여 줍니다.

![주 데이터베이스와 동기화된 보조 데이터베이스 클라우드 재해 복구](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)


이 설계 패턴의 주요 **장점**은 다음과 같습니다.

+ SQL 연결 문자열은 각 지역에 응용 프로그램을 배포하는 동안 설정되고 장애 조치(failover) 후 변경되지 않습니다.
+ 응용 프로그램 및 데이터베이스는 항상 함께 배치되므로 응용 프로그램의 성능은 장애 조치의 영향을 받지 않습니다.

보조 지역의 중복 응용 프로그램 인스턴스인 주 **절충**은 재해 복구를 위해서만 사용됩니다.

## 디자인 패턴 2: 응용 프로그램 부하 분산에 대한 활성-활성 배포
이 클라우드 재해 복구 옵션은 다음 특성을 가진 응용 프로그램에 가장 적합합니다.

+ 높은 비율의 데이터베이스 읽기 및 쓰기
+ 데이터베이스 쓰기 대기 시간이 최종 사용자 환경에 영향을 주지 않음  
+ 읽기 전용 논리가 다른 연결 문자열을 사용하여 읽기-쓰기 논리에서 분리될 수 있음
+ 읽기 전용 논리가 최신 업데이트를 통해 완전하게 동기화되는 데이터에 의존하지 않음  

응용 프로그램이 이러한 특성 부하 분산을 가진 경우 다른 지역의 여러 응용 프로그램 인스턴스에 걸친 최종 사용자 연결은 성능 및 최종 사용자 환경을 향상시킬 수 있습니다. 이를 달성하기 위해 각 지역은 주 지역의 주 데이터베이스에 연결된 읽기-쓰기(RW) 논리로 응용 프로그램의 활성 인스턴스가 있어야 합니다. 읽기 전용(RO) 논리는 응용 프로그램 인스턴스와 동일한 지역의 보조 데이터베이스에 연결되어야 합니다. 트래픽 관리자는 각 응용 프로그램 인스턴스에 대해 활성화된 [끝점 모니터링](../traffic-manager/traffic-manager-monitoring.md)으로 [라운드 로빈 라우팅](../traffic-manager/traffic-manager-configure-round-robin-routing-method.md) 또는 [성능 라우팅](../traffic-manager/traffic-manager-configure-performance-routing-method.md)을 사용하도록 설정되어야 합니다.

패턴 #1에서와 같이 유사한 모니터링 응용 프로그램 배포를 고려해야 합니다. 하지만 패턴 #1과 달리 끝점 장애 조치 트리거에 대한 책임이 없습니다.

> [AZURE.NOTE] 이 패턴이 하나 이상의 보조 데이터베이스를 사용하는 동안 보조 데이터베이스 중 하나만 앞에서 설명한 이유로 장애 조치에 대해 사용됩니다. 이 패턴은 보조 복제본에 대한 읽기 전용 액세스를 필요로 하기 때문에 활성 지역 복제가 필요합니다.

트래픽 관리자는 사용자의 지리적 위치에 가장 가까운 응용 프로그램 인스턴스에 대한 사용자 직접 연결에 성능 라우팅을 위해 구성되어야 합니다. 다음 다이어그램은 작동 중단 전의 이 구성을 보여 줍니다. ![작동 중단 없음: 가장 가까운 응용 프로그램으로 성능 라우팅 지역에서 복제](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

데이터베이스 작동 중단이 기본 지역에서 검색된 경우 주 데이터베이스의 장애 조치를 보조 지역 중 하나로 시작하면 주 데이터베이스의 위치가 변경됩니다. 트래픽 관리자는 라우팅 테이블에서 오프라인 끝점을 자동으로 제외하지만 나머지 온라인 인스턴스에 대한 최종 사용자 트래픽 라우팅을 계속합니다. 이제 주 데이터베이스는 다른 지역에 있기 때문에 모든 온라인 인스턴스는 새 주 데이터베이스에 연결하도록 읽기-쓰기 SQL 연결 문자열을 변경해야 합니다. 데이터베이스 장애 조치를 시작하기 전에 변경하는 것이 중요합니다. 항상 동일한 지역의 데이터베이스를 가리키므로 읽기 전용 SQL 연결 문자열은 변경되지 않은 상태로 유지되어야 합니다. 장애 조치 단계는 다음과 같습니다.

1. 읽기-쓰기 SQL 연결 문자열이 새로운 주를 가리키도록 변경됩니다.
2. 지정된 보조 데이터베이스를 호출하여 [데이터베이스 장애 조치(failover)를 시작합니다](sql-database-geo-replication-portal.md).

다음 다이어그램은 장애 조치 후 새 구성을 보여 줍니다. ![장애 조치(failover) 후 구성 클라우드 재해 복구](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

보조 지역 중 한 곳에서 작동 중단이 발생하는 경우 트래픽 관리자는 라우팅 테이블에서 해당 지역의 오프라인 끝점을 자동으로 제거합니다. 해당 지역의 보조 데이터베이스에 대한 복제 채널은 일시 중단됩니다. 나머지 영역은 추가 사용자 트래픽을 받아볼 수 있으므로 작동 중단 동안 응용 프로그램의 성능에 영향을 미칠 수 있습니다. 작동 중단이 완화되면 영향을 받은 지역의 보조 데이터베이스가 주 데이터베이스와 즉시 동기화됩니다. 동기화하는 동안 주 데이터베이스의 성능은 동기화되어야 하는 데이터의 양에 따라 약간 영향을 받을 수 있습니다. 다음 다이어그램은 보조 지역 중 한 곳의 작동 중단을 보여 줍니다.

![보조 지역에서 중단 클라우드 재해 복구 - 지역에서 복제](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

이 디자인 패턴의 주요 **장점**은 여러 보조 데이터베이스에서 응용 프로그램 워크로드를 확장하여 최적의 최종 사용자 성능을 얻을 수 있는 것입니다. 이 옵션의 **장단점**은 다음과 같습니다.

+ 응용 프로그램 인스턴스 및 데이터베이스 간의 읽기-쓰기 연결에는 다양한 대기 시간 및 비용이 있음
+ 작동 중단 동안 응용 프로그램 성능이 저하됨
+ 응용 프로그램 인스턴스는 데이터베이스 장애 조치(failover) 후 동적으로 SQL 연결 문자열을 변경해야 함  

> [AZURE.NOTE] 작업 보고, 비즈니스 인텔리전스 도구 또는 백업과 같은 특수한 작업을 오프로드하는데 유사한 방법을 사용할 수 있습니다. 일반적으로 이러한 작업은 상당한 데이터베이스 리소스를 소비하므로 예상된 작업에 일치하는 성능 수준으로 보조 데이터베이스 중 하나를 지정하는 것이 좋습니다.

## 디자인 패턴 3: 데이터 보존에 대한 활성-수동 배포  
이 옵션은 다음 특성을 가진 응용 프로그램에 가장 적합합니다.

+ 모든 데이터 손실은 높은 비즈니스 위험이 있으므로 작동 중지가 영구적인 경우 데이터베이스 장애 조치(failover)는 최후의 수단으로만 사용될 수 있습니다.
+ 응용 프로그램은 일정 기간 동안 "읽기 전용" 모드에서 작동할 수 있습니다.

이 패턴에서 응용 프로그램은 보조 데이터베이스에 연결된 경우 읽기 전용 모드로 전환합니다. 기본 지역의 응용 프로그램 논리는 주 데이터베이스와 같은 위치에 배치되며 읽기-쓰기(RW) 모드에서 작동하고 보조 지역의 응용 프로그램 논리는 보조 데이터베이스와 같은 위치에 배치되며 읽기 전용 모드(RO)에서 작동하도록 준비됩니다. 트래픽 관리자는 두 응용 프로그램 인스턴스에 대해 활성화된 [끝점 모니터링](../traffic-manager/traffic-manager-monitoring.md)으로 [장애 조치 라우팅](../traffic-manager/traffic-manager-configure-failover-routing-method.md)을 사용하도록 설정되어야 합니다.

다음 다이어그램은 작동 중단 전의 이 구성을 보여 줍니다. ![장애 조치(failover) 전 활성-수동 배포 클라우드 재해 복구](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

트래픽 관리자가 기본 지역에 대한 연결 실패를 감지하는 경우 사용자 트래픽을 보조 지역의 응용 프로그램 인스턴스로 자동으로 전환합니다. 이 패턴을 사용하는 경우 작동 중단이 감지된 후 데이터베이스 장애 조치를 시작하지 **않는** 것이 중요합니다. 보조 지역의 응용 프로그램이 활성화되고 보조 데이터베이스를 사용하여 읽기 전용 모드로 작동합니다. 이 내용은 다음 다이어그램에서 설명됩니다.

![작동 중단: 읽기 전용 모드의 응용 프로그램 클라우드 재해 복구](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

기본 지역의 작동 중단이 완화되면 트래픽 관리자는 기본 지역의 연결 복원을 감지하고 사용자 트래픽을 기본 지역의 응용 프로그램 인스턴스로 다시 전환합니다. 해당 응용 프로그램 인스턴스는 주 데이터베이스를 사용하여 읽기-쓰기 모드에서 다시 시작하고 작동합니다.

> [AZURE.NOTE] 이 패턴은 보조 복제본에 대한 읽기 전용 액세스를 필요로 하기 때문에 활성 지역 복제가 필요합니다.

보조 지역에서 작동 중단이 발생하는 경우 저하되고 복제 채널이 일시 중단되므로 트래픽 관리자는 기본 지역의 응용 프로그램 끝점을 표시합니다. 그러나 작동 중단 동안 응용 프로그램의 성능에 영향을 주지 않습니다. 작동 중단이 완화되면 보조 데이터베이스가 주 데이터베이스와 즉시 동기화됩니다. 동기화하는 동안 주 데이터베이스의 성능은 동기화되어야 하는 데이터의 양에 따라 약간 영향을 받을 수 있습니다.

![중단: 보조 데이터베이스 클라우드 재해 복구](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

이 디자인 패턴에는 다음과 같은 여러 **장점**이 있습니다.

+ 임시 작동 중단 동안 데이터 손실 방지
+ 복구가 트래픽 관리자에 의해 트리거되므로 모니터링 응용 프로그램을 배포할 필요가 없음
+ 가동 중지 시간은 트래픽 관리자가 구성 가능한 연결 실패를 얼마나 빨리 감지하는지에 따라 달라짐

**장단점**은 다음과 같습니다.

+ 응용 프로그램은 읽기 전용 모드에서 작동할 수 있어야 함
+ 읽기 전용 데이터베이스에 연결된 경우 동적으로 전환이 필요함
+ 읽기-쓰기 작업의 다시 시작은 주 지역의 복구가 필요하며 이는 몇 시간 또는 며칠 동안 전체 데이터 액세스를 사용할 수 없음을 의미함

> [AZURE.NOTE] 지역에서 영구 서비스 중단이 발생할 경우 수동으로 데이터베이스 장애 조치를 활성화하고 데이터 손실을 허용해야 합니다. 응용 프로그램은 데이터베이스에 대한 읽기-쓰기 액세스로 보조 지역에서 작동됩니다.

## 무중단 업무 방식 계획: 클라우드 재해 복구에 대한 응용 프로그램 디자인 선택

특정 클라우드 재해 복구 전략은 응용 프로그램의 요구 사항을 최상으로 충족하도록 이러한 디자인 패턴을 결합하거나 확장할 수 있습니다. 앞에서 설명한 대로 선택한 전략은 고객 및 응용 프로그램 배포 토폴로지에 제공하려는 SLA에 따라 달라집니다. 결정에 도움을 주기 위해 아래 표는 예상된 데이터 손실 또는 복구 시점 목표(RPO) 및 예상 복구 시간(ERT)에 따라 선택 항목을 비교합니다.

| 패턴 | RPO | ERT
| :--- |:--- | :---
| 배치된 데이터베이스 액세스로 재해 복구에 대한 활성-수동 배포 | 읽기-쓰기 액세스 < 5초 | 실패 감지 시간 + 장애 조치 API 호출 + 응용 프로그램 확인 테스트
| 응용 프로그램 부하 분산에 대한 활성-활성 배포 | 읽기-쓰기 액세스 < 5초 | 실패 감지 시간 + 장애 조치 API 호출 + SQL 연결 문자열 변경 + 응용 프로그램 확인 테스트
| 데이터 보존에 대한 활성-수동 배포 | 읽기 전용 액세스 < 5초 읽기-쓰기 액세스 = 0 | 읽기 전용 액세스 = 연결 실패 감지 시간 + 응용 프로그램 확인 테스트 <br>읽기-쓰기 액세스 = 가동 중단을 완화하는 시간


## 추가 리소스


- [비즈니스 연속성 개요](sql-database-business-continuity.md)
- [활성 지역 복제](sql-database-geo-replication-overview.md)
- [클라우드 재해 복구를 위한 응용 프로그램 설계](sql-database-designing-cloud-solutions-for-disaster-recovery.md)
- [복구된 Azure SQL 데이터베이스 마무리](sql-database-recovered-finalize.md)
- [SQL 데이터베이스 BCDR FAQ](sql-database-bcdr-faq.md)

<!---HONumber=AcomDC_0504_2016-->