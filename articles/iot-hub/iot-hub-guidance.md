<properties
 pageTitle="Azure IoT Hub 지침 | Microsoft Azure"
 description="Azure IoT Hub를 사용하는 솔루션에 대한 지침 항목 모음입니다."
 services="iot-hub"
 documentationCenter=".net"
 authors="fsautomata"
 manager="kevinmil"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="tbd"
 ms.date="09/29/2015"
 ms.author="elioda"/>

# Azure IoT Hub - 지침

## 비교: IoT Hub 및 이벤트 허브
Azure IoT Hub의 주요 사용 사례 중 하나는 장치에서 원격 분석을 수집하는 것입니다. 이러한 이유로, IoT Hub는 짧은 대기 시간 및 높은 안정성으로 이벤트 및 원격 분석을 엄청난 규모의 클라우드에 제공하는 이벤트처리 서비스인 [이벤트 허브]와 자주 비교됩니다.

하지만 서비스에는 다음 섹션에서 자세히 설명하는 많은 차이점이 있습니다.

| 영역 | IoT Hub | 이벤트 허브(영문) |
| ---- | ------- | ---------- |
| 통신 패턴 | 장치-클라우드 이벤트 수신 및 클라우드-장치 메시징. | 이벤트 수신만(일반적으로 장치-클라우드 시나리오에 대해 고려됨). |
| 보안 | 장치 단위 ID 및 취소 가능한 액세스 제어. [IoT Hub 개발자 가이드 - 보안]을 참조하세요. | [게시자의 정책][Event Hub publisher policies]을 사용한 제한된 해지 지원을 포함하는 이벤트 허브 전반의 [공유 액세스 정책][Event Hub - security]입니다. IoT 솔루션의 컨텍스트에서는 보통 장치당 자격 증명 및 스푸핑 방지 측정을 지원하기 위해서는 사용자 지정 솔루션을 구현해야 합니다. |
| 확장 | IoT Hub는 수백만 대의 연결된 장치를 동시에 지원하도록 최적화됩니다. | 이벤트 허브에서는 [서비스 버스 할당량]당 최대 5.000 AMQP 연결까지 더 제한된 수의 동시 연결을 지원할 수 있습니다. 반면에 이벤트 허브를 통해 사용자는 전송된 각 메시지에 대한 파티션을 지정할 수 있습니다. |
| 장치 SDK | IoT Hub는 다양한 플랫폼 및 언어에 대한 [장치 SDK][Azure IoT Hub SDKs]를 제공합니다. | 이벤트 허브는 .NET, C에서 지원되고 AMQP 및 HTTP 송신 인터페이스를 제공합니다. |

결론적으로 유일한 사용 사례가 장치-클라우드 원격 분석 수신인 경우에도 IoT Hub는 IoT 장치 연결을 위해 특별히 설계된 서비스를 제공하며 IoT 특정 기능과 함께 이러한 시나리오에 대한 가치 제안을 지속적으로 확장합니다. 이벤트 허브는 데이터 센터 내부 및 데이터 센터 간 시나리오 컨텍스트에서 대규모 이벤트 수신용으로 설계되었습니다. IoT Hub 및 이벤트 허브를 함께 사용하는 것이 일반적이며 전자는 장치-클라우드 통신을 처리하고 후자는 실시간 처리 엔진으로 후속 단계 이벤트 수신을 처리합니다.

## 장치 프로비전 <a id="provisioning"></a>
IoT 솔루션은 다양한 시스템 및 저장소에서 장치 정보를 유지관리하며 [IoT Hub의 ID 레지스트리][IoT Hub Developer Guide - identity registry]는 응용 프로그램별 장치 정보를 유지 관리하는 기타 저장소 중 하나입니다. 이러한 모든 시스템에서 필요한 장치 정보를 만드는 과정을 *프로비전*이라고 합니다.

장치 프로비전을 위한 수많은 요구 사항과 전략이 있습니다(자세한 내용은 [IoT Hub 장치 관리 지침] 참조). [IoT Hub ID 레지스트리][IoT Hub Developer Guide - identity registry]는 프로비전 프로세스에서 IoT Hub를 통합하는 데 필요한 API를 제공합니다.

## 현장 게이트웨이 <a id="fieldgateways"></a>
현장 게이트웨이는 통신 인에이블러로 작동하고 잠재적으로 로컬 장치 제어 시스템 및 장치 데이터 처리 허브 역할을 하는 특수한 장치 어플라이언스 또는 범용 소프트웨어입니다. 현장 게이트웨이는 장치에 대한 로컬 처리 및 제어 기능을 수행할 수 있습니다. 한편으로는 장치 원격 분석을 필터 또는 집계할 수 있으므로 백 엔드에 전송되는 데이터 양을 줄여줍니다.

현장 게이트웨이 범위에는 현장 게이트웨이 자체와 여기에 연결된 모든 장치가 포함됩니다. 이름에서 알 수 있듯이 현장 게이트웨이는 전용 데이터 처리 시설 외부에서 작동하며 일반적으로 바운딩된 위치입니다. 현장 게이트웨이는 액세스 및 정보 흐름을 관리하는 실제 역할을 한다는 점에서 단순한 트래픽 라우터와 다릅니다. 즉, 응용 프로그램 처리 엔터티 및 네트워크 연결이거나 세션 터미널입니다(예를 들어, 이 컨텍스트의 게이트웨이가 장치 프로비전, 데이터 변환, 프로토콜 변환 및 이벤트 규칙 처리를 지원할 수 있습니다). 한편, NAT 장치 또는 방화벽은 명시적인 연결 또는 세션 터미널이 아니고 이를 통과하는 연결 또는 세션을 라우팅(또는 거부)하므로 현장 게이트웨이로 한정되지 않습니다.

### 투명 및 불투명 현장 게이트웨이
장치 ID와 관련하여, 해당 범위의 기타 장치에 IoT Hub의 ID 레지스트리에 장치 ID 항목이 있는 경우 현장 게이트웨이를 *투명*하다고 합니다. IoT Hub의 ID 레지스트리에 있는 ID만 현장 게이트웨이의 ID인 경우 *불투명*하다고 합니다.

*불투명* 게이트웨이는 IoT Hub에서 [장치 ID 스푸핑 방지][IoT Hub Developer Guide - Anti-spoofing]를 제공하지 못하게 한다는 것에 유의해야 합니다. 또한 현장 게이트웨이 범위의 모든 장치는 IoT Hub에서 단일 장치로 표현되므로 단일 장치 기준의 한계 및 할당량이 적용됩니다.

### 기타 고려 사항

현장 게이트웨이를 구현할 때 Azure IoT 장치 SDK를 사용할 수 있습니다. 일부 SDK는 동일한 연결에서 여러 장치 통신을 IoT Hub로 멀티플렉싱하는 기능과 같은 현장 게이트웨이 관련 기능을 제공합니다. [IoT Hub 개발자 가이드 - 통신 프로토콜 선택]에서 설명한 것처럼, 현장 게이트웨이에 대한 전송 프로토콜로 HTTP/1을 사용하지 않아야 합니다.

## 사용자 지정 장치 인증 구성표/서비스 사용 <a id="customauth"></a>
Azure IoT Hub를 통해 [장치 ID 레지스트리][IoT Hub Developer Guide - identity registry]를 사용하여 장치별 보안 자격 증명 및 액세스 제어를 구성할 수 있습니다. 사용자 지정 장치 ID 레지스트리 및/또는 인증 구성표에 이미 상당한 투자를 한 IoT 솔루션의 경우 IoT Hub에 대한 *토큰 서비스*를 만들어 기타 IoT Hub의 기능을 계속해서 활용할 수 있습니다.

토큰 서비스는 자체 배포한 클라우드 서비스로, **DeviceConnect** 권한으로 IoT Hub 공유 액세스 정책을 사용하여 *장치 범위* 토큰을 만듭니다.

  ![][img-tokenservice]

토큰 서비스 패턴의 주요 단계는 다음과 같습니다.

1. IoT Hub에 대한 **DeviceConnect** 권한으로 [IoT Hub 공유 액세스 정책][IoT Hub Developer Guide - Security]을 만듭니다. 이 정책은 토큰 서비스에서 토큰을 서명하는 데 사용됩니다.
2. 장치에서 IoT Hub에 액세스하려면 토큰 서비스에 서명된 토큰을 요청합니다. 장치에서 사용자 지정 장치 ID 레지스트리/인증 구성표를 사용할 수 있습니다.
3. 토큰 서비스에서 [IoT Hub 개발자 가이드 - 보안]에 따라, 인증할 장치 `deviceId`와 함께 `resourceURI`로 `/devices/{deviceId}`를 사용하여 생성된 토큰을 반환합니다.
4. 장치는 IoT Hub에서 직접 토큰을 사용합니다.

토큰 서비스는 토큰 만료를 원하는 대로 설정할 수 있습니다. 만료 시 IoT Hub는 연결을 제공하고 장치는 토큰 서비스에 새 토큰을 요청해야 합니다. 분명히, 만료 시간이 짧으면 장치 및 토큰 서비스에 대한 부하가 증가합니다.

IoT Hub에서 연결할 수 있는 장치에 대한 장치 ID를 계속 만들어야 합니다. 즉, 장치가 토큰으로 인증되더라도 장치별 액세스 제어([IoT Hub 개발자 가이드 - ID 레지스트리]에 따라 장치 ID 비활성화)가 계속 작동합니다. 이렇게 하면 장기간 토큰이 존재하는 것이 완화됩니다.

### 사용자 지정 게이트웨이와 비교
IoT Hub에 사용자 지정 ID 레지스트리/인증 구성표를 구현하는 데는 토큰 서비스 패턴이 권장되는 방법입니다. IoT Hub에서 대부분의 솔루션 트래픽을 처리할 수 있기 때문입니다. 그러나 여기서는 사용자 지정 인증 구성표가 프로토콜(예: [TLS PSK])과 복잡하게 얽혀 있어 서비스에서 모든 트래픽(*사용자 지정 게이트웨이*)을 처리해야 합니다. 자세한 내용은 [프로토콜 게이트웨이]를 참조하세요.

## IoT Hub 크기 조정
IoT Hub는 IoT Hub S1 또는 S2 단위 수를 2.000까지 늘려 동시 연결 장치 수를 수백만 대까지 지원할 수 있습니다. 자세한 내용은 [IoT Hub 가격 책정][lnk-pricing]을 참조하세요.

각 IoT Hub 단위는 레지스트리에서 모두 동시에 연결 가능한 특정 수의 장치 ID와 일일 메시지 수를 허용합니다.

솔루션의 규모를 적절히 조정하기 위해 IoT Hub의 특정 용도 고려해야 합니다. 특히 다음과 같은 범주의 작업에 필요한 최대 처리량을 고려해야 합니다.

* 장치-클라우드 메시지
* 클라우드-장치 메시지
* ID 레지스트리 작업

이 처리량 정보 외에도 [IoT Hub 할당량 및 제한]을 참조하고 솔루션을 적절히 설계하세요.

### 장치-클라우드 및 클라우드-장치 메시지 처리량
IoT Hub 솔루션의 크기를 조정하는 가장 적절한 방법은 장치별로 트래픽을 평가하는 것입니다.

장치-클라우드 메시지는 다음과 같은 지속적인 처리량 지침을 따릅니다.

| 계층 | 지속적인 처리량 | 지속적인 전송 속도 |
| ---- | -------------------- | ------------------- |
| S1 | 장치당 최대 8kb/hour | 장치당 평균 4 messages/hour |
| S2 | 장치당 최대 4kb/min | 장치당 평균 2 messages/min |

장치-클라우드 메시지를 수신할 때 응용 프로그램 백 엔드는 다음과 같은 최대 처리량(모든 판독기)을 예상할 수 있습니다.

| 계층 | 지속적인 처리량 |
| ---- | -------------------- |
| S1 | 장치당 최대 120Kb/min, 최소 2Mb/s. |
| S2 | 장치당 최대 4Mb/min, 최소 2Mb/s. |

클라우드-장치 메시지 성능은 장치별로 조정되며 각 장치는 분당 최대 5개 메시지를 수신합니다.

### ID 레지스트리 작업 처리량
IoT Hub ID 레지스트리 작업은 대부분이 장치 프로비전과 관련되므로 런타임 작업으로 간주되지 않습니다. 관련 버스트 성능 수치는 [IoT Hub 할당량 및 제한]을 참조하세요.

### 분할
단일 IoT Hub를 수백만 대의 장치로 확장할 수 있기는 하지만, 솔루션에서 단일 IoT Hub에서 보장할 수 없는 특정 성능 특성을 필요로 하는 경우가 있습니다. 이 경우 트래픽 버스트를 부드럽게 처리하고 필요한 처리량 또는 작업 속도를 얻기 위해 장치를 여러 IoT Hub로 파티션하는 것이 좋습니다.

## 고가용성 및 재해 복구
Azure 서비스로 IoT Hub는 Azure 지역 수준에서 중복을 사용하여 솔루션의 추가 작업 없이도 HA(고가용성)를 제공합니다. 또한 Azure는 필요한 경우 DR(재해 복구) 기능 또는 지역 간 가용성을 사용하여 솔루션을 구축할 수 있는 다양한 기능을 제공합니다. 장치 또는 사용자에게 전역, 지역 간 고가용성을 제공하기 위해서는 이러한 기능을 활용하는 솔루션을 설계 및 준비해야 합니다. [Azure 비즈니스 연속성 기술 지침] 문서에서 비즈니스 연속성 및 DR에 대한 Azure 기본 제공 기능을 설명합니다. [Azure 응용 프로그램에 대한 재해 복구 및 고가용성] 문서는 Azure 응용 프로그램에서 HADR을 달성하기 위한 전략에 대한 아키텍처 지침을 제공합니다.

## IoT Hub를 통한 국가별 장애 조치
IoT 솔루션에서 배포 토폴로지에 대한 전체 내용은 이 섹션의 범위를 벗어나지만 고가용성 및 재해 복구 목적으로 *국가별 장애 조치* 배포 모델을 고려해보겠습니다.

국가별 장애 조치 모델에서 솔루션 백 엔드는 주로 한 데이터 센터 위치에서 실행되지만 추가 IoT Hub 및 백 엔드는, 기본 데이터 센터의 IoT Hub가 가동 중단되거나 장치에서 기본 데이터 센터로 네트워크 연결이 어떠한 이유로 중단되는 경우 장애 조치 용도로 추가 데이터 센터 지역으로 배포됩니다. 장치는 기본 게이트웨이에 연결할 수 없는 경우 항상 보조 서비스 끝점을 사용합니다. 지역 간 장애 조치 기능을 통해 솔루션 가용성을 단일 지역의 고가용성 이상으로 향상시킬 수 있습니다.

높은 수준에서 IoT Hub로 국가별 장애 조치를 구현하려면 다음이 필요합니다.

* **보조 IoT Hub 및 장치 라우팅 논리** - 주 지역에서 서비스 중단이 발생하는 경우 장치에서 보조 지역으로 연결을 시작해야 합니다. 관련된 대부분의 서비스는 상태를 저장하므로 일반적으로 솔루션 관리자가 국가 간 장애 조치 프로세스를 트리거합니다. 프로세스의 제어를 유지하면서 새 끝점에서 장치로 통신하는 가장 좋은 방법은 현재 활성 끝점에 대해 *안내자* 서비스를 정기적으로 확인하는 것입니다. 안내자 서비스는 DNS-리디렉션 기술을 사용하여 복제되고 연결을 유지할 수 있는 간단한 웹 응용 프로그램입니다(예: [Azure 트래픽 관리자] 사용).
* **ID 레지스트리 복제** - 사용하려면 보조 IoT Hub가 솔루션에 연결하는 데 필요한 모든 장치 ID를 포함해야 합니다. 솔루션은 지역에서 복제된 장치 ID의 백업을 유지하고 이를 보조 IoT Hub로 업로드한 후 장치에 대한 활성 끝점을 전환해야 합니다. 이 경우 [IoT Hub 개발자 가이드 - ID 레지스트리]에 있는 IoT Hub의 장치 ID 내보내기 기능이 매우 유용합니다.
* **논리 병합** - 주 지역을 다시 사용할 수 있게 된 경우 보조 사이트에 생성된 모든 상태 및 데이터를 주 지역으로 다시 마이그레이션해야 합니다. 이것은 주로 장치 ID 및 응용 프로그램 메타데이터와 관련되며 기본 IoT Hub 및 주 지역의 기타 가능한 응용 프로그램별 저장소에 병합되어야 합니다. 이 단계를 간소화하기 위해 일반적으로 멱등원 작업을 사용하는 것이 좋습니다. 그러면 이벤트의 최종적인 일관된 배포뿐만 아니라 이벤트의 중복 또는 순서 비지정 배달로 인한 부작용이 최소화됩니다. 또한 시스템에서 "처리"하거나 복구 지점 목표(RPO)에 따라 추가 시간이 소요될 수 있으므로 잠재적인 불일치나 "약간" 오래된 상태를 허용할 수 있도록 응용 프로그램 논리를 설계해야 합니다. 다음 문서에서 이 항목에 대한 자세한 지침을 제공합니다. [Failsafe: 복원력이 뛰어난 클라우드 아키텍처에 대한 지침].




[img-tokenservice]: media/iot-hub-guidance/tokenservice.png

[IoT Hub Developer Guide - identity registry]: iot-hub-devguide.md#identityregistry
[IoT Hub 개발자 가이드 - ID 레지스트리]: iot-hub-devguide.md#identityregistry
[IoT Hub 개발자 가이드 - 통신 프로토콜 선택]: iot-hub-devguide.md#amqpvshttp
[IoT Hub Developer Guide - Security]: iot-hub-devguide.md#security
[IoT Hub 개발자 가이드 - 보안]: iot-hub-devguide.md#security
[IoT Hub Developer Guide - Anti-spoofing]: iot-hub-devguide.md#antispoofing
[프로토콜 게이트웨이]: iot-hub-protocol-gateway.md
[IoT Hub 할당량 및 제한]: iot-hub-devguide.md#throttling

[IoT Hub 장치 관리 지침]: iot-hub-device-management.md
[이벤트 허브]: ../event-hubs/event-hubs-what-is-event-hubs/
[Azure 트래픽 관리자]: https://azure.microsoft.com/documentation/services/traffic-manager/
[Event Hub - security]: ../event-hubs/event-hubs-authentication-and-security-model-overview/
[Event Hub publisher policies]: ../event-hubs-overview/#common-publisher-tasks
[서비스 버스 할당량]: ../service-bus/service-bus-quotas/
[Azure IoT Hub SDKs]: https://github.com/Azure/azure-iot-sdks/blob/master/readme.md

[TLS PSK]: https://tools.ietf.org/html/rfc4279

[Azure 비즈니스 연속성 기술 지침]: https://msdn.microsoft.com/library/azure/hh873027.aspx
[Azure 응용 프로그램에 대한 재해 복구 및 고가용성]: https://msdn.microsoft.com/library/azure/dn251004.aspx
[Failsafe: 복원력이 뛰어난 클라우드 아키텍처에 대한 지침]: https://msdn.microsoft.com/library/azure/jj853352.aspx

[lnk-pricing]: https://azure.microsoft.com/pricing/details/iot-hub

<!---HONumber=Oct15_HO1-->