<properties
 pageTitle="IoT 장치 관리 | Microsoft Azure"
 description="IoT Hub 및 IoT Suite를 사용하여 IoT 장치 관리 개요"
 services="iot-hub,iot-suite"
 documentationCenter=""
 authors="dominicbetts"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="01/21/2016"
 ms.author="dobett"/>

# Azure IoT Suite 및 Azure IoT Hub를 사용하여 IoT 장치 관리

[Azure IoT Suite][lnk-iot-suite] 및 Azure IoT Hub는 규모별 IoT 솔루션, 다양한 장치 및 장치 토폴로지를 위한 장치 관리를 지원하는 기본 기능을 제공합니다. 이 문서에 나오는 장치 관리에 대한 참조는 특히 IoT 장치 관리와 관련이 있습니다.

## 소개

서비스 공급자 및 기업, IoT 장치의 모집단을 유지하는 모든 조직은 장치 관리 기능을 사용하여 다음과 같은 비즈니스 프로세스를 수행합니다.

* IoT 장치 등록 및 검색
* 연결 설정.
* 장치에 소프트웨어 원격 구성 및 업데이트. 예를 들어 제조 공장이나 유전에서 장치를 관리하는 경우 승인 체인, 규정 감사 요구 사항, 물리적 보호의 존재 등과 함께 장치를 원격으로 구성 및 업데이트하는 정책이 마련됩니다.

IoT 솔루션에 IoT 장치 관리를 사용할 때는 다음 기능을 고려하고 주어진 각 비즈니스 목표의 중요도를 확인합니다.

* **[장치 프로비전 및 검색](#device-provisioning-and-discovery)**: 장치를 시스템에 등록하는 프로세스입니다.
* **[장치 레지스트리 및 장치 모델](#device-registry-and-device-models)**: 장치 모델에서 장치 관계, 시스템에서 역할, 유효성 검사 방법에 대해 메타데이터의 구조화된 사용을 나타내는 방법입니다.
* **[장치 액세스 관리](#device-access-management)**: 장치가 클라우드 서비스에서 장치 리소스에 대한 액세스를 제어하는 방법입니다.
* **[원격 제어](#remote-control)**: 원격 사용자가 장치에 대한 액세스 권한을 얻고 장치에 변경을 지시하는 방법입니다.
* **[원격 관리](#remote-administration-and-monitoring)**: 관리자가 장치 모집단 상태를 정의하는 프로세스입니다.  
* **[원격 구성](#remote-configuration)**: 관리자가 장치 구성을 변경하는 방법입니다.
* **[원격 펌웨어 및 소프트웨어 업데이트](#remote-firmware-and-software-update)**: 관리자가 장치 펌웨어 및 소프트웨어를 업데이트하기 위해 사용할 수 있는 프로세스입니다.

다음 섹션에서는 이러한 각 장치 관리 기능에 대한 심층적인 내용을 제공하고 Azure IoT Hub를 사용하여 이러한 기능을 구현하기 위한 상위 수준의 모델을 설명합니다.

## 장치 프로비전 및 검색

레지스트리 API를 사용하여 Azure IoT Hub에 장치를 프로비전합니다. 장치를 등록하고 키를 제공하거나 수신했으면 해당 키를 사용하여 장치를 IoT Hub에 연결할 수 있습니다. Azure IoT Hub는 권한 있는 자격 증명이 있는 등록된 장치와만 통신합니다. 관리자는 장치 관리 포털을 통해 Azure IoT Hub에 장치 액세스를 비활성화할 수 있습니다.

IoT 장치가 제조, 프로비전 및 배포되는 방식에 따라 부트스트랩 프로세스를 사용할 수 있습니다. 솔루션의 일부로 부트스트랩 서비스를 빌드하여 간단한 연결을 제공하고 장치를 특정 IoT Hub에 할당하는 프로세스를 지연할 수 있습니다. 장치가 제조되는 시점에는 장치가 작동하는 위치를 알 수 없을 수 있습니다. 부트스트랩 서비스는 장치를 Azure IoT Hub에 알리는 잠재적으로 복잡한 수많은 워크플로의 일례일 뿐이며 이는 기존 비즈니스 프로세스와 통합됩니다.

부트스트랩 서비스를 사용하면 IoT 장치가 시작되고 요청을 발급하며 최종적으로는 할당된 Azure IoT Hub에 대한 액세스를 제공할 수 있습니다. 요청은 장치 부트스트랩 자격 증명 및 기타 필요한 데이터를 포함해야 합니다. 인증된 장치인 경우 부트스트랩 서비스가 해당 장치를 할당된 Azure IoT Hub에 등록하고 부트스트랩을 요청하는 장치에 연결 세부 정보를 제공합니다. IoT Hub는 부트스트랩을 요청하는 장치에 연결 세부 정보를 제공합니다.

## 장치 레지스트리 및 장치 모델

*장치 모델* 용어는 클라우드 서비스에서 읽거나 쓸 수 있는 장치 속성을 포함하는 모델을 나타냅니다. 또한 클라우드 서비스에서 장치에 대해 원격으로 실행할 수 있는 장치 명령도 포함합니다. 다음 섹션의 설명처럼 서비스 기반 모델에서 장치는 모델에 대해 알고 있지 않지만 클라우드 서비스는 장치에 대한 메타데이터를 계속해서 추적 및 사용할 수 있습니다.

IoT 시스템 및 장치 레지스트리 역할에서는 장치 정보 및 관련 메타데이터를 저장하는 것이 중요합니다. 변경할 수 없는 레거시 장치 또는 장치 모델을 사용하지 않는 장치의 경우 특히 그렇습니다. 서비스 기반 모델을 통해 IoT 서비스가 장치 모집단과 상호 작용하도록 할 수 있습니다. 장치가 정의된 모델을 사용하여 작동하는 경우 장치 레지스트리는 장치 데이터의 일관된 보기로 제공되며 여기서 장치는 마스터 역할을 합니다. 이 경우 서비스는 장치에 원하는 변경을 알리고 장치에서 변경 내용을 확인한 후에만 해당 변경이 유효합니다.

### 서비스 기반 모델

장치가 Azure IoT Hub에 연결되고 장치 모델을 제공하지 않는 경우 등록된 장치 및 관련 메타데이터를 추적하는 장치 레지스트리를 구현하는 것이 중요합니다. 이 경우 장치 레지스트리는 장치 메타데이터의 유일한 저장소 위치입니다. 추적하려는 장치 메타데이터의 예로는 논리 토폴로지(예: 4층, 109번 건물), 장치 기능(예: 출입구 센서) 또는 기타 태그 정보가 있습니다.

### 장치 기반 모델

IoT 솔루션으로 IoT 장치 기능을 활용하도록 하려면 장치를 IoT Hub에 연결한 후 장치가 클라우드에 자신을 설명하도록 해야 합니다. 다음은 IoT 솔루션에서 사용할 수 있는 두 가지 유형의 장치 모델입니다.

#### 자체 정의된 장치 모델

장치 엔지니어(또는 장치 시뮬레이터를 사용하는 개발자)는 장치를 구축함에 따라 장치 기능을 반복하여 자체 정의된 장치 모델을 사용합니다. 장치 엔지니어는 몇 가지 속성 및 지원되는 명령을 포함하는 장치를 만들어 시작할 수 있으며 속성과 명령은 나중에 더 추가할 수 있습니다. 마찬가지로, 해당 장치 엔지니어는 각각 고유한 기능을 제공하고 자체 정의된 모델을 사용하는 여러 장치를 포함할 수 있습니다. 이 경우 장치 엔지니어는 장치 모델의 구조를 등록하지 않아도 됩니다. 상당히 변형된 자체 정의된 모델은 대규모 장치로 확장할 때 문제가 될 수 있습니다.

#### 미리 정의된 장치 모델

네트워크 및 전력 또는 처리 제약 조건 하에서 작동하는 프로덕션 IoT 배포에는 장치 처리 및 전력 소비를 줄이는 데 도움이 되는 미리 정의된 장치 모델이 매우 유리할 수 있습니다. 특히, 제한되고 비용이 많이 드는 인프라(예: 위성)를 사용할 때 마찬가지로, 장치는 최소한의 네트워크 트래픽으로 서로 다른 네트워크(WiFi, 2G/3G/4G, BLE, Sat 등)를 통해 전송할 수 있습니다. 미리 정의된 장치 모델을 구현할 때 장치 엔지니어는 미리 정의된 장치 모델에 키로 제공할 인코딩된 장치 정보를 1~2바이트로 전송할 수 있습니다. 이러한 접근 방식이 간단하므로 자체 정의된 장치 모델에 비해 10~100배 효율성이 높습니다.

### 원격 모니터링 미리 구성된 솔루션 및 해당 장치 모델

Azure IoT Suite [원격 모니터링 미리 구성된 솔루션][lnk-remote-monitoring]은 자체 정의된 장치 모델을 구현합니다. 이 모델을 사용하여 장치를 정의하고 기능을 개발함에 따라 신속하게 반복할 수 있습니다.

이 미리 구성된 솔루션에 대한 소스 코드는 [azure-iot-solution][lnk-azure-iot-solution] GitHub 리포지토리에서 찾을 수 있습니다.

원격 모니터링 미리 구성된 솔루션으로 장치 개체를 만든 후 서비스로 보내는 코드는 **Simulator/Simulator.WorkerRole/SimulatorCore/Devices/DeviceBase.cs** 파일에 있습니다. **SendDeviceInfo** 및 **GetDeviceInfo** 메서드에서 자체 설명한 장치 모델을 만들어 Azure IoT Hub로 보낸 것을 확인할 수 있습니다.

클라우드 서비스에서 이벤트 관련 장치 모델을 처리하는 코드는 **EventProcessor/EventProcessor.WorkerRole/Processors/DeviceManagementProcessor.cs** 파일에 있습니다. 미리 구성된 솔루션의 서비스 측에 장치가 전송한 장치 모델 관련 메시지에 대해 작동하는 대부분의 작업은 **ProcessJToken** 메서드에서 발생합니다.

장치 모델 관련 메시지를 수신하면 **DeviceManagement/Infrastructure/BusinessLogic/DeviceLogic.cs** 파일에 있는 **UpdateDeviceFromSimulatedDeviceInfoPacketAsync** 및 **UpdateDeviceFromRealDeviceInfoPacketAsync** 메서드는 장치 레지스트리를 업데이트해야 합니다. 원격 모니터링 미리 구성된 솔루션의 장치 레지스트리 API는 **DeviceManagement/Web/WebApiControllers/DeviceApiController.cs** 파일에서 확인할 수 있습니다.

### 현장 게이트웨이 장치 모델

현장 게이트웨이는 인터넷에 직접 연결할 수 없거나 연결해서는 안 되는 장치에 대한 연결 및 프로토콜 변환을 설정하는 데 주로 사용됩니다. 구축 중인 장치가 현장 게이트웨이인 경우 Azure IoT Hub와의 모든 상호 작용에서 현장 게이트웨이를 통해 연결된 장치를 나타낼 수 있습니다. 현장 게이트웨이의 제조업체는 장치 프로토콜과 IoT 서비스에서 지원하는 프로토콜 간에 변환을 구현할 책임이 있습니다. 현장 게이트웨이를 BLE(Bluetooth 저에너지) 장치에 연결하려면 장치에 대한 BLE 인터페이스와 Azure IoT Hub에 대한 인터페이스를 구현해야 합니다.

## 장치 액세스 관리

IoT Suite 미리 구성된 솔루션은 장치 속성에 대한 읽기 쓰기 액세스 권한 및 장치 명령에 대한 실행 권한을 포함하여 다양한 측면의 장치에 대한 액세스를 제어합니다. 미리 구성된 솔루션에서 이 액세스는 장치 관리 포털에서 AAD(Azure Active Directory)를 통해 제어됩니다. 미리 구성된 솔루션에서 AAD의 사용을 확장하여 역할 기반 액세스 보안을 설정할 수 있습니다.

## 원격 제어

원격 제어는 Azure IoT Suite 미리 구성된 솔루션에 대한 시나리오의 범위를 벗어나는 내용입니다. 그러나 다음은 IoT 솔루션에서 원격 제어를 설정하기 위해 제공되는 옵션에 대한 고급 분석입니다.

IT 시나리오에서 원격 제어는 대개 원격 사용자 지원 또는 원격 서버의 원격 구성에 사용됩니다. IoT 시나리오에서 대부분의 장치에는 사용자가 참여하지 않으므로 원격 구성 및 진단 시나리오에 원격 제어가 사용됩니다. 서로 다른 두 모델을 사용하여 원격 제어를 구현할 수 있습니다.

* **직접 연결** 직접 연결을 통해 장치에 대한 원격 제어를 설정하려면(예: Linux의 SSH, Windows의 원격 데스크톱 또는 원격 디버깅 도구 사용) 장치에 대한 연결을 만들 수 있어야 합니다. 장치를 개방 인터넷에 노출하는 보안 위험이 있으므로 릴레이 서비스(예: Azure [서비스 버스 릴레이 서비스][service-bus-relay])를 사용하여 연결 및 트래픽을 설정하는 것이 좋습니다. 릴레이 연결은 장치에서 아웃바운드 연결이므로 장치에서 열린 TCP 포트의 공격 노출 영역을 제한할 수 있습니다.

* 장치 명령을 통한 **장치 명령** 원격 제어는 기존 연결을 활용하고 장치 및 Azure IoT Hub 간에 설정된 통신 채널을 활용합니다. 장치 명령 기반 원격 제어를 설정하려면 다음 요구 사항을 준수해야 합니다.
  * 장치에서 실행되는 소프트웨어가 해당 장치에서 장치 명령을 사용할 수 있음을 IoT 서비스에 알려야 합니다. 이 작업은 일반적으로 장치 모델의 일부로 정의됩니다.
  * 장치에서 실행되는 소프트웨어는 원격 제어 명령을 구현해야 합니다. 이러한 장치 명령은 요청(IoT 서비스에서 장치로) 및 응답(장치에서 IoT 서비스로) 패턴을 따라야 합니다. 장치 명령을 실행하면 장치 상태에 영향을 줄 수 있으며 장치 레지스트리에서 새 상태를 업데이트해야 합니다.

장치가 장치 구성 및 상태를 위한 마스터 저장소인 경우 장치 레지스트리는 결과적으로 일관된 모델을 사용하고 장치 상태에 대한 변경 내용을 장치 레지스트리에 푸시해야 합니다. IoT 서비스에서 장치로 요청으로 장치 레지스트리 상태 업데이트를 강제 적용할 수 있으며 장치가 시스템 상태 변경을 인식할 때마다 서비스를 자동으로 업데이트할 수 있습니다. 장치에서 서비스를 자동 업데이트하면 상당한 네트워크 트래픽이 생성되어 장치 프로세서 및 가용 전력 사용량이 증가합니다.

## 원격 관리 및 모니터링

대부분의 IoT 장치는 운영 및 관리 사용자 역할을 구별합니다. 원격 관리는 관리자가 장치 상태를 모니터하고, 장치에서 비즈니스 프로세스 및 응용 프로그램(예: CRM, ERP, 유지 관리 시스템 등)으로 데이터 흐름을 구성하며, 장치 명령을 사용하여 장치의 상태 또는 구성을 원격으로 업데이트할 수 있는 방법입니다.

Azure IoT Suite 미리 구성된 솔루션은 수직 IoT 솔루션에서 시나리오로 확장할 수 있는 장치 관리 환경을 위한 시작점을 만드는 Azure 웹 사이트를 포함합니다.

관리자는 장치 운영 데이터(일반적으로 빠르게 이동) 및 장치 메타데이터(일반적으로 느리게 이동)를 확인하여 장치 상태를 결정할 수 있습니다. 장치 상태 경고 시스템을 설정하기 위해 폴링 전략 대신 스트림 처리 엔진(예: [Azure 스트림 분석](https://azure.microsoft.com/services/stream-analytics/))을 통해 구현된 규칙을 사용할 수 있습니다.

## 원격 구성

장치 수명 주기(프로비전, 진단 또는 비즈니스 프로세스와 통합)의 여러 단계에서 장치 구성을 원격으로 변경하는 것이 중요할 수 있습니다. 원격 구성 변경은 장치의 모델과 장치 모델의 인스턴스 상태를 원격으로 업데이트하는 IoT 서비스의 기능을 조합하여 설정합니다.

원격 모니터링 미리 구성된 솔루션에서는 장치가 원격 구성에 대해 다음 명령을 지원함을 설명합니다.

* ChangeKey
* ChangeConfig
* ChangeSystemProperties

이러한 장치 명령은 특정 환경에서 포털에 의해 원격으로 실행되므로 미리 구성된 솔루션 장치 관리 포털에서 사용 가능한 장치 명령으로 표시되지 않습니다. 장치가 장치 명령을 수신하면 장치는 해당 서비스에 승인 응답을 보냅니다. 장치 명령을 처리한 후 장치는 장치 명령 실행이 성공(또는 실패 및 오류 코드)했음을 알리는 결과 응답을 보냅니다. 이 시점에 장치에서 장치에 대해 원하는 상태를 확인하고 장치 레지스트리가 업데이트됩니다.

## 원격 펌웨어 및 소프트웨어 업데이트

원격 펌웨어 및 소프트웨어 업데이트는 IoT 시스템의 중요한 기능입니다. 업데이트를 통해 장치에서 가장 최신의 가장 안전한 소프트웨어를 실행할 수 있습니다. 장치에서 펌웨어 및 소프트웨어를 원격으로 업데이트하는 것은 일반적으로 다른 비즈니스 프로세스와의 상호 작용을 포함하는 분산된 장기 실행 프로세스의 예입니다. 예를 들어, 많은 전원이 공급되는 연료 펌프를 제어하는 장치에서 펌웨어를 업데이트하는 경우 업데이트를 수행 및 확인하는 동안 다른 시스템에서 연료의 경로를 다시 정하는 단계가 필요할 수 있습니다.

### 펌웨어 업데이트 분석

다음 예제는 사용자 비즈니스 요구에 맞는 펌웨어 업데이트를 구현하는 한 가지 가능한 방법입니다. 이 예의 목표는 특정 구현을 강요하지 않고 프로세스의 고려 사항을 간략히 설명하는 것입니다. 업데이트를 설계하는 방법을 결정할 때는 이 문서의 범위를 벗어나는 수많은 비즈니스 및 기술적 요인을 고려해야 합니다.

장치 업데이트는 IoT 서비스에서 시작되고 장치 명령을 통해 지정된 시간에 장치에 알려집니다. 장치에서 펌웨어 또는 소프트웨어의 원격 업데이트를 명시적으로 지원하는 경우 IoT 서비스는 정의된 비즈니스 프로세스 및 정책에 따라 업데이트 명령을 제공해야 합니다. 업데이트할 장치 명령을 받으면 장치는 다음을 수행해야 합니다.

1. 업데이트 패키지를 다운로드 및 배포합니다.
2. 펌웨어 업데이트의 경우 새로 배포된 구성으로 다시 부팅하거나 새 소프트웨어 패키지를 시작합니다.
3. 새 펌웨어 또는 소프트웨어가 예상대로 실행되는지 확인합니다.

이 모든 다중 단계 프로세스에서 장치는 해당 단계를 거치는 과정에서 IoT 서비스에 장치 상태를 지속적으로 알려야 합니다.

Azure 저장소와 같은 저장소 서비스 또는 CDN(콘텐츠 배달 네트워크)은 업데이트 패키지를 배달할 수 있습니다. 펌웨어 또는 소프트웨어 업데이트를 적용하기 전에 다운로드한 패키지의 무결성을 확인하고 해당 패키지가 예상 소스에서 비롯된 것인지 확인하는 것이 중요합니다.

펌웨어 업데이트를 완료한 후에는 장치에서 성공적 상태를 확인 및 식별할 수 있어야 합니다. 장치가 성공적 상태로 들어가지 않은 경우 장치의 소프트웨어가 알려진 성공적 상태로 롤백을 시작해야 합니다. 알려진 성공적 상태는 마지막 성공적 상태이거나 저장소 파티션에 저장된 *골든 스테이트*로 알려진 장치 펌웨어 이미지일 수 있습니다.

## 다음 단계

Azure IoT Hub에 대해 더 알아보려면 다음 링크를 참조하세요.

* [IoT Hub 시작][]
* [IoT Hub Azure란?][]
* [장치 연결][]

[IoT Hub 시작]: iot-hub-csharp-csharp-getstarted.md
[IoT Hub Azure란?]: iot-hub-what-is-iot-hub.md
[service-bus-relay]: ../service-bus/service-bus-relay-overview.md
[장치 연결]: https://azure.microsoft.com/develop/iot/
[lnk-azure-iot-solution]: https://github.com/Azure/azure-iot-solution
[lnk-iot-suite]: https://azure.microsoft.com/documentation/suites/iot-suite/
[lnk-remote-monitoring]: ../iot-suite/iot-suite-remote-monitoring-sample-walkthrough.md

<!---HONumber=AcomDC_0211_2016-->