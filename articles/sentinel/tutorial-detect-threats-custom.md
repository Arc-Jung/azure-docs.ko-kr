---
title: Azure Sentinel을 사용하여 의심스러운 위협을 탐지하는 사용자 지정 분석 규칙 만들기 | 마이크로 소프트 문서
description: 이 자습서를 사용하여 Azure Sentinel을 사용하여 의심스러운 위협을 탐지하기 위해 사용자 지정 분석 규칙을 만드는 방법을 알아봅니다.
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/20/2020
ms.author: yelevin
ms.openlocfilehash: cea7429ecea105355b0afe306bfa334e55d5d9c4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "77585110"
---
# <a name="tutorial-create-custom-analytic-rules-to-detect-suspicious-threats"></a>튜토리얼: 사용자 지정 분석 규칙을 만들어 의심스러운 위협을 탐지합니다.

데이터 [원본을](quickstart-onboard.md) Azure Sentinel에 연결한 후 환경 전반에서 특정 조건을 검색하고 조건이 일치할 때 인시던트를 생성하여 조사할 수 있는 사용자 지정 규칙을 만들 수 있습니다. 이 자습서에서는 Azure Sentinel을 사용하여 위협을 검색하는 사용자 지정 규칙을 만드는 데 도움이 됩니다.

이 자습서에서는 Azure Sentinel을 사용하면 위협을 감지할 수 있습니다.
> [!div class="checklist"]
> * 분석 규칙 만들기
> * 위협 응답 자동화

## <a name="create-custom-analytic-rules"></a>사용자 지정 분석 규칙 만들기

사용자 지정 분석 규칙을 만들어 사용자 환경에서 의심스러운 위협 및 이상 유형을 검색할 수 있습니다. 이 규칙은 위협을 선별, 조사 및 수정할 수 있도록 즉시 알림을 받을 수 있도록 합니다.

1. Azure Sentinel 아래의 Azure Portal에서 **Analytics**를 선택합니다.

1. 상단 메뉴 모음에서 **+만들기를** 선택하고 **예약된 쿼리 규칙을**선택합니다. 그러면 **애널리틱스 규칙 마법사가**열립니다.

    ![예약된 쿼리 만들기](media/tutorial-detect-threats-custom/create-scheduled-query.png)

1. **일반** 탭에서 고유한 **이름**및 **설명**을 제공합니다. **전술** 필드에서 규칙을 분류할 공격 범주 중에서 선택할 수 있습니다. 필요에 따라 경고 **심각도를** 설정합니다. 규칙을 만들 때 해당 **상태는** 기본적으로 **활성화되어** 있으므로 규칙을 만든 후 바로 실행됩니다. 즉시 실행하지 않으려면 **비활성화를**선택하면 규칙이 **활성 규칙** 탭에 추가되고 필요할 때 활성화할 수 있습니다.

    ![사용자 지정 분석 규칙 만들기 시작](media/tutorial-detect-threats-custom/general-tab.png)

1. 규칙 **논리** 설정 탭에서 **규칙 쿼리** 필드에 직접 쿼리를 작성하거나 Log Analytics에서 쿼리를 만든 다음 복사하여 붙여넣기를 할 수 있습니다.
 
   ![Azure 센티넬에서 쿼리 만들기](media/tutorial-detect-threats-custom/settings-tab.png)

   - 오른쪽의 **결과 미리 보기** 영역을 참조하여 Azure Sentinel이 쿼리가 생성할 결과(로그 이벤트)를 표시하고 쿼리를 작성하고 구성할 때 즉시 변경됩니다. 그래프는 쿼리 일정 섹션의 설정에 의해 결정되는 정의된 기간 동안의 결과 수를 보여 **주며,** 이 결과는 다음과 같이 표시됩니다.
    - 쿼리가 너무 많거나 너무 빈번한 경고를 트리거하는 경우 **경고 임계값** 섹션에서 기준을 설정할 수 있습니다.

      다음은 Azure Activity에서 비정상적인 수의 리소스가 생성될 때 경고하는 샘플 쿼리입니다.

      `AzureActivity
     \| where OperationName == "Create or Update Virtual Machine" or OperationName =="Create Deployment"
     \| where ActivityStatus == "Succeeded"
     \| make-series dcount(ResourceId)  default=0 on EventSubmissionTimestamp in range(ago(7d), now(), 1d) by Caller`

      > [!NOTE]
      > 쿼리 길이는 1에서 10,000자 사이여야 하며 \*"검색" \*또는 "union"을 포함할 수 없습니다.

    1. 맵 **엔터티** 섹션을 사용하여 쿼리 결과의 매개 변수를 Azure Sentinel 인식 엔터티에 연결합니다. 이러한 엔터티는 **인시던트 설정** 탭에서 경고를 인시던트에 그룹화하는 것을 포함하여 추가 분석의 기초를 형성합니다.
    1. 쿼리 **예약** 섹션에서 다음 매개 변수를 설정합니다.

       1. **쿼리실행 쿼리를** 설정하여 쿼리실행 빈도(5분마다 또는 하루에 한 번 자주)를 제어합니다.

       1. **조회 데이터를 마지막에서** 설정하여 쿼리가 적용되는 데이터의 기간을 결정합니다-예를 들어, 지난 10분의 데이터 또는 지난 6시간의 데이터를 쿼리할 수 있다.

       > [!NOTE]
       > 이 두 설정은 한 지점까지 서로 독립적입니다. 간격보다 긴 기간(실제로 쿼리가 겹치는 경우)을 포함하는 짧은 간격으로 쿼리를 실행할 수 있지만 커버리지 기간을 초과하는 간격으로 쿼리를 실행할 수 없으며 그렇지 않으면 전체 쿼리 범위에 간격이 있습니다.

    1. 경고 **임계값** 섹션을 사용하여 기준선을 정의합니다. 예를 들어 쿼리 결과 수가 **초과인** **경우 경고 생성을** 설정하고 쿼리가 실행될 때마다 1000개 이상의 결과를 생성하는 경우에만 규칙을 생성하도록 규칙을 입력합니다. 필수 필드이기 때문에 기준을 설정하지 않으려면 경고가 모든 이벤트를 등록하도록 하려면 숫자 필드에 0을 입력합니다.

    1. **억제** 섹션에서 **경고가 생성된 후 실행 중지 쿼리를** 설정하려면 **경고를** 받으면 쿼리 간격을 초과하는 기간 동안 이 규칙의 작업을 일시 중단하려고 할 수 있습니다. 이 설정을 설정하면 쿼리 실행을 중지해야 하는 시간(최대 24시간)으로 **쿼리 실행 중지를** 설정해야 합니다.

1. **인시던트 설정** 탭에서 Azure Sentinel이 경고를 실행 가능한 인시던트로 변환할지 여부와 방법을 선택할 수 있습니다. 이 탭이 혼자 남아 있는 경우 Azure Sentinel은 각각의 모든 경고에서 별도의 단일 인시던트를 만듭니다. 이 탭의 설정을 변경하여 인시던트를 만들지 않거나 여러 경고를 단일 인시던트로 그룹화하도록 선택할 수 있습니다.

    1. **인시던트 설정** 섹션에서 **이 분석 규칙에 의해 트리거된 경고에서 인시던트 만들기는** 기본적으로 **Enabled로**설정되며, 이는 Azure Sentinel이 규칙에 의해 트리거되는 각 경고와 별도의 단일 인시던트를 생성한다는 것을 의미합니다.<br></br>이 규칙으로 인해 인시던트가 생성되지 않도록 하려면(예: 이 규칙이 후속 분석을 위해 정보를 수집하기 위한 것일 경우) 이 규칙을 **비활성화로**설정합니다.

    1. 경고 **그룹화** 섹션에서 유사하거나 되풀이되는 경고 그룹에서 단일 인시던트를 생성하려면 **이 분석 규칙에 의해 트리거되는 그룹 관련 경고를 인시던트에** 설정하고 다음 매개 변수를 설정합니다. **Enabled**

    1. **선택한 기간 내에 생성된 경고로 그룹을 제한합니다.**<br></br> 유사 또는 되풀이 경고가 함께 그룹화될 기간을 결정합니다. 이 기간 내에 있는 모든 해당 경고는 아래 그룹화 설정에 따라 인시던트 또는 인시던트 집합을 집합적으로 생성합니다. 이 시간 프레임 외부의 경고는 별도의 인시던트 또는 인시던트 집합을 생성합니다.

    2. 다음 을 통해 이 분석 규칙에 의해 트리거된 경고를 **단일 인시던트로**그룹화합니다.

        - **모든 엔터티가 일치하는 경우 경고를 단일 인시던트에 그룹화합니다.** <br></br>경고는 매핑된 각 엔터티에 대해 동일한 값을 공유하는 경우 함께 그룹화됩니다(위의 규칙 논리 설정 탭에 정의). 권장 설정입니다.

        - **이 규칙에 의해 트리거된 모든 경고를 단일 인시던트로 그룹화합니다.** <br></br>이 규칙에 의해 생성된 모든 경고는 동일한 값을 공유하지 않더라도 함께 그룹화됩니다.

        - **선택한 엔터티가 일치하는 경우 경고를 단일 인시던트에 그룹화합니다.** <br></br>경고는 매핑된 일부 엔터티에 대해 동일한 값을 공유하는 경우 함께 그룹화됩니다(드롭다운 목록에서 선택할 수 있음). 예를 들어 소스 또는 대상 IP 주소를 기반으로 별도의 인시던트를 만들려는 경우 이 설정을 사용할 수 있습니다.

    3. **닫힌 일치 인시던트 다시 열기**: 인시던트가 종료된 경우(기본 문제가 해결되었음을 의미) 해당 인시던트에 그룹화된 다른 경고가 생성된 경우 닫힌 인시던트를 다시 열려는 경우 이 설정을 **사용하도록** 설정하고 경고를 새 인시던트를 만들려는 경우 **사용 중지됨으로** 둡니다.

1. 자동 **응답** 탭에서 사용자 지정 규칙에 의해 경고가 생성될 때 자동으로 실행하려는 플레이북을 선택합니다. 플레이북 생성 및 자동화에 대한 자세한 내용은 [위협에 대한 대응을](tutorial-respond-threats-playbook.md)참조하십시오.

1. **검토를 선택하고 만들기를** 선택하여 새 경고 규칙에 대한 모든 설정을 검토한 다음 **만들기를 선택하여 경고 규칙을 초기화합니다.**
  
1. 경고를 만든 후 사용자 지정 규칙이 **활성 규칙**아래 테이블에 추가됩니다. 이 목록에서 각 규칙을 활성화, 비활성화 또는 삭제할 수 있습니다.

1. 만든 경고 규칙의 결과를 보려면 **인시던트** 페이지로 이동하여 [인시던트를 심사하고 인시던트를 조사하고](tutorial-investigate-cases.md)위협을 수정할 수 있습니다.


> [!NOTE]
> Azure Sentinel에서 생성된 경고는 [Microsoft 그래프 보안](https://aka.ms/securitygraphdocs)을 통해 사용할 수 있습니다. 자세한 내용은 Microsoft [그래프 보안 경고 설명서를](https://aka.ms/graphsecurityreferencebetadocs)참조하십시오.

## <a name="next-steps"></a>다음 단계

이 자습서에서는 Azure Sentinel을 사용하여 위협 탐지를 시작하는 방법을 배웠습니다.

위협에 대한 응답을 자동화하는 방법을 알아보려면 [Azure Sentinel](tutorial-respond-threats-playbook.md)에서 자동화된 위협 대응을 설정합니다.

