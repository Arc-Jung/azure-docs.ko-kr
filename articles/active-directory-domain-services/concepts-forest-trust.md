---
title: Azure AD 도메인 서비스에 대한 트러스트 작동 방식 | 마이크로 소프트 문서
description: Azure AD 도메인 서비스와 포리스트 트러스트가 작동하는 방식에 대해 자세히 알아보기
services: active-directory-ds
author: iainfoulds
manager: daveba
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: conceptual
ms.date: 11/19/2019
ms.author: iainfou
ms.openlocfilehash: 8b79e0fb24c15d2e9f16640e90d62f7df5c21f32
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/27/2020
ms.locfileid: "74233702"
---
# <a name="how-trust-relationships-work-for-resource-forests-in-azure-active-directory-domain-services"></a>Azure Active Directory 도메인 서비스의 리소스 포리스트에 대한 트러스트 관계 작동 방식

AD DS(Active Directory 도메인 서비스)는 도메인 및 포리스트 트러스트 관계를 통해 여러 도메인 또는 포리스트에 걸쳐 보안을 제공합니다. 트러스트 간에 인증이 수행되기 전에 Windows는 먼저 사용자, 컴퓨터 또는 서비스에서 요청하는 도메인이 요청 계정의 도메인과 트러스트 관계가 있는지 확인해야 합니다.

이러한 신뢰 관계를 확인하기 위해 Windows 보안 시스템은 요청을 받는 서버에 대한 DC(도메인 컨트롤러)와 요청 계정의 도메인에 있는 DC 간의 신뢰 경로를 계산합니다.

AD DS 및 Windows 분산 보안 모델에서 제공하는 액세스 제어 메커니즘은 도메인 및 포리스트 트러스트를 운영하기 위한 환경을 제공합니다. 이러한 트러스트가 제대로 작동하려면 모든 리소스 또는 컴퓨터가 있는 도메인의 DC에 대한 직접 신뢰 경로가 있어야 합니다.

신뢰 경로는 신뢰할 수 있는 도메인 기관에 대한 인증된 원격 프로시저 호출(RPC) 연결을 사용하여 Net Logon 서비스에 의해 구현됩니다. 보안 채널은 도메인 간 신뢰 관계를 통해 다른 AD DS 도메인으로도 확장됩니다. 이 보안 채널은 사용자 및 그룹의 보안 식별자(SID)를 비롯한 보안 정보를 얻고 확인하는 데 사용됩니다.

## <a name="trust-relationship-flows"></a>트러스트 관계 흐름

트러스트를 둘러싼 보안 통신의 흐름은 트러스트의 탄력성을 결정합니다. 트러스트를 만들거나 구성하는 방법에 따라 포리스트 내에서 또는 포리스트 간에 통신이 얼마나 확장되는지가 결정됩니다.

트러스트에 대한 의사 소통의 흐름은 트러스트의 방향에 따라 결정됩니다. 트러스트는 단방향 또는 양방향일 수 있으며 전이적 또는 비전속일 수 있습니다.

다음 다이어그램은 트리 *1* 및 *트리 2의* 모든 도메인에 기본적으로 전이 트러스트 관계가 있음을 보여 주며 있습니다. 결과적으로 *Tree 1의* 사용자는 *Tree 2의* 도메인에 있는 리소스에 액세스할 수 있으며 *트리 1의* 사용자는 리소스에서 적절한 사용 권한이 할당된 *트리 2의*리소스에 액세스할 수 있습니다.

![두 포리스트 간의 트러스트 관계 다이어그램](./media/concepts-forest-trust/trust-relationships.png)

### <a name="one-way-and-two-way-trusts"></a>단방향 및 양방향 트러스트

트러스트 관계를 사용하면 리소스에 대한 액세스가 단방향 또는 양방향일 수 있습니다.

단방향 트러스트는 두 도메인 간에 생성된 단방향 인증 경로입니다. *도메인 A와* *도메인 B*간의 단방향 트러스트에서 *도메인 A의* 사용자는 *도메인 B*의 리소스에 액세스할 수 있습니다. 그러나 도메인 *B의* 사용자는 *도메인 A*의 리소스에 액세스할 수 없습니다.

일부 단방향 트러스트는 생성되는 트러스트 유형에 따라 비전이적 또는 전이적일 수 있습니다.

양방향 트러스트에서 도메인 *A는* *도메인 B를* 신뢰하고 *도메인 B는* *도메인 A를*신뢰합니다. 이 구성은 인증 요청을 양방향으로 두 도메인 간에 전달할 수 있음을 의미합니다. 일부 양방향 관계는 생성되는 트러스트 유형에 따라 비전이또는 전이적일 수 있습니다.

AD DS 포리스트의 모든 도메인 트러스트는 양방향 전이적 트러스트입니다. 새 자식 도메인이 만들어지면 새 자식 도메인과 부모 도메인 간에 양방향의 전이적 트러스트가 자동으로 만들어집니다.

### <a name="transitive-and-non-transitive-trusts"></a>전이적 및 비전이적 트러스트

전이성은 트러스트가 형성된 두 도메인 외부에서 트러스트를 확장할 수 있는지 여부를 결정합니다.

* 전이적 트러스트를 사용하여 다른 도메인과의 트러스트 관계를 확장할 수 있습니다.
* 비전이적 트러스트를 사용하여 다른 도메인과의 트러스트 관계를 거부할 수 있습니다.

포리스트에서 새 도메인을 만들 때마다 새 도메인과 상위 도메인 간에 양방향 전이적 트러스트 관계가 자동으로 만들어집니다. 자식 도메인이 새 도메인에 추가되면 신뢰 경로는 도메인 계층 구조를 통해 위쪽으로 흐르며 새 도메인과 상위 도메인 간에 생성된 초기 신뢰 경로를 확장합니다. 전이적 트러스트 관계는 형성될 때 도메인 트리를 통해 위쪽으로 향하면서 도메인 트리의 모든 도메인 간에 전이적 트러스트를 만듭니다.

인증 요청은 이러한 신뢰 경로를 따르므로 포리스트의 모든 도메인의 계정을 포리스트의 다른 도메인에서 인증할 수 있습니다. 적절한 사용 권한이 있는 계정은 단일 로그온 프로세스를 사용하여 포리스트에 있는 모든 도메인의 리소스에 액세스할 수 있습니다.

## <a name="forest-trusts"></a>포리스트 트러스트

포리스트 트러스트를 사용하면 분할된 AD DS 인프라를 관리하고 여러 포리스트의 리소스 및 기타 개체에 대한 액세스를 지원할 수 있습니다. 포리스트 트러스트는 서비스 제공업체, 인수 합병을 진행 중인 회사, 협업 비즈니스 엑스트라넷 및 관리 자율성을 위한 솔루션을 찾는 회사에 유용합니다.

포리스트 트러스트를 사용하여 두 개의 서로 다른 포리스트를 연결하여 단방향 또는 양방향 전이적 트러스트 관계를 형성할 수 있습니다. 포리스트 트러스트를 사용하면 관리자가 두 개의 AD DS 포리스트를 단일 트러스트 관계로 연결하여 포리스트 전체에서 원활한 인증 및 권한 부여 환경을 제공할 수 있습니다.

포리스트 트러스트는 한 포리스트의 포리스트 루트 도메인과 다른 포리스트의 포리스트 루트 도메인 간에만 만들 수 있습니다. 포리스트 트러스트는 두 포리스트 간에만 만들 수 있으며 암시적으로 세 번째 포리스트로 확장할 수 없습니다. 이 동작은 *포리스트 1과* *포리스트 2*사이에 포리스트 트러스트가 만들어지고 *포리스트 2와* *포리스트 3*사이에 다른 포리스트 트러스트가 만들어지면 *포리스트 3에* 대한 암시적 트러스트가 없다는 것을 의미합니다. *Forest 3*

다음 다이어그램에서는 단일 조직에서 세 개의 AD DS 포리스트 간의 두 개의 별도 포리스트 트러스트 관계를 보여 주십습니다.

![포리스트 트러스트 관계 다이어그램](./media/concepts-forest-trust/forest-trusts.png)

이 예제 구성은 다음과 같은 액세스를 제공합니다.

* *포리스트 2의* 사용자는 *포리스트 1* 또는 *포리스트 3의* 모든 도메인의 리소스에 액세스할 수 있습니다.
* *포리스트 3의* 사용자는 *포리스트 2의* 모든 도메인에서 리소스에 액세스할 수 있습니다.
* *포리스트 1의* 사용자는 *포리스트 2의* 모든 도메인에서 리소스에 액세스할 수 있습니다.

이 구성에서는 *포리스트 1의* 사용자가 *포리스트 3의* 리소스에 액세스하거나 그 반대의 경우도 마찬가지입니다. *포리스트 1과* *포리스트 3의* 사용자가 리소스를 공유할 수 있도록 하려면 두 포리스트 간에 양방향 전이적 트러스트를 만들어야 합니다.

두 포리스트 간에 단방향 포리스트 트러스트가 만들어지면 신뢰할 수 있는 포리스트의 구성원은 신뢰하는 포리스트에 있는 리소스를 활용할 수 있습니다. 그러나 이 트러스트는 한 방향으로만 작동합니다.

예를 들어 단방향 포리스트 *1(신뢰할* 수 있는 포리스트)과 *포리스트 2(신뢰* 포리스트) 간에 포리스트 트러스트가 만들어집니다.

* *포리스트 1의* 구성원은 *포리스트 2에*있는 리소스에 액세스할 수 있습니다.
* *포리스트 2의* 구성원은 동일한 트러스트를 사용하여 *포리스트 1에* 있는 리소스에 액세스할 수 없습니다.

> [!IMPORTANT]
> Azure AD 도메인 서비스 리소스 포리스트는 온-프레미스 Active Directory에 대한 단방향 포리스트 트러스트만 지원합니다.

### <a name="forest-trust-requirements"></a>포리스트 트러스트 요구 사항

포리스트 트러스트를 만들려면 올바른 DNS(도메인 이름 시스템) 인프라가 있는지 확인해야 합니다. 포리스트 트러스트는 다음 DNS 구성 중 하나를 사용할 수 있는 경우에만 만들 수 있습니다.

* 단일 루트 DNS 서버는 포리스트 DNS 네임스페이스에 대한 루트 DNS 서버입니다 - 루트 영역에는 각 DNS 네임스페이스에 대한 위임이 포함되어 있으며 모든 DNS 서버의 루트 힌트에는 루트 DNS 서버가 포함됩니다.
* 공유 루트 DNS 서버가 없는 경우 각 포리스트 DNS 네임스페이스에 대한 루트 DNS 서버는 각 DNS 네임스페이스에 대해 DNS 조건부 전달자를 사용하여 다른 네임스페이스의 이름에 대한 쿼리를 라우팅합니다.

    > [!IMPORTANT]
    > Azure AD 도메인 서비스 리소스 포리스트는 이 DNS 구성을 사용해야 합니다. 리소스 포리스트 DNS 네임스페이스 이외의 DNS 네임스페이스를 호스팅하는 것은 Azure AD 도메인 서비스의 기능이 아닙니다. 조건부 전달기는 적절한 구성입니다.

* 공유 루트 DNS 서버가 없고 각 포리스트 DNS 네임스페이스에 대한 루트 DNS 서버가 사용중인 경우 DNS 보조 영역은 각 DNS 네임스페이스에서 구성되어 다른 네임스페이스의 이름에 대한 쿼리를 라우팅합니다.

포리스트 트러스트를 만들려면 포리스트 루트 도메인의 도메인 관리자 그룹 또는 Active Directory의 엔터프라이즈 관리자 그룹의 구성원이어야 합니다. 각 트러스트에는 두 포리스트의 관리자가 알아야 할 암호가 할당됩니다. 두 포리스트의 엔터프라이즈 관리자 구성원은 두 포리스트모두에서 트러스트를 한 번에 만들 수 있으며, 이 시나리오에서는 암호화된 임의의 암호가 자동으로 생성되고 두 포리스트에 대해 기록됩니다.

Azure AD 도메인 서비스에 대한 아웃바운드 포리스트 트러스트는 Azure 포털에서 만들어집니다. 관리되는 도메인 자체로 트러스트를 수동으로 만들지 않습니다. 들어오는 포리스트 트러스트는 온-프레미스 Active Directory에 이전에 언급된 권한을 가진 사용자가 구성해야 합니다.

## <a name="trust-processes-and-interactions"></a>프로세스 및 상호 작용 신뢰

많은 도메인 간 및 포리스트 간 트랜잭션은 다양한 작업을 완료하기 위해 도메인 또는 포리스트 트러스트에 의존합니다. 이 섹션에서는 트러스트 간에 리소스에 액세스하고 인증 조회를 평가할 때 발생하는 프로세스 및 상호 작용에 대해 설명합니다.

### <a name="overview-of-authentication-referral-processing"></a>인증 조회 처리 개요

인증 요청이 도메인이라고 하면 해당 도메인의 도메인 컨트롤러는 요청이 발생하는 도메인과 트러스트 관계가 있는지 여부를 결정해야 합니다. 트러스트의 방향과 트러스트가 전이적인지 비전이적인지 여부도 사용자가 도메인의 리소스에 액세스하도록 인증하기 전에 결정해야 합니다. 신뢰할 수 있는 도메인 간에 발생하는 인증 프로세스는 사용 중 인증 프로토콜에 따라 다릅니다. Kerberos V5 및 NTLM 프로토콜은 도메인에 대한 인증을 위해 참조를 다르게 처리합니다.

### <a name="kerberos-v5-referral-processing"></a>케르베로스 V5 추천 처리

Kerberos V5 인증 프로토콜은 클라이언트 인증 및 권한 부여 정보에 대한 도메인 컨트롤러의 Net Logon 서비스에 종속됩니다. Kerberos 프로토콜은 세션 티켓에 대한 온라인 키 배포 센터(KDC) 및 Active Directory 계정 저장소에 연결됩니다.

Kerberos 프로토콜은 또한 TGS(교차 영역 티켓 부여 서비스)에 대한 트러스트를 사용하고 보안 채널에서 권한 특성 인증서(PAC)의 유효성을 검사합니다. Kerberos 프로토콜은 MIT Kerberos 영역과 같은 비 Windows 브랜드 운영 체제 Kerberos 영역에서만 영역 간 인증을 수행하며 Net Logon 서비스와 상호 작용할 필요가 없습니다.

클라이언트가 인증을 위해 Kerberos V5를 사용하는 경우 계정 도메인의 도메인 컨트롤러에서 대상 도메인의 서버에 대한 티켓을 요청합니다. Kerberos KDC는 클라이언트와 서버 간에 신뢰할 수 있는 중개자 역할을 하며 두 당사자가 서로를 인증할 수 있는 세션 키를 제공합니다. 대상 도메인이 현재 도메인과 다른 경우 KDC는 인증 요청을 참조할 수 있는지 여부를 결정하는 논리적 프로세스를 따릅니다.

1. 현재 도메인이 요청되는 서버의 도메인에서 직접 신뢰할 수 있습니까?
    * 그렇다면 클라이언트에게 요청된 도메인에 대한 참조를 보냅니다.
    * 이 경우 다음 단계로 이동합니다.

2. 현재 도메인과 트러스트 경로의 다음 도메인 간에 전이 트러스트 관계가 있습니까?
    * 그렇다면 클라이언트에게 신뢰 경로의 다음 도메인으로 참조를 보냅니다.
    * 이 경우 클라이언트에게 로그온 거부 메시지를 보냅니다.

### <a name="ntlm-referral-processing"></a>NTLM 추천 처리

NTLM 인증 프로토콜은 클라이언트 인증 및 권한 부여 정보에 대한 도메인 컨트롤러의 Net Logon 서비스에 종속됩니다. 이 프로토콜은 Kerberos 인증을 사용하지 않는 클라이언트를 인증합니다. NTLM은 트러스트를 사용하여 도메인 간에 인증 요청을 전달합니다.

클라이언트가 NTLM을 인증에 사용하는 경우 인증에 대한 초기 요청은 클라이언트에서 대상 도메인의 리소스 서버로 직접 이동합니다. 이 서버는 클라이언트가 응답하는 문제를 만듭니다. 그런 다음 서버는 컴퓨터 계정 도메인의 도메인 컨트롤러에 대한 사용자의 응답을 보냅니다. 이 도메인 컨트롤러는 사용자 계정을 보안 계정 데이터베이스와 검사합니다.

계정이 데이터베이스에 없는 경우 도메인 컨트롤러는 다음 논리를 사용하여 통과 인증을 수행할지, 요청을 전달할지 또는 요청을 거부할지 결정합니다.

1. 현재 도메인이 사용자의 도메인과 직접 신뢰 관계를 맺고 있습니까?
    * 그렇다면 도메인 컨트롤러는 통과 인증을 위해 클라이언트의 자격 증명을 사용자의 도메인 컨트롤러로 보냅니다.
    * 이 경우 다음 단계로 이동합니다.

2. 현재 도메인에 사용자의 도메인과 전이 트러스트 관계가 있습니까?
    * 그렇다면 인증 요청을 트러스트 경로의 다음 도메인에 전달합니다. 이 도메인 컨트롤러는 사용자의 자격 증명을 자체 보안 계정 데이터베이스에 대해 확인하여 프로세스를 반복합니다.
    * 이 경우 클라이언트에게 로그온 거부 메시지를 보냅니다.

### <a name="kerberos-based-processing-of-authentication-requests-over-forest-trusts"></a>포리스트 트러스트를 통해 인증 요청의 Kerberos 기반 처리

포리스트 트러스트에 의해 두 포리스트가 연결되면 Kerberos V5 또는 NTLM 프로토콜을 사용하여 만든 인증 요청을 포리스트 간에 라우팅하여 두 포리스트의 리소스에 대한 액세스를 제공할 수 있습니다.

포리스트 트러스트가 처음 설정되면 각 포리스트는 파트너 포리스트에 있는 모든 신뢰할 수 있는 네임스페이스를 수집하고 [신뢰할 수 있는 도메인 개체에](#trusted-domain-object)정보를 저장합니다. 신뢰할 수 있는 네임스페이스에는 도메인 트리 이름, UPN(사용자 주체 이름) 접미사, 서비스 주체 이름(SPN) 접미사 및 다른 포리스트에 사용되는 SID(보안 ID) 네임스페이스가 포함됩니다. TDO 개체가 글로벌 카탈로그에 복제됩니다.

인증 프로토콜이 포리스트 트러스트 경로를 따르기 전에 리소스 컴퓨터의 서비스 주체 이름(SPN)을 다른 포리스트의 위치로 확인해야 합니다. SPN은 다음 중 하나일 수 있습니다.

* 호스트의 DNS 이름입니다.
* 도메인의 DNS 이름입니다.
* 서비스 연결 점 개체의 고유 이름입니다.

한 포리스트의 워크스테이션이 다른 포리스트의 리소스 컴퓨터의 데이터에 액세스하려고 하면 Kerberos 인증 프로세스가 도메인 컨트롤러에 연결하여 리소스 컴퓨터의 SPN에 대한 서비스 티켓을 가져옵니다. 도메인 컨트롤러가 글로벌 카탈로그를 쿼리하고 SPN이 도메인 컨트롤러와 동일한 포리스트에 있지 않다고 확인하면 도메인 컨트롤러는 상위 도메인에 대한 참조를 워크스테이션으로 다시 보냅니다. 이 때 워크스테이션은 서비스 티켓에 대한 상위 도메인을 쿼리하고 리소스가 있는 도메인에 도달할 때까지 참조 체인을 계속 따릅니다.

다음 다이어그램 및 단계는 Windows를 실행하는 컴퓨터가 다른 포리스트에 있는 컴퓨터에서 리소스에 액세스하려고 할 때 사용되는 Kerberos 인증 프로세스에 대한 자세한 설명을 제공합니다.

![포리스트 트러스트를 통해 Kerberos 프로세스의 다이어그램](media/concepts-forest-trust/kerberos-over-forest-trust-process.png)

1. *User1은* *europe.tailspintoys.com* 도메인의 자격 증명을 사용하여 *Workstation1에* 로그온합니다. 그런 다음 사용자는 *usa.wingtiptoys.com* 포리스트에 있는 *FileServer1에서* 공유 리소스에 액세스하려고 시도합니다.

2. *워크스테이션1은* 해당 도메인의 *도메인 컨트롤러인 ChildDC1에서*Kerberos KDC에 연락하고 *FileServer1* SPN에 대한 서비스 티켓을 요청합니다.

3. *ChildDC1은* 도메인 데이터베이스에서 SPN을 찾지 못하고 *tailspintoys.com* 포리스트에 이 SPN이 포함되어 있는지 확인하기 위해 글로벌 카탈로그를 쿼리합니다. 글로벌 카탈로그는 자체 포리스트로 제한되므로 SPN을 찾을 수 없습니다.

    그런 다음 글로벌 카탈로그에서 해당 포리스트에 대해 설정된 포리스트 트러스트에 대한 정보를 데이터베이스에서 확인합니다. 발견되면 포리스트 트러스트 트러스트 도메인 개체(TDO)에 나열된 이름 접미사를 대상 SPN의 접미사와 비교하여 일치를 찾습니다. 일치하는 일치가 발견되면 글로벌 카탈로그는 *ChildDC1로*다시 라우팅 힌트를 제공합니다.

    라우팅 힌트는 대상 포리스트에 대한 직접 인증 요청을 돕습니다. 힌트는 로컬 도메인 컨트롤러 및 글로벌 카탈로그와 같은 모든 기존 인증 채널이 SPN을 찾지 못하는 경우에만 사용됩니다.

4. *ChildDC1은* 상위 도메인에 대한 참조를 *워크스테이션1로*다시 보냅니다.

5. *워크스테이션1은* *wingtiptoys.com* 포리스트의 포리스트 루트 도메인에 있는 도메인*컨트롤러(ForestRootDC2)에*대한 참조를 위해 *ForestRootDC1(부모* 도메인)의 도메인 컨트롤러에 문의합니다.

6. *워크스테이션1은* *요청된* 서비스에 대한 서비스 티켓을 위해 wingtiptoys.com 포리스트의 *ForestRootDC2에* 문의합니다.

7. *ForestRootDC2는* SPN을 찾기 위해 글로벌 카탈로그에 연락하고, 글로벌 카탈로그는 SPN에 대한 일치를 찾아 *다시 ForestRootDC2로*보냅니다.

8. 그런 다음 *ForestRootDC2는* usa.wingtiptoys.com *다시* *워크스테이션1로*참조를 보냅니다.

9. *워크스테이션1은* *ChildDC2에서* KDC에 연락하고 *User1에* 대한 티켓을 협상하여 *FileServer1에*액세스합니다.

10. *워크스테이션1에* 서비스 티켓이 있으면 서비스 티켓을 *FileServer1로*전송하여 *User1의*보안 자격 증명을 읽고 그에 따라 액세스 토큰을 생성합니다.

## <a name="trusted-domain-object"></a>신뢰할 수 있는 도메인 개체

조직 내의 각 도메인 또는 포리스트 트러스트는 도메인 내의 *시스템* 컨테이너에 저장된 TDO(신뢰할 수 있는 도메인 개체)로 표시됩니다.

### <a name="tdo-contents"></a>TDO 내용

TDO에 포함된 정보는 TDO가 도메인 트러스트또는 포리스트 트러스트에 의해 만들어졌는지 여부에 따라 달라집니다.

도메인 트러스트가 만들어지면 DNS 도메인 이름, 도메인 SID, 트러스트 유형, 트러스트 전송성 및 상호 도메인 이름과 같은 특성이 TDO에 표시됩니다. 포리스트 트러스트 TD는 파트너 포리스트에서 신뢰할 수 있는 모든 네임스페이스를 식별하기 위해 추가 특성을 저장합니다. 이러한 특성에는 도메인 트리 이름, UPN(사용자 주체 이름) 접미사, 서비스 주체 이름(SPN) 접미사 및 SID(보안 ID) 네임스페이스가 포함됩니다.

트러스트는 Active Directory에 TPO로 저장되므로 포리스트의 모든 도메인은 포리스트 전체에 있는 트러스트 관계에 대한 지식을 갖습니다. 마찬가지로 포리스트 트러스트를 통해 둘 이상의 포리스트가 함께 결합되면 각 포리스트의 포리스트 루트 도메인은 신뢰할 수 있는 포리스트의 모든 도메인에 걸쳐 있는 트러스트 관계에 대한 지식을 갖습니다.

### <a name="tdo-password-changes"></a>TDO 암호 변경

트러스트 관계의 두 도메인은 Active Directory의 TDO 개체에 저장되는 암호를 공유합니다. 계정 유지 관리 프로세스의 일부로 30일마다 신뢰 도메인 컨트롤러는 TDO에 저장된 암호를 변경합니다. 모든 양방향 트러스트는 실제로 두 개의 단방향 트러스트가 반대 방향으로 진행되기 때문에 양방향 트러스트의 경우 프로세스가 두 번 발생합니다.

신뢰에는 신뢰와 신뢰할 수 있는 측면이 있습니다. 신뢰할 수 있는 쪽에서는 모든 쓰기 가능한 도메인 컨트롤러를 프로세스에 사용할 수 있습니다. 신뢰 측에서 PDC 에뮬레이터는 암호 변경을 수행합니다.

암호를 변경하려면 도메인 컨트롤러가 다음 프로세스를 완료합니다.

1. 신뢰 도메인의 PDC(기본 도메인 컨트롤러) 에뮬레이터는 새 암호를 만듭니다. 신뢰할 수 있는 도메인의 도메인 컨트롤러는 암호 변경을 시작하지 않습니다. 항상 신뢰 도메인 PDC 에뮬레이터에 의해 시작됩니다.

2. 트러스트 도메인의 PDC 에뮬레이터는 TDO 개체의 *OldPassword* 필드를 현재 *NewPassword* 필드로 설정합니다.

3. 트러스트 도메인의 PDC 에뮬레이터는 TDO 개체의 *NewPassword* 필드를 새 암호로 설정합니다. 이전 암호의 복사본을 유지하면 신뢰할 수 있는 도메인의 도메인 컨트롤러가 변경을 수신하지 못하거나 새 트러스트 암호를 사용하는 요청이 이루어지기 전에 변경 사항이 복제되지 않은 경우 이전 암호로 되돌릴 수 있습니다.

4. 트러스트 도메인의 PDC 에뮬레이터는 트러스트 계정의 암호를 새 암호로 설정하도록 요청하는 신뢰할 수 있는 도메인의 도메인 컨트롤러에 원격 호출을 합니다.

5. 신뢰할 수 있는 도메인의 도메인 컨트롤러는 신뢰 암호를 새 암호로 변경합니다.

6. 트러스트의 각 측면에서 업데이트는 도메인의 다른 도메인 컨트롤러에 복제됩니다. 트러스트 도메인에서 변경은 신뢰할 수 있는 도메인 개체의 긴급 복제를 트리거합니다.

이제 두 도메인 컨트롤러모두에서 암호가 변경됩니다. 일반 복제는 TDO 개체를 도메인의 다른 도메인 컨트롤러에 배포합니다. 그러나 트러스트 도메인의 도메인 컨트롤러는 신뢰할 수 있는 도메인의 도메인 컨트롤러를 업데이트하지 않고도 암호를 변경할 수 있습니다. 이 시나리오는 암호 변경을 처리하는 데 필요한 보안 채널을 설정하지 못했기 때문에 발생할 수 있습니다. 또한 프로세스 중 특정 시점에서 신뢰할 수 있는 도메인의 도메인 컨트롤러를 사용할 수 없으며 업데이트된 암호를 받지 못할 수도 있습니다.

암호 변경이 성공적으로 전달되지 않는 상황을 처리하기 위해 트러스트 도메인의 도메인 컨트롤러는 새 암호를 사용하여 성공적으로 인증(보안 채널 설정)하지 않는 한 새 암호를 변경하지 않습니다. 이 동작은 이전 암호와 새 암호가 모두 트러스트 도메인의 TDO 개체에 보관되는 이유입니다.

암호를 사용한 인증이 성공할 때까지 암호 변경이 완료되지 않습니다. 저장된 이전 암호는 신뢰할 수 있는 도메인의 도메인 컨트롤러가 새 암호를 수신할 때까지 보안 채널을 통해 사용할 수 있으므로 중단 없는 서비스를 사용할 수 있습니다.

암호가 유효하지 않아 새 암호를 사용한 인증에 실패하면 신뢰하는 도메인 컨트롤러가 이전 암호를 사용하여 인증하려고 시도합니다. 이전 암호로 성공적으로 인증하면 15분 이내에 암호 변경 프로세스가 다시 시작됩니다.

트러스트 암호 업데이트는 30일 이내에 트러스트 양쪽의 도메인 컨트롤러에 복제해야 합니다. 신뢰 암호가 30일 후에 변경되고 도메인 컨트롤러에 N-2 암호만 있는 경우 트러스트 측의 트러스트를 사용할 수 없으며 신뢰할 수 있는 쪽에 보안 채널을 만들 수 없습니다.

## <a name="network-ports-used-by-trusts"></a>트러스트에서 사용하는 네트워크 포트

트러스트는 다양한 네트워크 경계에 배포되어야 하므로 하나 이상의 방화벽에 걸쳐 있어야 할 수 있습니다. 이 경우 방화벽을 통해 트러스트 트래픽을 터널하거나 방화벽의 특정 포트를 열어 트래픽이 통과할 수 있도록 할 수 있습니다.

> [!IMPORTANT]
> Active Directory 도메인 서비스는 Active Directory RPC 트래픽을 특정 포트로 제한하는 것을 지원하지 않습니다.

Microsoft 지원 문서의 **Windows Server 2008 및 이후 버전** 섹션을 [읽으면 Active Directory 도메인 및 트러스트에 대한 방화벽을 구성하여](https://support.microsoft.com/help/179442/how-to-configure-a-firewall-for-domains-and-trusts) 포리스트 트러스트에 필요한 포트에 대해 알아봅니다.

## <a name="supporting-services-and-tools"></a>지원 서비스 및 도구

트러스트 및 인증을 지원하기 위해 몇 가지 추가 기능 및 관리 도구가 사용됩니다.

### <a name="net-logon"></a>Net Logon

Net Logon 서비스는 Windows 기반 컴퓨터에서 DC로 보안 채널을 유지 관리합니다. 또한 다음과 같은 신뢰 관련 프로세스에도 사용됩니다.

* 트러스트 설정 및 관리 - Net Logon은 신뢰 암호를 유지하고, 트러스트 정보를 수집하고, LSA 프로세스 및 TDO와 상호 작용하여 트러스트를 확인하는 데 도움이 됩니다.

    포리스트 트러스트의 경우 신뢰 정보에는 신뢰할 수 있는 포리스트가 관리한다고 주장하는 네임스페이스 집합이 포함된 포리스트 트러스트*정보(FTInfo)* 레코드가 포함되며, 이 레코드에는 트러스트 포리스트가 각 클레임을 신뢰할 수 있는지 여부를 나타내는 필드가 추가됩니다.

* 인증 - 보안 채널을 통해 도메인 컨트롤러에 사용자 자격 증명을 공급하고 도메인 보안 관리자및 사용자에 대한 사용자 권한을 반환합니다.

* 도메인 컨트롤러 위치 – 도메인 또는 도메인 전체에서 도메인 컨트롤러를 찾거나 찾는 데 도움이 됩니다.

* 통과 유효성 검사 - 다른 도메인의 사용자 자격 증명은 Net Logon에 의해 처리됩니다. 트러스트 도메인이 사용자의 ID를 확인해야 하는 경우 Net Logon을 통해 사용자의 자격 증명을 확인을 위해 신뢰할 수 있는 도메인으로 전달합니다.

* 권한 특성 인증서(PAC) 확인 - 인증을 위해 Kerberos 프로토콜을 사용하는 서버가 서비스 티켓에서 PAC를 확인해야 하는 경우 확인을 위해 보안 채널을 통해 PAC를 도메인 컨트롤러로 보냅니다.

### <a name="local-security-authority"></a>로컬 보안 기관

LSA(로컬 보안 당국)는 시스템에서 로컬 보안의 모든 측면에 대한 정보를 유지하는 보호된 하위 시스템입니다. 지역 보안 정책으로 통칭되는 LSA는 이름과 식별자 간의 번역을 위한 다양한 서비스를 제공합니다.

LSA 보안 하위 시스템은 개체에 대한 액세스 유효성 검사, 사용자 권한 확인 및 감사 메시지 생성을 위해 커널 모드와 사용자 모드 모두에서 서비스를 제공합니다. LSA는 신뢰할 수 있거나 신뢰할 수 없는 도메인의 서비스에서 제공하는 모든 세션 티켓의 유효성을 확인할 책임이 있습니다.

### <a name="management-tools"></a>관리 도구

관리자는 *Active Directory 도메인 및 트러스트,* *Netdom* 및 *Nltest를* 사용하여 트러스트를 노출, 생성, 제거 또는 수정할 수 있습니다.

* *활성 디렉터리 도메인 및 트러스트는* 도메인 트러스트, 도메인 및 포리스트 기능 수준 및 사용자 주체 이름 접미사를 관리하는 데 사용되는 MMC(Microsoft 관리 콘솔)입니다.
* *Netdom* 및 *Nltest* 명령줄 도구를 사용하여 트러스트를 찾고 표시하고 만들고 관리할 수 있습니다. 이러한 도구는 도메인 컨트롤러의 LSA 기관과 직접 통신합니다.

## <a name="next-steps"></a>다음 단계

리소스 포리스트에 대한 자세한 내용은 [Azure AD DS에서 포리스트 트러스트가 어떻게 작동합니까 를 참조하세요.][concepts-trust]

리소스 포리스트를 사용하여 Azure AD DS 관리 도메인 만들기를 시작하려면 [Azure AD DS 관리 도메인 만들기 및 구성을][tutorial-create-advanced]참조하십시오. 그런 다음 [온-프레미스 도메인(미리 보기)에 아웃바운드 포리스트 트러스트를 만들][create-forest-trust]수 있습니다.

<!-- LINKS - INTERNAL -->
[concepts-trust]: concepts-forest-trust.md
[tutorial-create-advanced]: tutorial-create-instance-advanced.md
[create-forest-trust]: tutorial-create-forest-trust.md
