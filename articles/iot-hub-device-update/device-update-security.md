---
title: Azure IoT Hub에 대 한 장치 업데이트에 대 한 보안 Microsoft Docs
description: IoT Hub에 대 한 장치 업데이트를 통해 장치가 안전 하 게 업데이트 되는 방식을 이해 합니다.
author: lichris
ms.author: lichris
ms.date: 2/11/2021
ms.topic: conceptual
ms.service: iot-hub
ms.openlocfilehash: 86b2dbe6a28d1440f93788eb40e133d9b62d3f0c
ms.sourcegitcommit: e6de1702d3958a3bea275645eb46e4f2e0f011af
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/20/2021
ms.locfileid: "102489432"
---
# <a name="device-update-security-model"></a>장치 업데이트 보안 모델

IoT Hub에 대 한 장치 업데이트는 장치 펌웨어, 이미지 및 응용 프로그램에 대 한 업데이트를 IoT 장치에 배포 하는 안전한 방법을 제공 합니다. 이 워크플로는 장치에서 업데이트를 증명 하는 데 사용할 수 있는 완전 한 관리 권의 모델을 사용 하 여 종단 간 보안 채널을 제공 합니다.

장치 업데이트 워크플로의 각 단계는 파이프라인의 모든 단계에서 다음에 대 한 보안 전달을 수행할 수 있도록 다양 한 보안 기능 및 프로세스를 통해 보호 됩니다. 장치 업데이트 클라이언트는 불법 업데이트 요청을 식별 하 고 적절 하 게 관리 합니다. 또한 클라이언트는 모든 다운로드를 검사 하 여 콘텐츠가 신뢰할 수 있고 수정 되지 않고 의도적인 지 확인 합니다.

## <a name="for-solution-operators"></a>솔루션 연산자의 경우

솔루션 운영자가 업데이트를 장치 업데이트 인스턴스로 가져오면 서비스에서 업데이트 이진 파일을 업로드 하 고 검사 하 여 악의적인 사용자가 수정 하거나 교환 하지 않았는지 확인 합니다. 확인 되 면 장치 업데이트 서비스는 가져오기 매니페스트 및 기타 메타 데이터의 파일 해시를 사용 하 여 내부 [업데이트 매니페스트](./update-manifest.md) 를 생성 합니다. 그러면이 업데이트 매니페스트가 장치 업데이트 서비스에 의해 서명 됩니다.

솔루션 운영자가 장치 업데이트를 요청 하면 서명 된 메시지가 보호 된 IoT Hub 채널을 통해 장치로 전송 됩니다. 장치의 장치 업데이트 에이전트가 인증 된 서명의 유효성을 검사 합니다. 

모든 결과 이진 다운로드는 업데이트 매니페스트 서명의 유효성 검사를 통해 보안이 유지 됩니다. 업데이트 매니페스트에는 이진 파일 해시가 포함 되어 있으므로 매니페스트를 신뢰할 수 있는 경우 장치 업데이트 에이전트는 해시를 신뢰 하 고 이진 파일과 일치 시킵니다. 업데이트 이진 파일이 다운로드 되 고 확인 되 면 장치의 설치 관리자에 전달 됩니다.

## <a name="for-device-builders"></a>장치 빌더

장치 업데이트 서비스가 단순 하 고 낮은 성능의 장치로 확장 되도록 하기 위해 보안 모델은 원시 비대칭 키와 원시 서명을 사용 합니다. Json 웹 토큰과 같은 json 기반 형식 & json 웹 키를 사용 합니다.

### <a name="securing-update-content-via-the-update-manifest"></a>업데이트 매니페스트를 통해 업데이트 콘텐츠 보안 설정

두 개의 시그니처를 사용 하 여 업데이트 매니페스트의 유효성을 검사 합니다. 서명은 *서명* 키와 *루트* 키로 구성 된 구조체를 사용 하 여 만듭니다.

장치 업데이트 에이전트에는 모든 장치 업데이트 호환 장치에 사용 되는 공개 키가 포함 되어 있습니다. 이러한 키는 *루트* 키입니다. 해당 개인 키는 Microsoft에서 제어 합니다.

또한 Microsoft는 장치 업데이트 에이전트에 포함 되지 않거나 장치에 저장 된 공개/개인 키 쌍을 생성 합니다. *서명* 키입니다.

업데이트를 IoT Hub에 대 한 장치 업데이트로 가져올 때 서비스에서 업데이트 매니페스트가 생성 되 면 서비스는 서명 키를 사용 하 여 매니페스트에 서명 하 고 루트 키로 서명 된 서명 키 자체를 포함 합니다. 업데이트 매니페스트가 장치로 전송 되 면 장치 업데이트 에이전트는 다음 서명 데이터를 수신 합니다.

1. 서명 값 자체입니다.
2. #1를 생성 하는 데 사용 되는 알고리즘입니다.
3. #1를 생성 하는 데 사용 되는 서명 키의 공개 키 정보입니다.
4. #3에 있는 공용 서명 키의 서명입니다.
5. #3를 생성 하는 데 사용 되는 루트 키의 공개 키 ID입니다.
6. #4를 생성 하는 데 사용 되는 알고리즘입니다.

장치 업데이트 에이전트는 위에 정의 된 정보를 사용 하 여 공용 서명 키의 서명이 루트 키로 서명 되었는지 확인 합니다. 그러면 장치 업데이트 에이전트에서 서명 키로 업데이트 매니페스트 서명이 서명 되었는지 확인 합니다. 모든 서명이 올바르면 장치 업데이트 에이전트에서 업데이트 매니페스트를 신뢰 합니다. 업데이트 매니페스트에는 업데이트 파일 자체에 해당 하는 파일 해시가 포함 되어 있으므로 해시가 일치 하는 경우에도 업데이트 파일을 신뢰할 수 있습니다.

루트 및 서명 키를 사용 하면 Microsoft에서 정기적으로 서명 키를 롤아웃할 수 있습니다 (보안 모범 사례).

### <a name="json-web-signature-jws"></a>JWS(JSON 웹 서명)

는에 `updateManifestSignature` 포함 된 정보가 변조 되지 않았는지 확인 하는 데 사용 됩니다 `updateManifest` . 는 `updateManifestSignature` Json 웹 키가 포함 된 Json 웹 서명을 사용 하 여 생성 되므로 소스를 확인할 수 있습니다. 시그니처는 "."로 구분 되는 세 개의 섹션이 있는 Base64Url 인코딩된 문자열입니다.  JSON 키와 토큰을 구문 분석 하 고 확인 하는 [jws_util .h 도우미 메서드](https://github.com/Azure/iot-hub-device-update/tree/main/src/utils/jws_utils) 를 참조 하세요.

JSON 웹 서명은 JSON 기반 데이터 구조를 사용 하 여 콘텐츠에 서명 하는 데 널리 사용 되는 [IETF 표준](https://tools.ietf.org/html/rfc7515) 입니다. 데이터의 서명을 확인 하 여 데이터의 무결성을 보장 하는 방법입니다. 자세한 내용은 JWS (JSON 웹 서명) [RFC 7515](https://www.rfc-editor.org/info/rfc7515)에서 찾을 수 있습니다.

### <a name="json-web-token"></a>JSON Web Token

JSON 웹 토큰은 두 당사자 간에 클레임을 안전 하 게 표현 하는 개방형 산업 [표준](https://tools.ietf.org/html/rfc7519) 메서드입니다.

### <a name="root-keys"></a>루트 키

모든 장치 업데이트 장치에는 루트 키 집합이 포함 되어 있습니다. 이러한 키는 모든 장치 업데이트의 서명에 대 한 신뢰의 루트입니다. 이러한 루트 키 중 하나를 통해 모든 서명을 연결 해야 합법적인 것으로 간주 됩니다.

루트 키 집합은 보안 목적을 위해 정기적으로 서명 키를 회전 하는 것이 적절 하므로 시간이 지남에 따라 변경 됩니다. 따라서 장치 업데이트 에이전트 소프트웨어는 최신 루트 키 집합을 사용 하 여 자신을 업데이트 해야 합니다. 

### <a name="signatures"></a>시그니처

모든 서명은 루트 키 중 하나로 서명 된 (공개) 서명 키에 의해 수용 됩니다. 서명은 서명 키에 서명 하는 데 사용 된 루트 키를 식별 합니다. 

장치 업데이트 에이전트는 먼저 서명 (공개) 키의 서명이 적절 하 고 유효한 지, 그리고 승인 된 루트 키 중 하나로 서명 되었는지 확인 하 여 서명 유효성을 검사 해야 합니다. 서명 키의 유효성을 성공적으로 검사 한 후에는 현재 신뢰할 수 있는 서명 공개 키를 사용 하 여 서명 자체의 유효성을 검사할 수 있습니다.

서명 키는 루트 키 보다 훨씬 더 빠른 흐름에서 회전 하므로 다양 한 서명 키로 서명 된 메시지가 필요 합니다. 

서명 키의 해지는 장치 업데이트 서비스에 의해 관리 되므로 사용자는 서명 키를 캐시 하지 않아야 합니다. 서명이 제공 된 서명 키를 항상 사용 합니다.

### <a name="receiving-updates"></a>업데이트 받기

장치 업데이트 에이전트에서 받은 업데이트 요청은 서명 된 업데이트 매니페스트 (UM) 문서를 포함 합니다. 에이전트는 UM의 서명이 적절 하 고 그대로 유지 되는지 확인 해야 합니다. 이 작업은 UM 서명의 서명 키가 적절 한 루트 키로 서명 되었는지 확인 하 여 수행 됩니다. 완료 되 면 에이전트는 서명 키에 대해 UM 서명의 유효성을 검사 합니다.

UM 서명의 유효성을 검사 한 후에는 장치 업데이트 에이전트가이를 "원인 원인"으로 신뢰할 수 있습니다. 이 소스에서 모든 추가 보안 신뢰를 분석 합니다. 

UM은 다운로드 하 고 설치할 콘텐츠의 Url 및 파일 해시를 포함 합니다. 에이전트가 업데이트 이진 파일을 다운로드 한 후에는 UM에 있는 파일 해시에 대해 업데이트의 유효성을 검사 해야 합니다. 다운로드 유효성 검사를 위한 전이적 트러스트 모델을 제공 합니다. 콘텐츠는 그대로 유지 되 고 (수정 되지 않음) 다운로드 된 항목이 실제로 다운로드 되었는지 확인 합니다. 

### <a name="securing-the-device"></a>장치 보안

장치 업데이트 관련 보안 자산이 장치에서 적절히 보호 되 고 보호 되는지 확인 하는 것이 중요 합니다. 루트 키와 같은 자산은 수정 되지 않도록 보호 해야 합니다. 이 작업을 수행 하는 다양 한 방법이 있습니다. 예를 들어 보안 장치 (TPM, SGX, HSM, 기타 보안 장치)를 사용 하거나 장치 업데이트 에이전트에서 하드 코딩 합니다. 후자를 사용 하려면 장치 업데이트 에이전트 코드를 디지털 서명 하 고 시스템의 코드 무결성 지원을 사용 하도록 설정 하 여 악의적으로 수정 된 에이전트 코드를 보호 해야 합니다.

구성 요소에서 구성 요소로의 전달이 안전한 방식으로 수행 되도록 하는 등의 추가 보안 조치를 보장할 수 있습니다. 예를 들어 다양 한 구성 요소를 실행 하기 위해 격리 된 특정 계정을 등록 합니다. 네트워크 기반 통신 (예: REST API 호출)을 localhost로만 제한 합니다.

**[다음 단계: 장치 업데이트에서 Azure RBAC를 사용 하는 방법에 대 한 자세한 정보](.\device-update-control-access.md)**