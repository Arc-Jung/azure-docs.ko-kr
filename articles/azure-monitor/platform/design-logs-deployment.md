---
title: Azure 모니터 로그 배포 설계 | 마이크로 소프트 문서
description: 이 문서에서는 Azure Monitor에서 작업 영역을 배포할 준비를 하는 고객에 대한 고려 사항 및 권장 사항에 대해 설명합니다.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 09/20/2019
ms.openlocfilehash: e493b07814821496f941a4b81402ba0b49acbede
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "79248828"
---
# <a name="designing-your-azure-monitor-logs-deployment"></a>Azure 모니터 로그 배포 설계

Azure Monitor는 Azure 리소스인 Log Analytics 작업 영역에 [로그](data-platform-logs.md) 데이터를 저장하고 데이터가 수집, 집계 및 관리 경계 역할을 하는 컨테이너입니다. Azure 구독에 하나 이상의 작업 영역을 배포할 수 있지만 초기 배포가 비용 효과적이고 관리 가능하며 확장 가능한 작업을 제공하기 위해 지침을 따르고 있는지 확인하기 위해 이해해야 할 몇 가지 고려 사항이 있습니다. 조직의 요구 사항을 충족하는 배포를 제공합니다.

작업 영역의 데이터는 서로 다른 종류의 데이터를 저장하고 데이터를 생성하는 리소스를 기반으로 고유한 속성 집합을 포함하는 테이블로 구성됩니다. 대부분의 데이터 원본은 Log Analytics 작업 영역에서 자신의 테이블에 씁니다.

![작업 영역 데이터 모델 예제](./media/design-logs-deployment/logs-data-model-01.png)

Log Analytics 작업 영역이 제공하는 정보:

* 데이터 저장을 위한 지리적 위치입니다.
* 권장되는 디자인 전략 중 하나에 따라 다른 사용자에게 액세스 권한을 부여하여 데이터 격리를 제공합니다.
* [가격 책정 계층,](https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage#changing-pricing-tier) [보존](https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage#change-the-data-retention-period)및 [데이터 상한과](https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage#manage-your-maximum-daily-data-volume)같은 설정 구성 범위입니다.

이 문서에서는 설계 및 마이그레이션 고려 사항에 대한 자세한 개요, 액세스 제어 개요 및 IT 조직에 권장하는 디자인 구현에 대한 이해를 제공합니다.



## <a name="important-considerations-for-an-access-control-strategy"></a>액세스 제어 전략에 대한 중요한 고려 사항

필요한 작업 영역 수를 식별하는 것은 다음 요구 사항 중 하나 이상에 의해 영향을 받습니다.

* 글로벌 회사이며 데이터 주권 또는 규정 준수 때문에 특정 지역에 저장된 로그 데이터가 필요합니다.
* Azure를 사용하고 있으며 작업 영역을 자신이 관리하는 Azure 리소스와 같은 지역에 두어서 아웃바운드 데이터 전송 요금을 피하려고 합니다.
* 여러 부서 또는 비즈니스 그룹을 관리하고 각 부서마다 자신의 데이터를 보지만 다른 부서의 데이터는 볼 수 없습니다. 또한 통합 교차 부서 또는 비즈니스 그룹 보기에 대한 비즈니스 요구 사항은 없습니다.

오늘날 IT 조직은 중앙 집중식, 분산형 또는 두 구조의 중간 하이브리드를 따라 모델링됩니다. 따라서 다음 작업 영역 배포 모델은 일반적으로 이러한 조직 구조 중 하나에 매핑하는 데 사용되었습니다.

* **중앙 집중식**: 모든 로그는 중앙 작업 영역에 저장되고 단일 팀에 의해 관리되며 Azure Monitor는 팀당 차별화된 액세스를 제공합니다. 이 시나리오에서는 쉽게 관리 하 고, 리소스 간에 검색 하 고 상호 연관 된 로그입니다. 작업 영역은 구독의 여러 리소스에서 수집된 데이터 양에 따라 크게 증가할 수 있으며, 다른 사용자에 대한 액세스 제어를 유지하기 위한 추가 관리 오버헤드가 있습니다. 이 모델을 "허브 및 스포크"라고 합니다.
* **분산 :** 각 팀은 소유하고 관리하는 리소스 그룹에서 자체 작업 영역을 만들 수 있으며 로그 데이터는 리소스별로 분리됩니다. 이 시나리오에서는 작업 영역을 안전하게 유지 하 고 액세스 제어 리소스 액세스와 일치 하지만 로그를 상호 상관 관계 하기 어렵다. 많은 리소스에 대한 광범위한 보기가 필요한 사용자는 의미 있는 방식으로 데이터를 분석할 수 없습니다.
* **하이브리드**: 보안 감사 규정 준수 요구 사항은 많은 조직에서 두 배포 모델을 병렬로 구현하기 때문에 이 시나리오를 더욱 복잡하게 만듭니다. 이로 인해 일반적으로 로그 커버리지의 간격이 있는 복잡하고 비용이 많이 들며 유지 관리가 어려운 구성이 발생합니다.

Log Analytics 에이전트를 사용하여 데이터를 수집하는 경우 에이전트 배포를 계획하려면 다음을 이해해야 합니다.

* Windows 에이전트에서 데이터를 수집하려면 각 에이전트가 시스템 센터 운영 관리자 관리 그룹에 보고하는 동안에도 [하나 이상의 작업 영역에 보고하도록 구성할](../../azure-monitor/platform/agent-windows.md)수 있습니다. Windows 에이전트는 최대 4개의 작업 영역을 보고할 수 있습니다.
* Linux 에이전트는 다중 호밍을 지원하지 않으며 단일 작업 영역에만 보고할 수 있습니다.

시스템 센터 운영 관리자 2012 R2 이상사용 하는 경우:

* 각 운영 관리자 관리 그룹은 [하나의 작업 영역에만 연결할](../platform/om-agents.md)수 있습니다. 
* 관리 그룹에 보고하는 Linux 컴퓨터는 Log Analytics 작업 영역에 직접 보고하도록 구성되어야 합니다. Linux 컴퓨터가 이미 작업 영역에 직접 보고하고 있고 Operations Manager를 사용하여 모니터링하려는 경우 다음 단계에 따라 [Operations Manager 관리 그룹에 보고합니다.](agent-manage.md#configure-agent-to-report-to-an-operations-manager-management-group) 
* Windows 컴퓨터에 Log Analytics Windows 에이전트를 설치하고 작업 영역과 통합된 Operations Manager 및 다른 작업 영역에 모두 보고하도록 할 수 있습니다.

## <a name="access-control-overview"></a>액세스 제어 개요

RBAC(역할 기반 액세스 제어)를 사용하면 사용자와 그룹이 작업 영역에서 모니터링 데이터로 작업하는 데 필요한 액세스 권한만 부여할 수 있습니다. 이렇게 하면 단일 작업 영역을 사용하여 IT 조직 운영 모델에 맞게 모든 리소스에 활성화된 수집된 데이터를 저장할 수 있습니다. 예를 들어 Azure 가상 시스템(VM)에서 호스팅되는 인프라 서비스를 담당하는 팀에 액세스 권한을 부여하면 VM에서 생성된 로그만 액세스할 수 있습니다. 이것은 우리의 새로운 리소스 컨텍스트 로그 모델을 따르고 있다. 이 모델의 기초는 Azure 리소스에서 내보낸 모든 로그 레코드에 대한 것으로 이 리소스와 자동으로 연결됩니다. 로그는 리소스를 기반으로 범위 지정 및 RBAC를 준수하는 중앙 작업 영역으로 전달됩니다.

사용자가 액세스할 수 있는 데이터는 다음 표에 나열된 요소의 조합에 의해 결정됩니다. 각 섹션은 아래 섹션에 설명되어 있습니다.

| 요소 | 설명 |
|:---|:---|
| [액세스 모드](#access-mode) | 사용자가 작업 영역에 액세스하는 데 사용하는 방법입니다.  사용 가능한 데이터의 범위와 적용되는 액세스 제어 모드를 정의합니다. |
| [액세스 제어 모드](#access-control-mode) | 사용 권한이 작업 영역 또는 리소스 수준에서 적용되는지 여부를 정의하는 작업 영역 설정입니다. |
| [권한을](manage-access.md) | 작업 영역 또는 리소스에 대한 개별 또는 사용자 그룹에 적용되는 사용 권한입니다. 사용자가 액세스할 수 있는 데이터를 정의합니다. |
| [테이블 레벨 RBAC](manage-access.md#table-level-rbac) | 액세스 모드 또는 액세스 제어 모드에 관계없이 모든 사용자에게 적용되는 선택적 세분화된 권한입니다. 사용자가 액세스할 수 있는 데이터 형식을 정의합니다. |

## <a name="access-mode"></a>액세스 모드

*액세스 모드는* 사용자가 Log Analytics 작업 영역에 액세스하고 액세스할 수 있는 데이터의 범위를 정의하는 방법을 나타냅니다. 

사용자는 데이터에 액세스하기 위한 두 가지 옵션이 있습니다.

* **작업 영역 컨텍스트**: 사용 권한이 있는 작업 영역의 모든 로그를 볼 수 있습니다. 이 모드의 쿼리는 작업 영역의 모든 테이블의 모든 데이터로 범위가 지정됩니다. Azure Portal의 **Azure Monitor** 메뉴에서 **로그를** 선택할 때와 같이 로그가 작업 공간으로 범위로 액세스할 때 사용되는 액세스 모드입니다.

    ![작업 공간에서 분석 컨텍스트 로그](./media/design-logs-deployment/query-from-workspace.png)

* **리소스 컨텍스트**: Azure 포털의 리소스 메뉴에서 **로그를** 선택할 때와 같이 특정 리소스, 리소스 그룹 또는 구독에 대한 작업 영역에 액세스하는 경우 액세스 권한이 있는 모든 테이블의 리소스에 대해서만 로그를 볼 수 있습니다. 이 모드의 쿼리는 해당 리소스와 연결된 데이터로만 범위가 조정됩니다. 이 모드를 사용하면 세분화된 RBAC도 사용할 수 있습니다.

    ![리소스에서 로그 분석 컨텍스트](./media/design-logs-deployment/query-from-resource.png)

    > [!NOTE]
    > 로그는 관련 리소스와 제대로 연결된 경우에만 리소스 컨텍스트 쿼리에 사용할 수 있습니다. 현재 다음 리소스에는 제한이 있습니다.
    > - Azure 외부의 컴퓨터
    > - Service Fabric
    > - 애플리케이션 정보
    >
    > 쿼리를 실행하고 관심 있는 레코드를 검사하여 로그가 리소스와 제대로 연관되어 있는지 테스트할 수 있습니다. 올바른 리소스 ID가 [_ResourceId](log-standard-properties.md#_resourceid) 속성에 있는 경우 리소스 중심 쿼리에 데이터를 사용할 수 있습니다.

Azure Monitor는 로그 검색을 수행하는 컨텍스트에 따라 자동으로 올바른 모드를 결정합니다. 범위는 항상 로그 분석의 왼쪽 상단 섹션에 표시됩니다.

### <a name="comparing-access-modes"></a>액세스 모드 비교

다음 표에는 액세스 모드가 요약됩니다.

| | 작업 영역 컨텍스트 | 리소스 컨텍스트 |
|:---|:---|:---|
| 각 모델은 누구를 위한 것인가요? | 중앙 관리. 데이터 수집을 구성해야 하는 관리자와 다양한 리소스에 액세스해야 하는 사용자 또한 현재 Azure 외부리소스에 대한 로그에 액세스해야 하는 사용자에게도 필요합니다. | 응용 프로그램 팀. 모니터링 중인 Azure 리소스의 관리자입니다. |
| 사용자가 로그를 보는 데 필요한 것은 무엇입니까? | 작업 영역에 대한 사용 권한입니다. **작업 영역 사용 권한을** 사용하여 액세스 [관리에서 작업 영역 사용 권한을](manage-access.md#manage-access-using-workspace-permissions)참조하십시오. | 리소스에 대한 액세스를 읽습니다. Azure 권한을 [사용하여 액세스 관리에서](manage-access.md#manage-access-using-azure-permissions) **리소스 권한을** 참조하십시오. 사용 권한을 상속하거나(예: 포함된 리소스 그룹에서) 리소스에 직접 할당할 수 있습니다. 리소스에 대한 로그에 대한 사용 권한이 자동으로 할당됩니다. |
| 사용 권한의 범위는 무엇입니까? | 작업. 작업 영역에 액세스할 수 있는 사용자는 사용 권한이 있는 테이블에서 작업 영역의 모든 로그를 쿼리할 수 있습니다. [테이블 액세스 제어](manage-access.md#table-level-rbac) 참조 | Azure 리소스입니다. 사용자는 특정 리소스, 리소스 그룹 또는 구독에 대한 로그를 쿼리할 수 있지만 다른 리소스에 대한 로그를 쿼리할 수는 없습니다. |
| 사용자가 로그에 액세스하는 방법은 무엇입니까? | <ul><li>**Azure 모니터** 메뉴에서 **로그를** 시작합니다.</li></ul> <ul><li>**로그 분석 작업 공간에서** **로그** 시작.</li></ul> <ul><li>Azure 모니터 [통합 문서에서](../visualizations.md#workbooks).</li></ul> | <ul><li>Azure 리소스의 메뉴에서 **로그** 시작</li></ul> <ul><li>**Azure 모니터** 메뉴에서 **로그를** 시작합니다.</li></ul> <ul><li>**로그 분석 작업 공간에서** **로그** 시작.</li></ul> <ul><li>Azure 모니터 [통합 문서에서](../visualizations.md#workbooks).</li></ul> |

## <a name="access-control-mode"></a>액세스 제어 모드

*액세스 제어 모드는* 작업 영역에 대한 사용 권한이 결정되는 방법을 정의하는 각 작업 영역에 대한 설정입니다.

* **작업 영역 사용 권한 필요**: 이 제어 모드에서는 세분화된 RBAC를 허용하지 않습니다. 사용자가 작업 영역에 액세스하려면 작업 영역 또는 특정 테이블에 대한 사용 권한을 부여받아야 합니다.

    사용자가 작업 영역 컨텍스트 모드 다음에 작업 영역에 액세스하는 경우 액세스 권한이 부여된 모든 테이블의 모든 데이터에 액세스할 수 있습니다. 사용자가 리소스 컨텍스트 모드 에 따라 작업 영역에 액세스하는 경우 액세스 권한이 부여된 모든 테이블에서 해당 리소스에 대한 데이터만 액세스할 수 있습니다.

    이 설정은 2019년 3월 이전에 생성된 모든 작업 영역에 대한 기본 설정입니다.

* 리소스 또는 작업 영역 사용 권한 사용 : 이 제어 모드를 사용하면 세분화된 RBAC가 **허용됩니다.** 사용자는 Azure `read` 권한을 할당하여 볼 수 있는 리소스와 연결된 데이터에만 액세스할 수 있습니다. 

    사용자가 작업 영역 컨텍스트 모드에서 작업 영역에 액세스하면 작업 영역 사용 권한이 적용됩니다. 사용자가 리소스 컨텍스트 모드에서 작업 영역에 액세스하면 리소스 권한만 확인되고 작업 영역 사용 권한이 무시됩니다. 작업 영역 사용 권한에서 사용자를 제거하고 리소스 권한을 인식하도록 허용하여 사용자에 대해 RBAC를 사용하도록 설정합니다.

    이 설정은 2019년 3월 이후에 생성된 모든 작업 영역에 대한 기본 설정입니다.

    > [!NOTE]
    > 사용자에게 작업 영역에 대한 리소스 권한만 있는 경우 작업 영역 액세스 모드가 리소스 또는 작업 영역 사용 **권한으로**설정되어 있다고 가정할 때 리소스 컨텍스트 모드를 사용하여 작업 영역에만 액세스할 수 있습니다.

PowerShell을 사용하거나 리소스 관리자 템플릿을 사용하여 포털에서 액세스 제어 모드를 변경하는 방법을 알아보려면 [액세스 제어 모드 구성을](manage-access.md#configure-access-control-mode)참조하십시오.

## <a name="ingestion-volume-rate-limit"></a>섭취 볼륨 속도 제한

Azure Monitor는 점점 더 빠른 속도로 매달 테라바이트 단위의 데이터를 보내는 수천 명의 고객을 처리하는 대규모 데이터 서비스입니다. 기본 사용 률 임계값은 작업 영역당 **6GB/min으로** 설정됩니다. 실제 크기는 로그 길이와 압축 비율에 따라 데이터 형식간에 따라 달라질 수 있으므로 대략적인 값입니다. 이 제한은 에이전트 또는 데이터 [수집API에서](data-collector-api.md)전송되는 데이터에는 적용되지 않습니다.

더 높은 속도로 데이터를 단일 작업 공간으로 보내면 일부 데이터가 삭제되고 임계값을 계속 초과하는 동안 6시간마다 작업 영역의 *작업* 테이블로 이벤트가 전송됩니다. 인비많이트 볼륨이 속도 제한을 계속 초과하거나 곧 도달하려는 경우 지원 요청을 열어 작업 영역의 증가를 요청할 수 있습니다.
 
작업 영역에서 이러한 이벤트에 대한 알림을 얻으려면 결과 수에 따라 경고 논리를 기반으로 다음 쿼리를 사용하여 [로그 경고 규칙을](alerts-log.md) 만듭니다.

``` Kusto
Operation
|where OperationCategory == "Ingestion"
|where Detail startswith "The rate of data crossed the threshold"
``` 


## <a name="recommendations"></a>권장 사항

![리소스 컨텍스트 디자인 예제](./media/design-logs-deployment/workspace-design-resource-context-01.png)

이 시나리오에서는 데이터 주권 또는 규정 준수로 인해 제한되지 않거나 리소스가 배포되는 지역에 매핑해야 하는 IT 조직 구독의 단일 작업 영역 디자인을 다룹니다. 이를 통해 조직 보안 및 IT 관리자 팀이 Azure 액세스 관리와의 향상된 통합을 활용하고 보다 안전한 액세스 제어를 활용할 수 있습니다.

VM용 애플리케이션 인사이트 및 Azure Monitor와 같은 모든 리소스, 모니터링 솔루션 및 인사이트, 여러 팀에서 유지 관리하는 인프라 및 응용 프로그램을 지원하면 수집된 로그 데이터를 IT 조직에 전달하도록 구성됩니다. 중앙 집중식 공유 작업 영역입니다. 각 팀의 사용자에게 액세스 권한이 부여된 리소스에 대한 로그에 대한 액세스 권한이 부여됩니다.

작업 영역 아키텍처를 배포한 후에는 [Azure Policy](../../governance/policy/overview.md)를 통해 Azure 리소스에서 이 작업을 적용할 수 있습니다. 정책을 정의하고 Azure 리소스를 준수하여 모든 리소스 로그를 특정 작업 영역으로 보낼 수 있는 방법을 제공합니다. 예를 들어 Azure 가상 시스템 또는 가상 시스템 크기 집합을 사용하면 작업 영역 준수 및 보고서 결과를 평가하는 기존 정책을 사용하거나 비규격인 경우 수정하도록 사용자 지정할 수 있습니다.  

## <a name="workspace-consolidation-migration-strategy"></a>작업 영역 통합 마이그레이션 전략

이미 여러 작업 영역을 배포하고 리소스 컨텍스트 액세스 모델로 통합하려는 고객의 경우 권장 액세스 모델로 마이그레이션하기 위해 증분 접근 방식을 취하는 것이 좋습니다. 신속하거나 공격적으로. 합리적인 일정에 따라 계획, 마이그레이션, 유효성 검사 및 폐기에 대한 단계별 접근 방식을 따르면 계획되지 않은 사고나 클라우드 운영에 예기치 않은 영향을 주지 않도록 할 수 있습니다. 규정 준수 또는 비즈니스상의 이유로 데이터 보존 정책이 없는 경우 프로세스 중에 마이그레이션하는 작업 영역에 데이터를 보존하기 위해 적절한 기간을 평가해야 합니다. 공유 작업 영역에 보고할 리소스를 다시 구성하는 동안 필요에 따라 원래 작업 영역의 데이터를 분석할 수 있습니다. 마이그레이션이 완료되면 보존 기간이 끝나기 전에 원래 작업 영역에 데이터를 보관하도록 관리되는 경우 삭제하지 마십시오.

이 모델로의 마이그레이션을 계획하는 동안 다음사항을 고려하십시오.

* 데이터 보존에 관한 업계 규정 및 내부 정책을 준수해야 하는지 파악합니다.
* 응용 프로그램 팀이 기존 리소스 컨텍스트 기능 내에서 작업할 수 있는지 확인합니다.
* 응용 프로그램 팀의 리소스에 부여된 액세스를 식별하고 프로덕션 환경에서 구현하기 전에 개발 환경에서 테스트합니다.
* 리소스 또는 작업 영역 사용 권한을 사용하도록 작업 **영역을 구성합니다.**
* 작업 영역을 읽고 쿼리할 수 있는 응용 프로그램 팀의 권한을 제거합니다.
* 모든 모니터링 솔루션, 컨테이너용 Azure 모니터 및/또는 VM용 Azure 모니터, 자동화 계정 및 원래 작업 영역에 배포된 업데이트 관리, 시작/중지 VM 등과 같은 관리 솔루션에 대한 인사이트 및 구성합니다.

## <a name="next-steps"></a>다음 단계

이 가이드에서 권장하는 보안 권한 및 컨트롤을 구현하려면 [로그에 대한 액세스 관리를 검토합니다.](manage-access.md)
