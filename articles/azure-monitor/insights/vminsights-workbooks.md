---
title: 통합 문서를 사용하여 대화형 보고서 VM용 Azure Monitor 만들기
description: VM용 Azure 모니터에 대해 미리 정의된 사용자 지정 매개 통합 문서로 복잡한 보고를 간소화합니다.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/12/2020
ms.openlocfilehash: a6ab126c3a5b0d2a82b17fac42dcc9e20f6aba3f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "79480456"
---
# <a name="create-interactive-reports-azure-monitor-for-vms-with-workbooks"></a>통합 문서를 사용하여 대화형 보고서 VM용 Azure Monitor 만들기

통합 문서는 텍스트, [로그 쿼리,](../log-query/query-language.md)메트릭 및 매개 변수를 풍부한 대화형 보고서로 결합합니다. 통합 문서는 동일한 Azure 리소스에 대한 액세스 권한이 있는 다른 팀 멤버에 의해 편집될 수 있습니다.

통합 문서는 다음과 같은 시나리오에 유용합니다.

* CPU 사용률, 디스크 공간, 메모리, 네트워크 종속성 등 관심 메트릭을 미리 모르는 경우 가상 시스템의 사용을 탐색합니다. 다른 사용 현황 분석 도구와 달리 통합 문서를 사용하면 여러 종류의 시각화 및 분석을 결합할 수 있으므로 이러한 종류의 자유형 탐색에 적합합니다.
* 키 카운터 및 기타 로그 이벤트에 대한 메트릭을 표시하여 최근에 프로비전된 VM의 성능을 팀에 설명합니다.
* VM의 크기 조정 실험 결과를 팀의 다른 구성원과 공유합니다. 텍스트로 실험의 목표를 설명한 다음 실험을 평가하는 데 사용되는 각 사용 메트릭 및 분석 쿼리와 각 메트릭이 목표 이상또는 아래 목표인지에 대한 명확한 호출 을 표시할 수 있습니다.
* 중단이 VM 사용에 미치는 영향을 보고하고, 데이터, 텍스트 설명 및 향후 중단을 방지하기 위한 다음 단계에 대한 토론을 결합합니다.

다음 표에는 VM용 Azure 모니터가 시작하는 데 포함된 통합 문서를 요약합니다.

| 통합 문서 | 설명 | Scope |
|----------|-------------|-------|
| 성능 | 활성화한 모든 Log Analytics 성능 카운터를 활용하는 단일 통합 문서에서 상위 N 목록 및 차트 보기의 사용자 지정 가능한 버전을 제공합니다.| 대규모 |
| 성능 카운터 | 다양한 성능 카운터 집합에서 상위 N 차트 보기입니다. | 대규모 |
| Connections | 연결은 모니터링되는 VM의 인바운드 및 아웃바운드 연결에 대한 심층적인 보기를 제공합니다. | 대규모 |
| 활성 포트 | 모니터링되는 VM의 포트에 바인딩된 프로세스 및 선택한 기간의 해당 작업을 제공합니다. | 대규모 |
| 포트 열기 | 모니터링되는 VM에서 열리는 포트 수와 열려 있는 포트에 대한 세부 정보를 제공합니다. | 대규모 |
| 실패한 연결 | 모니터링되는 VM에 실패한 연결 수, 실패 추세 및 시간이 지남에 따라 실패 비율이 증가하는 경우 를 표시합니다. | 대규모 |
| 보안 및 감사 | IP 끝점이 전 세계에 상주하는 전체 연결, 악의적인 연결을 보고하는 TCP/IP 트래픽 분석입니다.  모든 기능을 사용하려면 보안 검색을 사용하도록 설정해야 합니다. | 대규모 |
| TCP 트래픽 | 모니터링되는 VM과 그리드에서 전송, 수신 및 총 네트워크 트래픽에 대한 순위가 매겨진 보고서로 추세선으로 표시됩니다. | 대규모 |
| 트래픽 비교 | 이 통합 문서를 사용하면 단일 컴퓨터 또는 컴퓨터 그룹에 대한 네트워크 트래픽 추세를 비교할 수 있습니다. | 대규모 |
| 성능 | 활성화한 모든 Log Analytics 성능 카운터를 활용하는 사용자 지정 가능한 성능 보기 버전을 제공합니다. | 단일 VM | 
| Connections | 연결은 VM에서 인바운드 및 아웃바운드 연결에 대한 심층보기를 제공합니다. | 단일 VM |
 
## <a name="creating-a-new-workbook"></a>새 통합 문서 만들기

통합 문서는 독립적으로 편집할 수 있는 차트, 테이블, 텍스트 및 입력 컨트롤로 구성된 섹션으로 구성됩니다. 통합 문서를 더 잘 이해하기 위해 템플릿을 열어 사용자 지정 통합 문서를 만드는 방법을 살펴보겠습니다. 

1. [Azure 포털에](https://portal.azure.com)로그인합니다.

2. **Virtual Machines**를 선택합니다.

3. 목록에서 VM을 선택합니다.

4. VM 페이지에서 **모니터링** 섹션에서 **인사이트를**선택합니다.

5. VM 인사이트 페이지에서 **성능** 또는 **지도** 탭을 선택한 다음 페이지의 링크에서 **통합 문서 보기를** 선택합니다. 드롭다운 목록에서 **갤러리로 이동을**선택합니다.

    ![통합 문서 드롭다운 목록의 스크린샷](media/vminsights-workbooks/workbook-dropdown-gallery-01.png)

    이렇게 하면 미리 빌드된 여러 통합 문서와 함께 통합 문서 갤러리를 시작 합니다.

7. 새 통합 문서를 **새로**선택하여 만듭니다.

    ![통합 문서 갤러리 스크린샷](media/vminsights-workbooks/workbook-gallery-01.png)

## <a name="editing-workbook-sections"></a>통합 문서 섹션 편집

통합 문서에는 **편집 모드** 및 **읽기 모드**라는 두 가지 모드가 있습니다. 새 통합 문서를 처음 시작하면 **편집 모드에서**열립니다. 그렇지 않으면 숨겨져 있는 모든 단계 및 매개 변수를 포함하여 통합 문서의 모든 내용을 표시합니다. **읽기 모드**는 간소화된 보고서 스타일 보기를 제공합니다. 읽기 모드를 사용하면 수정이 필요할 때 몇 번의 클릭만으로 기본 메커니즘을 유지하면서 보고서를 만드는 데 들어간 복잡성을 추상화할 수 있습니다.

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/workbook-new-workbook-editor-01.png)

1. 단면 편집이 완료되면 단면의 왼쪽 하단 모서리에서 **편집 완료를** 클릭합니다.

2. 중복 섹션을 만들려면 **이 섹션 복제** 아이콘을 클릭합니다. 중복 섹션을 만드는 것은 이전 반복을 손실하지 않고 쿼리를 반복하는 좋은 방법입니다.

3. 통합 문서에서 섹션을 이동하려면 **위로 이동** 또는 **아래로 이동** 아이콘을 클릭합니다.

4. 섹션을 영구적으로 제거하려면 **제거** 아이콘을 클릭합니다.

## <a name="adding-text-and-markdown-sections"></a>텍스트 및 Markdown 섹션 추가

통합 문서에 제목, 설명 및 해설을 추가하면 테이블 및 차트의 집합을 설명으로 전환할 수 있습니다. 통합 문서의 텍스트 섹션은 머리글, 굵게, 기울임꼴 및 글머리 기호 목록과 같은 텍스트 서식 지정에 대해 [Markdown 구문](https://daringfireball.net/projects/markdown/)을 지원합니다.

통합 문서에 텍스트 섹션을 추가하려면 통합 문서의 맨 아래 또는 섹션의 맨 아래에 있는 **텍스트 추가** 단추를 사용합니다.

## <a name="adding-query-sections"></a>쿼리 추가 섹션

![통합 문서의 쿼리 섹션](media/vminsights-workbooks/005-workbook-query-section.png)

통합 문서에 쿼리 섹션을 추가하려면 통합 문서의 맨 아래 또는 섹션의 맨 아래에 있는 **쿼리 추가** 단추를 사용합니다.

쿼리 섹션은 매우 유연하고 다음과 같은 질문에 응답하는 데 사용할 수 있습니다.

* 네트워크 트래픽증가와 같은 기간 동안 CPU 사용률은 어떻게 증가했을까요?
* 지난 한 달 동안 사용 가능한 디스크 공간의 추세는 어땠습니까?
* 지난 2주 동안 VM에서 발생한 네트워크 연결 장애는 몇 건입니까? 

또한 통합 문서를 시작한 가상 시스템의 컨텍스트에서 쿼리하는 것에만 국한되지 않습니다. 해당 리소스에 대한 액세스 권한이 있는 경우 여러 가상 컴퓨터와 Log Analytics 작업 영역에서 쿼리할 수 있습니다.

**작업** 영역 식별자를 사용하여 다른 Log Analytics 작업 영역 또는 특정 Application Insights 앱의 데이터를 포함합니다. 리소스 간 쿼리에 대한 자세한 내용은 [공식 지침을](../log-query/cross-workspace-query.md)참조하십시오.

### <a name="advanced-analytic-query-settings"></a>고급 분석 쿼리 설정

각 섹션에는 자체 고급 설정이 있으며, ![이 설정에는](media/vminsights-workbooks/006-settings.png) **매개변수 추가** 버튼 오른쪽에 있는 워크북 섹션 편집 컨트롤 아이콘을 통해 액세스할 수 있습니다.

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/007-settings-expanded.png)

|         |          |
| ---------------- |:-----|
| **사용자 지정 너비**    | 항목을 임의의 크기로 만들어 한 줄에 많은 항목을 맞출 수 있으므로 차트와 테이블을 풍부한 대화형 보고서로 더 잘 구성할 수 있습니다.  |
| **조건부로 표시** | 읽기 모드에서 매개 변수를 기반으로 단계를 숨기도록 지정합니다. |
| **매개 변수 내보내기**| 표 또는 차트에서 선택한 행이 이후 단계에 따라 값이 변경되거나 표시되도록 허용합니다.  |
| **편집하고 있지 않을 때 쿼리 표시** | 읽기 모드에 있는 경우에도 차트 또는 테이블 위에 쿼리를 표시합니다.
| **편집하고 있지 않을 때 분석에서 열기 단추 표시** | 차트의 오른쪽 모서리에 파란색 분석 아이콘을 추가하여 한 번의 클릭으로 액세스할 수 있습니다.|

이러한 설정 중 대부분은 매우 간단하지만 **매개 변수 내보내기**를 이해하려면 이 기능을 사용할 수 있는 통합 문서를 검사하는 것이 좋습니다.

미리 빌드된 통합 문서 중 하나인 **TCP 트래픽은**VM의 연결 메트릭에 대한 정보를 제공합니다.

통합 문서의 첫 번째 섹션은 로그 쿼리 데이터를 기반으로 합니다. 두 번째 섹션은 로그 쿼리 데이터를 기반으로 하지만 첫 번째 테이블에서 행을 선택하면 차트의 내용을 대화형으로 업데이트합니다.

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/008-workbook-tcp-traffic.png)

이 동작은 항목을 선택한 경우 테이블의 로그 쿼리에서 활성화된 매개 변수 고급 설정을 **내보내도록** 하여 가능합니다.

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/009-settings-export.png)

그런 다음 두 번째 로그 쿼리는 행을 선택하면 내보낸 값을 사용하여 섹션 제목 및 차트에서 사용되는 값 집합을 만듭니다. 행을 선택하지 않으면 단면 제목과 차트가 숨겨지게 됩니다. 

예를 들어 두 번째 섹션의 숨겨진 매개변수는 그리드에서 선택한 행의 다음 참조를 사용합니다.

```
VMConnection
| where TimeGenerated {TimeRange}
| where Computer in ("{ComputerName}") or '*' in ("{ComputerName}") 
| summarize Sent = sum(BytesSent), Received = sum(BytesReceived) by bin(TimeGenerated, {TimeRange:grain})
```

## <a name="adding-metrics-sections"></a>메트릭 추가 섹션

메트릭 섹션에서는 Azure Monitor 메트릭 데이터를 대화형 보고서로 통합할 수 있는 모든 권한을 제공합니다. VM용 Azure 모니터에서 미리 빌드된 통합 문서는 일반적으로 메트릭 데이터가 아닌 분석 쿼리 데이터를 포함합니다.  메트릭 데이터가 있는 통합 문서를 만들도록 선택할 수 있으므로 두 기능 모두 한 곳에서 최대한 활용할 수 있습니다. 액세스 권한이 있는 구독에 있는 리소스에서 메트릭 데이터를 가져올 수 있는 기능도 있습니다.

다음은 CPU 성능의 그리드 시각화를 제공하기 위해 통합 문서로 가져온 가상 컴퓨터 데이터의 예입니다.

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/010-metrics-grid.png)

## <a name="adding-parameter-sections"></a>매개 변수 추가 섹션

통합 문서 매개 변수를 사용하면 쿼리 또는 텍스트 섹션을 수동으로 편집하지 않고 통합 문서에서 값을 변경할 수 있습니다. 그러면 기본 분석 쿼리 언어를 이해해야 하는 요구 사항을 제거하고 통합 문서 기반 보고의 잠재적인 대상을 크게 확장하게 됩니다.

``{parameterName}``과 같은 중괄호에서 매개 변수의 이름을 입력하여 쿼리, 텍스트 또는 다른 매개 변수 섹션에서 매개 변수 값을 대체합니다. 매개 변수 이름은 JavaScript 식별자, 알파벳 문자 또는 밑줄과 유사한 규칙으로 제한되며 그 다음에 는 범문자 또는 밑줄이 뒤따릅니다. 예를 들어 **a1**은 허용되지만, **1a**는 허용되지 않습니다.

매개 변수는 선형이며 통합 문서의 맨 위에서 시작하고 이후 단계까지 이어집니다.  통합 문서의 나중에 선언된 매개 변수는 이전에 선언된 매개 변수를 재정의할 수 있습니다. 또한 쿼리를 사용하여 이전에 정의된 매개 변수의 값에 액세스하는 매개 변수를 사용할 수도 있습니다. 또한 매개 변수의 단계 자체 내에서 매개 변수는 왼쪽에서 오른쪽으로 이어지는 선형이며 여기서 오른쪽 매개 변수는 동일한 단계에서 이전에 선언된 매개 변수에 종속될 수 있습니다.
 
현재 지원되는 네 가지 유형의 매개 변수가 있습니다.

|                  |      |
| ---------------- |:-----|
| **텍스트**    | 사용자가 텍스트 상자를 편집할 수 있도록 허용하고 선택적으로 기본값을 채우기 위해 쿼리를 제공할 수 있습니다. |
| **드롭다운** | 사용자가 값 집합에서 선택할 수 있습니다. |
| **시간 범위 선택기**| 사용자가 미리 정의된 시간 범위 값 집합 중에서 선택하거나 사용자 지정 시간 범위에서 선택할 수 있습니다.|
| **리소스 선택기** | 사용자가 통합 문서에 대해 선택한 리소스 중에서 선택할 수 있습니다.|

### <a name="using-a-text-parameter"></a>텍스트 매개 변수 사용

텍스트 상자에 사용자가 입력하는 값은 이스케이프 또는 인용 없이 쿼리에서 직접 대체됩니다. 필요한 값이 문자열인 경우 쿼리는 매개 변수에 인용 부호를 표시해야 합니다(예: **'{parameter}'**).

텍스트 매개 변수를 사용하면 텍스트 상자의 값을 어디서나 사용할 수 있습니다. 테이블 이름, 열 이름, 함수 이름, 연산자 등이 될 수 있습니다.  텍스트 매개 변수 유형에는 **분석 쿼리에서 기본값 받기**설정이 있으며, 이를 통해 통합 문서 작성자가 쿼리를 사용하여 해당 텍스트 상자의 기본값을 채울 수 있습니다.

로그 쿼리의 기본값을 사용하는 경우 첫 번째 행(행 0, 열 0)의 첫 번째 값만 기본값으로 사용됩니다. 따라서 하나의 행과 하나의 열만 반환하도록 쿼리를 제한하는 것이 좋습니다. 쿼리에서 반환된 다른 데이터는 무시됩니다. 

쿼리가 반환하는 값이 어떤 값이든지 이스케이프 또는 인용 부호 없이 직접 대체됩니다. 쿼리에서 행을 반환하지 않는 경우 매개 변수의 결과는 빈 문자열(매개 변수가 필요 없는 경우)이거나 정의되지 않습니다(매개 변수가 필수인 경우).

### <a name="using-a-drop-down"></a>드롭다운 사용

드롭다운 매개 변수 유형을 사용하면 드롭다운 컨트롤을 만들 수 있으므로 하나 또는 여러 값을 선택할 수 있습니다.

드롭다운은 로그 쿼리 또는 JSON에 의해 채워집니다. 쿼리가 하나의 열을 반환하는 경우 해당 열의 값은 드롭다운 컨트롤의 값과 레이블입니다. 쿼리가 두 개의 열을 반환하는 경우 첫 번째 열은 값이고 두 번째 열은 드롭다운에 표시된 레이블입니다. 쿼리가 세 개의 열을 반환하는 경우 세 번째 열이 해당 드롭다운의 기본 선택을 나타내는 데 사용됩니다. 이 열은 어떤 형식이든 될 수 있지만 가장 간단한 형식은 부울 또는 숫자 형식입니다. 여기서 0은 false이고, 1은 true입니다.

열이 문자열 형식인 경우 null/비어 있는 문자열은 false로 간주되고, 다른 모든 값은 true로 간주됩니다. 단일 선택 드롭다운의 경우 true 값이 있는 첫 번째 값이 기본 선택으로 사용됩니다.  여러 선택 드롭다운의 경우 실제 값이 있는 모든 값이 기본 선택 집합으로 사용됩니다. 드롭다운의 항목은 쿼리가 반환된 행의 순서에 관계없이 표시됩니다. 

연결 개요 보고서에 있는 매개 변수를 살펴보겠습니다. 방향 바로 옆에 있는 편집 기호를 **클릭합니다.**

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/011-workbook-using-dropdown.png)

그러면 **매개 변수 편집** 메뉴 항목이 시작됩니다.

![VM 통합 문서 섹션 편집 컨트롤에 대 한 Azure 모니터](media/vminsights-workbooks/012-workbook-edit-parameter.png)

JSON을 사용하면 콘텐츠로 채워진 임의의 테이블을 생성할 수 있습니다. 예를 들어 다음 JSON은 드롭다운에서 두 개의 값을 생성합니다.

```
[
    { "value": "inbound", "label": "Inbound"},
    { "value": "outbound", "label": "Outbound"}
]
```

보다 적용 가능한 예는 드롭다운을 사용하여 이름으로 성능 카운터 집합을 선택하는 것입니다.

```
Perf
| summarize by CounterName, ObjectName
| order by ObjectName asc, CounterName asc
| project Counter = pack('counter', CounterName, 'object', ObjectName), CounterName, group = ObjectName
```

쿼리는 다음과 같이 결과를 표시합니다.

![퍼프 카운터 드롭다운](media/vminsights-workbooks/013-workbook-edit-parameter-perf-counters.png)

드롭다운은 대화형 보고서를 사용자 지정하고 생성할 수 있는 매우 강력한 도구입니다.

### <a name="time-range-parameters"></a>시간 범위 매개 변수

드롭다운 매개 변수 형식을 통해 고유한 사용자 지정 시간 범위 매개 변수를 만들 수 있는 동시에 동일한 수준의 유연성이 필요하지 않는 경우 기본 시간 범위 매개 변수 형식을 사용할 수도 있습니다. 

시간 범위 매개 변수 형식에는 5분부터 최근 90일까지 이동하는 15개의 기본 범위가 포함됩니다. 사용자 지정 시간 범위 선택 영역을 허용하는 옵션이 있습니다. 이를 통해 보고서의 연산자가 시간 범위에 대해 명시적 시작 및 중지 값을 선택할 수 있습니다.

### <a name="resource-picker"></a>리소스 선택기

리소스 선택기 매개 변수 형식에서는 특정 형식의 리소스로 보고서 범위를 지정하는 기능을 제공합니다. 리소스 선택기 유형을 활용하는 미리 빌드된 통합 문서의 예로는 **성능** 통합 문서입니다.

![작업 영역 드롭다운](media/vminsights-workbooks/014-workbook-edit-parameter-workspaces.png)

## <a name="saving-and-sharing-workbooks-with-your-team"></a>팀과 통합 문서 저장 및 공유

통합 문서는 통합 문서 갤러리에 액세스하는 방법에 따라 로그 분석 작업 영역 또는 가상 컴퓨터 리소스 내에 저장됩니다. 통합 문서를 비공개인 **내 보고서** 섹션또는 리소스에 액세스할 수 있는 모든 사용자가 액세스할 수 있는 **공유 보고서** 섹션에 저장할 수 있습니다. 리소스에서 모든 통합 문서를 보려면 작업 모음에서 **열기** 단추를 클릭합니다.

현재 **내 보고서**에 있는 통합 문서를 공유하려면:

1. 작업 모음에서 **열기**를 클릭합니다.
2. 공유하려는 통합 문서 옆에 있는 "..." 단추를 클릭합니다.
3. **공유 보고서로 이동**을 클릭합니다.

링크 또는 전자 메일을 통해 통합 문서를 공유하려면 작업 모음에서 **공유**를 클릭합니다. 통합 문서를 보려면 링크의 수신자는 Azure Portal에서 이 리소스에 대한 액세스가 필요함을 명심하세요. 편집하려면 수신자는 최소한 리소스에 대한 참가자 권한이 필요합니다.

Azure 대시보드에 통합 문서에 대한 링크를 고정하려면:

1. 작업 모음에서 **열기**를 클릭합니다.
2. 고정하려는 통합 문서 옆에 있는 "..." 단추를 클릭합니다.
3. **대시보드에 고정**을 클릭합니다.

## <a name="next-steps"></a>다음 단계

- 제한 사항 및 전반적인 VM 성능을 식별하려면 [Azure VM 성능 보기](vminsights-performance.md)를 참조하십시오.

- 검색된 응용 프로그램 종속성에 대해 자세히 알아보려면 [VM 맵에 대한 Azure 모니터 보기를](vminsights-maps.md)참조하십시오.
