---
title: 응용 프로그램 게이트웨이작동 방식
description: 이 문서에서는 응용 프로그램 게이트웨이에서 들어오는 요청을 수락하고 백 엔드로 라우팅하는 방법에 대한 정보를 제공합니다.
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 11/16/2019
ms.author: absha
ms.openlocfilehash: 84a7bdfb9f8f7c741140cbe2086149dff90db211
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "80132978"
---
# <a name="how-an-application-gateway-works"></a>응용 프로그램 게이트웨이작동 방식

이 문서에서는 응용 프로그램 게이트웨이에서 들어오는 요청을 수락하고 백 엔드로 라우팅하는 방법을 설명합니다.

![응용 프로그램 게이트웨이가 요청을 수락하는 방법](./media/how-application-gateway-works/how-application-gateway-works.png)

## <a name="how-an-application-gateway-accepts-a-request"></a>응용 프로그램 게이트웨이가 요청을 수락하는 방법

1. 클라이언트가 응용 프로그램 게이트웨이에 요청을 보내기 전에 DNS(도메인 이름 시스템) 서버를 사용하여 응용 프로그램 게이트웨이의 도메인 이름을 확인합니다. Azure는 모든 응용 프로그램 게이트웨이가 azure.com 도메인에 있기 때문에 DNS 항목을 제어합니다.

2. Azure DNS는 응용 프로그램 게이트웨이의 프런트 엔드 IP 주소인 클라이언트에 IP 주소를 반환합니다.

3. 응용 프로그램 게이트웨이는 하나 이상의 수신기에서 들어오는 트래픽을 허용합니다. 수신기는 연결 요청을 확인하는 논리적 엔터티입니다. 클라이언트에서 응용 프로그램 게이트웨이로의 연결을 위한 프런트 엔드 IP 주소, 프로토콜 및 포트 번호로 구성됩니다.

4. WAF(웹 응용 프로그램 방화벽)가 사용 중이면 응용 프로그램 게이트웨이는 WAF 규칙에 대해 요청 헤더와 본문을 확인합니다. 이 작업은 요청이 유효한 요청인지 보안 위협인지를 결정합니다. 요청이 유효한 경우 백 엔드로 라우팅됩니다. 요청이 유효하지 않고 WAF가 예방 모드에 있으면 보안 위협으로 차단됩니다. 검색 모드에 있는 경우 요청이 평가되고 기록되지만 백 엔드 서버로 계속 전달됩니다.

Azure 응용 프로그램 게이트웨이는 내부 응용 프로그램 로드 밸런서 또는 인터넷 연결 응용 프로그램 로드 밸런서로 사용할 수 있습니다. 인터넷 을 사용하는 응용 프로그램 게이트웨이는 공용 IP 주소를 사용합니다. 인터넷 을 향한 응용 프로그램 게이트웨이의 DNS 이름은 공용 IP 주소로 공개적으로 확인할 수 있습니다. 따라서 인터넷 을 향한 응용 프로그램 게이트웨이는 클라이언트 요청을 인터넷으로 라우팅할 수 있습니다.

내부 응용 프로그램 게이트웨이는 개인 IP 주소만 사용합니다. 사용자 지정 또는 [개인 DNS 영역을](https://docs.microsoft.com/azure/dns/private-dns-overview)사용하는 경우 도메인 이름은 응용 프로그램 게이트웨이의 개인 IP 주소로 내부적으로 확인할 수 있어야 합니다. 따라서 내부 로드 밸러저는 응용 프로그램 게이트웨이에 대한 가상 네트워크에 액세스할 수 있는 클라이언트의 요청만 라우팅할 수 있습니다.

## <a name="how-an-application-gateway-routes-a-request"></a>응용 프로그램 게이트웨이가 요청을 라우팅하는 방법

요청이 유효하고 WAF에 의해 차단되지 않은 경우 응용 프로그램 게이트웨이는 수신기와 연결된 요청 라우팅 규칙을 평가합니다. 이 작업은 요청을 라우팅할 백 엔드 풀을 결정합니다.

요청 라우팅 규칙에 따라 응용 프로그램 게이트웨이는 수신기의 모든 요청을 특정 백 엔드 풀로 라우팅할지, URL 경로에 따라 다른 백 엔드 풀로 요청을 라우팅할지 또는 요청을 다른 포트 또는 외부 사이트로 리디렉션할지 여부를 결정합니다.
>[!NOTE]
>규칙은 v1 SKU에 대해 포털에 나열된 순서대로 처리됩니다. 

When the application gateway selects the backend pool, it sends the request to one of the healthy backend servers in the pool (y.y.y.y). 서버의 상태는 상태 프로브에 의해 결정됩니다. 백 엔드 풀에 여러 서버가 포함된 경우 응용 프로그램 게이트웨이는 라운드 로빈 알고리즘을 사용하여 정상 서버 간에 요청을 라우팅합니다. 이 로드는 서버의 요청을 균형 조정합니다.

응용 프로그램 게이트웨이가 백 엔드 서버를 결정하면 HTTP 설정에 따라 백 엔드 서버가 있는 새 TCP 세션이 열립니다. HTTP 설정은 백 엔드 서버로 새 세션을 설정하는 데 필요한 프로토콜, 포트 및 기타 라우팅 관련 설정을 지정합니다.

HTTP 설정에 사용되는 포트 및 프로토콜은 응용 프로그램 게이트웨이와 백 엔드 서버 간의 트래픽이 암호화되어 있는지(따라서 종단 간 TLS를 수행) 암호화되지 않았는지 여부를 결정합니다.

응용 프로그램 게이트웨이가 원래 요청을 백 엔드 서버로 보내면 호스트 이름, 경로 및 프로토콜 재정의와 관련된 HTTP 설정에서 만들어진 모든 사용자 지정 구성이 수행됩니다. 이 작업은 쿠키 기반 세션 선호도, 연결 드레인, 백 엔드에서 호스트 이름 선택 등을 유지합니다.

 >[!NOTE]
>백 엔드 풀의 경우:
> - **공용 끝점인**응용 프로그램 게이트웨이는 프런트 엔드 공용 IP를 사용하여 서버에 도달합니다. 프런트 엔드 공용 IP 주소가 없는 경우 아웃바운드 외부 연결에 할당됩니다.
> - **내부적으로 해결할 수 있는 FQDN 또는 개인 IP 주소를 포함하는**응용 프로그램 게이트웨이는 인스턴스 개인 IP 주소를 사용하여 백 엔드 서버로 요청을 라우팅합니다.
> - **외부 끝점 또는 외부적으로 해결할 수 있는 FQDN을 포함하며**응용 프로그램 게이트웨이는 프런트 엔드 공용 IP 주소를 사용하여 백 엔드 서버로 요청을 라우팅합니다. DNS 확인은 구성된 경우 개인 DNS 영역 또는 사용자 지정 DNS 서버를 기반으로 하거나 Azure에서 제공하는 기본 DNS를 사용합니다. 프런트 엔드 공용 IP 주소가 없는 경우 아웃바운드 외부 연결에 할당됩니다.

### <a name="modifications-to-the-request"></a>요청 수정

응용 프로그램 게이트웨이는 요청을 백 엔드로 전달하기 전에 모든 요청에 4개의 추가 헤더를 삽입합니다. 이러한 헤더는 x-forwarded-for, x-forwarded-proto, x-forwarded-port 및 x-원래 호스트입니다. x-forwarded-for 헤더의 형식은 IP:port의 쉼표로 구분된 목록입니다.

x-forwarded-proto에 대 한 유효한 값은 HTTP 또는 HTTPS입니다. X 전달 포트는 요청이 응용 프로그램 게이트웨이에 도달한 포트를 지정합니다. X 원래 호스트 헤더에는 요청이 도착한 원래 호스트 헤더가 포함됩니다. 이 헤더는 트래픽이 백 엔드로 라우팅되기 전에 들어오는 호스트 헤더가 수정되는 Azure 웹 사이트 통합에 유용합니다. 세션 선호도를 옵션으로 사용하도록 설정하면 게이트웨이 관리 선호도 쿠키가 추가됩니다.

HTTP 헤더 다시 쓰기를 사용하여 [헤더를](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers) 수정하거나 경로 재정의 설정을 사용하여 URI 경로를 수정하도록 응용 프로그램 게이트웨이를 구성할 수 있습니다. 그러나 이렇게 하도록 구성하지 않는 한 들어오는 모든 요청은 백 엔드로 프록시됩니다.

## <a name="next-steps"></a>다음 단계

[애플리케이션 게이트웨이 구성 요소에 대해 알아보기](application-gateway-components.md)
