---
title: 응용 프로그램 게이트웨이에 대한 Azure 모니터 메트릭
description: 메트릭을 사용하여 애플리케이션 게이트웨이의 성능을 모니터링하는 방법 알아보기
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 2/5/2019
ms.author: absha
ms.openlocfilehash: ebbdda39f019f374f8e5abe951d0180c0dd453f6
ms.sourcegitcommit: b55d7c87dc645d8e5eb1e8f05f5afa38d7574846
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/16/2020
ms.locfileid: "81457878"
---
# <a name="metrics-for-application-gateway"></a>애플리케이션 게이트웨이에 대한 메트릭

응용 프로그램 게이트웨이는 응용 프로그램 게이트웨이 및 백 엔드 인스턴스의 성능을 위해 메트릭이라는 데이터 포인트를 [Azure Monitor에](https://docs.microsoft.com/azure/azure-monitor/overview) 게시합니다. 이러한 메트릭은 특정 시간에 응용 프로그램 게이트웨이의 일부 측면을 설명하는 정렬된 표준 시간열 데이터 집합의 숫자 값입니다. 응용 프로그램 게이트웨이를 통해 흐르는 요청이 있는 경우 60초 간격으로 메트릭을 측정하고 보냅니다. 응용 프로그램 게이트웨이를 통해 흐르는 요청이 없거나 메트릭에 대한 데이터가 없는 경우 메트릭이 보고되지 않습니다. 자세한 내용은 [Azure Monitor 메트릭](https://docs.microsoft.com/azure/azure-monitor/platform/data-platform-metrics)을 참조하세요.

## <a name="metrics-supported-by-application-gateway-v2-sku"></a>애플리케이션 게이트웨이 V2 SKU에서 지원하는 메트릭

### <a name="timing-metrics"></a>타이밍 메트릭

응용 프로그램 게이트웨이는 요청 및 응답과 관련된 몇 가지 기본 제공 타이밍 메트릭을 제공하며, 모두 밀리초 단위로 측정됩니다. 

![](./media/application-gateway-metrics/application-gateway-metrics.png)

> [!NOTE]
>
> 응용 프로그램 게이트웨이에 둘 이상의 수신기가 있는 경우 의미 있는 추론을 얻기 위해 서로 다른 대기 시간 메트릭을 비교하는 동안 항상 *Listener* 차원별로 필터링합니다.

- **백 엔드 연결 시간**

  백 엔드 응용 프로그램과의 연결을 설정하는 데 소요된 시간입니다. 

  여기에는 네트워크 대기 시간뿐만 아니라 백 엔드 서버의 TCP 스택이 새 연결을 설정하는 데 걸린 시간이 포함됩니다. TLS의 경우 악수에 소요된 시간도 포함됩니다. 

- **백 엔드 첫 바이트 응답 시간**

  백 엔드 서버에 대한 연결을 설정하고 응답 헤더의 첫 번째 바이트를 받는 사이의 시간 간격입니다. 

  이는 백 엔드 연결 *시간,* 응용 프로그램 게이트웨이에서 백 엔드에 도달하기 위해 요청이 소요된 시간, 백 엔드 응용 프로그램이 응답하는 데 걸린 시간(서버가 콘텐츠를 생성하는 데 걸린 시간, 데이터베이스 쿼리를 가져오는 데 걸린 시간) 및 백 엔드에서 응용 프로그램 게이트웨이에 도달하기 위해 응답의 첫 번째 바이트에 의해 소요된 시간을 근사화합니다.

- **백 엔드 마지막 바이트 응답 시간**

  백 엔드 서버에 대한 연결을 설정하고 응답 본문의 마지막 바이트를 받는 사이의 시간 간격입니다. 

  이는 *백엔드 첫 번째 바이트 응답 시간* 및 데이터 전송 시간의 합계를 근사화합니다(이 숫자는 요청된 개체의 크기와 서버 네트워크의 대기 시간에 따라 크게 달라질 수 있음).

- **애플리케이션 게이트웨이 총 시간**

  요청을 받고 처리하며 응답을 보내는 데 걸리는 평균 시간입니다. 

  이는 응용 프로그램 게이트웨이가 HTTP 요청의 첫 번째 바이트를 수신한 시점부터 클라이언트에 마지막 응답 바이트가 전송된 시간까지의 간격입니다. 여기에는 응용 프로그램 게이트웨이, *백 엔드 마지막 바이트 응답 시간,* 모든 응답 및 클라이언트 *RTT를*보내는 응용 프로그램 게이트웨이에서 소요되는 시간 등이 포함됩니다.

- **클라이언트 RTT**

  클라이언트와 응용 프로그램 게이트웨이 간의 평균 왕복 시간입니다.



이러한 메트릭은 관찰된 속도 저하가 클라이언트 네트워크, 응용 프로그램 게이트웨이 성능, 백 엔드 네트워크 및 백 엔드 서버 TCP 스택 포화, 백 엔드 응용 프로그램 성능 또는 큰 파일 크기로 인한 것인지 여부를 확인하는 데 사용할 수 있습니다.

예를 들어 백 엔드 첫 *번째 바이트 응답 시간* 추세가 급증했지만 백 엔드 연결 *시간* 추세가 안정적이면 백 엔드 대기 시간을 위한 응용 프로그램 게이트웨이가 안정적이고 백 엔드 응용 프로그램의 응답 시간이 증가하여 스파이크가 발생한다고 추론할 수 있습니다. 반면에 백 엔드 첫 *번째 바이트 응답 시간의* 스파이크가 *백 엔드 연결 시간의*해당 스파이크와 연관된 경우 응용 프로그램 게이트웨이와 백 엔드 서버 간의 네트워크 또는 백 엔드 서버 TCP 스택이 포화 상태임을 추론할 수 있습니다. 

백 엔드 마지막 *바이트 응답 시간에* 스파이크가 있지만 백 엔드 첫 번째 바이트 응답 *시간이* 안정적이면 스파이크가 요청되는 파일이 더 커서 스파이크가 있다고 추론할 수 있습니다.

마찬가지로 응용 *프로그램 게이트웨이 총 시간이* 급증했지만 *백 엔드 마지막 바이트 응답 시간이* 안정적인 경우 응용 프로그램 게이트웨이에서 성능 병목 현상의 징후이거나 클라이언트와 응용 프로그램 게이트웨이 간의 네트워크의 병목 현상이 될 수 있습니다. 또한 클라이언트 *RTT에* 해당 스파이크가 있는 경우 클라이언트와 응용 프로그램 게이트웨이 간의 네트워크 로 인해 성능이 저하되었음을 나타냅니다.

### <a name="application-gateway-metrics"></a>애플리케이션 게이트웨이 메트릭

Application Gateway에는 다음 메트릭이 지원됩니다.

- **수신된 바이트**

   클라이언트에서 응용 프로그램 게이트웨이에서 받은 바이트 수

- **전송된 바이트**

   응용 프로그램 게이트웨이에서 클라이언트로 전송한 바이트 수

- **클라이언트 TLS 프로토콜**

   응용 프로그램 게이트웨이와의 연결을 설정한 클라이언트에서 시작한 TLS 및 TLS가 아닌 요청 수입니다. TLS 프로토콜 분포를 보려면 차원 TLS 프로토콜별로 필터링합니다.

- **현재 용량 단위**

   트래픽의 균형을 맞추기 위해 소비되는 용량 단위 수입니다. 용량 단위에는 계산 단위, 영구 연결 및 처리량의 세 가지 결정요인이 있습니다. 각 용량 단위는 계산 단위 1개 또는 영구 연결 2500개 또는 2.22Mbps 처리량으로 구성됩니다.

- **현재 계산 단위**

   소비된 프로세서 용량 수입니다. 계산 단위에 영향을 미치는 요소는 TLS 연결/초, URL 다시 쓰기 계산 및 WAF 규칙 처리입니다. 

- **현재 연결**

   클라이언트에서 응용 프로그램 게이트웨이로 활성 상태인 총 동시 연결 수
   
- **예상 청구 용량 단위**

  v2 SKU를 사용하면 가격 책정 모델이 소비에 의해 좌우됩니다. 용량 단위는 고정 비용 외에 비용이 청구되는 소비 기반 비용을 측정합니다. *예상 청구 용량 단위는* 청구가 예상되는 용량을 사용하는 용량 단위 수를 나타냅니다. 이는 현재 용량 단위(트래픽로드에 필요한 용량 단위)와 고정 *청구 가능 용량* 단위(프로비저닝된 최소 용량 단위) 간의 더 큰 값으로 계산됩니다. *Current capacity units*

- **실패한 요청**

  응용 프로그램 게이트웨이가 5xx 서버 오류 코드와 함께 제공한 요청 수입니다. 여기에는 응용 프로그램 게이트웨이에서 생성되는 5xx 코드와 백 엔드에서 생성된 5xx 코드가 포함됩니다. 요청 수를 추가로 필터링하여 각 백 엔드/특정 백 엔드 풀-http 설정 조합당 개수를 표시할 수 있습니다.
   
- **고정 청구 가능 용량 단위**

  애플리케이션 게이트웨이 구성에서 *최소 규모 단위* 설정(한 인스턴스가 용량 단위로 변환)에 따라 프로비전된 최소 용량 단위 수입니다.
   
 - **초당 새 연결**

   클라이언트에서 응용 프로그램 게이트웨이및 응용 프로그램 게이트웨이에서 백 엔드 멤버로 설정된 초당 평균 새 TCP 연결 수입니다.


- **응답 상태**

   응용 프로그램 게이트웨이에서 반환되는 HTTP 응답 상태입니다. 2xx, 3xx, 4xx 및 5xx 범주로 응답을 표시하도록 응답 상태 코드 분산을 더욱 세분화할 수 있습니다.

- **처리량**

   Application Gateway에서 제공하는 초당 바이트 수

- **총 요청 수**

   응용 프로그램 게이트웨이가 제공한 성공적인 요청 수입니다. 요청 수를 추가로 필터링하여 각 백 엔드/특정 백 엔드 풀-http 설정 조합당 개수를 표시할 수 있습니다.

### <a name="backend-metrics"></a>백 엔드 메트릭

Application Gateway에는 다음 메트릭이 지원됩니다.

- **백 엔드 응답 상태**

  백 엔드에서 반환되는 HTTP 응답 상태 코드 수입니다. 응용 프로그램 게이트웨이에서 생성된 응답 코드는 포함되지 않습니다. 2xx, 3xx, 4xx 및 5xx 범주로 응답을 표시하도록 응답 상태 코드 분산을 더욱 세분화할 수 있습니다.

- **정상 호스트 수**

  상태 프로브에 의해 정상으로 결정되는 백엔드 수입니다. 백 엔드 당 풀 단위로 필터링하여 특정 백 엔드 풀의 정상 호스트 수를 표시할 수 있습니다.

- **비정상 호스트 수**

  상태 프로브에 의해 비정상으로 결정되는 백엔드 수입니다. 백 엔드 당 풀 단위로 필터링하여 특정 백 엔드 풀에서 비정상 호스트 수를 표시할 수 있습니다.
  
- **건강한 호스트당 분당 요청**

  백 엔드 풀에서 각 정상 구성원이 1분 동안 받은 평균 요청 수입니다. *백 엔드풀 HttpSettings* 차원을 사용하여 백 엔드 풀을 지정해야 합니다.  
  

## <a name="metrics-supported-by-application-gateway-v1-sku"></a>애플리케이션 게이트웨이 V1 SKU에서 지원하는 메트릭

### <a name="application-gateway-metrics"></a>애플리케이션 게이트웨이 메트릭

Application Gateway에는 다음 메트릭이 지원됩니다.

- **CPU 사용률**

  응용 프로그램 게이트웨이에 할당된 CPU의 사용률을 표시합니다.  정상적인 조건에서 CPU 사용량이 90%를 초과해서는 안 되며, 이로 인해 응용 프로그램 게이트웨이 뒤에 호스트된 웹 사이트의 대기 시간이 발생하고 클라이언트 환경이 중단될 수 있습니다. 인스턴스 수를 늘리거나 더 큰 SKU 크기로 이동하거나 둘 다 수행하여 응용 프로그램 게이트웨이의 구성을 수정하여 CPU 사용률을 간접적으로 제어하거나 개선할 수 있습니다.

- **현재 연결**

  Application Gateway와 설정된 현재 연결 수

- **실패한 요청**

  응용 프로그램 게이트웨이가 5xx 서버 오류 코드와 함께 제공한 요청 수입니다. 여기에는 응용 프로그램 게이트웨이에서 생성되는 5xx 코드와 백 엔드에서 생성된 5xx 코드가 포함됩니다. 요청 수를 추가로 필터링하여 각 백 엔드/특정 백 엔드 풀-http 설정 조합당 개수를 표시할 수 있습니다.

- **응답 상태**

  응용 프로그램 게이트웨이에서 반환되는 HTTP 응답 상태입니다. 2xx, 3xx, 4xx 및 5xx 범주로 응답을 표시하도록 응답 상태 코드 분산을 더욱 세분화할 수 있습니다.

- **처리량**

  Application Gateway에서 제공하는 초당 바이트 수

- **총 요청 수**

  응용 프로그램 게이트웨이가 제공한 성공적인 요청 수입니다. 요청 수를 추가로 필터링하여 각 백 엔드/특정 백 엔드 풀-http 설정 조합당 개수를 표시할 수 있습니다.

- **웹 응용 프로그램 방화벽 차단된 요청 수**
- **웹 응용 프로그램 방화벽 차단 된 요청 배포**
- **웹 응용 프로그램 방화벽 총 규칙 배포**

### <a name="backend-metrics"></a>백 엔드 메트릭

Application Gateway에는 다음 메트릭이 지원됩니다.

- **정상 호스트 수**

  상태 프로브에 의해 정상으로 결정되는 백엔드 수입니다. 백 엔드 당 풀 단위로 필터링하여 특정 백 엔드 풀의 정상 호스트 수를 표시할 수 있습니다.

- **비정상 호스트 수**

  상태 프로브에 의해 비정상으로 결정되는 백엔드 수입니다. 백 엔드 당 풀 단위로 필터링하여 특정 백 엔드 풀에서 비정상 호스트 수를 표시할 수 있습니다.

## <a name="metrics-visualization"></a>메트릭 시각화

**모니터링** 선택 메트릭 아래에서 응용 프로그램 **게이트웨이로 이동합니다.** 사용 가능한 값을 보려면 **메트릭** 드롭다운 목록을 선택합니다.

다음 이미지에서는 최근 30분 동안 표시된 세 가지 메트릭을 포함한 예제가 표시됩니다.

[![](media/application-gateway-diagnostics/figure5.png "Metric view")](media/application-gateway-diagnostics/figure5-lb.png#lightbox)

현재 지원되는 메트릭 목록을 보려면 [Azure Monitor에서 지원되는 메트릭](../azure-monitor/platform/metrics-supported.md)을 참조하세요.

### <a name="alert-rules-on-metrics"></a>메트릭에 대한 경고 규칙

리소스에 대한 메트릭을 기반으로 하는 경고 규칙을 시작할 수 있습니다. 예를 들어 애플리케이션 게이트웨이의 처리량이 지정된 기간 동안 임계값보다 높거나 낮거나 같을 때 경고에서 웹후크를 호출하거나 관리자에게 전자 메일을 보낼 수 있습니다.

다음 예제에서는 처리량이 임계값을 위반하면 관리자에게 전자 메일을 보내는 경고 규칙을 만드는 과정을 설명합니다.

1. **규칙 추가** 페이지를 열려면 **메트릭 경고 추가를** 선택합니다. 측정항목 페이지에서 이 페이지에 도달할 수도 있습니다.

   !["메트릭 경고 추가" 단추][6]

2. 규칙 **추가** 페이지에서 이름, 조건 및 알림 섹션을 작성하고 **확인을**선택합니다.

   * **조건** 선택기에서 **보다 큼**, **보다 크거나 같음**, **보다 작음**, **보다 작거나 같음**의 네 가지 값 중 하나를 선택합니다.

   * **기간** 선택기에서 5분에서 6시간 사이의 기간까지 선택합니다.

   * **전자 메일 소유자, 참가자 및 읽기 권한자**를 선택하면 해당 리소스에 액세스할 수 있는 사용자에 따라 동적으로 전자 메일을 보낼 수 있습니다. 그렇지 않으면 **추가 관리자 전자 메일** 상자에서 쉼표로 구분된 사용자 목록을 제공할 수도 있습니다.

   ![규칙 페이지 추가][7]

임계값을 위반하면 다음 이미지와 비슷한 전자 메일이 도착합니다.

![위반된 임계값에 대한 전자 메일][8]

메트릭 경고를 만들면 경고 목록이 표시됩니다. 모든 경고 규칙에 대한 개요도 제공됩니다.

![경고 및 규칙 목록][9]

경고 알림에 대한 자세한 내용은 [경고 알림 받기](../monitoring-and-diagnostics/insights-receive-alert-notifications.md)를 참조하세요.

웹후크에 대한 자세한 내용 및 경고와 함께 웹후크를 사용하는 방법을 알아보려면 [Azure 메트릭 경고에 대한 웹후크 구성](../azure-monitor/platform/alerts-webhooks.md)을 참조하세요.

## <a name="next-steps"></a>다음 단계

* [Azure Monitor 로그](../azure-monitor/insights/azure-networking-analytics.md)를 사용하여 카운터 및 이벤트 로그를 시각화합니다.
* Power BI 블로그 게시물을 [통해 Azure 활동 로그를 시각화합니다.](https://blogs.msdn.com/b/powerbi/archive/2015/09/30/monitor-azure-audit-logs-with-power-bi.aspx)
* [Power BI 등에서 Azure 활동 로그 보기 및 분석](https://azure.microsoft.com/blog/analyze-azure-audit-logs-in-powerbi-more/) 블로그 게시물

[1]: ./media/application-gateway-diagnostics/figure1.png
[2]: ./media/application-gateway-diagnostics/figure2.png
[3]: ./media/application-gateway-diagnostics/figure3.png
[4]: ./media/application-gateway-diagnostics/figure4.png
[5]: ./media/application-gateway-diagnostics/figure5.png
[6]: ./media/application-gateway-diagnostics/figure6.png
[7]: ./media/application-gateway-diagnostics/figure7.png
[8]: ./media/application-gateway-diagnostics/figure8.png
[9]: ./media/application-gateway-diagnostics/figure9.png
[10]: ./media/application-gateway-diagnostics/figure10.png
