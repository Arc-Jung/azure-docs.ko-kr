---
title: Azure 응용 프로그램 게이트웨이에서 종단 간 TLS 사용
description: 이 문서에서는 TLS 지원을 종료하는 응용 프로그램 게이트웨이 끝의 개요입니다.
services: application-gateway
author: amsriva
ms.service: application-gateway
ms.topic: article
ms.date: 3/19/2019
ms.author: victorh
ms.openlocfilehash: ae80b49c3bfb40743665768622d3f4a8a6990c12
ms.sourcegitcommit: 7e04a51363de29322de08d2c5024d97506937a60
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/14/2020
ms.locfileid: "81311858"
---
# <a name="overview-of-tls-termination-and-end-to-end-tls-with-application-gateway"></a>애플리케이션 게이트웨이를 통한 TLS 종단 및 엔드 투 엔드 TLS 개요

이전에 는 SSL(보안 소켓 계층)이라고 불리던 전송 계층 보안(TLS)은 웹 서버와 브라우저 간에 암호화된 링크를 설정하기 위한 표준 보안 기술입니다. 이 링크를 사용하면 웹 서버와 브라우저 간에 전달되는 모든 데이터가 비공개및 암호화된 상태로 유지됩니다. 응용 프로그램 게이트웨이는 게이트웨이에서 TLS 종료와 엔드 투 엔드 TLS 암호화를 모두 지원합니다.

## <a name="tls-termination"></a>TLS 종단

응용 프로그램 게이트웨이는 게이트웨이에서 TLS 종료를 지원하며, 그 후에는 트래픽이 일반적으로 백 엔드 서버로 암호화되지 않은 흐름으로 흐릅니다. 응용 프로그램 게이트웨이에서 TLS 종료를 수행할 때의 여러 가지 이점이 있습니다.

- **성능 향상** – TLS 암호 해독을 수행할 때 가장 큰 성능 은 초기 핸드셰이크입니다. 성능을 향상시키기 위해 암호 해독을 수행하는 서버는 TLS 세션 ID를 캐시하고 TLS 세션 티켓을 관리합니다. 응용 프로그램 게이트웨이에서 이 작업을 수행하는 경우 동일한 클라이언트의 모든 요청이 캐시된 값을 사용할 수 있습니다. 백 엔드 서버에서 수행된 경우 클라이언트의 요청이 다른 서버로 이동될 때마다 클라이언트는 다시 인증해야 합니다. TLS 티켓을 사용하면 이 문제를 완화하는 데 도움이 될 수 있지만 모든 클라이언트에서 지원되지 않으며 구성 및 관리가 어려울 수 있습니다.
- **백 엔드 서버의 활용도 향상** – SSL/TLS 처리는 CPU 집약적이며 키 크기가 증가함에 따라 점점 더 집중적으로 변하고 있습니다. 백 엔드 서버에서 이 작업을 제거하면 가장 효율적인 콘텐츠에 집중할 수 있습니다.
- **지능형 라우팅** - 트래픽을 해독하면 응용 프로그램 게이트웨이는 헤더, URI 등과 같은 요청 콘텐츠에 액세스할 수 있으며 이 데이터를 사용하여 요청을 라우팅할 수 있습니다.
- **인증서 관리** - 인증서는 모든 백 엔드 서버가 아닌 응용 프로그램 게이트웨이에 구입하여 설치하기만 하면 됩니다. 이를 통해 시간과 비용을 절약할 수 있습니다.

TLS 종료를 구성하려면 응용 프로그램 게이트웨이가 TLS/SSL 프로토콜 사양에 따라 대칭 키를 파생할 수 있도록 수신기에 TLS/SSL 인증서를 추가해야 합니다. 그런 다음 대칭 키를 사용하여 게이트웨이로 전송된 트래픽을 암호화하고 해독합니다. TLS/SSL 인증서는 개인 정보 교환(PFX) 형식이어야 합니다. 이 파일 형식을 사용하면 애플리케이션 게이트웨이에서 트래픽의 암호화 및 암호 해독을 수행하는 데 필요한 프라이빗 키를 내보낼 수 있습니다.

> [!NOTE] 
>
> 응용 프로그램 게이트웨이는 새 인증서를 만들거나 인증 기관에 인증서 요청을 보낼 수 있는 기능을 제공하지 않습니다.

TLS 연결이 작동하려면 TLS/SSL 인증서가 다음 조건을 충족하는지 확인해야 합니다.

- 현재 날짜와 시간이 인증서의 "유효 날짜" 및 "유효 기간" 범위 내에 있음을
- 인증서의 CN(일반 이름)이 요청의 호스트 헤더와 일치합니다. 예를 들어 클라이언트가 `https://www.contoso.com/`에 요청하는 경우 CN이 `www.contoso.com`이어야 합니다.

### <a name="certificates-supported-for-tls-termination"></a>TLS 종료에 지원되는 인증서

응용 프로그램 게이트웨이는 다음과 같은 유형의 인증서를 지원합니다.

- CA(인증 기관) 인증서: CA 인증서는 CA(인증 기관)에서 발급한 디지털 인증서입니다.
- EV(확장 유효성 검사) 인증서: EV 인증서는 업계 표준 인증서 지침을 준수하는 인증서입니다. 이렇게 하면 브라우저 로케이터 바가 녹색으로 바뀌고 회사 이름도 게시됩니다.
- 와일드카드 인증서: 이 인증서는 *.site.com 기반으로 하는 하위 도메인의 수에 관계없이 지원하며, 여기서 하위 도메인은 *를 대체합니다. 그러나 site.com 지원하지 않으므로 사용자가 선행 "www"를 입력하지 않고 웹 사이트에 액세스하는 경우 와일드카드 인증서가 적용되지 않습니다.
- 자체 서명된 인증서: 클라이언트 브라우저는 이러한 인증서를 신뢰하지 않으며 가상 서비스의 인증서가 트러스트 체인의 일부가 아님을 사용자에게 경고합니다. 자체 서명된 인증서는 관리자가 클라이언트를 제어하고 브라우저의 보안 경고를 안전하게 우회할 수 있는 테스트 또는 환경에 적합합니다. 프로덕션 워크로드는 자체 서명된 인증서를 사용해서는 안 됩니다.

자세한 내용은 [응용 프로그램 게이트웨이를 사용 하 여 TLS 종료 구성을](https://docs.microsoft.com/azure/application-gateway/create-ssl-portal)참조 하십시오.

### <a name="size-of-the-certificate"></a>인증서 크기
[지원되는](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#application-gateway-limits) 최대 TLS/SSL 인증서 크기를 알아하려면 응용 프로그램 게이트웨이 제한 섹션을 확인하십시오.

## <a name="end-to-end-tls-encryption"></a>종단 간 TLS 암호화

일부 고객은 백 엔드 서버에 대한 암호화되지 않은 통신을 원하지 않을 수 있습니다. 이는 보안 요구 사항, 규정 준수 요구 사항 때문이거나 애플리케이션이 보안 연결만 수락하는 것이기 때문일 수 있습니다. 이러한 응용 프로그램의 경우 응용 프로그램 게이트웨이는 종단 간 TLS 암호화를 지원합니다.

종단 간 TLS를 사용하면 응용 프로그램 게이트웨이가 제공하는 계층 7 로드 밸런싱 기능의 이점을 활용하면서 암호화된 백 엔드로 중요한 데이터를 안전하게 전송할 수 있습니다. 이러한 기능 중 일부는 쿠키 기반 세션 선호도, URL 기반 라우팅, 사이트 기반 라우팅 지원 또는 X-Forwarded-* 헤더 삽입 기능입니다.

종단 간 TLS 통신 모드로 구성된 경우 응용 프로그램 게이트웨이는 게이트웨이에서 TLS 세션을 종료하고 사용자 트래픽을 해독합니다. 그런 다음 구성된 규칙을 적용하여 트래픽을 라우팅할 적절한 백 엔드 풀 인스턴스를 선택합니다. 그런 다음 응용 프로그램 게이트웨이는 백 엔드 서버에 대한 새 TLS 연결을 시작하고 백 엔드 서버의 공개 키 인증서를 사용하여 데이터를 다시 암호화한 다음 백 엔드로 요청을 전송합니다. 웹 서버의 모든 응답은 동일한 프로세스를 거쳐 최종 사용자에게 돌아갑니다. 종단 간 TLS는 [백 엔드 HTTP 설정에서](https://docs.microsoft.com/azure/application-gateway/configuration-overview#http-settings) 프로토콜 설정을 HTTPS로 설정하여 활성화된 다음 백 엔드 풀에 적용됩니다.

TLS 정책은 프런트 엔드 트래픽과 백 엔드 트래픽 모두에 적용됩니다. 프런트 엔드에서 응용 프로그램 게이트웨이는 서버 역할을 하며 정책을 적용합니다. 백 엔드에서 응용 프로그램 게이트웨이는 클라이언트 역할을 하며 TLS 핸드셰이크 중에 프로토콜/암호 정보를 기본 설정으로 보냅니다.

응용 프로그램 게이트웨이는 인증서를 응용 프로그램 게이트웨이로 삭제했거나 인증서 CN이 HTTP 백 엔드 설정의 호스트 이름과 일치하는 잘 알려진 CA 기관에서 인증서를 서명한 백 엔드 인스턴스와만 통신합니다. 여기에는 Azure App 서비스 웹 앱 및 Azure API 관리와 같은 신뢰할 수 있는 Azure 서비스가 포함됩니다.

백 엔드 풀에 있는 멤버의 인증서가 잘 알려진 CA 기관에 의해 서명되지 않은 경우 끝간 TLS가 활성화된 백 엔드 풀의 각 인스턴스는 보안 통신을 허용하는 인증서로 구성되어야 합니다. 인증서를 추가하면 Application Gateway가 알려진 백 엔드 인스턴스하고만 통신하게 됩니다. 그러면 엔드투엔드 통신의 보안이 유지됩니다.

> [!NOTE] 
>
> Azure App 서비스 웹 앱 및 Azure API 관리와 같은 신뢰할 수 있는 Azure 서비스에는 인증 인증서 설정이 필요하지 않습니다.

> [!NOTE] 
>
> 백 엔드 **서버를** 인증하기 위해 백 엔드 HTTP 설정에 추가된 인증서는 응용 프로그램 게이트웨이에서 TLS 종료를 위해 **수신기에** 추가된 인증서와 같거나 보안 강화를 위해 다를 수 있습니다.

![끝 tls 시나리오][1]

이 예제에서는 TLS1.2를 사용하는 요청이 End to end TLS를 사용하여 Pool1의 백 엔드 서버로 라우팅됩니다.

## <a name="end-to-end-tls-and-whitelisting-of-certificates"></a>종단 간 TLS 및 인증서 화이트리스트

Application Gateway는 알려진 백 엔드 인스턴스, 즉 Application Gateway을 통해 인증서가 허용 목록에 추가된 인스턴스와 유일하게 통신할 수 있습니다. 인증서 허용 목록을 사용하려면 백 엔드 서버 인증서의 공개 키를 애플리케이션 게이트웨이(루트 인증서가 아니라)에 업로드해야 합니다. 그러면 알려진 허용 목록의 백 엔드에 대한 연결만 허용됩니다. 나머지 백 엔드는 게이트웨이 오류를 초래합니다. 자체 서명된 인증서는 테스트 용도이며 프로덕션 워크로드에는 권장하지 않습니다. 마찬가지로 이러한 인증서를 사용하려면 위에서 설명했듯이 애플리케이션 게이트웨이를 통해 허용 목록에 추가해야 합니다.

> [!NOTE]
> Azure App Service와 같은 신뢰할 수 있는 Azure 서비스에는 인증 인증서 설정이 필요하지 않습니다.

## <a name="end-to-end-tls-with-the-v2-sku"></a>v2 SKU를 사용하여 TLS끝까지

인증 인증서는 Application Gateway v2 SKU에서 더 이상 사용되지 않으며 신뢰할 수 있는 루트 인증서로 대체되었습니다. 이러한 인증서는 다음과 같은 몇 가지 주요 차이점을 제외하고 인증 인증서와 비슷합니다.

- CN이 HTTP 백 엔드 설정에서 호스트 이름과 일치하는 잘 알려진 CA 기관에서 서명한 인증서는 TLS가 작동하기 위해 끝까지 추가 단계를 필요로 하지 않습니다. 

   예를 들어, 백 엔드 인증서가 잘 알려진 CA에서 발급한 것이고 CN이 contoso.com이며, 백 엔드 http 설정의 호스트 필드도 contoso.com으로 설정된 경우 추가 단계가 필요하지 않습니다. 백 엔드 http 설정 프로토콜을 HTTPS로 설정할 수 있으며 상태 프로브와 데이터 경로모두 TLS가 활성화됩니다. Azure App Service 또는 다른 Azure 웹 서비스를 백 엔드로 사용하는 경우 이러한 서비스도 암시적으로 신뢰할 수 있으며 TLS 를 끝까지 위한 추가 단계가 필요하지 않습니다.
   
> [!NOTE] 
>
> TLS/SSL 인증서를 신뢰할 수 있도록 하려면 해당 백 엔드 서버의 인증서는 응용 프로그램 게이트웨이의 신뢰할 수 있는 저장소에 포함 된 CA에 의해 발급 되었습니다.신뢰할 수 있는 CA에 의해 인증서를 발급 하지 않은 경우 응용 프로그램 게이트웨이 는 신뢰할 수 있는 CA에 의해 발급 된 CA발급 의 인증서를 확인 하 고 신뢰할 수 있는 CA가 발견 될 때까지 (이 시점에서 신뢰할 수 있는 보안 연결이 설정 됩니다) 또는 신뢰할 수 있는 CA를 찾을 수 없습니다 (게이트웨이에서 게이트웨이를 찾을 수 없습니다. 따라서 백 엔드 서버 인증서에는 루트 및 중간 DC가 모두 포함되어 있는 것이 좋습니다.

- 인증서가 자체 서명되거나 알 수 없는 중개인이 서명한 경우 v2 SKU에서 TLS를 끝까지 종료하려면 신뢰할 수 있는 루트 인증서를 정의해야 합니다. Application Gateway는 해당 서버 인증서의 루트 인증서가 풀과 연결된 백 엔드 http 설정의 신뢰할 수 있는 루트 인증서 목록 중 하나와 일치하는 백 엔드와만 통신합니다.

> [!NOTE] 
>
> 자체 서명된 인증서는 인증서 체인의 일부여야 합니다. 체인이 없는 단일 자체 서명 된 인증서는 V2 SKU에서 지원되지 않습니다.

- 루트 인증서 일치 외에도 응용 프로그램 게이트웨이는 백 엔드 http 설정에 지정된 호스트 설정이 백 엔드 서버의 TLS/SSL 인증서에서 제공하는 CN(일반 이름)의 설정과 일치하는지 여부를 확인합니다. 백 엔드에 대한 TLS 연결을 설정하려고 할 때 응용 프로그램 게이트웨이는 서버 이름 표시(SNI) 확장을 백 엔드 http 설정에 지정된 호스트로 설정합니다.
- 백 엔드 http 설정의 호스트 필드 대신 **백 엔드 주소에서 호스트 이름을 선택하는** 경우 SNI 헤더는 항상 백 엔드 풀 FQDN으로 설정되고 백 엔드 서버 TLS/SSL 인증서의 CN은 FQDN과 일치해야 합니다. 이 시나리오에서는 IP가 있는 백 엔드 풀 멤버가 지원되지 않습니다.
- 루트 인증서는 백 엔드 서버 인증서의 base64 인코딩 루트 인증서입니다.

## <a name="next-steps"></a>다음 단계

종단 간 TLS에 대해 학습한 후 [PowerShell을 사용하여 End to end TLS를 사용하여 응용 프로그램 게이트웨이를 만들어 TLS를 끝까지 구성합니다.](application-gateway-end-to-end-ssl-powershell.md)

<!--Image references-->

[1]: ./media/ssl-overview/scenario.png
