<properties
	pageTitle="J2EE 웹앱 검색, 심사, 진단"
	description="충돌 분석 및 Java 웹 응용 프로그램에서 성능 문제 검색 및 진단"
	authors="alancameronwills"
	services="application-insights"
    documentationCenter=""
	manager="douge"/>

<tags
	ms.service="application-insights"
	ms.workload="tbd"
	ms.tgt_pltfrm="ibiza"
	ms.devlang="na"
	ms.topic="article" 
	ms.date="09/09/2015"
	ms.author="awills"/>

# Application Insights를 사용하여 J2EE 앱 검색, 심사 및 진단

*Application Insights는 미리 보기 상태입니다.*


응용 프로그램을 게시한 후 Application Insights를 사용하면 확인을 실행하고 정상적으로 작동하는지 확인할 수 있습니다. 문제가 있으면 바로 파악하고 이에 대해 어떻게 대처해야 하는지 알고자 합니다.

* *"몇 일 전에 '사소한' 핫픽스가 배포되었습니다. 광범위한 테스트 패스를 실행하지 않았지만 안타깝게도 예기치 못한 변경 사항 일부가 페이로드에 병합되었으며 이는 프런트 엔드 및 백 엔드 사이의 비호환성을 유발합니다. 즉시, 서버 예외 사항이 급증했고 경고가 발생했으며 상황을 인식하도록 했습니다. Application Insights 포털에서 몇 번의 클릭만으로 문제를 줄이기 위해 예외 사항 호출 스택에서 충분한 정보를 얻었습니다. 즉시 롤백하고 손상을 제한했습니다. Application Insights는 DevOps 사이클에서 이 부분을 매우 쉽고 조치할 수 있도록 합니다."*

DevOps 사이클에서 이 부분을 파이프라인으로 생각할 수 있습니다.

![감지-심사-진단](./media/app-insights-detect-triage-diagnose-java/01-pipe1.png)


문제를 진단하면 어디에 초점을 맞추어야 하는지 알게 됩니다(코드를 디버그해야하는지, 더 많은 비용을 할당해야 하는지 또는 종속성이 수반되어야 하는지). 마지막으로 수정한 적이 있는지 확인할 수 있습니다.



![복구-유효성 검사](./media/app-insights-detect-triage-diagnose-java/02-pipe2.png)


Application Insights는 파이프라인의 각 단계에서 동작하는 방법을 살펴보겠습니다.

Application Insights는 장치 앱 및 웹 응용 프로그램에 대해 동작합니다. 이 연습에서는 웹 응용 프로그램에 주안점을 둡니다. 온라인 뱅킹 시스템을 담당하는 Fabrikam 은행의 OBS 팀을 살펴보도록 하겠습니다. [해당 웹 프로젝트에 Application Insights를 추가](app-insights-java-get-started.md)했습니다.


![은행 웹 사이트 예시](./media/app-insights-detect-triage-diagnose-java/03-bank.png)



## 가용성 저하 감지


Marcela Markova는 OBS 팀에서 테스트 전문가이며 온라인 성능 모니터링을 리드합니다. Marcela는 다음과 같이 여러 [웹 테스트][availability]를 설정합니다.

* http://fabrikambank.com/onlinebanking/ 앱의 주 방문 페이지에 대한 단일 URL 테스트. HTTP 코드 200 및 '시작!' 텍스트의 조건을 설정합니다. 이 테스트에 실패하면 네트워크 또는 서버에 심각한 문제가 있거나 배포 문제일 수 있습니다. (또는 누군가 알리지 않고 해당 페이지에서 시작! 메시지를 변경한 것입니다.)


* 각 페이지에서 몇 가지 중요한 세부 정보를 나열하고 확인하는 현재 계정에 로그인하고 가져오는 보다 심화된 다단계 테스트. 이 테스트는 계정 데이터베이스에 대한 링크가 동작하고 있는지 학인합니다. Marcela는 가상 고객 ID를 사용합니다. 이 중 몇 개는 테스트 목적으로 유지 관리됩니다.


이러한 테스트를 설정하여 Marcela는 팀이 가동 중단에 대해 빨리 알게 될 것을 확신할 수 있습니다.


오류는 웹 테스트 개요 차트에 빨간색 점으로 표시됩니다.

![이전 기간에 걸쳐 실행한 웹 테스트 표시](./media/app-insights-detect-triage-diagnose-java/04-webtests.png)


하지만 더 중요한 점은 모든 오류에 대한 경고가 개발팀에 이메일로 전송된다는 것입니다. 이러한 방법으로 팀은 거의 모든 고객보다 먼저 이에 대해 알고 있습니다.


## 성능 메트릭 모니터링


Application Insights의 개요 페이지에는 [주요 메트릭][perf]을 보여주는 차트가 있습니다.

![다양한 메트릭](./media/app-insights-detect-triage-diagnose-java/05-perfMetrics.png)

브라우저 페이지 로드 시간은 웹 페이지에서 직접 전송한 원격 분석에서 파생됩니다. 서버 응답 시간, 서버 요청 수 및 실패한 요청 수는 웹 서버에서 측정되며 여기에서 Application Insights로 전송됩니다.




실패한 요청 수는 사용자가 오류를 본 사례를 나타냅니다(일반적으로 코드에 포함된 예외 사항을 따름). "죄송합니다. 현재 세부 정보를 업데이트할 수 없습니다"라는 메시지를 보거나, 당혹스럽게도 웹 서버로 인해 사용자 화면의 스택 덤프를 볼 수 있습니다.


Marcela는 가끔 이러한 차트를 살펴봅니다. 실패한 요청이 없도록 노력하고 있지만 지난 주를 포함하도록 차트의 범위를 변경하면 가끔 오류가 표시됩니다. 사용 중인 서버에서 허용되는 수준입니다. 하지만 실패 또는 서버 응답 시간과 같은 일부 기타 메트릭에서 갑작스럽게 증가하는 경우, Marcela는 이에 대해 즉시 알고자 합니다. 코드 릴리스 로 인한 예기치 못한 문제 또는 데이터베이스와 같은 종속성에서의 오류를 나타내거나, 부하가 큰 요청에 대해 서툴게 반응할 수 있습니다.


Marcela는 가만히 앉아서 경고를 기다리고 있지는 않습니다. 매든 재배포 후 곧바로 예외 수뿐 아니라 가장 느린 요청의 전체적인 수치 및 표 모두 [응답 시간][perf]을 살펴봅니다.



![응답 시간 그래프 및 서버 응답 시간 표.](./media/app-insights-detect-triage-diagnose-java/09-dependencies.png)

일반적으로 매주 마지막을 비교하여 모든 배포의 성능 효과를 평가할 수 있습니다. 갑작스러운 악화가 있는 경우 관련 개발자와 함께 해당 수치를 높입니다.

종속성, 성능 카운터, 예외, 사용 현황 데이터, 기타 메트릭과 이벤트에 대한 차트도 있습니다.

#### 경고

따라서 Marcela는 두 가지 [경고][metrics]를 설정합니다. 하나는 일반적인 임계값보다 큰 응답 시간을 위한 것이고, 다른 하나는 현재 배경보다 큰 실패한 요청의 비율을 위한 것입니다.


가용성 경고와 함께 이러한 경고를 통해 Marcela는 비정상적인 상황이 발생하자마자 이에 대해 알게 된다는 데에 확신이 생깁니다.


다양한 기타 메트릭에도 경고를 설정할 수 있습니다. 예를들어, 예외 수가 커지너가 사용할 수 있는 메모리가 부족해지거나 클라이언트 요청에서 최고량이 있는 경우에 이메일을 받을 수 있습니다.



![경고 추가 블레이드](./media/app-insights-detect-triage-diagnose-java/07-alerts.png)



## 예외 사항 감지


catch되지 않은 예외는 Application Insights에 자동으로 보고됩니다.


또한 [trackException()](app-insights-api-custom-events-metrics.md#track-exception) 호출을 처리기에 삽입하여 catch하는 예외에 대한 보고서를 보낼 수 있습니다.

``` Java

   TelemetryClient telemetry = new TelemetryClient();
   try {
    ...
   } catch (Exception ex) {
    // Set up some properties:
    Map<String, String> properties = new HashMap<String, String>();
    properties.put("Game", currentGame.getName());

    Map<String, Double> measurements = new HashMap<String, Double>();
    measurements.put("Users", currentGame.getUsers().getCount());

    // Send the exception telemetry:
    telemetry.trackException(ex, properties, measurements);
   }

```



Fabrikam 은행 팀은 명백한 복구가 있는 경우를 제외하고 예외 사항에 대한 원격 분석을 항상 보내는 사례를 발전시켰습니다.

일반적으로 진단에 유용할 수 있는 속성을 연결합니다.

예외 사항 및 이벤트는 [진단 검색][diagnostic] 블레이드에 표시됩니다. 이를 자세히 알아보면 추가 속성 및 스택 추적을 확인할 수 있습니다.

![진단 검색에서 특정 유형의 데이터를 표시하는 필터 사용](./media/app-insights-detect-triage-diagnose-java/appinsights-333facets.png)




## 심사


심사(심각도 및 익스텐트는 문제의 심각도 평가)는 감지 후 첫 번째 단계입니다. 자정에 팀을 호출해야 할까요? 또는 백로그에 손쉽게 액세스할 수 있는 다음 간격까지 기다려도 될까요? 심사에는 몇 가지 핵심적인 질문이 있습니다.


얼마나 일어나고 있나요? 개요 블레이드의 차트는 문제에 대한 일부 관점을 제공합니다. 예를들어 Fabrikam 응용 프로그램이 하룻밤에 4개의 웹 테스트 경고를 생성했습니다. 팀이 아침에 차트를 보면서 여전히 대부분의 테스트가 녹색이지만 일부는 정말 빨간색 점이 있음을 보았습니다. 가용성 차트를 자세히 알아보니 이러한 간헐적인 문제가 모두 한 곳의 테스트 위치에서 발생했음이 명확해졌습니다. 하나의 경로에만 영향을 미치는 명백한 네트워크 문제였으며 저절로 해결될 가능성이 큽니다.


이와 반대로 예외 수 또는 응답 시간 그래프에서 극적이며 안정적인 증가는 명백히 두려워할만한 것입니다.


유용한 심사 방법은 직접 해보기입니다. 동일한 문제를 실행하면 진실을 알 수 있습니다.


사용자의 어느 부분에 영향을 미치나요? 대략적인 답을 얻으려면 실패율을 세션 수로 나눕니다.


![실패한 요청 및 세션 차트](./media/app-insights-detect-triage-diagnose-java/10-failureRate.png)

느린 응답의 경우 가장 느린 응답 요청의 테이블과 각 페이지의 사용 빈도를 비교합니다.


차단된 시나리오는 얼마나 중요한가요? 특정 사용자 이야기를 차단하는 기능적 문제가 있는 경우 큰 문제인가요? 고객이 요금을 지불할 수 없는 경우라면 심각한 문제입니다. 고객이 화면 색상 기본 설정을 변경할 수 없는 경우라면 기다릴 수 있습니다. 이벤트 또는 예외 사항의 세부 정보 또는 느린 페이지의 ID는 고객이 문제를 겪고 있는 위치를 말해 줍니다.


## 진단


진단은 디버깅과 같지는 않습니다. 코드를 통한 추적을 시작하기 전에 문제가 발생하고 있는 이유, 위치 및 시기에 대한 대략적인 개념이 있어야 합니다.


**언제 발생하나요?** 이벤트 및 메트릭 차트에서 제공하는 기록 보기를 통해 가능한 원인과 효과를 쉽게 연관지을 수 있습니다. 응답 시간 또는 예외 속도에 간헐적인 최대치가 있으면 요청 수를 살펴 봅니다. 동시에 최대치로 올라가는 경우 리소스 문제일 수 있습니다. 더 많은 CPU 또는 메모리를 할당해야 하나요? 또는 부하를 관리할 수 없는 종속성인가요?


**원인이 무엇인가요?** 예를들어 고객이 계정서를 원할 때 특정 요청 유형의 성능에서 갑작스러운 하락이 있는 경우, 웹 응용 프로그램보다는 외부 하위 시스템일 가능성이 있습니다. 메트릭 탐색기에서 종속성 실패 비율 및 종속성 기간 비율을 선택하여 감지한 문제가 있는 과거 몇 시간 또는 몇 일에 대한 기록을 비교합니다. 연관된 변경 내용이 있는 경우 외부 하위 시스템 때문일 수 있습니다.


![종속성 오류 및 종속성에 대한 호출 기간 차트](./media/app-insights-detect-triage-diagnose-java/11-dependencies.png)

일부 느린 종속성 문제는 지리적 위치 문제입니다. Fabrikam 은행은 Azure 가상 컴퓨터를 사용하며, 의도치 않게 다른 국가에 웹 서버 및 계정 서버가 있음을 발견했습니다. 그 중 하나를 마이그레이션하여 극적인 개선이 이루어졌습니다.


**무엇을 했나요?** 문제가 종속성에 있는 것으로 나타나지 않고 항상 있지 않는 경우, 최근 변경 내용으로 인한 것일 수 있습니다. 메트릭 및 이벤트 차트에서 제공하는 기록적 관점을 통해 갑작스러운 변경 내용과 배포를 쉽게 연관지을 수 있습니다. 이는 문제에 대한 검색 범위를 좁힙니다.


**무엇이 일어나고 있나요?** 일부 문제가 드물게만 발생하고 오프라인 테스트를 통해서는 추적하기 어려울 수 있습니다. 최대한 할 수 있는 일은 실시간으로 발생할 때 버그를 확보하려고 노력하는 것입니다. 예외 보고서에서 스택 덤프를 점검할 수 있습니다. 또한 자주 사용하는 로깅 프레임워크 또는 trackTrace()나 trackEvent()를 사용하여 추적 호출을 작성할 수 있습니다.


Fabrikam은 계좌 간 이체에 간헐적인 문제가 있었으나 특정 계좌 유형에만 발생하지는 않았습니다. 자세히 이해하기 위해 계좌 유형을 각각의 호출에 속성으로 연결하여 코드에서 주요 포인트로 trackTrace() 호출을 삽입했습니다. 이를 통해 진단 검색에서 해당 추적을 필터링하기 쉬워졌습니다. 또한 속성 및 측정값으로 매개 변수 값을 추적 호출에 연결했습니다.


## 처리


문제를 진단하면 이를 수정하기 위한 계획을 세울 수 있습니다. 최근 변경 내용을 롤백해야 할 수도 있고, 진행하여 수정할 수도 있습니다. 수정이 이루어지면 수정이 성공했는지 Application Insights에서 알려줍니다.


Fabrikam 은행 개발팀은 보다 구조화된 접근법으로 Application Insights를 사용하기 전에 사용했던 측정 방식을 수행합니다.

* Application Insights 개요 페이지에서 특정 측정값을 기준으로 성능 목표를 설정합니다.

* 'funnels.'를 통해 사용자 진행률을 측정하는 메트릭과 같이 시작부터 응용 프로그램에 성능 측정값을 디자인합니다.




## 사용

Application Insights는 사용자가 앱으로 수행할 작업에 대해 알아보는 데 사용할 수도 있습니다. 원활하게 실행되면 팀은 가장 인기 있는 기능, 사용자가 좋아하는 기능 또는 어려워하는 기능 및 다시 방문하는 빈도에 대해 알고자 합니다. 이는 예정된 작업의 우선 순위를 정하는 데 도움이 됩니다. 또한 개발 주기의 일환으로 각 기능의 성공을 측정할 계획을 세울 수 있습니다. [자세히 알아보기][usage].



## 사용자 활동 모니터링

응답 시간이 일관되게 양호하고 예외 사항이 거의 없는 경우, 개발자 팀은 사용자의 환경을 개선하는 방법 및 더 많은 사용자가 원하는 목표를 달성하도록 권장하는 방법에 대해 생각할 수 있습니다.


예를 들어, 웹 사이트를 통한 일반 사용자 여정에는 분명한 '깔때기 양상'이 있습니다. 많은 고객이 다른 유형의 대출 금리에 대해 고려합니다. 그 중 일부 고객은 견적서를 작성하며, 견적서를 받은 사람 중 소수의 고객만 진행하여 대출을 받습니다.

![](./media/app-insights-detect-triage-diagnose-java/12-funnel.png)

빠져나가는 고객의 수가 가장 많은 영역을 고려하면, 깔때기형 차트의 아래쪽을 통해 더 많은 사용자를 받는 방법에 대해 작업할 수 있습니다. 일부의 경우 사용자 환경(UX) 실패일 수 있습니다. 예를 들어, '다음' 단추를 찾기 어렵거나 지침이 분명하지 않습니다. 탈퇴에 가장 중요한 비즈니스 이유는 대출 이율이 너무 높기 때문일 수 있습니다.

어떤 이유이든 데이터는 사용자가 무엇을 사용하고 있는지 아는 데 도움이 됩니다. 추적 호출을 추가로 삽입하여 세부 정보를 확인할 수 있습니다. trackEvent()는 개별적인 단추 클릭의 세부 사항에서 대출금 상환과 같은 중요한 성과에 이르기까지 모든 사용자 동작을 계산하는 데 사용할 수 있습니다.

팀은 사용자 작업에 대한 정보를 가져오는 데 익숙합니다. 오늘날에는 새로운 기능을 디자인할 때마다 사용에 대한 피드백을 받는 방법을 생각합니다. 처음부터 기능으로의 추적 호출을 디자인합니다. 피드백을 사용하여 각 개발 주기로 기능을 향상시킵니다.




## 응용 프로그램

이것이 한 팀이 Application Insights를 사용하여 개별 문제를 수정하는 것이 아니라 개발 수명 주기를 개선한 방법입니다. Application Insights가 자신만의 응용 프로그램 성능을 개선하는 데 어떻게 도움을 줄 수 있는지에 대한 아이디어를 제공했기 바랍니다.

## 비디오

[AZURE.VIDEO performance-monitoring-application-insights]

<!--Link references-->

[api]: app-insights-api-custom-events-metrics.md
[availability]: app-insights-monitor-web-app-availability.md
[diagnostic]: app-insights-diagnostic-search.md
[metrics]: app-insights-metrics-explorer.md
[perf]: app-insights-web-monitor-performance.md
[usage]: app-insights-web-track-usage.md
 

<!---HONumber=Sept15_HO2-->