---
title: Azure의 Oracle 데이터베이스에 대한 참조 아키텍처 | 마이크로 소프트 문서
description: Microsoft Azure 가상 컴퓨터에서 Oracle 데이터베이스 엔터프라이즈 에디션 데이터베이스를 실행하기 위한 아키텍처를 참조합니다.
services: virtual-machines-linux
author: romitgirdhar
manager: gwallace
tags: ''
ms.service: virtual-machines
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 12/13/2019
ms.author: rogirdh
ms.custom: ''
ms.openlocfilehash: 235482f5d44877e5c4e47aed4d7eaf2baea5c3fd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/27/2020
ms.locfileid: "75560337"
---
# <a name="reference-architectures-for-oracle-database-enterprise-edition-on-azure"></a>Azure의 Oracle 데이터베이스 엔터프라이즈 에디션에 대한 참조 아키텍처

이 가이드는 Azure에서 가용성이 높은 Oracle 데이터베이스를 배포하는 방법에 대한 정보를 자세히 설명합니다. 또한 이 가이드에서는 재해 복구 고려 사항에 대해 설명합니다. 이러한 아키텍처는 고객 배포를 기반으로 만들어졌습니다. 이 가이드는 오라클 데이터베이스 엔터프라이즈 에디션에만 적용됩니다.

오라클 데이터베이스의 성능을 극대화하는 방법을 자세히 알아보려면 [오라클 DB 아키텍트(Architect a Oracle DB)를](oracle-design.md)참조하십시오.

## <a name="assumptions"></a>가정

- [가용성 영역과](../../../availability-zones/az-overview.md) 같은 Azure의 다양한 개념을 이해해야 합니다.
- 오라클 데이터베이스 엔터프라이즈 에디션 12c 이상 실행 중
- 이 문서의 솔루션을 사용할 때 라이선스에 미치는 영향을 알고 있으며 이를 인정합니다.

## <a name="high-availability-for-oracle-databases"></a>오라클 데이터베이스를 위한 고가용성

클라우드에서 고가용성을 달성하는 것은 모든 조직의 계획 및 설계에서 중요한 부분입니다. Microsoft Azure는 가용성 영역 및 가용성 집합을 제공합니다(가용성 [영역을](../../../availability-zones/az-overview.md) 사용할 수 없는 지역에서 사용). 클라우드를 위해 설계할 가상 시스템의 가용성 관리에 대해 자세히 [읽어보십시오.](../../../virtual-machines/linux/manage-availability.md)

오라클은 클라우드 네이티브 도구 및 제품 외에도 [오라클 데이터 가드,](https://docs.oracle.com/en/database/oracle/oracle-database/18/sbydb/introduction-to-oracle-data-guard-concepts.html#GUID-5E73667D-4A56-445E-911F-1E99092DD8D7) [FSFO가 있는 데이터 가드,](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/index.html) [샤딩](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/admin/sharding-overview.html)및 Azure에서 설정할 수 있는 [골든게이트와](https://www.oracle.com/middleware/technologies/goldengate.html) 같은 고가용성을 위한 솔루션을 제공합니다. 이 가이드에서는 이러한 각 솔루션에 대한 참조 아키텍처를 다룹니다.

마지막으로 클라우드용 응용 프로그램을 마이그레이션하거나 만들 때 응용 프로그램 코드를 조정하여 [재시도 패턴](https://docs.microsoft.com/azure/architecture/patterns/retry) 및 회로 [차단기 패턴과](https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker)같은 클라우드 네이티브 패턴을 추가하는 것이 중요합니다. [클라우드 디자인 패턴 가이드에](https://docs.microsoft.com/azure/architecture/patterns/) 정의된 추가 패턴은 애플리케이션의 복원력을 높이는 데 도움이 될 수 있습니다.

### <a name="oracle-rac-in-the-cloud"></a>클라우드의 오라클 RAC

오라클 리얼 애플리케이션 클러스터(RAC)는 오라클이 하나의 데이터베이스 스토리지(공유-모든 아키텍처 패턴)에 액세스하는 많은 인스턴스를 통해 고객이 높은 처리량을 달성할 수 있도록 지원하는 솔루션입니다. Oracle RAC는 고가용성 온프레미스에도 사용할 수 있지만, 오라클 RAC만 클라우드에서 고가용성에 사용할 수 없으며 랙 수준 또는 데이터 센터 수준 오류에 대해서가 아니라 인스턴스 수준 오류로부터만 보호합니다. 이러한 이유로 오라클은 고가용성을 위해 오라클 데이터 가드를 데이터베이스(단일 인스턴스 또는 RAC)와 함께 사용하는 것이 좋습니다. 고객은 일반적으로 미션 크리티컬 애플리케이션을 실행하기 위해 높은 SLA를 필요로 합니다. 오라클 RAC는 현재 Azure에서 오라클의 인증 또는 지원을 받지 않습니다. 그러나 Azure는 인스턴스 수준 오류로부터 보호하는 데 도움이 되는 가용성 영역 및 계획된 유지 관리 창을 제공하는 것과 같은 기능을 제공합니다. 이 외에도 고객은 오라클 데이터 가드, 오라클 골든게이트, 오라클 샤딩 과 같은 기술을 사용하여 랙 수준뿐만 아니라 데이터 센터 수준 및 지리적 정치적 오류로부터 데이터베이스를 보호함으로써 고성능 및 리실리언을 사용할 수 있습니다.

오라클 데이터 가드 또는 골든게이트와 함께 여러 [가용성 영역에서](https://docs.microsoft.com/azure/availability-zones/az-overview) 오라클 데이터베이스를 실행할 때 고객은 99.99%의 가동 시간 SLA를 얻을 수 있습니다. 가용성 영역이 아직 없는 Azure 지역에서 고객은 [가용성 집합을](https://docs.microsoft.com/azure/virtual-machines/linux/manage-availability#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy) 사용하고 99.95%의 가동 시간 SLA를 달성할 수 있습니다.

>참고: Microsoft에서 제공하는 가동 시간 SLA보다 훨씬 높은 가동 시간 대상을 가질 수 있습니다.

## <a name="disaster-recovery-for-oracle-databases"></a>오라클 데이터베이스에 대한 재해 복구

클라우드에서 미션 크리티컬 애플리케이션을 호스팅할 때는 고가용성 및 재해 복구를 위해 설계하는 것이 중요합니다.

오라클 데이터베이스 엔터프라이즈 에디션의 경우 오라클 데이터 가드는 재해 복구에 유용한 기능입니다. [페어링된 Azure 지역에서](/azure/best-practices-availability-paired-regions) 대기 데이터베이스 인스턴스를 설정하고 재해 복구를 위해 데이터 가드 장애 조치(Failover)를 설정할 수 있습니다. 데이터 손실이 없는 경우 활성 데이터 가드 외에 Oracle 데이터 가드 Far Sync 인스턴스를 배포하는 것이 좋습니다. 

응용 프로그램에서 대기 시간을 허용하는 경우 Oracle 기본 데이터베이스와 다른 가용성 영역에서 Data Guard Far Sync 인스턴스를 설정하는 것이 좋습니다(철저한 테스트가 필요함). 최대 **가용성** 모드를 사용하여 다시 실행 파일의 동기 전송을 Far Sync 인스턴스로 설정합니다. 그런 다음 이러한 파일은 대기 데이터베이스로 비동기적으로 전송됩니다. 

**최대 가용성** 모드(동기)의 다른 가용성 영역에서 Far Sync 인스턴스를 설정할 때 응용 프로그램에서 성능 손실을 허용하지 않는 경우 기본 데이터베이스와 동일한 가용성 영역에서 Far Sync 인스턴스를 설정할 수 있습니다. 가용성을 추가하려면 기본 데이터베이스에 가까운 여러 Far Sync 인스턴스와 대기 데이터베이스(역할이 전환되는 경우)에 가까운 인스턴스를 하나 이상 설정하는 것이 좋습니다. 이 오라클 액티브 데이터 가드 [파 싱크 백서에서 오라클 데이터](https://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf)가드 파 싱크에 대해 자세히 읽어보십시오.

오라클 스탠다드 에디션 데이터베이스를 사용하는 경우 고가용성 및 재해 복구를 설정할 수 있는 DBVisit 대기와 같은 ISV 솔루션이 있습니다.

## <a name="reference-architectures"></a>참조 아키텍처

### <a name="oracle-data-guard"></a>Oracle 데이터 가드

오라클 데이터 가드는 엔터프라이즈 데이터에 대한 고가용성, 데이터 보호 및 재해 복구를 보장합니다. Data Guard는 대기 데이터베이스를 기본 데이터베이스의 트랜잭션 일관된 복사본으로 유지 관리합니다. 기본 데이터베이스와 보조 데이터베이스 간의 거리와 대기 시간에 대한 응용 프로그램 허용 오차에 따라 동기 또는 비동기 복제를 설정할 수 있습니다. 그런 다음 계획된 또는 계획되지 않은 중단으로 인해 기본 데이터베이스를 사용할 수 없는 경우 Data Guard는 대기 데이터베이스를 기본 역할로 전환하여 가동 중지 시간을 최소화할 수 있습니다. 

Oracle Data Guard를 사용하는 경우 읽기 전용목적으로 보조 데이터베이스를 열 수도 있습니다. 이 구성을 활성 데이터 가드라고 합니다. 오라클 데이터베이스 12c는 데이터 가드 원거리 동기화 인스턴스라는 기능을 도입했다. 이 인스턴스를 사용하면 성능저하 없이 Oracle 데이터베이스의 데이터 손실 제로 구성을 설정할 수 있습니다.

> [!NOTE]
> 활성 데이터 가드에는 추가 라이선스가 필요합니다. 이 라이센스는 Far Sync 기능을 사용하려면 필요합니다. 오라클 담당자에게 연결하여 라이선스에 미치는 영향에 대해 논의하십시오.

#### <a name="oracle-data-guard-with-fsfo"></a>FSFO를 갖춘 오라클 데이터 가드
빠른 시작 장애 조치(FSFO)가 있는 오라클 데이터 가드는 별도의 컴퓨터에 브로커를 설정하여 추가 복원력을 제공할 수 있습니다. 데이터 가드 브로커와 보조 데이터베이스는 모두 관찰자를 실행하고 가동 중지 시간에 대한 기본 데이터베이스를 관찰합니다. 이렇게 하면 데이터 가드 관찰자 설정도 중복됩니다. 

Oracle Database 버전 12.2 이상을 사용하면 단일 Oracle Data Guard 브로커 구성으로 여러 관찰자를 구성할 수도 있습니다. 이 설정은 한 관찰자와 보조 데이터베이스가 가동 중지 시간을 경험하는 경우 추가 가용성을 제공합니다. 데이터 가드 브로커는 가볍고 상대적으로 작은 가상 컴퓨터에서 호스팅 할 수 있습니다. 데이터 가드 브로커와 그 이점에 대해 자세히 알아보려면 이 주제에 대한 [Oracle 설명서를](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/oracle-data-guard-broker-concepts.html) 참조하십시오.

다음 다이어그램은 가용성 영역이 있는 Azure에서 Oracle Data Guard를 사용하는 데 권장되는 아키텍처입니다. 이 아키텍처를 사용하면 99.99%의 VM 가동 시간 SLA를 얻을 수 있습니다.

![데이터 가드 브로커가 있는 가용성 영역을 사용하는 오라클 데이터베이스 - FSFO](./media/oracle-reference-architecture/oracledb_dg_fsfo_az.png)

이전 다이어그램에서 클라이언트 시스템은 웹을 통해 Oracle 백엔드를 사용 하 고 사용자 지정 응용 프로그램에 액세스 합니다. 웹 프런트 엔드는 로드 밸러버로 구성됩니다. 웹 프런트 엔드는 작업을 처리하기 위해 해당 응용 프로그램 서버를 호출합니다. 응용 프로그램 서버는 기본 Oracle 데이터베이스를 쿼리합니다. Oracle 데이터베이스는 라이선스 비용을 절감하고 성능을 최대화하기 위해 제한된 코어 vCPU를 갖춘 하이퍼스레드 [메모리 최적화 가상 머신을](../../../virtual-machines/windows/sizes-memory.md) 사용하여 [구성되었습니다.](../../../virtual-machines/windows/constrained-vcpu.md) 여러 개의 프리미엄 또는 울트라 디스크(관리형 디스크)가 성능 및 고가용성에 사용됩니다.

Oracle 데이터베이스는 고가용성을 위해 여러 가용성 영역에 배치됩니다. 각 영역은 독립적인 전력, 냉각 및 네트워킹이 장착된 하나 이상의 데이터 센터로 구성됩니다. 복원력을 보장하기 위해 모든 사용 가능한 영역에 최소 3개의 별도 영역이 설정됩니다. 지역 내의 가용성 영역을 물리적으로 분리하여 데이터 센터 오류로부터 데이터를 보호합니다. 또한 두 개의 FSFO 관찰자가 두 개의 가용성 영역에 설정되어 정전이 발생할 때 데이터베이스를 보조 로 시작하고 장애 조치합니다. 

이전 아키텍처에 표시된 영역과 다른 가용성 영역(이 경우 AZ 1)에 추가 관찰자 및/또는 대기 데이터베이스를 설정할 수 있습니다. 마지막으로 오라클 데이터베이스는 OEM(오라클 엔터프라이즈 관리자)에 의해 가동 시간 및 성능을 모니터링합니다. OEM을 사용하면 다양한 성능 및 사용 보고서를 생성할 수도 있습니다.

가용성 영역이 지원되지 않는 지역에서는 가용성 집합을 사용하여 가용성을 높여 가용성을 높이 평가할 수 있습니다. 가용성 세트를 사용하면 99.95%의 VM 가동 시간을 달성할 수 있습니다. 다음 다이어그램은 이 사용에 대한 참조 아키텍처입니다.

![데이터 가드 브로커를 사용한 가용성 세트를 사용하는 오라클 데이터베이스 - FSFO](./media/oracle-reference-architecture/oracledb_dg_fsfo_as.png)

> [!NOTE]
> * 오라클 엔터프라이즈 관리자 VM은 배포되는 OEM 인스턴스가 하나뿐이기 때문에 가용성 집합에 배치할 필요가 없습니다.
> * 울트라 디스크는 현재 가용성 집합 구성에서 지원되지 않습니다.

#### <a name="oracle-data-guard-far-sync"></a>오라클 데이터 가드 파 싱크

오라클 데이터 가드 파 싱크는 오라클 데이터베이스에 대한 제로 데이터 손실 보호 기능을 제공합니다. 이 기능을 사용하면 데이터베이스 시스템에 오류가 있을 경우 데이터 손실을 방지할 수 있습니다. 오라클 데이터 가드 파 싱크는 별도의 VM에 설치해야 합니다. Far Sync는 컨트롤 파일, 암호 파일, 스파일 및 대기 로그만 있는 경량 Oracle 인스턴스입니다. 데이터 파일이나 로그 파일이 없습니다. 

데이터 손실 이 없음을 방지하려면 기본 데이터베이스와 Far Sync 인스턴스 간에 동기 통신이 있어야 합니다. Far Sync 인스턴스는 동기 방식으로 주 데이터베이스에서 다시 작업을 수신하고 비동기 방식으로 모든 대기 데이터베이스로 즉시 전달합니다. 이 설정은 모든 대기 데이터베이스가 아닌 Far Sync 인스턴스로 다시 작업을 보내야 하기 때문에 기본 데이터베이스의 오버헤드도 줄어듭니다. Far Sync 인스턴스가 실패하면 Data Guard는 주 데이터베이스에서 보조 데이터베이스로의 비동기 전송을 자동으로 사용하여 거의 제로에 가까운 데이터 손실 보호를 유지합니다. 복원력을 추가하기 위해 고객은 각 데이터베이스 인스턴스(기본 및 보조)당 여러 Far Sync 인스턴스를 배포할 수 있습니다.

다음 다이어그램은 오라클 데이터 가드 파 싱크를 사용하는 고가용성 아키텍처입니다.

![데이터 가드 Far Sync & 브로커가 있는 가용성 영역을 사용하는 오라클 데이터베이스 - FSFO](./media/oracle-reference-architecture/oracledb_dg_fs_az.png)

이전 아키텍처에는 데이터베이스 인스턴스와 동일한 가용성 영역에 배포된 Far Sync 인스턴스가 있어 둘 사이의 대기 시간을 줄입니다. 응용 프로그램이 대기 시간에 민감한 경우 [근접 배치 그룹에](../../../virtual-machines/linux/proximity-placement-groups.md)데이터베이스 및 Far Sync 인스턴스 또는 인스턴스를 배포하는 것이 좋습니다.

다음 다이어그램은 오라클 데이터 가드 FSFO 및 Far Sync를 활용하여 고가용성 및 재해 복구를 달성하는 아키텍처입니다.

![데이터 가드 Far Sync & 브로커를 사용하여 재해 복구를 위한 가용성 영역을 사용하는 오라클 데이터베이스 - FSFO](./media/oracle-reference-architecture/oracledb_dg_fs_az_dr.png)

### <a name="oracle-goldengate"></a>Oracle GoldenGate

GoldenGate는 기업 전체의 여러 이기종 플랫폼 간에 트랜잭션 수준에서 데이터를 교환하고 조작할 수 있도록 합니다. 트랜잭션 무결성과 기존 인프라의 오버헤드를 최소화하여 커밋된 트랜잭션을 이동합니다. 모듈식 아키텍처를 통해 선택한 데이터 레코드, 트랜잭션 변경 및 다양한 토폴로지에서 DDL(데이터 정의 언어)에 대한 변경 사항을 추출하고 복제할 수 있는 유연성을 제공합니다.

Oracle GoldenGate를 사용하면 양방향 복제를 제공하여 고가용성을 위해 데이터베이스를 구성할 수 있습니다. 이렇게 하면 **다중 마스터** 또는 **활성-활성 구성을**설정할 수 있습니다. 다음 다이어그램은 Azure에서 Oracle GoldenGate 활성 활성 설정에 권장되는 아키텍처입니다. 다음 아키텍처에서 Oracle 데이터베이스는 라이선스 비용을 절감하고 성능을 최대화하기 위해 제한된 코어 vCPU를 갖춘 하이퍼스레드 [메모리 최적화 가상 머신을](../../../virtual-machines/windows/sizes-memory.md) 사용하여 [구성되었습니다.](../../../virtual-machines/windows/constrained-vcpu.md) 여러 개의 프리미엄 또는 울트라 디스크(관리형 디스크)가 성능과 가용성에 사용됩니다.

![데이터 가드 브로커가 있는 가용성 영역을 사용하는 오라클 데이터베이스 - FSFO](./media/oracle-reference-architecture/oracledb_gg_az.png)

> [!NOTE]
> 현재 가용성 영역을 사용할 수 없는 지역의 가용성 집합을 사용하여 유사한 아키텍처를 설정할 수 있습니다.

Oracle GoldenGate에는 추출, 펌프 및 복제와 같은 프로세스가 있어 한 Oracle 데이터베이스 서버에서 다른 서버로 데이터를 비동기적으로 복제할 수 있습니다. 이러한 프로세스를 사용하면 양방향 복제를 설정하여 가용성 영역 수준 가동 중지 시간이 있는 경우 데이터베이스의 고가용성을 보장할 수 있습니다. 앞의 다이어그램에서 추출 프로세스는 Oracle 데이터베이스와 동일한 서버에서 실행되는 반면 데이터 펌프 및 복제 프로세스는 동일한 가용성 영역에서 별도의 서버에서 실행됩니다. Replicat 프로세스는 다른 가용성 영역의 데이터베이스에서 데이터를 수신하고 가용성 영역에서 Oracle 데이터베이스에 데이터를 커밋하는 데 사용됩니다. 마찬가지로 데이터 펌프 프로세스는 추출 프로세스에 의해 추출된 데이터를 다른 가용성 영역의 Replicat 프로세스로 보냅니다. 

앞의 아키텍처 다이어그램에는 별도의 서버에서 구성된 데이터 펌프 및 복제 프로세스를 보여 주지만 서버의 용량및 사용량에 따라 동일한 서버에서 모든 Oracle GoldenGate 프로세스를 설정할 수 있습니다. 서버의 사용 패턴을 이해하려면 항상 AWR 보고서 및 Azure의 메트릭을 참조하십시오.

Oracle GoldenGate 양방향 복제를 서로 다른 가용성 영역 또는 다른 지역에서 설정할 때는 다른 구성 요소 간의 대기 시간이 응용 프로그램에 허용되는지 확인하는 것이 중요합니다. 가용성 영역과 지역 간의 대기 시간은 다를 수 있으며 여러 요인에 따라 다릅니다. 응용 프로그램 성능 요구 사항을 충족하는지 확인하려면 다양한 가용성 영역 및/또는 지역에서 응용 프로그램 계층과 데이터베이스 계층 간에 성능 테스트를 설정하는 것이 좋습니다.

응용 프로그램 계층은 자체 서브넷에서 설정할 수 있으며 데이터베이스 계층은 자체 서브넷으로 분리될 수 있습니다. 가능하면 Azure [응용 프로그램 게이트웨이를](../../../application-gateway/overview.md) 사용하여 응용 프로그램 서버 간의 트래픽을 로드조정하는 것이 좋습니다. Azure 응용 프로그램 게이트웨이는 강력한 웹 트래픽 로드 밸러서입니다. 동일한 서버에 사용자 세션을 유지 하므로 데이터베이스의 충돌을 최소화 하는 쿠키 기반 세션 선호도를 제공 합니다. 응용 프로그램 게이트웨이에 대한 대안은 [Azure 로드 밸러터](../../../load-balancer/load-balancer-overview.md) 및 [Azure 트래픽 관리자입니다.](../../../traffic-manager/traffic-manager-overview.md)

### <a name="oracle-sharding"></a>오라클 샤딩

샤딩은 Oracle 12.2에서 도입된 데이터 계층 패턴입니다. 이를 통해 독립적인 데이터베이스에서 데이터를 가로로 분할하고 확장할 수 있습니다. 각 데이터베이스가 전용 가상 머신에서 호스팅되는 공유-무-아키텍처로, 복원력 및 가용성 향상 외에도 높은 읽기 및 쓰기 처리량을 가능하게 합니다. 이 패턴은 단일 고장 지점을 제거하고, 고장 격리를 제공하며, 가동 중지 시간 없이 롤링 업그레이드를 가능하게 합니다. 한 샤드 또는 데이터 센터 수준 오류의 가동 중지 시간은 다른 데이터 센터의 다른 샤드의 성능이나 가용성에 영향을 주지 않습니다. 

샤딩은 가동 중지 시간을 감당할 수 없는 높은 처리량 OLTP 애플리케이션에 적합합니다. 샤딩 키가 동일한 모든 행은 항상 동일한 샤드에 있어야 하므로 높은 일관성을 제공하는 성능이 향상됩니다. 샤딩을 사용하는 응용 프로그램에는 샤딩 키(예: *customerId* 또는 *accountNum)를*사용하여 주로 데이터에 액세스하는 잘 정의된 데이터 모델 및 데이터 배포 전략(일관된 해시, 범위, 목록 또는 복합)이 있어야 합니다. 또한 샤딩을 사용하면 특정 데이터 집합을 최종 고객에게 더 가깝게 저장할 수 있으므로 성능 및 규정 준수 요구 사항을 충족할 수 있습니다.

고가용성 및 재해 복구를 위해 샤드를 복제하는 것이 좋습니다. 이 설정은 오라클 데이터 가드 또는 오라클 골든게이트와 같은 오라클 기술을 사용하여 수행할 수 있습니다. 복제 단위는 샤드, 샤드의 일부 또는 샤드 그룹일 수 있습니다. 샤드 데이터베이스의 가용성은 하나 이상의 샤드의 중단 또는 속도 저하의 영향을 받지 않습니다. 고가용성의 경우 대기 샤드는 기본 샤드가 배치된 동일한 가용성 영역에 배치할 수 있습니다. 재해 복구의 경우 대기 샤드는 다른 지역에 위치할 수 있습니다. 샤드를 여러 지역에 배포하여 해당 지역의 트래픽을 제공할 수도 있습니다. [Oracle Sharding 설명서에서](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-high-availability.html)샤드 데이터베이스의 고가용성 및 복제 를 구성하는 것에 대해 자세히 알아보십시오.

오라클 샤딩은 주로 다음 구성 요소로 구성됩니다. 이러한 구성 요소에 대한 자세한 내용은 [Oracle 샤딩 설명서에서](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html)확인할 수 있습니다.

- **샤드 카탈로그** - 모든 샤드 데이터베이스 구성 데이터에 대한 영구 저장소인 특수 목적 Oracle 데이터베이스입니다. 샤드 카탈로그의 샤드 추가 또는 제거, 데이터 매핑 및 DDL과 같은 모든 구성 변경이 시작됩니다. 샤드 카탈로그에는 SDB에 중복된 모든 테이블의 마스터 복사본도 포함되어 있습니다. 

  샤드 카탈로그는 구체화된 뷰를 사용하여 모든 샤드에서 중복된 테이블에 변경 내용을 자동으로 복제합니다. 샤드 카탈로그 데이터베이스는 샤딩 키를 지정하지 않는 다중 샤드 쿼리 및 쿼리를 처리하는 데 사용되는 쿼리 코디네이터의 역할도 합니다. 
  
  샤드 카탈로그 고가용성을 위한 가용성 영역 또는 가용성 세트와 함께 Oracle Data Guard를 사용하는 것이 권장되는 모범 사례입니다. 샤드 카탈로그의 가용성은 샤드 데이터베이스의 가용성에 영향을 미치지 않습니다. 샤드 카탈로그의 가동 중지 시간은 데이터 가드 장애 조치(Failover)가 완료되는 짧은 기간 동안유지 관리 작업 및 다중 하드 쿼리에만 영향을 줍니다. 온라인 트랜잭션은 SDB에서 계속 라우팅및 실행되며 카탈로그 중단의 영향을 받지 않습니다.

- **샤드 디렉터** - 샤드가 상주하는 각 지역/가용성 영역에 배포해야 하는 경량 서비스입니다. 샤드 디렉터는 오라클 샤딩의 맥락에서 배포된 글로벌 서비스 관리자입니다. 고가용성의 경우 샤드가 존재하는 각 가용성 영역에 하나 이상의 샤드 디렉터를 배포하는 것이 좋습니다. 

  처음에 데이터베이스에 연결할 때 라우팅 정보는 샤드 디렉터에 의해 설정되고 샤드 디렉터를 우회하여 후속 요청에 대해 캐시됩니다. 세션이 샤드로 설정되면 모든 SQL 쿼리 및 DM이 지원되고 지정된 샤드의 범위에서 실행됩니다. 이 라우팅은 빠르며 샤드 내 트랜잭션을 수행하는 모든 OLTP 워크로드에 사용됩니다. 최고의 성능과 가용성이 필요한 모든 OLTP 워크로드에 직접 라우팅을 사용하는 것이 좋습니다. 샤드를 사용할 수 없거나 샤딩 토폴로지가 변경되면 라우팅 캐시가 자동으로 새로 고쳐집니다. 
  
  데이터 종속 적인 고성능 라우팅의 경우 오라클은 샤드 데이터베이스의 데이터에 액세스할 때 연결 풀을 사용하는 것이 좋습니다. 오라클 연결 풀, 언어별 라이브러리 및 드라이버는 오라클 샤딩을 지원합니다. 자세한 내용은 [오라클 샤딩 문서를](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html#GUID-3D41F762-BE04-486D-8018-C7A210D809F9) 참조하십시오.

- **전역 서비스** - 글로벌 서비스는 일반 데이터베이스 서비스와 유사합니다. 전역 서비스에는 데이터베이스 서비스의 모든 속성 외에도 클라이언트와 샤드 및 복제 지연 허용 오차 간의 지역 선호도와 같은 샤드 데이터베이스의 속성이 있습니다. 샤드 데이터베이스에서 데이터를 읽고/쓰려면 하나의 전역 서비스만 만들어야 합니다. 활성 데이터 가드를 사용하고 샤드의 읽기 전용 복제본을 설정할 때 읽기 전용 워크로드에 대해 다른 gGobal 서비스를 만들 수 있습니다. 클라이언트는 이러한 글로벌 서비스를 사용하여 데이터베이스에 연결할 수 있습니다.

- **샤드 데이터베이스** - 샤드 데이터베이스는 오라클 데이터베이스입니다. 각 데이터베이스는 빠른 시작 장애 조치(FSFO)가 활성화된 브로커 구성에서 Oracle Data Guard를 사용하여 복제됩니다. 각 샤드에 데이터 가드 장애 조치 및 복제를 설정할 필요가 없습니다. 공유 데이터베이스를 만들 때 자동으로 구성되고 배포됩니다. 특정 샤드가 실패하면 Oracle Sharing은 기본 에서 대기로의 데이터베이스 연결을 통해 자동으로 실패합니다.

오라클 엔터프라이즈 관리자 클라우드 제어 GUI 및/또는 `GDSCTL` 명령줄 유틸리티의 두 가지 인터페이스를 사용하여 오라클 샤드 데이터베이스를 배포하고 관리할 수 있습니다. 클라우드 제어를 사용하여 다양한 샤드를 모니터링하여 가용성과 성능을 확인할 수도 있습니다. 명령은 `GDSCTL DEPLOY` 샤드와 해당 리스너를 자동으로 만듭니다. 또한 이 명령은 관리자가 지정한 샤드 수준 고가용성에 사용되는 복제 구성을 자동으로 배포합니다.

데이터베이스를 조각하는 방법에는 여러 가지가 있습니다.

* 시스템 관리 샤딩 - 분할을 사용하여 샤드 간에 자동으로 분산
* 사용자 정의 샤딩 - 규정 또는 데이터 지역화 요구 사항이 있을 때 잘 작동하는 샤드에 데이터를 매핑할 수 있습니다.
* 복합 샤딩 - 서로 다른 _샤드스페이스에_ 대해 시스템 관리 및 사용자 정의 샤딩조합
* 테이블 하위 파티션 - 일반 분할 된 테이블과 유사합니다.

오라클 설명서에서 다양한 [샤딩 방법에](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-methods.html) 대해 자세히 읽어보십시오.

샤드 데이터베이스는 단일 데이터베이스처럼 보일 수 있지만, 샤드되지 않은 데이터베이스에서 샤드된 데이터베이스로 마이그레이션할 때는 샤드와 샤드된 테이블을 복제할 테이블을 결정하는 데 신중한 계획이 필요합니다. 

중복된 테이블은 모든 샤드에 저장되지만 샤드 테이블은 다른 샤드에 분산됩니다. 작은 차원의 테이블을 복제하고 팩트 테이블을 배포/분할하는 것이 좋습니다. 샤드 카탈로그를 중앙 코디네이터로 사용하거나 각 샤드에서 데이터 펌프를 실행하여 샤드 데이터베이스에 데이터를 로드할 수 있습니다. 오라클 설명서에서 [데이터를 샤드 데이터베이스로 마이그레이션하는](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-loading-data.html) 것에 대해 자세히 읽어보십시오.

#### <a name="oracle-sharding-with-data-guard"></a>데이터 가드를 가진 오라클 샤딩

Oracle Data Guard는 시스템 관리, 사용자 정의 및 복합 샤딩 방법으로 샤딩에 사용할 수 있습니다.

다음 다이어그램은 각 샤드의 고가용성에 사용되는 오라클 데이터 가드를 사용하는 오라클 샤딩에 대한 참조 아키텍처입니다. 아키텍처 다이어그램에는 _복합 샤딩 방법을_보여 주습니다. 아키텍처 다이어그램은 데이터 지역성, 부하 분산, 고가용성, 재해 복구 등에 대한 요구 사항이 다른 응용 프로그램에 따라 다를 수 있으며 샤딩에 대해 다른 방법을 사용할 수 있습니다. Oracle Sharding을 사용하면 이러한 옵션을 제공하여 이러한 요구 사항을 충족하고 수평적이고 효율적으로 확장할 수 있습니다. 오라클 골든게이트를 사용하여 유사한 아키텍처를 배포할 수도 있습니다.

![데이터 가드 브로커와 가용성 영역을 사용하여 오라클 데이터베이스 샤딩 - FSFO](./media/oracle-reference-architecture/oracledb_dg_sh_az.png)

시스템 관리 샤딩을 구성하고 관리하는 것이 가장 쉽지만, 사용자 정의 샤딩 또는 복합 샤딩은 데이터와 응용 프로그램이 지리적으로 분산되어 있거나 복제를 제어해야 하는 시나리오에 적합합니다. 각 샤드의 

앞의 아키텍처에서는 복합 샤딩을 사용하여 데이터를 지리적으로 분산하고 응용 프로그램 계층을 수평으로 확장합니다. 복합 샤딩은 시스템 관리 및 사용자 정의 샤딩의 조합이므로 두 방법의 이점을 제공합니다. 앞의 시나리오에서 데이터는 먼저 지역별로 구분된 여러 샤드스페이스에 분산되어 있습니다. 그런 다음 샤드스페이스의 여러 샤드에 걸쳐 일관된 해시로 데이터가 더 분할됩니다. 각 샤드스페이스에는 여러 샤드 그룹이 포함되어 있습니다. 각 샤드 그룹에는 여러 샤드가 있으며 이 경우 복제의 "단위"입니다. 각 샤드 그룹에는 샤드스페이스의 모든 데이터가 포함됩니다. 샤드그룹 A1과 B1은 기본 샤드 그룹이며 샤드그룹 A2및 B2는 대기 그룹입니다. 개별 샤드를 샤드 그룹이 아닌 복제 단위로 선택할 수 있습니다.

이전 아키텍처에서는 고가용성을 위해 모든 가용성 영역에 GSM/샤드 디렉터가 배포됩니다. 데이터 센터/리전당 최소 한 명의 GSM/샤드 디렉터를 배포하는 것이 좋습니다. 또한 응용 프로그램 서버의 인스턴스는 샤드 그룹을 포함하는 모든 가용성 영역에 배포됩니다. 이 설정을 사용하면 응용 프로그램이 응용 프로그램 서버와 데이터베이스/샤드 그룹 간의 대기 시간을 낮게 유지할 수 있습니다. 데이터베이스에 오류가 발생하면 대기 데이터베이스와 동일한 영역에 있는 응용 프로그램 서버는 데이터베이스 역할 전환이 발생하면 요청을 처리할 수 있습니다. Azure 응용 프로그램 게이트웨이 및 샤드 디렉터는 요청 및 응답 대기 시간을 추적하고 그에 따라 요청을 라우팅합니다.

응용 프로그램 관점에서 클라이언트 시스템은 Azure 응용 프로그램 게이트웨이(또는 Azure의 다른 로드 밸런싱 기술)에 요청을 하여 요청을 클라이언트에 가장 가까운 지역으로 리디렉션합니다. 또한 Azure Application Gateway는 고정 세션을 지원하므로 동일한 클라이언트에서 오는 모든 요청이 동일한 응용 프로그램 서버로 라우팅됩니다. 응용 프로그램 서버는 데이터 액세스 드라이버의 연결 풀링을 사용합니다. 이 기능은 JDBC, ODP.NET, OCI 등과 같은 드라이버에서 사용할 수 있습니다. 드라이버는 요청의 일부로 지정된 샤딩 키를 인식할 수 있습니다. JDBC 고객을 위한 [오라클 유니버설 커넥션 풀(UCP)을](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jjucp/ucp-database-sharding-overview.html) 사용하면 아파치 톰캣 및 IIS와 같은 비오라클 애플리케이션 클라이언트가 오라클 샤딩과 함께 작업할 수 있습니다. 

초기 요청 중에 응용 프로그램 서버는 해당 지역의 샤드 디렉터에 연결하여 요청을 라우팅해야 하는 샤드에 대한 라우팅 정보를 가져옵니다. 전달된 샤딩 키에 따라 디렉터는 응용 프로그램 서버를 각 샤드로 라우팅합니다. 응용 프로그램 서버는 맵을 작성하여 이 정보를 캐시하고 후속 요청에 대해 샤드 디렉터를 우회하고 요청을 샤드로 바로 라우팅합니다.

#### <a name="oracle-sharding-with-goldengate"></a>골든게이트를 곁들인 오라클 샤딩

다음 다이어그램은 오라클 골든게이트와 함께 각 샤드의 지역 내 고가용성을 위한 오라클 샤딩에 대한 참조 아키텍처입니다. 이전 아키텍처와 달리 이 아키텍처는 단일 Azure 영역(다중 가용성 영역) 내에서만 고가용성을 묘사합니다. 오라클 골든게이트를 사용하여 다중 지역 고가용성 샤드 데이터베이스(앞의 예와 유사)를 배포할 수 있습니다.

![골든게이트를 사용한 가용성 영역을 사용하는 오라클 데이터베이스 샤딩](./media/oracle-reference-architecture/oracledb_gg_sh_az.png)

앞의 참조 아키텍처에서는 _시스템에서 관리하는_ 샤딩 방법을 사용하여 데이터를 샤드합니다. Oracle GoldenGate 복제는 청크 수준에서 수행되므로 한 샤드에 복제된 데이터의 절반을 다른 샤드로 복제할 수 있습니다. 나머지 절반은 다른 샤드로 복제할 수 있습니다. 

데이터가 복제되는 방식은 복제 계수에 따라 다릅니다. 복제 계수가 2이면 샤드 그룹의 세 샤드에 걸쳐 각 데이터 청크의 복사본이 두 개 있습니다. 마찬가지로 샤드 그룹에 3개 및 3개의 샤드의 복제 계수가 있는 경우 각 샤드의 모든 데이터가 샤드 그룹의 다른 모든 샤드에 복제됩니다. 샤드 그룹의 각 샤드는 다른 복제 계수를 가질 수 있습니다. 이 설정을 사용하면 샤드 그룹 내에서 여러 샤드 그룹 내에서 그리고 여러 샤드 그룹에서 고가용성 및 재해 복구 설계를 효율적으로 정의할 수 있습니다.

앞의 아키텍처에서 샤드 그룹 A와 샤드 그룹 B는 모두 동일한 데이터를 포함하지만 가용성 영역이 서로 다른 영역에 있습니다. 샤드 그룹 A와 샤드 그룹 B의 복제 계수가 모두 3인 경우 샤드 테이블의 각 행/청크는 두 샤드 그룹에서 6번 복제됩니다. 샤드 그룹 A의 복제 계수가 3이고 샤드 그룹 B에 복제 계수가 2인 경우 각 행/청크는 두 샤드 그룹에서 5번 복제됩니다.

이 설정은 인스턴스 수준 또는 가용성 영역 수준 오류가 발생하는 경우 데이터 손실을 방지합니다. 응용 프로그램 계층에서 읽고 각 샤드에 쓸 수 있습니다. 충돌을 최소화하기 위해 Oracle Sharding은 각 해시 값 범위에 대해 "마스터 청크"를 지정합니다. 이 기능을 사용하면 특정 청크에 대한 쓰기 요청이 해당 청크로 전달됩니다. 또한 Oracle GoldenGate는 발생할 수 있는 모든 충돌을 처리하기 위해 자동 충돌 감지 및 해결 방법을 제공합니다. 오라클 샤딩을 통해 골든게이트를 구현하는 방법에 대한 자세한 정보 및 제한 사항은 [오라클 골든게이트를 샤드 데이터베이스와 함께](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-high-availability.html#GUID-4FC0AC46-0B8B-4670-BBE4-052228492C72)사용하는 방법에 대한 오라클의 설명서를 참조하십시오.

이전 아키텍처에서는 고가용성을 위해 모든 가용성 영역에 GSM/샤드 디렉터가 배포됩니다. 데이터 센터 또는 지역당 최소 한 개의 GSM/샤드 디렉터를 배포하는 것이 좋습니다. 또한 응용 프로그램 서버의 인스턴스는 샤드 그룹을 포함하는 모든 가용성 영역에 배포됩니다. 이 설정을 사용하면 응용 프로그램이 응용 프로그램 서버와 데이터베이스/샤드 그룹 간의 대기 시간을 낮게 유지할 수 있습니다. 데이터베이스에 오류가 발생하면 대기 데이터베이스와 동일한 영역에 있는 응용 프로그램 서버는 데이터베이스 역할이 전환되면 요청을 처리할 수 있습니다. Azure 응용 프로그램 게이트웨이 및 샤드 디렉터는 요청 및 응답 대기 시간을 추적하고 그에 따라 요청을 라우팅합니다.

응용 프로그램 관점에서 클라이언트 시스템은 Azure 응용 프로그램 게이트웨이(또는 Azure의 다른 로드 밸런싱 기술)에 요청을 하여 요청을 클라이언트에 가장 가까운 지역으로 리디렉션합니다. 또한 Azure Application Gateway는 고정 세션을 지원하므로 동일한 클라이언트에서 오는 모든 요청이 동일한 응용 프로그램 서버로 라우팅됩니다. 응용 프로그램 서버는 데이터 액세스 드라이버의 연결 풀링을 사용합니다. 이 기능은 JDBC, ODP.NET, OCI 등과 같은 드라이버에서 사용할 수 있습니다. 드라이버는 요청의 일부로 지정된 샤딩 키를 인식할 수 있습니다. JDBC 고객을 위한 [오라클 유니버설 커넥션 풀(UCP)을](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jjucp/ucp-database-sharding-overview.html) 사용하면 아파치 톰캣 및 IIS와 같은 비오라클 애플리케이션 클라이언트가 오라클 샤딩과 함께 작업할 수 있습니다. 

초기 요청 중에 응용 프로그램 서버는 해당 지역의 샤드 디렉터에 연결하여 요청을 라우팅해야 하는 샤드에 대한 라우팅 정보를 가져옵니다. 전달된 샤딩 키에 따라 디렉터는 응용 프로그램 서버를 각 샤드로 라우팅합니다. 응용 프로그램 서버는 맵을 작성하여 이 정보를 캐시하고 후속 요청에 대해 샤드 디렉터를 우회하고 요청을 샤드로 바로 라우팅합니다.

## <a name="patching-and-maintenance"></a>패치 및 유지 보수

Oracle 워크로드를 Azure에 배포할 때 Microsoft는 모든 호스트 OS 수준 패치를 처리합니다. 계획된 OS 수준 유지 관리는 고객이 이 계획된 유지 관리를 위해 고객에게 미리 전달됩니다. 서로 다른 두 가용성 영역의 두 서버는 동시에 패치되지 않습니다. VM 유지 관리 및 패치에 대한 자세한 내용은 [가상 시스템의 가용성 관리를](../../../virtual-machines/linux/manage-availability.md) 참조하십시오. 

[Azure 자동화를](../../../automation/automation-tutorial-update-management.md)사용하여 가상 시스템 운영 체제를 패치하는 것을 자동화할 수 있습니다. Azure 파이프라인 또는 [Azure 자동화를](../../../automation/automation-tutorial-update-management.md) 사용하여 Oracle 데이터베이스를 패치하고 유지 관리하여 가동 중지 시간을 최소화할 수 [있습니다.](/azure/devops/pipelines/get-started/what-is-azure-pipelines?view=azure-devops) [지속적인 제공 및 블루/그린 배포를](/azure/devops/learn/what-is-continuous-delivery) 참조하여 오라클 데이터베이스의 컨텍스트에서 어떻게 사용할 수 있는지 알아보십시오.

## <a name="architecture-and-design-considerations"></a>아키텍처 및 설계 고려 사항

- Oracle Database VM에 제한된 [코어 vCPU가](../../../virtual-machines/windows/constrained-vcpu.md) 있는 하이퍼스레드 [메모리 최적화 가상 머신을](../../../virtual-machines/windows/sizes-memory.md) 사용하여 라이선싱 비용을 절감하고 성능을 극대화하는 것이 좋습니다. 성능과 가용성을 위해 여러 프리미엄 또는 울트라 디스크(관리디스크)를 사용합니다.
- 관리 디스크를 사용하는 경우 재부팅 시 디스크/장치 이름이 변경될 수 있습니다. 이름 대신 장치 UUID를 사용하여 마운트가 재부팅 될 때 계속 유지되도록하는 것이 좋습니다. 자세한 내용은 [여기](../../../virtual-machines/linux/configure-raid.md#add-the-new-file-system-to-etcfstab)를 참조하세요.
- 가용성 영역을 사용하여 지역에서 고가용성을 달성합니다.
- Oracle 데이터베이스에 울트라 디스크(사용 가능한 경우) 또는 프리미엄 디스크를 사용하는 것이 좋습니다.
- Oracle 데이터 가드를 사용하여 다른 Azure 지역에서 대기 오라클 데이터베이스를 설정하는 것이 좋습니다.
- 근접 [배치 그룹을](../../../virtual-machines/linux/co-location.md#proximity-placement-groups) 사용하여 응용 프로그램과 데이터베이스 계층 간의 대기 시간을 줄이는 것이 좋습니다.
- 관리, 모니터링 및 로깅을 위해 [Oracle 엔터프라이즈 관리자를](https://docs.oracle.com/en/enterprise-manager/) 설정합니다.
- 데이터베이스에 대한 간소화된 스토리지 관리를 위해 오라클 자동 스토리지 관리(ASM)를 사용하는 것이 좋습니다.
- [Azure 파이프라인을](/azure/devops/pipelines/get-started/what-is-azure-pipelines) 사용하여 가동 중지 시간 없이 데이터베이스에 대한 패치 및 업데이트를 관리할 수 있습니다.
- 응용 프로그램 코드를 조정하여 [재시도 패턴,](/azure/architecture/patterns/retry) [회로 차단기 패턴](/azure/architecture/patterns/circuit-breaker)및 클라우드 [디자인 패턴 가이드에](/azure/architecture/patterns/) 정의된 기타 패턴과 같은 클라우드 네이티브 패턴을 추가하여 응용 프로그램의 복원력을 높일 수 있습니다.

## <a name="next-steps"></a>다음 단계

시나리오에 적용되는 다음 Oracle 참조 문서를 검토합니다.

- [오라클 데이터 가드 소개](https://docs.oracle.com/en/database/oracle/oracle-database/18/sbydb/introduction-to-oracle-data-guard-concepts.html#GUID-5E73667D-4A56-445E-911F-1E99092DD8D7)
- [오라클 데이터 가드 브로커 개념](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/oracle-data-guard-broker-concepts.html)
- [액티브-액티브 고가용성을 위한 오라클 골든게이트 구성](https://docs.oracle.com/goldengate/1212/gg-winux/GWUAD/wu_bidirectional.htm#GWUAD282)
- [오라클 샤딩 개요](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html)
- [오라클 액티브 데이터 가드 원거리 동기화 제로 데이터 손실](https://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf)
