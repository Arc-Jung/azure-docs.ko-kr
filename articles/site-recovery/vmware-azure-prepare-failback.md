---
title: Azure 사이트 복구를 통해 VMware VM을 다시 보호 및 장애 복구할 수 있습니다.
description: Azure 사이트 복구를 사용 하 여 장애 조치 후 VM웨어 VM의 장애 복구 에 대비
ms.topic: conceptual
ms.date: 12/24/2019
ms.openlocfilehash: 5a330f8cba31640d0116ca3d5ccab352ce5b3509
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "79257187"
---
# <a name="prepare-for-reprotection-and-failback-of-vmware-vms"></a>VMware VM의 재보호 및 장애 조치 준비

온-프레미스 VM 또는 Azure에 대한 물리적 서버의 [장애 조치](site-recovery-failover.md) 후 장애 조치 후 생성된 Azure VM을 다시 보호하여 온-프레미스 사이트로 다시 복제합니다. Azure에서 온-프레미스로 의 복제를 사용하면 준비가 되면 Azure에서 온-프레미스로 장애 조치(failover)를 실행하여 장애 복구를 수행할 수 있습니다.

계속하기 전에 Azure에서 온-프레미스 사이트로 장애 조치하는 방법에 대한 이 비디오에서 간략한 개요를 얻을 수 있습니다.<br /><br />
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video5-Failback-from-Azure-to-On-premises/player]

## <a name="reprotectionfailback-components"></a>재보호/장애 조치 구성 요소

Azure에서 다시 보호하고 장애 조치하기 전에 여러 구성 요소 및 설정이 필요합니다.

**구성 요소**| **세부 정보**
--- | ---
**온-프레미스 구성 서버** | 온-프레미스 구성 서버가 실행중이고 Azure에 연결되어 있어야 합니다.<br/><br/> 실패한 VM은 구성 서버 데이터베이스에 있어야 합니다. 재해가 구성 서버에 영향을 주는 경우 장애 복구가 작동하는지 확인하기 위해 동일한 IP 주소로 복원합니다.<br/><br/>  복제된 컴퓨터의 IP 주소가 장애 조치(failover)에서 유지된 경우 Azure VM 컴퓨터와 구성 서버의 장애 복구 NIC 간에 사이트 간 연결(또는 ExpressRoute 연결)을 설정해야 합니다. 유지된 IP 주소의 경우 구성 서버에는 소스 컴퓨터 연결용 및 Azure 장애 복구 연결에 대한 NIC 두 개가 필요합니다. 이렇게 하면 원본에 대한 서브넷 주소 범위가 겹치지 못하고 VM에 실패할 수 있습니다.
**Azure의 서버 프로세스** | 온-프레미스 사이트로 장애 조치(fail@son)로 돌아가려면 Azure의 프로세스 서버가 필요합니다.<br/><br/> 프로세스 서버는 보호된 Azure VM에서 데이터를 수신하고 온-프레미스 사이트로 보냅니다.<br/><br/> 프로세스 서버와 보호된 VM 간에 대기 시간이 짧은 네트워크가 필요하므로 복제 성능을 높이기 위해 프로세스 서버를 Azure에 배포하는 것이 좋습니다.<br/><br/> 개념 증명을 위해 온-프레미스 프로세스 서버 및 개인 피어링이 있는 ExpressRoute를 사용할 수 있습니다.<br/><br/> 프로세스 서버는 VM을 통해 실패한 Azure 네트워크에 있어야 합니다. 프로세스 서버는 온-프레미스 구성 서버 및 마스터 대상 서버와통신할 수 있어야 합니다.
**별도의 마스터 대상 서버** | 마스터 대상 서버는 장애 조치 데이터를 수신하며 기본적으로 Windows 마스터 대상 서버는 온-프레미스 구성 서버에서 실행됩니다.<br/><br/> 마스터 대상 서버에는 최대 60개의 디스크가 연결될 수 있습니다. 실패한 VM에는 총 60개 이상의 디스크가 있거나 대량의 트래픽을 다시 실패하는 경우 장애 복구를 위해 별도의 마스터 대상 서버를 만듭니다.<br/><br/> 다중 VM 일관성을 위해 컴퓨터가 복제 그룹으로 수집되는 경우 VM은 모두 Windows이거나 모두 Linux여야 합니다. 그 이유는 복제 그룹의 모든 VM은 동일한 마스터 대상 서버를 사용해야 하며 마스터 대상 서버는 복제된 컴퓨터의 것과 동일한 운영 체제(동일하거나 더 높은 버전)를 가져야 합니다.<br/><br/> 마스터 대상 서버에는 디스크에 스냅숏이 없어야 하며, 그렇지 않으면 다시 보호 및 장애 복구가 작동하지 않습니다.<br/><br/> 마스터 대상에는 Paravirtual SCSI 컨트롤러가 있을 수 없습니다. 컨트롤러는 LSI Logic 컨트롤러 일 수 있습니다. LSI Logic 컨트롤러가 없으면 다시 보호가 실패합니다.
**장애 조치 복제 정책** | 온-프레미스 사이트로 다시 복제하려면 장애 조치 정책이 필요합니다. 이 정책은 Azure에 복제 정책을 만들 때 자동으로 만들어집니다.<br/><br/> 정책은 구성 서버와 자동으로 연결됩니다. RPO 임계값은 15분, 복구 지점 보존시간은 24시간, 앱 일관된 스냅숏 빈도는 60분으로 설정됩니다. 정책을 편집할 수 없습니다. 
**사이트 간 VPN/익스프레스루트 프라이빗 피어링** | 다시 보호 및 장애 조치(failback)에는 사이트 간 VPN 연결 또는 데이터를 복제하기 위해 ExpressRoute 개인 피어링이 필요합니다. 


## <a name="ports-for-reprotectionfailback"></a>다시 보호/장애 조치용 포트

다시 보호/장애 조치(failback)를 위해 여러 포트를 열어야 합니다. 다음 그래픽은 포트 및 다시 보호/장애 해제 흐름을 보여 줍니다.

![장애 조치 및 장애 복구용 포트](./media/vmware-azure-reprotect/failover-failback.png)


## <a name="deploy-a-process-server-in-azure"></a>Azure에서 프로세스 서버 배포

1. 장애 복구를 위해 Azure에서 [프로세스 서버를 설정합니다.](vmware-azure-set-up-process-server-azure.md)
2. Azure VM이 프로세스 서버에 연결할 수 있는지 확인합니다. 
3. 사이트 간 VPN 연결 또는 ExpressRoute 개인 피어링 네트워크에 프로세스 서버에서 온-프레미스 사이트로 데이터를 전송할 수 있는 충분한 대역폭이 있는지 확인합니다.

## <a name="deploy-a-separate-master-target-server"></a>개별 마스터 대상 서버 배포

1. 마스터 대상 서버 [요구 사항 및 제한 사항에 유의하십시오.](#reprotectionfailback-components)
2. 다시 보호하고 실패하려는 VM의 운영 체제와 일치하도록 [Windows](site-recovery-plan-capacity-vmware.md#deploy-additional-master-target-servers) 또는 [Linux](vmware-azure-install-linux-master-target.md) 마스터 대상 서버를 만듭니다.
3. 마스터 대상 서버에 저장소 vMotion을 사용하지 않거나 장애 조치(failback)가 실패할 수 있는지 확인합니다. 디스크를 사용할 수 없기 때문에 VM 컴퓨터를 시작할 수 없습니다.
    - 이를 방지하려면 마스터 대상 서버를 vMotion 목록에서 제외합니다.
    - 마스터 대상이 다시 보호한 후 저장소 vMotion 작업을 거치면 마스터 대상 서버에 연결된 보호된 VM 디스크가 vMotion 작업의 대상으로 마이그레이션됩니다. 이 후에 장애 복구를 시도하면 디스크를 찾을 수 없기 때문에 디스크 분리가 실패합니다. 그러면 저장소 계정에서 디스크를 찾기가 어렵습니다. 이 경우 수동으로 찾아 VM에 연결합니다. 그런 다음 온-프레미스 VM을 부팅할 수 있습니다.

4. 기존 Windows 마스터 대상 서버에 보존 드라이브를 추가합니다. 새 디스크를 추가하고 드라이브를 포맷합니다. 보존 드라이브는 VM이 온-프레미스 사이트로 다시 복제될 때 지점을 중지하는 데 사용됩니다. 이러한 기준을 기록합니다. 충족되지 않으면 마스터 대상 서버에 대한 드라이브가 나열되지 않습니다.
    - 볼륨은 복제 대상과 같은 다른 용도로 사용되지 않으며 잠금 모드에 있지 않습니다.
    - 볼륨은 캐시 볼륨이 아닙니다. 프로세스 서버와 마스터 대상에 대한 사용자 지정 설치 볼륨은 보존 볼륨에 적합하지 않습니다. 프로세스 서버와 마스터 대상이 볼륨에 설치되면 이 볼륨은 마스터 대상의 캐시 볼륨입니다.
    - 볼륨의 파일 시스템 형식은 FAT 또는 FAT32가 아닙니다.
    - 볼륨 용량은 0이 아닌 값입니다.
    - Windows의 기본 보존 볼륨은 R 볼륨입니다.
    - Linux의 기본 보존 볼륨은 /mnt/retention입니다.

5. 기존 프로세스 서버를 사용하는 경우 드라이브를 추가합니다. 새 드라이브는 마지막 단계의 요구 사항을 충족해야 합니다. 보존 드라이브가 없으면 포털의 드롭다운 목록에 선택 사항이 나열되지 않습니다. 온-프레미스 마스터 대상에 드라이브를 추가하고 나면 드라이브가 포털의 선택 사항에 나타나는 데 최대 15분이 걸립니다. 15분 후에 드라이브가 나타나지 않으면 구성 서버를 새로 고칠 수 있습니다.
6. 마스터 대상 서버에 VMware 도구 또는 open-vm-tools를 설치합니다. 도구가 없으면 마스터 대상의 ESXi 호스트에 있는 데이터 저장소를 검색할 수 없습니다.
7. 디스크를 설정합니다. VMware의 마스터 대상 VM의 구성 매개 변수에서 EnableUUID=true 설정입니다. 이 행이 없는 경우 추가합니다. 올바르게 탑재할 수 있도록 VMDK에 일관성 있는 UUID를 제공하려면 이 설정이 필요합니다.
8. vCenter 서버 액세스 요구 사항 확인:
    - 장애 복구중인 VM이 VMware vCenter Server에서 관리하는 ESXi 호스트에 있는 경우 마스터 대상 서버는 복제된 데이터를 가상 컴퓨터의 디스크에 쓰려면 온-프레미스 VM 가상 시스템 디스크(VMDK) 파일에 액세스해야 합니다. 온-프레미스 VM 데이터 스토어가 읽기/쓰기 액세스 권한이 있는 마스터 대상 호스트에 탑재되어 있는지 확인합니다.
    - VM이 VMware vCenter 서버에서 관리하는 ESXi 호스트에 없는 경우 사이트 복구는 다시 보호하는 동안 새 VM을 만듭니다. 이 VM은 마스터 대상 서버 VM을 만드는 ESXi 호스트에서 만들어집니다. ESXi 호스트를 신중하게 선택하여 원하는 호스트에 VM을 만듭니다. VM의 하드 디스크는 마스터 대상 서버가 실행 중인 호스트에서 액세스할 수 있는 데이터 저장소에 있어야 합니다.
    - 장애 복구(Failback)를 위한 온-프레미스 VM이 이미 있는 경우의 또 다른 옵션은 장애 복구(Failback)를 수행하기 전에 해당 VM을 삭제하는 것입니다. 그런 다음 Failback은 마스터 대상 ESXi 호스트와 동일한 호스트에 새 VM을 만듭니다. 대체 위치로 다시 장애 조치하면 온-프레미스 마스터 대상 서버에서 사용하는 것과 동일한 데이터스토어 및 동일한 ESXi 호스트로 데이터가 복구됩니다.
9. VMware VM으로 다시 실패하는 물리적 컴퓨터의 경우 컴퓨터를 다시 보호하기 전에 마스터 대상 서버가 실행 중인 호스트를 검색해야 합니다.
10. 마스터 대상 VM에 하나 이상의 가상 시스템 파일 시스템(VMFS) 데이터 스토어가 연결된 ESXi 호스트가 있는지 확인합니다. VMFS 데이터 스토어가 연결되어 있지 않으면 다시 보호 설정의 데이터스토어 입력이 비어 있으므로 계속할 수 없습니다.


## <a name="next-steps"></a>다음 단계

VM을 [다시 보호합니다.](vmware-azure-reprotect.md)
