<properties
	pageTitle="재해 복구를 위한 네트워크 인프라 디자인 | Microsoft Azure"
	description="이 문서에서는 Azure Site Recovery에 대한 실제 네트워크 디자인 고려 사항을 알아봅니다."
	services="site-recovery"
	documentationCenter=""
	authors="prateek9us"
	manager="jwhit"
	editor=""/>

<tags
	ms.service="site-recovery"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="storage-backup-recovery"
	ms.date="02/22/2016"
	ms.author="pratshar"/>

#  재해 복구를 위한 네트워크 인프라 디자인

이 문서는 BCDR(비즈니스 연속성 및 재해 복구) 인프라를 설계, 구현 및 지원할 책임이 있고 Microsoft ASR(Azure Site Recovery)를 활용하여 BCDR 서비스를 지원하고 개선하려는 IT 전문가에게 리디렉션됩니다. 이 문서는 System Center Virtual Machine Manager 서버 배포에 대한 실제적인 고려 사항, 확대 서브넷과 서브넷 장애 조치의 장단점 및 Microsoft Azure의 가상 사이트에 대한 재해 복구를 구조화하는 방법을 설명합니다.

## 개요

[ASR(Azure Site Recovery)](https://azure.microsoft.com/services/site-recovery/)는 비즈니스 연속성 재해 복구(BCDR)를 위해 가상화된 응용 프로그램의 보호 및 복구를 오케스트레이션하는 Microsoft Azure 서비스입니다. 이 문서는 사이트 복구를 사용하여 VM(가상 컴퓨터)을 복제하는 경우 재해 복구 사이트에서 IP 범위 및 서브넷을 설계에 초점을 맞추어 판독기에서 네트워크를 디자인하는 과정을 안내합니다.

또한 이 문서는 사이트 복구가 멀티 사이트 가상 데이터 센터를 설계하고 구현하여 테스트 또는 재해 시 BCDR 서비스를 지원하는 방법을 보여줍니다.

모든 사용자가 24/7 연결을 예상한 경우 인프라 및 응용 프로그램을 계속 실행하는 것이 무엇보다 중요합니다. 비즈니스 연속성 및 재해 복구(BCDR)의 목적은 조직이 정상 작업을 신속하게 다시 시작할 수 있도록 실패한 구성 요소를 복원하는 것입니다. 출현 가능성 낮은 심각한 이벤트를 처리하는 재해 복구 전략을 개발하는 것은 매우 어렵습니다. 특히 비현실적인 이벤트와 관련되면 미래를 예측하는 데 내재된 어려움 및 광범위한 재난에 대한 보호의 적절한 평가를 제공하기 위해 드는 높은 비용이 문제가 됩니다.

BCDR 계획에 중요한 것은 복구 시간 목표(RTO) 및 복구 지점 목표(RPO)가 재해 복구 계획의 일환으로 정의 되어야 한다는 점입니다. 고객의 데이터 센터에 재해가 발생하는 경우 고객은 Azure Site Recovery를 사용하여 최소 데이터 손실(낮은 RPO)로 보조 데이터 센터 또는 Microsoft Azure에 있는 복제된 해당 온라인 가상 컴퓨터를 신속하게(낮은 RTO) 가져옵니다.

장애 조치는 (시나리오에 따라) 기본 데이터 센터에서 보조 데이터 센터 또는 Azure에 지정된 가상 컴퓨터를 복사하는 ASR에서 가능해지고 복제본을 주기적으로 새로 고칩니다. 인프라를 계획하는 동안 네트워크 디자인은 회사 RTO 및 RPO 목적을 충족하지 못하도록 방해할 수 있는 잠재적 병목 현상으로 간주되어야 합니다.

관리자가 재해 복구 솔루션을 배포하려는 경우 한 가지 핵심적인 질문은 장애 조치를 완료한 후에 가상 컴퓨터를 연결할 수 있는 방법입니다. 관리자는 ASR에서 네트워크 매핑을 사용하여 가상 컴퓨터가 장애 조치 후에 첨부된 네트워크를 선택할 수 있습니다. 네트워크 매핑에 대한 자세한 내용은 [네트워크 매핑 준비](site-recovery-network-mapping.md)를 참조하세요.

복구 사이트에 대한 네트워크를 디자인하는 동안 관리자는 두 가지를 선택할 수 있습니다.

- 복구 사이트에서 네트워크에 다른 IP 주소 범위를 사용합니다. 이 시나리오에서 장애 조치 후의 가상 컴퓨터는 새 IP 주소를 가져오고 관리자는 DNS 업데이트를 수행해야 합니다. 여기에 DNS 업데이트를 수행하는 방법을 자세히 알아보기
- 복구 사이트에서 네트워크에 동일한 IP 주소 범위를 사용합니다. 특정 시나리오에서 관리자는 장애 조치 후에 기본 사이트에 있는 IP 주소를 유지하려 합니다. 일반적인 시나리오에서 관리자는 IP 주소의 새 위치를 나타내도록 경로를 업데이트해야 합니다. 하지만 기본 데이터베이스와 복구 사이트 간의 확대 VLAN를 배포할 경우에는 가상 컴퓨터에 대한 IP 주소를 유지하는 것이 유용한 옵션입니다. 동일한 IP 주소를 유지하면 장애 조치 후 단계와 관련된 네트워크를 정리하여 복구 과정을 단순화합니다.

이 문서에서는 재해 복구에 대한 네트워크 주소 공간을 디자인하기 위한 두 가지 주요 기술 고려 사항을 설명합니다.

- 패브릭 관리자(System Center Virtual Machine Manager) 배포 토폴로지를 디자인하여 ASR(Azure Site Recovery)를 통해 워크로드를 보호합니다.
- 재해 복구 환경의 IP 주소 관리입니다.


## Azure Site Recovery에 대한 System Center VMM 배포 디자인

비즈니스 요구 사항이 토폴로지 확인을 결정합니다. 비즈니스 요구 사항을 기반으로 조직은 다른 데이터 센터를 관리하는 단일 관리 헤드 또는 여러 관리 헤드에 의해 관리되는 여러 데이터 센터를 갖도록 선택할 수 있습니다. 이 섹션에서는 조직에서 SCVMM(System Center Virtual Machine Manager) 배포 토폴로지를 디자인하여 ASR로 워크로드를 보호하는 방법을 설명합니다.

Azure Site Recovery는 여러 배포 시나리오에서 가상 컴퓨터의 복제, 장애 조치(Failover) 및 복구를 오케스트레이션하여 BCDR(비즈니스 연속성 및 재해 복구) 전략에 기여합니다. 단순성의 디자인 원칙을 기반으로, ASR은 관리자가 기존 데이터 센터 토폴로지에 재해 복구 솔루션을 구축하도록 하는 방식으로 모델링됩니다. 따라서 ASR는 조직이 비즈니스 요구에 가장 잘 맞는 토폴로지를 선택하도록 할 수 있습니다.

배포 시나리오의 전체 목록은 [사이트 복구란?](site-recovery-overview.md)을 참조하세요.

고객은 보조 사이트를 관리하는 VMM 서버와 함께 기본 사이트의 VMM 서버에서 워크로드를 보호할 수 있습니다. 재해가 발생한 경우 모든 워크로드는 기본 사이트에서 보조 VMM 서버를 통해 관리되는 보조 사이트에 원활하게 장애 조치됩니다. 그러나 일부 조직에서는 관리 오버 헤드를 방지하기 위해 모든 데이터 센터를 관리하기 위해 단일 VMM 서버를 사용하려고 할 수 있습니다. 이 토폴로지를 가진 고객의 경우 워크로드를 복구할 수 있기 전에 VMM 서버를 복구할 수 있다는 점이 중요합니다. 결과적으로 고객은 해당 워크로드를 "재해 증명"하기 위해 해당 VMM 토폴로지를 주의 깊게 디작인해야 합니다.

인프라에 단일 VMM 서버가 있는 경우 VMM 클라우드의 가상 컴퓨터를 Azure에 복제하기 위해 Azure Site Recovery를 배포하거나 단일 VMM 서버의 클라우드 간에 복제할 수 있습니다. 복구의 경우 Hyper-V 관리자 콘솔에서 Hyper-V 복제본을 사용하여 Azure Site Recovery 콘솔 외부에서 VMM 서버를 통해 수동으로 장애를 복구해야 합니다. 가장 가능한 RTO(복구 시간 목표) 및 RPO(복구 지점 목표)를 사용하여 워크로드를 복구하기 위해 다음 토폴로지 중 하나에서 VMM 서버를 배포하는 것이 좋습니다.

### 독립 실행형 배포

이 토폴로지에서는 독립 실행형 VMM 서버를 기본 사이트의 가상 컴퓨터에 배포하고 이 가상 컴퓨터를 Azure Site Recovery 및 Hyper-V 복제본을 사용하여 보조 사이트로 복제합니다. 일부 인스턴스에서 VM은 하나만 인스턴스화되어야 하기 때문에 동일한 가상 컴퓨터에 VMM 서버와 이 서버를 지원하는 SQL Server를 설치해서 가동 중지 시간을 줄일 수 있습니다. VMM 서비스가 원격 SQL Server를 사용하는 경우 VMM 서버를 복구하기 전에 SQL Server 인스턴스를 복구해야 합니다.

Hyper-V 복제본을 사용하여 VM에 단일 VMM을 배포하는 단계는 다음과 같습니다.

1. SQL Server가 설치되어 있는 VM에 VMM을 설치합니다.
2. 관리할 호스트를 이 VMM 서버의 클라우드에 추가합니다.
3. Azure 포털에 로그인한 다음 보호하도록 클라우드를 구성합니다.
4. VMM 서버로 보호해야 할 모든 VM에 대해 복제를 사용하도록 설정합니다.
5. Hyper-V 관리 콘솔로 이동하고 Hyper-V 복제본을 선택한 다음 VMM VM에서 복제를 사용하도록 설정합니다. Hyper-V 복제 설정이 ASR에 의해 재정의되지 않도록 VMM VM이 ASR 서비스로 보호되는 클라우드에 추가되지 않도록 합니다.

재해가 발생할 경우 다음 단계를 사용하여 워크로드를 복구할 수 있습니다.

1. Hyper-V 관리자를 사용하여 복제본 VMM VM 을 복구 사이트에 장애 조치(failover)합니다.
2. VMM VM이 복구된 후 사용자는 보조 사이트에서 Hyper-V 복구 관리자에 로그인할 수 있습니다.
3. 계획되지 않은 장애 조치(failover)가 완료된 후 사용자는 주 사이트의 모든 리소스에 액세스할 수 있습니다.


이 토폴로지는 워크로드를 장애 조치하기 전에 사용자가 반드시 해당 VMM VM를 보조 사이트에 수동으로 장애 조치하도록 합니다.

![독립 실행형](./media/site-recovery-network-design/standalone.png)

### 클러스터 배포


항상 사용 가능한 VMM 서버를 배포하는 작업은 VMM 서비스가 클러스터를 인식하게 만드는 메서드입니다. 워크로드 가용성을 보장하고 VMM 서버 오류로부터 복구하기 때문에 중요한 워크로드를 VMM을 통해 관리하는 경우에 유용합니다. VMM 서버를 항상 사용할 수 있어야 합니다. 서비스가 클러스터를 인식하도록 만들면 VMM 서버가 실행 중인 호스트의 하드웨어 장애 조치에 대해 VMM 서버를 보호할 수 있을 뿐만 아니라 VMM가 실행 중인 VM에서 발생할 수 있는 문제를 방지할 수 있습니다. 항상 사용 가능한 VMM 서버를 배포하려면 VMM 서버가 반드시 Windows Server 장애 조치 클러스터에 나타나야 합니다. 항상 사용 가능한 VMM 서버를 배포하는 방법에 대한 자세한 내용은 여기에서 사용할 수 있는 System Center 블로그 게시물을 참조하세요.

ASR을 사용하여 워크로드를 보호하는 경우 VMM 서버는 그림 2처럼 확대 클러스터에 지리적으로 분산된 사이트에 걸쳐 배포되어야 합니다. VMM에서 사용하는 SQL Server 데이터베이스는 보조 사이트에서 복제를 통해 SQL Server AlwaysOn 가용성 그룹과 함께 보호되어야 합니다. 재해가 VMM 서버에서 발생하는 경우 ASR을 사용하여 워크로드를 장애 조치될 수 있게된 다음 해당하는 SQL Server 데이터베이스가 자동으로 복구 사이트에 장애 조치(failover)됩니다.

![늘어난 VMM 클러스터](./media/site-recovery-network-design/network-design1.png)

그림 2

## 재해 복구 환경에 네트워크 주소 공간 디자인

관리자가 재해 복구 솔루션을 배포하려는 경우 한 가지 핵심적인 질문은 장애 조치를 완료한 후에 응용 프로그램을 연결할 수 있는 방법입니다. 최신 응용 프로그램은 거의 항상 어느 정도 네트워킹에 종속되어 있으므로 한 사이트에서 다른 사이트로 물리적으로 서비스를 이동하면 네트워킹 문제가 발생합니다. 재해 복구 솔루션에서 이 문제를 처리하는 두 가지 방법이 있습니다. 첫 번째 방법은 고정 IP 주소를 유지 관리하는 것입니다. 비록 서로 다른 물리적 위치에서 서비스가 이동하고 호스팅 서버가 존재하기는 하지만 응용 프로그램이 IP 주소 구성을 새 위치로 함께 가지고 갑니다. 두 번째 방법은 복구된 사이트로 전환하는 동안 IP 주소를 완전히 변경하는 작업을 포함합니다. 각 방법에는 아래에 요약된 것처럼 여러 가지 구현 변형이 있습니다.

복구 사이트에 대한 네트워크를 디자인하는 동안 관리자는 두 가지를 선택할 수 있습니다.

### 옵션 1: IP 주소 유지 

재해 복구 프로세스의 관점에서 고정된 IP 주소를 사용하는 것은 구현할 수 있는 가장 쉬운 방법처럼 보이지만 실제로 가장 적게 사용되는 방식이었던 원인인 여러 잠재적 문제점이 있습니다. Azure Site Recovery는 모든 시나리오에서 IP 주소를 유지하는 기능을 제공합니다. IP를 유지하기로 결정하기 전에 장애 조치 기능에 적용된 제약 조건에 대해 잘 생각해봐야 합니다. IP 주소의 유지 여부를 결정하는 데 도움이 되는 요소를 살펴보겠습니다. 이 범주에는 확대 서브넷 및 서브넷 장애 조치 등 두 가지 주요 하위 형식이 있습니다. 두 위치에 걸친 서브넷 장애 조치 또는 확대 서브넷이 있는 경우 시나리오를 별도로 설명합니다.

#### 확대 서브넷

여기서 서브넷은 기본 및 DR 위치 모두에서 동시에 사용할 수 있습니다. 즉, 간단히 말해 서버와 해당 IP(계층 3) 구성을 두 번째 사이트로 이동할 수 있고 네트워크가 자동으로 트래픽을 새 위치에 라우팅한다는 것입니다. 서버 관점에서는 이것을 간단히 처리할 수 있지만 실제로는 많은 문제점이 있습니다.

- 계층 2(데이터 링크 계층) 관점에서 확대 VLAN을 관리할 수 있는 네트워킹 장비가 필요하지만 현재 널리 사용되며 문제가 줄어들고 있습니다. 두 번째로 더 어려운 문제는 VLAN을 늘림으로써 잠재적 장애 도메인이 이 두 사이트에 확장되어 본질적으로 단일 오류 지점이 된다는 것입니다. 드물지만 브로드캐스트 storm이 시작했지만 경리되게 됩니다. 마지막 문제에 대한 복잡한 의견을 발견했으며 "여기에 이 기술을 절대 구현하지 않겠다"는 의견은 물론 여러 성공적인 구현도 살펴보았습니다.
- Microsoft Azure를 DR 사이트로 사용하는 경우 확대 서브넷은 불가능합니다.


#### 서브넷 장애 조치(failover)

서브넷 장애 조치를 구현하여 여러 사이트에 걸쳐 서브넷을 확대하지 않고 위에서 설명한 확대 서브넷 솔루션의 이점을 얻는 것은 불가능합니다. 여기서 지정된 서브넷은 사이트 1 또는 사이트 2에 있으며 두 사이트에 동시에 존재하지 않습니다. 장애 조치(failover) 시 IP 주소 공간을 유지 관리하기 위해 라우터 인프라에 대해 프로그래밍 방식으로 정렬하여 한 사이트에서 다른 사이트로 서브넷을 이동할 수 있습니다. 장애 조치(failover) 시나리오에서 서브넷은 연결되어 있는 보호된 VM과 함께 이동합니다. 이 방법의 주요 단점은 오류 발생 시 전체 서브넷을 이동해야 하는 것으로, 이는 문제가 없을 수 있지만 장애 조치(failover)의 세부적인 고려 사항에 영향을 미칠 수 있습니다.

Contoso라는 가상의 기업이 전체 서브넷을 장애 조치(failover)하면서 해당 VM을 복구 위치에 복제할 수 있는 방법을 살펴보겠습니다. 두 개의 온-프레미스 위치 사이에 VM을 복제하는 동안 Contoso가 해당 서브넷을 관리할 수 있는 방법을 우선 살펴보고 Azure가 재해 복구 사이트로 사용될 때 서브넷 장애 조치(failover)가 작동하는 방식을 설명하겠습니다.

##### 서브넷 장애 조치 – 엔터프라이즈 등급 DR

각 VM의 IP를 유지하고 전체 서브넷을 함께 장애 조치하려는 시나리오를 살펴보겠습니다. 주 사이트에 서브넷 192.168.1.0/24에서 실행되는 응용 프로그램이 있습니다. 장애 조치(failover)가 발생한 경우 이 서브넷의 일부인 모든 가상 컴퓨터는 복구 사이트로 장애 조치(failover)되고 해당 IP 주소를 유지합니다. 서브넷 192.168.1.0/24에 속하는 모든 가상 컴퓨터가 복구 사이트로 이동한 사실을 반영하도록 경로를 적절히 수정해야 합니다.

다음 그림에서 기본 사이트와 복구 사이트, 세 번째 사이트와 기본 사이트 및 세 번째 사이트와 복구 사이트 간의 경로를 적절히 수정해야 합니다. 이 문서의 초기 버전에 대해 다음과 같이 가정했습니다.

- System Center VMM의 고유한 인스턴스에서 각 데이터 센터를 지원합니다. 데이터 센터 간에는 System Center VMM 데이터베이스의 복제가 없습니다.
- 각 데이터 센터는 가상 컴퓨터에 대해 고정 IP 주소를 사용합니다.
- 데이터 센터 간의 연결은 인터넷을 통한 VPN 연결이 아닌 전용 회로를 통해 이루어집니다.

	![IP 주소 유지](./media/site-recovery-network-design/network-design3.png)

	그림 3

	![IP 주소 유지](./media/site-recovery-network-design/network-design2.png)
	
	그림 4

특정 가상 컴퓨터에 대한 보호를 사용하도록 설정하는 경우 ASR가 다음 워크플로에 따라 네트워킹 리소스를 할당합니다.

- ASR가 각 System Center VMM 인스턴스에 대한 관련 네트워크에 정의된 고정 IP 주소 풀에서 가상 컴퓨터의 각 네트워크 인터페이스에 대한 IP 주소를 할당합니다.
- 관리자가 복구 사이트의 네트워크에 대해 기본 사이트에서 사용한 것과 동일한 IP 주소 풀을 정의하면 IP 주소를 복제 가상 컴퓨터에 할당하는 동안 ASR은 기본 가상 컴퓨터에 할당된 것과 동일한 IP 주소를 할당합니다. IP가 VMM에서 예약되어 있지만 장애 조치 IP로 설정되지 않습니다. 장애 조치(failover) IP는 장애 조치(failover)하기 직전에 설정됩니다.

	![IP 주소 유지](./media/site-recovery-network-design/network-design4.png)
	
	그림 5

그림 5는 Hyper-V 콘솔에서 복제 가상 컴퓨터에 대한 장애 조치(failover) TCP/IP 설정을 보여줍니다. 이러한 설정은 가상 컴퓨터가 시작되기 전 장애 조치 후에 채워질 수 있습니다.

동일한 IP를 사용할 수 없는 경우 ASR는 정의된 IP 주소 풀에서 사용 가능한 다른 IP 주소를 할당합니다.

보호를 위해 VM을 사용하도록 설정한 후에 다음 샘플 스크립트를 사용하여 가상 컴퓨터에 할당된 IP를 확인할 수 있습니다. 동일한 IP가 장애 조치(failover) IP로 설정되고 장애 조치(failover) 시 VM에 할당됩니다.

![IP 주소 유지](./media/site-recovery-network-design/script.png)

>[AZURE.NOTE] 가상 컴퓨터가 DHCP를 사용하는 시나리오에서 IP 주소의 관리는 완전히 ASR의 제어 범위를 벗어납니다. 관리자는 복구 사이트에서 IP 주소를 제공하는 DHCP 서버가 기본 사이트와 동일한 범위에서 제공할 수 있도록 해야 합니다.

##### 온-프레미스 서브넷 장애 조치 – Azure에 대한 DR

ASR(Azure Site Recovery)는 Microsoft Azure가 가상 컴퓨터에 대한 재해 복구 사이트로 사용되도록 할 수 있습니다. 이 경우에 더 많은 제약 조건을 처리해야 합니다.

Woodgrove Bank라는 가상의 회사가 해당 사업 분야 응용 프로그램을 호스트하는 온-프레미스 인프라를 가지고 Azure에서 해당 모바일 응용 프로그램을 호스트하는 시나리오를 살펴보겠습니다. Azure 및 온-프레미스 서버에서 Woodgrove Bank VM 간의 연결은 사이트 간(S2S) VPN(가상 사설망)에서 제공됩니다. S2S VPN은 Azure에서 Woodgrove Bank의 가상 네트워크를 Woodgrove Bank의 온-프레미스 네트워크를 확장한 것으로 볼 수 있습니다. 이 통신은 Woodgrove Bank 에지와 Azure 가상 네트워크 간의 S2S VPN을 통해 활성화됩니다. 이제 Woodgrove에서 ASR을 사용하여 Azure에 대한 데이터 센터에서 실행되는 해당 워크로드를 복제하려고 합니다. 이 옵션은 경제적 DR 옵션을 바라고 공용 클라우드 환경에 데이터를 저장할 수 있는 Woodgrove의 요구를 충족합니다. Woodgrove는 하드 코드된 IP 주소에 종속된 응용 프로그램 및 구성을 다루어야 하므로 Azure로 장애 조치(failover)한 이후 해당 응용 프로그램의 IP 주소를 유지하도록 요구합니다.

Woodgrove의 온-프레미스 인프라는 VMM 2012 R2 서버에서 관리됩니다. 응용 프로그램 네트워크라는 VLAN 기반 논리 네트워크를 System Center VMM 서버에 만듭니다. 논리 네트워크를 사용하여 응용 프로그램 VM 네트워크라는 VM 네트워크를 만듭니다. 응용 프로그램의 모든 가상 컴퓨터는 고정 IP 주소를 사용하므로 고정 IP 풀도 논리 네트워크에 대해 정의되었습니다.

**논리 네트워크**

![논리 네트워크](./media/site-recovery-network-design/network-design5.png)

그림 6

**VM 네트워크**

![VM 네트워크](./media/site-recovery-network-design/network-design6.png)

그림 7

Woodgrove는 IP 주소 범위(172.16.1.0/24, 172.16.2.0/24)에서 Azure에 실행 중인 해당 리소스까지 IP 주소를 할당하도록 결정했습니다.

Woodgrove가 IP 주소를 유지하면서 Azure에 대한 가상 컴퓨터를 복제할 수 있으려면 Azure 가상 네트워크를 만들어야 합니다. 응용 프로그램이 온-프레미스 사이트에서 Azure에 장애 조치할 수 있도록 온-프레미스 네트워크를 확장해야 합니다. Azure를 사용하면 Azure에서 만든 가상 네트워크에 대한 지점 및 사이트 VPN 연결 뿐만 아니라 사이트 간을 추가할 수 있습니다. 사이트 간 연결을 설정하는 경우 Azure가 늘어난 서브넷을 지원하지 않기 때문에 IP 주소의 범위가 온-프레미스 IP 주소 범위와 다른 경우에만 Azure 네트워크를 통해 온-프레미스 위치(Azure에서는 로컬 네트워크라고 함)에 트래픽을 라우팅할 수 있습니다. 이는 온-프레미스에 서브넷 192.168.1.0/24가 있는 경우 Azure 네트워크에 로컬 네트워크 192.168.1.0/24를 추가할 수 없다는 것입니다. 이렇게 예측하는 이유는 Azure가 서브넷에 활성 VM이 없고 해당 서브넷이 DR 용도로만 만들어진다는 것을 모르기 때문입니다. Azure 네트워크 외부에서 제대로 네트워크 트래픽을 라우팅할 수 있으려면 네트워크 및 로컬 네트워크의 서브넷이 충돌하지 않아야 합니다.

![서브넷 장애 조치(failover)](./media/site-recovery-network-design/network-design7.png)

그림 8

Woodgrove가 해당 비즈니스 요구 사항을 충족하는 데 도움이 되려면 다음 워크플로를 구현해야 합니다.

- 가상 컴퓨터를 만들고 복구 네트워크라 부르며 여기에 장애 조치된 가상 컴퓨터를 만듭니다.
- 장애 조치 후에 VM에 대한 IP를 유지하려면 VM 속성에 있는 구성 탭으로 이동하고 VM에 온-프레미스가 있는 동일한 IP를 지정한 다음 저장을 클릭합니다. VM이 장애 조치되는 경우 Azure Site Recovery는 가상 컴퓨터에 제공된 IP를 할당합니다. 

	![네트워크 속성](./media/site-recovery-network-design/network-design8.png)

	그림 9

장애 조치가 트리거되고 가상 컴퓨터가 원하는 IP를 사용하여 복구 네트워크에 생성되면 Vnet 간 연결을 사용하여 이 네트워크에 대한 연결을 설정할 수 있습니다. 필요한 경우 이 작업은 스크립팅될 수 있습니다. 이전 섹션에서 서브넷 장애 조치(failover)에 대해 설명한 것처럼 Azure에 대한 장애 조치(failover)의 경우에도 192.168.1.0/24가 Azure로 이동했다는 것을 반영하도록 라우팅을 적절하게 수정해야 합니다.

![네트워크 속성](./media/site-recovery-network-design/network-design9.png)

그림 10

### 옵션 2: IP 주소 변경

이 방법은 작성자가 확인한 것에 기반하여 가장 우세해 보입니다. 장애 조치에 관련된 모든 VM의 IP 주소 변경 양식을 사용합니다. 이 방법의 단점은 들어오는 네트워크가 'IPx에 있던 응용 프로그램이 이제 IPy에 있다는 점을 ‘배워야’ 한다는 것입니다. IPx 및 IPy가 논리적 이름이더라도 DNS 항목은 일반적으로 변경되거나 네트워크에 플러시되어야 하고 네트워크 테이블에서 캐시된 항목은 업데이트되거나 플러시되어야 합니다. 따라서 DNS 인프라가 설치된 방식에 따라 가동 중지 시간이 발생할 수 있습니다. 이러한 문제는 인트라넷 응용 프로그램의 경우 낮은 TTL 값을 사용하고, 인터넷 기반 응용 프로그램의 경우 [ASR와 함께 Azure 트래픽 관리자](http://azure.microsoft.com/blog/2015/03/03/reduce-rto-by-using-azure-traffic-manager-with-azure-site-recovery/)를 사용하면 완화할 수 있습니다.

#### IP 주소 변경 - 엔터프라이즈 등급 DR

기본 및 복구 사이트에 걸쳐 다른 IP를 사용하려는 시나리오를 살펴보겠습니다. 다음 예제에서는 기본 또는 복구 사이트에 호스트된 응용 프로그램에서 세 번째 사이트에 액세스할 수 있습니다.

![다른 IP](./media/site-recovery-network-design/network-design10.png)

그림 11

그림 11에서 기본 사이트의 192.168.1.0/24 서브넷에 호스트되는 일부 응용 프로그램이 있으며 이는 장애 조치(failover) 후에 서브넷 172.16.1.0/24의 복구 사이트에서 실행되도록 구성되었습니다. 세 사이트 모두 서로 액세스할 수 있도록 VPN 연결/네트워크 라우팅이 적절하게 구성되었습니다.
 
그림 12가 보여주듯이 하나 이상의 응용 프로그램을 장애 조치(failover)한 후 해당 응용 프로그램이 복구 서브넷에서 복원됩니다. 여기서 전체 서브넷을 동시에 장애 조치하도록 제한되지 않습니다. 변경하지 않고 VPN 또는 네트워크 경로를 다시 구성해야 합니다. 장애 조치(failover) 및 일부 DNS 업데이트는 응용 프로그램이 액세스할 수 있도록 유지합니다. DNS가 동적 업데이트를 허용하도록 구성된 경우 장애 조치(failover) 후 가상 컴퓨터가 시작되면 새 IP를 사용하여 자체적으로 등록합니다.

![다른 IP](./media/site-recovery-network-design/network-design11.png)

그림 12

장애 조치(failover) 후에 복제 가상 컴퓨터는 기본 가상 컴퓨터의 IP 주소와 동일하지 않은 IP 주소를 가질 수 있습니다. 가상 컴퓨터가 시작되면 사용 중인 DNS 서버가 업데이트됩니다. DNS 항목은 일반적으로 네트워크 전체에서 변경되거나 플러시되어야 하고, 네트워크 테이블의 캐시된 항목도 업데이트되고 플러시되어야 하므로 이러한 상태가 변경되는 동안 가동 중지 시간이 발생하는 것은 흔한 일입니다. 이 문제는 다음으로 완화할 수 있습니다.

- 인트라넷 응용 프로그램의 경우 낮은 TTL 값 사용
- 인터넷 기반 응용 프로그램에 대한 ASR과 함께 Azure 트래픽 관리자 사용
- DNS 서버를 업데이트할 때 제 시간에 업데이트되도록 하기 위해 복구 계획 내에서 다음 스크립트 사용(동적 DNS 등록이 구성되지 않은 경우 스크립트가 필요하지 않음)

![다른 IP](./media/site-recovery-network-design/script2.png)

#### IP 주소 변경 - Azure에 대한 DR

[재해 복구 사이트인 Microsoft Azure에 대한 네트워킹 인프라 설정](http://azure.microsoft.com/blog/2014/09/04/networking-infrastructure-setup-for-microsoft-azure-as-a-disaster-recovery-site/) 블로그 게시물은 IP 주소 유지가 요구 사항이 아닌 경우 필요한 Azure 네트워킹 인프라를 설정하는 방법을 설명합니다. 응용 프로그램을 설명하기 시작하고 온-프레미스 및 Azure에서 네트워킹을 설정하는 방법을 알아본 다음 마지막 테스트 장애 조치 및 계획된 장애 조치를 수행하는 방법으로 마무리합니다.




## 다음 단계

Site Recovery가 원본 및 대상 네트워크를 매핑하는 방법을 [알아봅니다.](site-recovery-network-mapping.md)

<!---HONumber=AcomDC_0224_2016-->