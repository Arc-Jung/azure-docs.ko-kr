---
title: Azure 파일 동기화 클라우드 계층화 정책 선택 | Microsoft Docs
description: 클라우드 계층화 정책을 Azure 파일 동기화 선택할 때 염두에 두어야 할 사항에 대 한 세부 정보입니다.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 1/24/2021
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 2ed1b8162c49ccc26cb98dd02897a9c40f809d14
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/05/2021
ms.locfileid: "102204479"
---
# <a name="choose-cloud-tiering-policies"></a>클라우드 계층화 정책 선택

이 문서에서는 클라우드 계층화 정책을 선택 하 고 조정 하는 사용자를 위한 지침을 제공 합니다. 이 문서를 읽기 전에 클라우드 계층화가 작동 하는 방식을 이해 해야 합니다. 클라우드 계층화 기본 사항에 대해서는 [클라우드 계층화 Azure 파일 동기화 이해](storage-sync-cloud-tiering-overview.md)를 참조 하세요. 예제를 사용한 클라우드 계층화 정책에 대 한 자세한 설명은 [클라우드 계층화 정책 Azure 파일 동기화](storage-sync-cloud-tiering-policy.md)을 참조 하세요.

## <a name="limitations"></a>제한 사항
- 클라우드 계층화는 Windows 시스템 볼륨에서 지원 되지 않습니다.

- 볼륨 수준 FSRM 할당량이 있는 경우에도 클라우드 계층화를 사용 하도록 설정할 수 있습니다. FSRM 할당량을 설정 하면 호출 되는 사용 가능한 공간 쿼리 Api는 할당량 설정에 따라 볼륨의 사용 가능한 공간을 자동으로 보고 합니다. 

### <a name="minimum-file-size-for-a-file-to-tier"></a>계층에 대 한 파일의 최소 파일 크기

에이전트 버전 9 이상에서 파일 계층에 대 한 최소 파일 크기는 파일 시스템 클러스터 크기를 기준으로 합니다. 클라우드 계층화에 적합 한 최소 파일 크기는 클러스터 크기를 2 배, 최소 8kb로 계산 합니다. 다음 표에서는 볼륨 클러스터 크기를 기준으로 계층화 할 수 있는 최소 파일 크기를 보여 줍니다.

|볼륨 클러스터 크기 (바이트) |이 크기 이상의 파일은 계층화 될 수 있습니다.  |
|----------------------------|---------|
|4kb 이상 (4096)      | 8KB    |
|8KB (8192)                 | 16KB   |
|16KB (16384)               | 32KB   |
|32 KB (32768)               | 64KB   |
|64 KB (65536)    | 128KB  |

최대 64 KB의 클러스터 크기는 현재 지원 되지만 더 큰 크기의 경우 클라우드 계층화가 작동 하지 않습니다.

Windows에서 사용 하는 모든 파일 시스템은 클러스터 크기 (할당 단위 크기 라고도 함)에 따라 하드 디스크를 구성 합니다. 클러스터 크기는 파일을 저장 하는 데 사용할 수 있는 최소 크기의 디스크 공간을 나타냅니다. 파일 크기가 클러스터 크기의 짝수 배수가 아닌 경우에는 클러스터 크기의 다음 배수로 파일을 저장 하기 위해 추가 공간을 사용 해야 합니다.

Azure 파일 동기화는 Windows Server 2012 R2 이상 버전의 NTFS 볼륨에서 지원 됩니다. 다음 표에서는 Windows Server 2019를 사용 하 여 새 NTFS 볼륨을 만들 때의 기본 클러스터 크기에 대해 설명 합니다.

|볼륨 크기    |Windows Server 2019             |
|---------------|--------------------------------|
|70MB – 16TB   | 4KB                |
|16TB – 32 TB   | 8KB                |
|32TB – 64 TB   | 16KB               |
|64TB – 128 TB  | 32KB               |
|128TB – 256 TB | 64KB(이전 최대) |
|256 TB – 512 TB| 128KB              |
|512 TB – 1 PB  | 256 KB              |
|1 PB – 2 PB    | 512KB              |
|2TB-4 PB    | 1024KB             |
|4TB – 8TB    | 2048KB(최대 크기)  |
|> 8TB         | 지원되지 않음       |

볼륨을 만들 때 다른 클러스터 크기의 볼륨에 수동으로 포맷 했을 수 있습니다. 이전 버전의 Windows에서 볼륨을 분석 하는 경우 기본 클러스터 크기도 다를 수 있습니다. [이 문서에는 기본 클러스터 크기에 대 한 자세한 내용이 포함 되어 있습니다.](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat) 4kb 보다 작은 클러스터 크기를 선택 하더라도 계층화 될 수 있는 가장 작은 파일 크기로 8kb 제한이 적용 됩니다. 기술적으로 두 클러스터 크기가 8kb 보다 작은 경우에도 마찬가지입니다.

NTFS가 매우 작은 파일 (1kb에서 4kb 크기의 파일)을 저장 하는 방법에는 절대 최소값의 이유가 있습니다. 볼륨의 다른 매개 변수에 따라 작은 파일이 디스크의 클러스터에 저장 되지 않을 수 있습니다. 이러한 파일을 볼륨의 마스터 파일 테이블 또는 "MFT 레코드"에 직접 저장 하는 것이 더 효율적일 수 있습니다. 클라우드 계층화 재분석 지점은 항상 디스크에 저장 되 고 정확히 하나의 클러스터를 사용 합니다. 이러한 작은 파일의 계층화는 공간을 절약 하지 않을 수 있습니다. 극단적인 사례는 클라우드 계층화를 사용 하는 경우 더 많은 공간을 사용할 수도 있습니다. 이를 방지 하기 위해 클라우드 계층화가 계층으로 계층화 되는 파일의 가장 작은 크기는 4kb 또는 작은 클러스터 크기의 8kb입니다. 

## <a name="selecting-your-initial-policies"></a>초기 정책 선택

일반적으로 서버 끝점에서 클라우드 계층화를 사용 하도록 설정 하는 경우 개별 서버 끝점 마다 하나의 로컬 가상 드라이브를 만들어야 합니다. 서버 끝점을 격리 하면 클라우드 계층화가 작동 하는 방식을 보다 쉽게 이해 하 고 정책을 적절 하 게 조정할 수 있습니다. 그러나 동일한 드라이브에 여러 서버 끝점이 있는 경우에도 Azure 파일 동기화 작동 합니다. 자세한 내용은 [로컬 볼륨의 다중 서버 끝점](storage-sync-cloud-tiering-policy.md#multiple-server-endpoints-on-a-local-volume) 섹션을 참조 하세요. 또한 처음으로 클라우드 계층화를 사용 하도록 설정 하는 경우 날짜 정책을 사용 하지 않도록 설정 하 고 사용 가능한 볼륨 공간 정책을 10%에서 20%까지 유지 하는 것이 좋습니다. 대부분의 파일 서버 볼륨의 경우 20% 볼륨의 사용 가능한 공간이 일반적으로 가장 적합 합니다.

간소화를 위해 항목을 계층화 하는 방법을 명확 하 게 이해 하려면 볼륨의 사용 가능한 공간 정책을 주로 조정 하 고 필요 하지 않은 경우에는 날짜 정책을 사용 하지 않도록 설정 하는 것이 좋습니다. 대부분의 고객은 최대한 많은 핫 파일을 사용 하 여 로컬 캐시를 채우고 나머지를 클라우드로 계층화 하는 것이 중요 하기 때문에이 방법을 사용 하는 것이 좋습니다. 하지만, 날짜 정책에 지정 된 기간 (일)을 로컬로 유지할 필요가 없는 경우 로컬 디스크 공간을 사전에 확보 하 고 해당 서버 끝점에 액세스 한 파일을 알고 있는 경우 날짜 정책이 유용할 수 있습니다. 날짜 정책을 설정 하면 동일한 볼륨의 다른 끝점에서 더 많은 파일을 캐시 하는 데 중요 한 로컬 디스크 용량을 확보할 수 있습니다.

정책을 설정한 후에는 송신을 모니터링 하 고이에 따라 두 정책을 조정 합니다. Azure Monitor에서 응용 프로그램 메트릭에 의해 **클라우드 계층화 회수 크기** 및 **클라우드 계층화 회수 크기** 를 구체적으로 확인 하는 것이 좋습니다. 송신을 모니터링 하는 방법을 알아보려면 [클라우드 계층화 모니터링](storage-sync-monitor-cloud-tiering.md)을 참조 하세요.

## <a name="adjusting-your-policies"></a>정책 조정

Azure에서 지속적으로 회수 되는 파일 양이 원하는 것 보다 큰 경우에는 로컬 서버 볼륨에 저장할 수 있는 공간 보다 더 많은 핫 파일이 있을 수 있습니다. 가능 하면 로컬 볼륨 크기를 늘리고 볼륨의 사용 가능한 공간 정책 비율을 작은 증분으로 줄입니다. 사용 가능한 볼륨 공간 비율을 너무 많이 줄이면 부정적인 결과가 발생할 수 있습니다. 데이터 집합의 변동 비율이 높으면 새 파일 및 "콜드" 파일 회수를 위한 더 많은 여유 공간이 필요 합니다. 계층화는 최대 1 시간까지 지연 된 후 처리 시간이 필요 하므로 볼륨에 항상 충분 한 여유 공간이 있어야 합니다.

더 많은 데이터를 로컬에 유지 하면 Azure에서 회수 되는 파일 수를 줄일 수 있으며, 그에 따라 비용을 많이 제공 하는 온-프레미스 저장소도 더 많이 필요 합니다. 

사용 가능한 볼륨 공간 정책을 조정할 때 로컬에서 유지 해야 하는 데이터의 양은 대역폭, 데이터 집합의 액세스 패턴 및 예산과 같은 요인에 따라 결정 됩니다. 낮은 대역폭 연결을 사용 하는 경우 사용자의 지연 시간을 최소화 하기 위해 더 많은 로컬 데이터가 필요할 수 있습니다. 그렇지 않은 경우에는 지정된 기간 동안의 변동률에 따라 보관할 데이터의 양을 결정할 수 있습니다. 예를 들어 1TB 데이터 집합의 10%가 변경 되거나 매월 액세스 되는 것을 알고 있는 경우 파일을 자주 회수 하지 않도록 100 GB의 로컬 상태를 유지할 수 있습니다. 볼륨이 2tb 인 경우 5% (또는 100 GB)의 로컬을 유지 하는 것이 좋습니다. 나머지 95%는 사용 가능한 볼륨 공간 비율을 의미 합니다. 그러나 큰 변동 기간의 버퍼를 추가 해야 합니다. 즉, 더 큰 볼륨의 사용 가능한 공간 비율에서 시작 하 여 나중에 필요한 경우 조정 해야 합니다.

## <a name="standard-operating-procedures"></a>표준 운영 절차

- Azure 파일 동기화를 통해 Azure Files로 처음 마이그레이션할 때 클라우드 계층화는 초기 업로드에 종속 됩니다.
- 클라우드 계층화는 60 분 마다 사용 가능한 볼륨 공간 및 날짜 정책에 대 한 준수를 확인 합니다.
- 파일을 마이그레이션할 때 Robocopy에/LFSM 스위치를 사용 하면 파일을 동기화 하 고 클라우드 계층화를 사용 하 여 초기 업로드 중에 공간을 만들 수 있습니다. 
- 열 지도를 구성 하기 전에 계층화가 발생 하면 파일이 마지막으로 수정 된 타임 스탬프로 계층화 됩니다.

## <a name="next-steps"></a>다음 단계
* [Azure 파일 동기화 배포에 대한 계획](storage-sync-files-planning.md)
