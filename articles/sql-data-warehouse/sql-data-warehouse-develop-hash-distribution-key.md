<properties
   pageTitle="해시 배포 및 SQL 데이터 웨어하우스 | Microsoft Azure의 쿼리 성능에 미치는 영향"
   description="솔루션 개발을 위해 해시 배포된 테이블 및 Azure SQL 데이터 웨어하우스의 쿼리 성능에 미치는 영향에 대해 알아봅니다."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="jrowlandjones"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="06/26/2015"
   ms.author="JRJ@BigBangData.co.uk;barbkess"/>

# 해시 배포 및 SQL 데이터 웨어하우스의 쿼리 성능에 미치는 영향

해시 배포에 대한 현명한 결정은 쿼리 성능을 개선하기 위해 매우 중요한 방법 중 하나입니다.

실제로 세 가지 주요 요인이 있습니다.

1. 데이터 이동 최소화
2. 데이터 오차 방지
3. 분산된 실행 제공

## 데이터 이동 최소화
데이터 이동은 테이블이 함께 조인되거나 테이블에 대한 집계가 수행될 때 흔히 발생합니다. 공유 키에 테이블을 배포하는 해시는 이러한 이동을 최소화하는 매우 효과적인 방법 중 하나입니다.

그러나 다음과 같은 조건을 모두 만족해야 해시 배포가 효과적으로 이동을 최소화할 수 있습니다.

1. 두 테이블 모두 해시를 배포하고 공유된 배포 키에서 조인해야 합니다.
2. 두 열의 데이터 형식이 일치해야 합니다.
3. 조인하는 열들이 동등 조인이어야 합니다(즉, 왼쪽 테이블 열의 값이 오른쪽 테이블 열의 값과 동일해야 함).
4. 조인은 `CROSS JOIN`가 **아닙니다**.

> [AZURE.NOTE]`JOIN`, `GROUP BY`, `DISTINCT` 및 `HAVING` 절에 사용한 열이 모두 HASH 열 후보로 적합합니다. 한편 `WHERE` 절의 열은 해시 열 후보로 적합하지 **않습니다**. 아래의 분산 실행에 관한 섹션을 참조하세요.

쿼리 구문에서 해시 배포 키를 포함하지 않은 열에 사용할 때에도 데이터 이동이 발생할 수 있습니다(`COUNT DISTINCT` 및 `OVER` 절 모두 좋은 예).

> [AZURE.NOTE]라운드 로빈 테이블은 일반적으로 데이터 이동을 발생시킵니다. 테이블의 데이터가 명확하지 않은 방법으로 할당되었으므로 대부분의 쿼리를 완료하기 전에 먼저 데이터를 이동해야 합니다.

## 데이터 오차 방지
해시 배포가 효과를 얻으려면 선택한 열이 다음과 같은 속성을 나타내야 합니다.

1. 열이 많은 수의 고유 값을 포함합니다.
2. 열에 **데이터 오차**가 없습니다.

각 고유 값이 배포에 할당됩니다. 따라서 충분한 고유 해시 값이 생성되도록 하려면 데이터에 적절한 수의 고유 값이 필요합니다. 그렇지 않으면 해시 품질이 저하될 수 있습니다. 배포 수가 예를 들어 고유 값 수를 초과하면 일부 배포는 비어 있게 됩니다. 이 경우 성능이 저하될 수 있습니다.

마찬가지로, 해시된 열에 대한 모든 행이 동일한 값을 포함하고 있으면 데이터에 **오차**가 있다고 말합니다. 극단적인 경우 해시 값이 한 개만 생성되어 모든 행이 단일 배포에 포함될 수 있습니다. 해시된 열의 각 고유 값이 행 수와 같은 것이 이상적입니다.

> [AZURE.NOTE]라운드 로빈 테이블은 오차의 징후를 나타내지 않습니다. 왜냐하면 데이터가 배포에 대해 균일하게 저장되기 때문입니다.

## 분산된 실행 제공
분산된 실행은 각 배포에 동일한 양의 수행할 작업이 있는 경우 달성됩니다. 대규모 병렬 처리(MPP)는 팀 게임입니다. 즉, 모든 처리가 준비되어야 실행될 수 있는 처리가 선택됩니다. 모든 배포에 동일한 양의 작업(즉, 처리할 데이터)이 있으면 모든 쿼리가 거의 같은 시기에 완료됩니다. 이 상태를 분산된 실행이라고 합니다.

앞에서 보았듯이 데이터 오차는 분산된 실행에 영향을 미칠 수 있습니다. 그러나 해시 배포 키의 선택도 마찬가지일 수 있습니다. 쿼리의 `WHERE` 절에 나타나는 열이 선택된 경우 쿼리가 분산되지 않을 가능성이 높습니다.

> [AZURE.NOTE]`WHERE` 절은 일반적으로 분할을 위해 사용하기에 가장 좋은 열을 식별하는 데 도움이 됩니다.

`WHERE` 절에 나타나는 열의 좋은 예가 날짜 필드입니다. 날짜 필드는 열 분할이 적합한 대표적인 예이지만 흔히 해시 배포 열이 좋지 않습니다. 일반적으로 데이터 웨어하우스 쿼리가 일, 주 또는 월 같은 지정된 기간보다 더 좋습니다. 실제로 날짜별 해시 배포는 확장성을 제한하고 성능을 저하시킬 수 있습니다. 예를 들어 지정한 날짜 범위가 1주, 즉 7일인 경우 최대 해시 수는 하루에 한 개씩 7개가 될 것입니다. 즉, 배포 중 7개에만 데이터가 포함될 수 있습니다. 나머지 배포에는 데이터가 없을 수 있습니다. 이렇게 되면 7개의 배포만이 데이터를 처리하므로 분산되지 않은 쿼리 실행이 될 수 있습니다.

> [AZURE.NOTE]라운드 로빈 테이블은 일반적으로 분산된 실행을 제공합니다. 왜냐하면 데이터가 배포에 대해 균일하게 저장되기 때문입니다.

## 추천
성능 및 전체 쿼리 처리량을 최대화하려면 해시 배포된 테이블이 가능하면 아래 패턴을 따르도록 해 보십시오.

해시 배포 키:

1. 쿼리의 `JOIN`, `GROUP BY`, `DISTINCT` 또는 `HAVING` 절에 사용합니다.
2. `WHERE` 절에 사용하지 않습니다.
3. 서로 다른 값을 많이, 적어도 1000개 포함합니다.
4. 작은 수의 배포에 해시하는 행 수를 지나치게 많이 지정하지 않습니다.
5. NOT NULL로 정의합니다. NULL 행을 하나의 배포에 집중시킵니다.

## 요약

해시 배포를 다음과 같이 요약할 수 있습니다.

- 해시 함수는 결정적입니다. 언제나 동일한 값이 동일한 배포에 할당됩니다.
- 하나의 열이 배포 열로 사용됩니다. 해시 함수는 지정된 열을 사용하여 배포에 대한 행 할당을 계산합니다.
- 해시 함수는 값 자체가 아닌 열의 형식을 기반으로 합니다.
- 테이블을 해시 배포하면 오차가 있는 테이블이 발생하는 경우가 있습니다.
- 해시 배포된 테이블은 일반적으로 쿼리를 확인할 때 필요한 데이터 이동이 적으므로 큰 실제 테이블의 쿼리 성능이 개선됩니다.
- 쿼리 처리량을 향상시키려면 해시 배포된 열 선택에 대한 권장 사항을 준수하세요.

> [AZURE.NOTE]SQL 데이터 웨어하우스에서 데이터 형식 일관성 문제! 기존 스키마가 일관성 있게 열에 대해 동일한 형식을 사용하는지 확인합니다. 이는 배포 키의 경우 특히 중요합니다. 배포 키 데이터 형식이 동기화되지 않았는데 테이블을 조인하면 불필요한 데이터 이동이 발생합니다. 이렇게 되면 테이블이 크고 처리량과 성능이 저하될 수 있으므로 부담이 될 수 있습니다.


## 다음 단계
더 많은 개발 팁은 [개발 개요][]를 참조하세요.

<!--Image references-->

<!--Article references-->
[개발 개요]: sql-data-warehouse-overview-develop.md

<!--MSDN references-->

<!--Other Web references-->

<!---HONumber=July15_HO3-->