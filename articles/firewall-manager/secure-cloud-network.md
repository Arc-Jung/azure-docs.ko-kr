---
title: '자습서: Azure Firewall Manager 미리 보기를 사용하여 가상 WAN 보호'
description: 이 자습서에서는 Azure Portal을 통해 Azure Firewall Manager를 사용하여 가상 WAN을 보호하는 방법을 알아봅니다.
services: firewall-manager
author: vhorne
ms.service: firewall-manager
ms.topic: tutorial
ms.date: 02/18/2020
ms.author: victorh
ms.openlocfilehash: 3dc94a8be265682fbe2128f2e5870dfdf5850a2d
ms.sourcegitcommit: 0947111b263015136bca0e6ec5a8c570b3f700ff
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/24/2020
ms.locfileid: "77443060"
---
# <a name="tutorial-secure-your-virtual-wan-using-azure-firewall-manager-preview"></a>자습서: Azure Firewall Manager 미리 보기를 사용하여 가상 WAN 보호 

[!INCLUDE [Preview](../../includes/firewall-manager-preview-notice.md)]

Azure Firewall Manager Preview를 사용하여 개인 IP 주소, Azure PaaS 및 인터넷으로 향하는 클라우드 네트워크 트래픽을 보호하는 보안 가상 허브를 만들 수 있습니다. 방화벽에 대한 트래픽 라우팅이 자동화되므로 UDR(사용자 정의 경로)을 만들 필요가 없습니다.

![클라우드 네트워크 보안](media/secure-cloud-network/secure-cloud-network.png)

Firewall Manager는 허브 가상 네트워크 아키텍처도 지원합니다. 보안 가상 허브 및 허브 가상 네트워크 아키텍처 유형을 비교하려면 [Azure Firewall Manager 아키텍처 옵션이란?](vhubs-and-vnets.md)을 참조하세요.

이 자습서에서는 다음 작업 방법을 알아봅니다.

> [!div class="checklist"]
> * 스포크 가상 네트워크 만들기
> * 보안 가상 허브 만들기
> * 허브 및 스포크 VNet 연결
> * 방화벽 정책 만들기 및 허브 보안 설정
> * 허브로 트래픽 라우팅
> * 방화벽 테스트

## <a name="create-a-hub-and-spoke-architecture"></a>허브 및 스포크 아키텍처 만들기

먼저, 서버를 배치할 수 있는 스포크 VNet을 만듭니다.

### <a name="create-a-spoke-vnet-and-subnets"></a>스포크 VNet 및 서브넷 만들기

1. Azure Portal 홈 페이지에서 **리소스 만들기**를 선택합니다.
2. **네트워킹** 아래에서 **가상 네트워크**를 선택합니다.
4. **이름**에 **Spoke-01**을 입력합니다.
5. **주소 공간**에 **10.0.0.0/16**을 입력합니다.
6. **구독**의 경우 사용자의 구독을 선택합니다.
7. **리소스 그룹**에 대해 **새로 만들기**를 선택하고 이름에 **FW-Manager**를 입력한 다음, **확인**을 선택합니다.
8. **위치**에 대해 **(미국) 미국 동부**를 선택합니다.
9. **서브넷** 아래의 **이름**에 **Workload-SN**을 입력합니다.
10. **주소 범위**에 **10.0.1.0/24**를 입력합니다.
11. 다른 기본 설정을 유지한 다음, **만들기**를 선택합니다.

다음으로, 점프 서버용 서브넷을 만듭니다.

1. Azure Portal 홈페이지에서 **리소스 그룹** > **FW-Manager**를 선택합니다.
2. **Spoke-01** 가상 네트워크를 선택합니다.
3. **서브넷** >  **+서브넷**을 선택합니다.
4. **이름**에 **Jump-SN**을 입력합니다.
5. **주소 범위**에 **10.0.2.0/24**를 입력합니다.
6. **확인**을 선택합니다.

### <a name="create-the-secured-virtual-hub"></a>보안 가상 허브 만들기

Firewall Manager를 사용하여 보안 가상 허브를 만듭니다.

1. Azure Portal 홈 페이지에서 **모든 서비스**를 선택합니다.
2. 검색 상자에 **Firewall Manager**를 입력하고 **Firewall Manager**를 선택합니다.
3. **Firewall Manager** 페이지에서 **보안 가상 허브 만들기**를 선택합니다.
4. **새 보안 가상 허브 만들기** 페이지에서 구독을 선택하고 **FW-Manager** 리소스 그룹을 선택합니다.
5. **보안 가상 허브 이름**에 **Hub-01**을 입력합니다.
6. **위치**에 대해 **미국 동부**를 선택합니다.
7. **주소 공간**에 **10.6.0.0/16**을 입력합니다.
8. 새 vWAN 이름에 **vwan-01**을 입력합니다.
9. **신뢰할 수 있는 보안 파트너를 사용하도록 설정하기 위해 VPN Gateway 포함** 확인란을 취소된 상태로 둡니다.
10. **다음:Azure Firewall**을 선택합니다.
11. 기본 **Azure Firewall** **사용** 설정을 그대로 적용한 후, **다음: 신뢰할 수 있는 보안 파트너**를 선택합니다.
12. 기본 **신뢰할 수 있는 보안 파트너** **사용 안 함** 설정을 그대로 적용하고 **다음: 리뷰 + 만들기**를 클릭합니다.
13. **만들기**를 선택합니다. 배포하는 데 30분 정도 걸립니다.

### <a name="connect-the-hub-and-spoke-vnets"></a>허브 및 스포크 VNet 연결

이제 허브 및 스포크 VNet을 피어링할 수 있습니다.

1. **FW-Manager** 리소스 그룹을 선택한 다음, **vwan-01** 가상 WAN을 선택합니다.
2. **연결**에서 **가상 네트워크 연결**을 선택합니다.
3. **연결 추가**를 선택합니다.
4. **연결 이름**에 **hub-spoke**를 입력합니다.
5. **허브**에 대해 **Hub-01**을 선택합니다.
6. **가상 네트워크**에 대해 **Spoke-01**을 선택합니다.
7. **확인**을 선택합니다.

## <a name="create-a-firewall-policy-and-secure-your-hub"></a>방화벽 정책 만들기 및 허브 보안 설정

방화벽 정책은 하나 이상의 보안 가상 허브에서 트래픽을 전달하는 규칙 컬렉션을 정의합니다. 방화벽 정책을 만든 다음, 허브를 보호합니다.

1. Firewall Manager에서 **Azure Firewall 정책 만들기**를 선택합니다.
2. 구독을 선택한 다음, **FW-Manager** 리소스 그룹을 선택합니다.
3. **정책 세부 정보**에서 **이름**에 **Policy-01**을 입력하고 **지역**에 대해 **미국 동부**를 선택합니다.
4. **다음: 규칙**을 선택합니다.
5. **규칙** 탭에서 **규칙 컬렉션 추가**를 선택합니다.
6. **규칙 컬렉션 추가** 페이지에서 **이름**에 **RC-01**을 입력합니다.
7. **규칙 컬렉션 유형**에 대해 **애플리케이션**을 선택합니다.
8. **우선 순위**에 대해 **100**을 입력합니다.
9. **규칙 컬렉션 작업**이 **허용**인지 확인합니다.
10. 규칙 **이름**에 **Allow-msft**를 입력합니다.
11. **원본 주소**에 **\*** 를 입력합니다.
12. **프로토콜**에 **http,https**를 입력합니다.
13. ** 대상 유형이 **FQDN**인지 확인합니다.
14. **대상**에 **\*microsoft.com**을 입력합니다.
15. **추가**를 선택합니다.
16. 완료되면 **다음: 보안 가상 허브**를 선택합니다.
17. **보안 가상 허브** 탭에서 **Hub-01**을 선택합니다.
19. **검토 + 만들기**를 선택합니다.
20. **만들기**를 선택합니다.

이 작업을 완료하는 데 5분 정도 걸릴 수 있습니다.

## <a name="route-traffic-to-your-hub"></a>허브로 트래픽 라우팅

이제 네트워크 트래픽이 방화벽을 통해 라우팅될 수 있도록 해야 합니다.

1. Firewall Manager에서 **보안 가상 허브**를 선택합니다.
2. **Hub-01**을 선택합니다.
3. **설정**에서 **경로 설정**을 선택합니다.
4. **인터넷 트래픽**, **가상 네트워크의 트래픽**에서 **Azure Firewall을 통해 보내기**를 선택합니다.
5. **Azure 프라이빗 트래픽**, **가상 네트워크에 대한 트래픽**에서 **Azure Firewall을 통해 보내기**를 선택합니다.
6. **IP 주소 접두사 편집**을 선택합니다.
7. **IP 주소 접두사 추가**를 선택합니다.
8. 워크로드 서브넷의 주소로 **10.0.1.0/24**를 입력하고 **저장**을 선택합니다.
9. **설정**에서 **연결**을 선택합니다.
10. **허브-스포크** 연결을 선택하고 **보안 인터넷 트래픽**을 선택한 다음, **확인**을 선택합니다.


## <a name="test-your-firewall"></a>방화벽 테스트

방화벽 규칙을 테스트하려면 2~3개의 서버를 배포해야 합니다. Workload-SN 서브넷에 Workload-Srv를 배포하여 방화벽 규칙을 테스트하고, 원격 데스크톱을 사용하여 인터넷에서 연결한 후 Workload-Srv에 연결할 수 있도록 Jump-Srv를 배포합니다.

### <a name="deploy-the-servers"></a>서버 배포

1. Azure Portal에서 **리소스 만들기**를 선택합니다.
2. **인기** 목록에서 **Windows Server 2016 Datacenter**를 선택합니다.
3. 가상 머신에 대해 다음 값을 입력합니다.

   |설정  |값  |
   |---------|---------|
   |Resource group     |**FW-Manager**|
   |가상 머신 이름     |**Jump-Srv**|
   |지역     |**((미국) 미국 동부)**|
   |관리자 사용자 이름     |**azureuser**|
   |암호     |암호 입력|

4. **인바운드 포트 규칙** 아래의 **공용 인바운드 포트**에서 **선택한 포트 허용**을 선택합니다.
5. **인바운드 포트 선택**에서 **RDP(3389)** 를 선택합니다.

6. 나머지는 기본값으로 두고 **다음: 디스크**를 선택합니다.
7. 디스크는 기본값으로 두고 **다음: 네트워킹**을 선택합니다.
8. 가상 네트워크로 **Spoke-01**을 선택했는지와 서브넷이 **Jump-SN**인지 확인합니다.
9. **퍼블릭 IP**에 대해 새 기본 퍼블릭 IP 주소 이름(Jump-Srv-ip)을 그대로 적용합니다.
11. 나머지는 기본값으로 두고 **다음: 관리**를 선택합니다.
12. **끄기**를 선택하여 부팅 진단을 사용하지 않도록 설정합니다. 나머지는 기본값으로 두고 **검토 + 만들기**를 선택합니다.
13. 요약 페이지에서 설정을 검토한 다음, **만들기**를 선택합니다.

다음 표의 정보를 사용하여 이름이 **Workload-Srv**인 다른 가상 머신을 구성합니다. 나머지 구성은 Srv-Jump 가상 머신과 동일합니다.

|설정  |값  |
|---------|---------|
|서브넷|**워크로드-SN**|
|공용 IP|**없음**|
|공용 인바운드 포트|**없음**|

### <a name="add-a-route-table-and-default-route"></a>경로 테이블 및 기본 경로 추가

인터넷을 통해 Jump-Srv에 연결하도록 하려면 경로 테이블과 **Jump-SN** 서브넷에서 인터넷으로의 기본 게이트웨이 경로를 만들어야 합니다.

1. Azure Portal에서 **리소스 만들기**를 선택합니다.
2. 검색 상자에 **경로 테이블**을 입력한 다음, **경로 테이블**을 선택합니다.
3. **만들기**를 선택합니다.
4. **이름**에 **RT-01**을 입력합니다.
5. 구독을 선택하고, 리소스 그룹으로 **FW-Manager**를, 지역으로 **(미국) 미국 동부**를 선택합니다.
6. **만들기**를 선택합니다.
7. 배포가 완료되면 **RT-01** 경로 테이블을 선택합니다.
8. **경로**를 선택한 다음, **추가**를 선택합니다.
9. **경로 이름**으로 **jump-to-inet**을 입력합니다.
10. **주소 접두사**로 **0.0.0.0/0**을 입력합니다.
11. **다음 홉 유형**으로 **인터넷**을 선택합니다.
12. **확인**을 선택합니다.
13. 배포가 완료되면 **서브넷**을 선택한 다음, **연결**을 선택합니다.
14. **가상 네트워크**에 대해 **Spoke-01**을 선택합니다.
15. **서브넷**에 대해 **Jump-SN**을 선택합니다.
16. **확인**을 선택합니다.

### <a name="test-the-rules"></a>규칙 테스트

이제 방화벽 규칙이 예상대로 작동하는지 테스트합니다.

1. Azure Portal에서 **Workload-Srv** 가상 머신에 대한 네트워크 설정을 검토하고 프라이빗 IP 주소를 참고합니다.
2. 원격 데스크톱을 **Jump-Srv** 가상 머신과 연결하고 로그인합니다. 여기에서 원격 데스크톱 연결을 **Workload-Srv** 프라이빗 IP 주소로 엽니다.

3. Internet Explorer를 열고 [https://www.google.com]\(https://www.microsoft.com )을 찾습니다.
4. Internet Explorer 보안 경고에서 **확인** > **닫기**를 선택합니다.

   Microsoft 홈페이지가 표시됩니다.

5. [https://www.microsoft.com]\(https://www.google.com ) 로 이동합니다.

   방화벽에서 차단해야 합니다.

이제 방화벽 규칙이 작동하는지 확인했습니다.

* 다른 모든 FQDN이 아닌 허용된 FQDN 하나만 찾아볼 수 있습니다.



## <a name="next-steps"></a>다음 단계

> [!div class="nextstepaction"]
> [신뢰할 수 있는 보안 파트너에 대해 알아보기](trusted-security-partners.md)
