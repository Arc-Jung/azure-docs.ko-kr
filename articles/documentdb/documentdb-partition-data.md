<properties      
    pageTitle="DocumentDB에서 데이터 분할 | Azure"      
    description="DocumentDB에서 데이터를 분할하는 방법 및 해시, 범위 및 조회 분할을 사용해야 하는 경우에 대해 알아봅니다."          
    services="documentdb"      
    authors="arramac"      
    manager="johnmac"      
    editor="monicar"      
    documentationCenter=""/> <tags      
    ms.service="documentdb"      
    ms.workload="data-services"      
    ms.tgt_pltfrm="na"      
    ms.devlang="na"      
    ms.topic="article"      
    ms.date="05/28/2015"      
    ms.author="arramac"/>

# DocumentDB에서 데이터 분할

[Microsoft Azure DocumentDB](../../services/documentdb/)는 신속하고 예측 가능한 성능을 얻을 수 있고, 응용 프로그램 증가에 따라 효율적인 *확장*이 가능하도록 설계되었습니다. DocumentDB는 웹 및 모바일 앱의 MSN 제품군을 지원하는 사용자 데이터 저장소와 같이 Microsoft에서 대규모 프로덕션 서비스를 지원하기 위해 사용됩니다.

일반적으로 **분할(sharding)**이라고 부르는 개념인 데이터 수평 분할을 통해 DocumentDB 응용 프로그램에 대한 저장소 및 처리량 측면에서 거의 무제한적인 확장성을 얻을 수 있습니다. DocumentDB 계정은 **컬렉션**이라고 부르는 스택 가능한 단위를 통해 비용과 비례적으로 확장될 수 있습니다. 컬렉션 간 데이터 분할 효과는 데이터 형식 및 액세스 패턴에 따라 달라집니다.

이 문서를 읽은 다음에는 다음과 같은 질문에 답할 수 있습니다.

 - 해시, 범위 및 조회 분할이란 무엇인가요?
 - 각 분할 기법을 사용해야 하는 경우와 그 이유는 무엇인가요?
 - Azure DocumentDB에서 분할된 응용 프로그램을 작성할 때는 어떻게 하나요?

이 문서에서는 분할에 대한 몇 가지 개념을 제공합니다. DocumentDB .NET SDK를 사용하여 데이터를 분할하는 코드를 작성할 준비가 된 경우 [DocumentDB .NET SDK를 사용하여 데이터 분할](documentdb-sharding.md)을 참조하세요.

## 컬렉션 = 분할

데이터 분할 기법에 대해 자세히 알아보려면 먼저 컬렉션이 무엇인지에 대해 이해하는 것이 중요합니다. 이미 알고 있듯이, 컬렉션은 JSON 문서의 컨테이너입니다. DocumentDB에서 컬렉션은 *논리적* 컨테이너일 뿐만 아니라 *물리적* 컨테이너이기도 합니다. 이러한 컬렉션은 저장 프로시저 및 트리거에 대한 트랜잭션 경계이며, 쿼리 및 CRUD 작업에 대한 진입점입니다. 각 컬렉션에는 동일 계정에서 다른 컬렉션과 공유되지 않는 예약된 처리량이 지정됩니다. 따라서 컬렉션을 추가하고 이들 간에 문서를 배포함으로써 저장소 및 처리량 측면에서 응용 프로그램을 확장할 수 있습니다.

컬렉션은 관계형 데이터베이스의 테이블과 동일하지 않습니다. 컬렉션은 스키마를 강제 적용하지 않습니다. 따라서 동일한 컬렉션에서도 다양한 스키마를 사용해서 여러 유형의 문서를 저장할 수 있습니다. 하지만 테이블에서와 같은 방식으로 컬렉션을 사용해서 단일 유형의 개체를 저장할 수도 있습니다. 모델 효율성은 쿼리 및 트랜잭션에 데이터가 표시되는 방법에 따라서만 결정됩니다.

## DocumentDB에서 분할

Azure DocumentDB에서 데이터 분할에 사용되는 가장 일반적인 기법은 *범위 분할*, *조회 분할* 및 *해시 분할*입니다. 일반적으로 문서 내에서 단일 JSON 속성 이름을 "timestamp" 또는 "userID"와 같은 분할 키로 지정합니다. 일부 경우에는 내부 JSON 속성이거나 각 고유 문서 유형에 대해 서로 다른 속성 이름일 수 있습니다.

이러한 기법들에 대해 조금 더 자세히 살펴보겠습니다.

## 범위 분할

범위 분할에서는 분할 키가 특정 범위 내에 있는지 여부에 따라 분할이 지정됩니다. 이 분할은 일반적으로 *time stamp* 속성(예: 2015년 2월 1일부터 2015년 2월 2일 사이의 eventTime)을 사용한 분할에 사용됩니다.

> [AZURE.TIP]쿼리가 분할 키에 대한 특정 범위 값으로 제한된 경우에는 범위 분할을 사용해야 합니다.

## 조회 분할

조회 분할에서는 특정 분할에 고유한 분할 값을 지정하는 조회 맵(분할 맵)을 기준으로 분할이 지정됩니다. 이 분할은 일반적으로 지역별 분할(예: 노르웨이, 덴마크 및 스웨덴이 포함된 스칸디나비아 분할)에 사용됩니다.

> [AZURE.TIP]조회 분할은 다중 테넌트 응용 프로그램을 관리할 때 가장 높은 관리 수준을 제공합니다. 다중 테넌트를 단일 컬렉션에 지정하거나, 단일 테넌트를 단일 컬렉션에 지정하거나, 여러 컬렉션 간에 단일 테넌트를 지정할 수도 있습니다.

## 해시 분할

해시 분할에서는 분할이 해시 함수 값을 기준으로 지정되기 때문에 여러 분할 간에 요청 및 데이터를 고르게 배포할 수 있습니다. 이 분할은 일반적으로 많은 수의 고유 클라이언트에서 생성 또는 소비되는 데이터를 분할하는 데 사용되며, 사용자 프로필, 카탈로그 항목 및 IoT("사물 인터넷") 원격 분석 데이터를 저장하는 데 유용합니다.

> [AZURE.TIP]조회 분할을 통해 열거하기에 엔터티 수가 너무 많은 경우(예: 사용자 또는 장치) 그리고 요청 속도가 엔터티 간에 상당히 균일한 경우에는 항상 해시 분할을 사용해야 합니다.

## 올바른 분할 기법 선택

그렇다면 어떤 분할 기법이 적합할까요? 적합한 분할 기법은 일반적인 액세스 패턴과 데이터 유형에 따라 달라집니다. 디자인 타임에 올바른 분할 기법을 선택하면 기술적 문제를 방지하고 데이터 크기 및 요청 볼륨의 증가를 처리할 수 있습니다.

- **범위 분할**은 일반적으로 날짜 컨텍스트에서 사용되며, 타임스탬프별로 분할을 에이징하는 쉽고 자연스러운 메커니즘을 제공합니다. 또한 분할 경계에 맞게 조정되므로 쿼리가 일반적으로 시간 범위로 제한되는 경우에도 유용합니다. 
- **조회 분할**을 통해서는 정렬되지 않고 관련되지 않은 데이터 집합을 자연스러운 방식으로 그룹화하고 구성할 수 있습니다. 예를 들어 조직별로 테넌트를 그룹화하고 지리적 위치별로 주를 그룹화할 수 있습니다. 조회는 또한 컬렉션 간 데이터 마이그레이션을 위한 미세 조정 기능을 제공합니다. 
- **해시 분할**은 프로비전된 저장소 및 처리량을 효율적으로 사용할 수 있도록 요청을 균일하게 부하 분산하는 데 유용합니다. *일관적인 해싱* 알고리즘을 사용하면 분할을 추가 또는 제거할 때 이동해야 하는 데이터의 양을 최소화할 수 있습니다.

분할 기법은 하나만 선택할 필요가 없습니다. 시나리오에 따라 이러한 기법을 *조합*해서 사용하는 것도 유용할 수 있습니다. 예를 들어 차량 원격 분석 데이터를 저장하는 경우에는 분할을 쉽게 관리할 수 있도록 타임스탬프에 따른 범위로 장치 원격 분석 데이터를 분할하고 처리량 확장을 위해(범위-해시 조합 분할) VIN(차량 식별 번호)에 따라 다시 하위 분할을 수행할 수 있습니다.

## 분할된 응용 프로그램 개발
DocumentDB에서 분할된 응용 프로그램을 개발할 때는 세 가지 주요 디자인 영역에 주의해야 합니다.

- 생성 및 읽기(쿼리 포함)를 올바른 컬렉션으로 라우팅하는 방법.
- 분할 맵이라고 부르는 분할 해결 구성을 영구 저장하고 검색하는 방법.
- 데이터 및 요청 볼륨 증가에 따라 분할을 추가/제거하는 방법.

이러한 각 영역에 대해 조금 더 자세히 살펴보겠습니다.

## 생성 및 쿼리 라우팅

문서 생성 요청 라우팅은 지금까지 설명한 세 가지 모든 기법에 대해 직관적인 방법입니다. 문서는 분할 키에 따라 해시, 조회 또는 범위 값으로부터 분할에서 생성됩니다.

쿼리 및 읽기는 일반적으로 단일 분할 키로 범위가 지정되므로 쿼리를 일치하는 분할로만 분산할 수 있습니다. 하지만 모든 데이터 간의 쿼리를 위해서는 요청을 여러 분할로 *분산*하고 결과를 병합해야 합니다. 최상위 N개 결과를 인출할 때와 같이 결과를 병합하기 위해서는 일부 쿼리에서 사용자 지정 논리를 수행해야 합니다.

## 분할 맵 관리

또한 분할 맵을 저장하는 방법, 클라이언트에서 이를 로드하고 변경 시 업데이트를 수신하는 방법 및 여러 클라이언트 간에 공유되는 방법을 결정해야 합니다. 분할 맵이 자주 변경되지 않을 경우에는 이를 단순히 응용 프로그램 구성 파일에 저장할 수 있습니다.

그렇지 않으면, 이를 영구 저장소에 저장할 수 있습니다. 프로덕션 환경에서 자주 볼 수 있었던 일반적인 디자인 패턴은 분할 맵을 JSON으로 직렬화하고 DocumentDB 컬렉션 내에도 저장하는 방법입니다. 그런 다음에는 클라이언트가 추가적인 라운드 트립을 방지하기 위해 맵을 캐시하고 변경 사항을 주기적으로 폴링할 수 있습니다. 클라이언트가 분할 맵을 수정할 수 있는 경우, 일관적인 이름 지정 스키마를 사용하고 분할 맵에 대한 일관적인 업데이트를 허용할 수 있도록 낙관적 동시성(eTags)을 사용하는지 확인해야 합니다.

## 분할 추가 및 제거

DocumentDB에서는 언제라도 컬렉션을 추가 및 제거하고, 이를 사용해서 새로 수신되는 데이터를 저장하거나 기존 컬렉션에서 사용할 수 있는 데이터의 균형을 재조정할 수 있습니다. 컬렉션 수에 대해서는 [제한](documentdb-limits.md) 페이지를 검토하세요. 언제라도 Microsoft에 문의해서 이러한 제한을 늘릴 수 있습니다.

조회 및 범위 분할을 사용한 새로운 분할 추가 및 제거는 직관적입니다. 예를 들어 새 지리적 위치 또는 최근 데이터에 대한 새 시간 범위를 추가할 때는 분할 맵에 새 분할을 첨부하기만 하면 됩니다. 기존 분할을 여러 분할로 분할하거나 두 분할을 병합하기 위해서는 약간의 추가 노력이 필요합니다. 다음과 같은 두 가지 경우가 필요할 수 있습니다.

- 분할을 읽기 위해 오프라인으로 전환합니다.
- 경로는 마이그레이션 중 이전의 분할 구성뿐만 아니라 새로운 분할 구성을 사용해서 두 분할을 모두 읽습니다. 트랜잭션 및 일관성 수준 보증은 마이그레이션이 완료될 때까지 제공되지 않습니다.

해싱은 분할 추가 및 제거 시에 비교적 더 복잡합니다. 단순 해싱 기법은 셔플링을 일으킬 수 있으며 대부분의 데이터를 이동해야 합니다. **일관적인 해싱**을 사용하면 데이터의 일부만 이동되도록 보장할 수 있습니다.

데이터 이동을 요구하지 않고 새 분할을 추가할 수 있는 비교적 쉬운 방법은 데이터를 새로운 컬렉션에 넣어 놓고 이전 및 신규 컬렉션 간에 요청을 분산하는 방법입니다. 하지만 이러한 방법은 드문 경우(예: 최대 사용 시간 워크로드 분산 및 데이터 이동 가능 시까지 일시적으로 데이터를 저장하기 위한 목적)에만 사용해야 합니다.

## 다음 단계
이 문서에서는 DocumentDB에서 데이터를 분할하는 방법에 대한 몇 가지 일반적인 기법들을 소개하고 언제 어떤 기법을 사용하거나 어떤 기법을 조합해야 하는지에 대해 살펴봤습니다.

-   이제 이 [문서](documentdb-sharding.md)에서 DocumentDB SDK와 함께 파티션 해결 프로그램을 사용하여 데이터를 분할하는 방법을 살펴보겠습니다. 
-   [지원되는 SDK](https://msdn.microsoft.com/library/azure/dn781482.aspx) 중 하나 다운로드
-   궁금한 사항이 있는 경우 [MSDN 지원 포럼](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureDocumentDB)을 통해 문의하세요.
   


 

<!---HONumber=July15_HO3-->