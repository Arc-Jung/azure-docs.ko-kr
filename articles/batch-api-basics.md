<properties 
	pageTitle="Azure 배치에 대한 API 기본 사항" 
	description="개발자에게 Azure 일괄 처리 API 및 일괄 처리 서비스를 소개하는 개념" 
	services="batch" 
	documentationCenter=".net" 
	authors="yidingzhou" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="batch" 
	ms.devlang="multiple" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="big-compute" 
	ms.date="02/02/2015" 
	ms.author="yidingz, kabatta"/>


<!--The next line, with one pound sign at the beginning, is the page title--> 
# Azure 배치에 대한 API 기본 사항

Azure 배치 서비스는 확장 가능한 분산 계산을 위한 작업 예약 프레임워크를 제공합니다. 이 배치 서비스는 Azure에서 여러 클러스터 및 데이터 센터에 위치한 가상 컴퓨터 집합을 유지 관리합니다. 이 배치 서비스는 요청 시에 또는 이러한 지정된 VM 컬렉션에 대해 특정 시간에 실행되도록 예약된 하나 이상의 프로그램을 실행하여 분산 계산을 수행합니다. 배치 서비스는 리소스 요구 사항, 사양 및 사용자가 제공한 제약 조건에 따라 계산 태스크가 실행되도록 이러한 VM을 관리합니다.

배치 서비스를 사용하면 계산 리소스의 큐 대기, 예약, 할당 및 관리를 위한 코드를 작성할 필요가 없습니다. 이 서비스를 사용하면 기본 플랫폼에서 진행되는 작업 예약 및 리소스 관리의 복잡성에 대해 걱정하지 않고 특정 응용 프로그램에 집중할 수 있습니다. 또한 배치 서비스를 통해 이러한 작업의 위치 뿐 아니라 처리해야 하는 데이터에 대한 액세스도 최적화할 수 있습니다.

다음은 배치 서비스를 사용할 때 가능한 일부 시나리오입니다.

- 계산이 많은 병렬 처리

- 파일의 일별 정리

- 일괄 처리

다음 섹션을 참조하여 배치 서비스에 대해 자세히 알아볼 수 있습니다.

- [배치 서비스의 리소스](#resource)

- [배치 서비스의 워크플로](#workflow)

- [파일 및 디렉터리](#file)

- [응용 프로그램 크기 조정](#scaling)

- [응용 프로그램용 인증서](#cert)

- [예약 우선 순위](#scheduling)

- [태스크에 대한 환경 설정](#environment)

## <a name="resource"></a> 배치 서비스의 리소스

배치 서비스를 사용하는 경우 다음 리소스를 활용할 수 있습니다.

- [계정](#account)

- [태스크용 가상 컴퓨터](#taskvm)

- [풀](#pool)

- [작업 항목](#workitem)

- [작업](#job)

- [작업](#task)

### <a name="account"></a>계정

배치 계정은 배치 서비스 내에서 고유 하게 식별되는 엔터티입니다. 모든 처리는 배치 계정을 통해 수행됩니다. 배치 서비스를 사용하여 작업을 수행할 때 계정의 이름 및 키가 필요합니다. 현재 새 계정을 만들려면 Azure 배치 팀에 문의해야 합니다. 계정이 만들어지면 키가 제공됩니다.

### <a name="taskvm"></a>태스크용 가상 컴퓨터

TVM(태스크용 가상 컴퓨터)은 응용 프로그램의 특정 작업을 전담하는 Azure VM입니다. TVM의 크기에 따라 TVM에 할당되는 CPU 코어 수, 메모리 용량 및 로컬 파일 시스템 크기가 결정됩니다. [Azure용 가상 컴퓨터 및 클라우드 서비스 크기](http://msdn.microsoft.com/library/dn197896.aspx)에 설명된 대로 TVM은 소형, 대형 또는 초대형 가상 컴퓨터일 수 있습니다.

TVM이 실행할 수 있는 프로그램의 종류에는 실행 파일(.exe), 명령 파일(.cmd), 배치 파일(.bat) 및 스크립트 파일이 포함됩니다. 또한 TVM에는 다음과 같은 특성이 있습니다.

- 태스크별로 구분된 파일 시스템 폴더 및 공유 파일 시스템 폴더

- 태스크별 폴더에 기록되는 Stdout.txt 및 stderr.txt 파일

- 처리를 위한 환경 변수

- 액세스를 제어하도록 구성된 방화벽 설정

### <a name="pool"></a>풀

풀은 응용 프로그램이 실행되는 TVM 컬렉션입니다. 사용자가 풀을 만들 수도 있고, 완료할 작업을 지정한 경우에는 배치 서비스에서 자동으로 풀을 만듭니다. 응용 프로그램의 요구를 충족하는 풀을 만들고 관리할 수 있습니다. 풀은 풀이 생성된 배치 계정을 통해서만 사용할 수 있습니다. 하나의 배치 계정에는 둘 이상의 풀이 있을 수 있습니다.

풀에 추가된 모든 TVM에는 고유 이름 및 연결된 IP 주소가 할당됩니다. TVM이 풀에서 제거되면 운영 체제에 대해 수행된 변경 내용, 모든 해당 로컬 파일, 해당 이름 및 해당 IP 주소가 손실됩니다. TVM이 풀에서 제거되면 수명 기간이 끝납니다.

풀에 포함된 TVM 간 통신을 허용하도록 풀을 구성할 수 있습니다. 내부 풀 통신이 필요하면 배치 서비스는 풀의 각 TVM에서 1100보다 큰 포트를 허용합니다. 풀에 있는 각 TVM은 이 포트 범위로 들어오는 연결만 허용하고 풀의 다른 TVM에서 들어오는 연결은 제한하도록 구성됩니다. 응용 프로그램에 TVM 간 통신이 필요하지 않으면 배치 서비스는 풀에 여러 다른 클러스터 또는 데이터 센터에 포함된 많은 수의 TVM을 잠재적으로 할당하여 더 많은 병렬 처리를 가능하게 할 수 있습니다.

풀을 만들 때는 다음과 같은 특성을 지정할 수 있습니다.

- 풀에 포함된 TVM의 크기

- TVM에서 실행되는 운영 체제 제품군 및 버전

- 풀에 사용할 수 있어야 하는 TVM 개수 목표

- 풀에 대한 크기 조정 정책

- 풀에 포함된 TVM의 통신 상태

- 풀에 포함된 TVM의 시작 태스크

풀을 만들 때 풀을 연결해야 하는 저장소 계정을 지정할 수 있습니다. 배치 서비스는 더 나은 네트워크 연결 및 대역폭 용량을 갖는 데이터 센터의 TVM을 지정된 저장소 계정에 할당합니다. 이를 통해 작업 중에 데이터에 보다 효과적으로 액세스할 수 있습니다.

### <a name="workitem"></a>작업 항목

작업 항목은 풀의 TVM에 대해 계산이 수행되는 방식을 지정합니다. 작업 항목에는 다음과 같은 구성 항목이 포함됩니다.

1.TVM에서 처리를 수행하는 프로그램

2.프로그램에 대한 명령줄 매개 변수

3.계산의 우선 순위

4.계산이 다시 수행되어야 할지 정의하는 작업을 비롯한 계산의 일정

작업 항목은 항상 풀에 할당되며 풀은 이미 존재하거나 작업 항목이 만들어질 때 자동으로 만들어질 수 있습니다.

### <a name="job"></a>작업

작업은 실행 중인 작업 항목의 인스턴스이며 태스크 컬렉션으로 구성됩니다. 배치 서비스는 작업 항목의 구성에 따라 작업을 인스턴스화합니다. 작업은 작업 항목과 연결된 풀의 TVM을 사용합니다.

### <a name="task"></a>작업

태스크는 작업과 연결되고 TVM에서 실행되는 계산의 단위입니다. 태스크는 다음 리소스를 사용합니다.

- 작업 항목에 지정된 프로그램

- 처리할 데이터를 포함하는 리소스 파일. 이러한 파일은 Blob 저장소에서 TVM으로 자동으로 복사됩니다. 자세한 내용은 파일 및 디렉터리를 참조하세요.

- 프로그램에 필요한 환경 설정. 자세한 내용은 태스크에 대한 환경 설정을 참조하세요.

- 계산이 수행되어야 하는 제약 조건. 예를 들어 태스크가 실행되도록 할당된 최대 시간, 태스크가 실패한 경우 다시 시도되는 최대 횟수 및 작업 디렉터리에 파일을 보관하는 최대 시간이 여기에 해당합니다.

TVM에서 계산을 수행하도록 정의할 수 있는 태스크 외에도 배치 서비스에서 제공하는 다음과 같은 특수한 태스크를 사용할 수 있습니다.

- [시작 태스크](#starttask)

- [작업 관리자 태스크](#jobmanagertask)

#### <a name="starttask"></a>시작 태스크

시작 태스크를 풀과 연결하여 풀에 포함된 TVM의 운영 체제를 구성할 수 있습니다. 소프트웨어 설치 및 백그라운드 프로세스 시작은 시작 태스크가 수행할 수 있는 일부 동작입니다. 시작 태스크는 풀에 남아 있는 한, TVM이 시작될 때마다 실행됩니다.

시작 태스크는 풀 추가 작업을 위한 요청 본문에 XML 섹션을 추가하여 정의합니다. 다음 예제는 시작 태스크의 기본 정의를 보여 줍니다.

	{
		"commandLine":"mypoolsetup.exe",
		"resourceFiles":
		[
			{
				"blobSource":"http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d",
				"filePath":"mypoolsetup.exe"
			},
			{
				"blobSource":"http://account.blob.core.windows.net/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d",
				"filePath":"myapp2.exe"
			}
		],
		"maxTaskRetryCount":0
	}


#### <a name="jobmanagertask"></a>작업 관리자 태스크

작업 관리자 태스크는 다른 모든 작업이 시작되기 전에 시작됩니다. 작업 관리자 태스크는 다음과 같은 이점을 제공합니다.

- 작업이 만들어질 때 배치 서비스가 자동으로 생성합니다.

- 작업의 다른 태스크보다 먼저 진행되도록 예약됩니다.

- 풀 크기를 줄일 경우 연결된 해당 TVM이 풀에서 마지막으로 제거됩니다.

- 다시 시작해야 할 경우 가장 높은 우선 순위가 지정됩니다. 유휴 TVM을 사용할 수 없는 경우 배치 서비스는 풀에서 실행 중인 태스크 중 하나를 종료하여 실행을 위한 공간을 확보할 수 있습니다.

- 해당 종료는 작업의 모든 태스크에 대한 종료에 연결될 수 있습니다.

작업의 작업 관리자 태스크는 다른 작업의 태스크보다 우선 순위가 높지 않습니다. 작업 간에는 작업 수준 우선 순위만 준수됩니다. 작업 관리자 태스크는 작업 항목 추가 작업을 위한 요청 본문에 XML 섹션을 추가하여 정의합니다. 다음 예제는 작업 관리자 태스크의 기본 정의를 보여 줍니다.

	{
		"name":"jmTask",
		"commandLine":"myapp1.exe",
		"resourceFiles":
		[
			{
				"blobSource":"http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d",
				"filePath":"myapp1.exe"
			},
			{
				"blobSource":"http://account.blob.core.windows.net/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d",
				"filePath":"myapp2.exe"
			}
		],
		"taskConstraints":
		{
			"maxWallClockTime":"PT1H",
			"maxTaskRetryCount":0,
			"retentionTime":"PT1H"
		},
		"killJobOnCompletion":true,
		"runElevated":false,
		"runExclusive":true
	}




## <a name="workflow"></a>배치 서비스의 워크플로

배치 서비스를 사용하려면 배치 계정이 필요하고, 서비스의 여러 리소스를 사용하여 계산을 예약합니다. 배치 서비스에서 분산 컴퓨팅 시나리오를 만들 경우 다음과 같은 기본 워크플로를 사용합니다.

1.분산 컴퓨팅 시나리오에서 사용할 파일을 Azure 저장소 계정에 업로드합니다. 이러한 파일은 배치 서비스에서 액세스할 수 있도록 저장소 계정에 있어야 합니다. 배치 서비스는 해당 파일을 태스크가 실행될 때 TVM에 로드합니다.

2.저장소 계정에 종속 이진 파일을 업로드합니다. 이진 파일에는 태스크 및 종속 어셈블리에서 실행되는 프로그램이 포함됩니다. 이러한 파일은 저장소에서 액세스할 수는 있어야 하며 TVM에 로드됩니다.

3.TVM 풀을 만듭니다. 풀이 만들어질 때 사용할 태스크용 가상 컴퓨터의 크기를 할당할 수 있습니다. 태스크가 실행될 때 이 풀에서 TVM에 태스크가 할당됩니다.

4.작업 항목을 만듭니다. 작업 항목을 만들 때 작업이 자동으로 만들어집니다. 작업 항목을 사용하여 태스크 작업을 관리할 수 있습니다.

5.태스크를 작업 항목에 추가합니다. 각 태스크는 사용자가 업로드한 프로그램을 사용하여 업로드된 파일의 정보를 처리합니다.

6.출력의 결과를 모니터링합니다.

## <a name="files"></a>파일 및 디렉터리

각 태스크에는 태스크에 의해 실행되는 프로그램, 태스크에 의해 처리되는 데이터 및 태스크가 수행한 처리의 출력을 저장하기 위한 0개 이상의 디렉터리 및 파일이 만들어지는 작업 디렉터리가 있습니다. 이러한 디렉터리 및 파일은 한 작업을 실행하는 동안 다른 태스크에서 사용될 수 있습니다. TVM의 모든 작업, 파일 및 디렉터리는 단일 사용자 계정에 의해 소유됩니다.

배치 서비스는 TVM의 파일 시스템 일부를 루트 디렉터리로 노출합니다. TVM의 루트 디렉터리는 WATASK\_TVM\_ROOT\_DIR 환경 변수를 통해 태스크에서 사용될 수 있습니다. 환경 변수 사용에 대한 자세한 내용은 태스크에 대한 환경 설정을 참조하세요.

루트 디렉터리에는 다음과 같은 하위 디렉터리가 포함됩니다.

- **태스크** - 이 위치는 TVM에서 실행되는 태스크에 속하는 모든 파일이 저장되는 위치입니다. 각 태스크에 대해 배치 서비스는 고유 경로의 작업 디렉터리를 %WATASK\_TVM\_ROOT\_DIR%/tasks/workitemName/jobName/taskName/ 형태로 만듭니다. 이 디렉터리는 태스크에 대한 읽기/쓰기 액세스를 제공합니다. 이 디렉터리 아래에서 태스크는 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있으며 이 디렉터리는 태스크에 대해 지정된 RetentionTime 제약 조건에 따라 유지됩니다.

- **공유** - 이 위치는 계정의 모든 태스크에 대한 공유 디렉터리입니다. TVM에서 공유 디렉터리는 %WATASK\_TVM\_ROOT\_DIR%/shared에 있습니다. 이 디렉터리는 태스크에 대한 읽기/쓰기 액세스를 제공합니다. 태스크는 이 디렉터리 아래에서 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있습니다.

- **시작** - 이 위치는 시작 태스크에서 작업 디렉터리로 사용됩니다. 시작 태스크를 시작하기 위해 배치 서비스에서 다운로드한 모든 파일도 이 디렉터리 아래에 저장됩니다. TVM에서 시작 디렉터리는 %WATASK\_TVM\_ROOT\_DIR%/start에 있습니다. 태스크는 이 디렉터리 아래에서 파일을 만들고, 읽고, 업데이트하고, 삭제할 수 있으며 이 디렉터리는 시작 태스크가 운영 체제를 구성하는 데 사용할 수 있습니다.

풀에서 TVM이 제거되면 TVM에 저장된 모든 파일이 제거됩니다.

## <a name="scaling"></a>응용 프로그램 크기 조정

응용 프로그램은 필요한 계산을 수용하도록 자동으로 쉽게 확장 또는 축소될 수 있습니다. 현재 작업 부하 및 리소스 사용량 통계에 따라 풀의 TVM 수를 동적으로 조정할 수 있습니다. 또한 자동으로 크기가 조정되도록 구성하여 전반적인 응용 프로그램 실행 비용을 최적화할 수 있습니다. 풀이 만들어질 때 크기 조정 설정을 지정할 수 있고 언제든지 구성을 업데이트할 수 있습니다.

일련의 크기 조정 수식을 사용하여 응용 프로그램의 자동 크기 조정을 지정합니다. 다음 크기 조정 간격에 대해 풀에 있는 TVM의 수를 확인하는 데 수식을 사용할 수 있습니다. 예를 들어 풀에서 예약할 많은 수의 태스크를 제출해야 합니다. 보류 중인 작업의 현재 수 및 작업의 완료율에 따라 풀의 크기를 지정하는 크기 조정 수식을 풀에 할당할 수 있습니다. 배치 서비스는 수식을 정기적으로 계산하고 작업에 따라 풀 크기를 조정합니다.

수식은 다음 메트릭을 기반으로 할 수 있습니다.

- **시간 메트릭** - 지정된 시간 동안 5분 간격으로 수집되는 통계를 기반으로 합니다.

- **리소스 메트릭** - CPU 사용량, 대역폭 사용량, 메모리 사용량 및 TVM 수를 기반으로 합니다.

- **태스크 메트릭** - 활성, 보류 중 및 완료됨과 같은 태스크의 상태를 기반으로 합니다.

응용 프로그램의 자동 크기 조정에 대한 자세한 내용은 태스크용 가상 컴퓨터의 자동 크기 조정 구성을 참조하세요.

## <a name="cert"></a>응용 프로그램용 인증서

일반적으로 비밀 정보를 암호화할 때는 인증서를 사용해야 합니다. TVM에 인증서를 설치할 수 있습니다. 암호화된 비밀은 명령줄 매개 변수에서 태스크에 전달되거나 리소스 중 하나에 포함되며 암호를 해독하는 데 설치된 인증서를 사용할 수 있습니다. 비밀 정보의 예로는 저장소 계정에 대한 키가 있습니다.

인증서 추가 작업을 사용하여 배치 계정에 인증서를 추가할 수 있습니다. 그런 다음 인증서를 기존 풀이나 새 풀에 연결할 수 있습니다. 인증서가 풀에 연결되면 배치 서비스가 풀의 각 TVM에 인증서를 설치합니다. 배치 서비스는 TVM이 시작되면 시작 태스크 및 작업 관리자 태스크를 포함하는 태스크를 시작하기 전에 해당 인증서를 설치합니다.

## <a name="scheduling"></a>예약 우선 순위

작업 항목을 만들 때 우선 순위를 할당할 수 있습니다. 작업 항목의 각 작업은 이러한 우선 순위로 만들어집니다. 배치 서비스는 작업의 우선 순위 값을 사용하여 계정 내의 작업 예약 순서를 결정합니다. 우선 순위 값의 범위는-1000에서 1000까지이며 -1000이 가장 낮은 우선 순위를, 1000이 가장 높은 우선 순위를 나타냅니다. 작업 업데이트 작업을 사용하여 작업의 우선 순위를 업데이트할 수 있습니다.

동일한 계정 내에서 우선 순위가 높은 작업은 우선 순위가 낮은 작업보다 먼저 예약됩니다. 하나의 계정에서 우선 순위가 더 높은 작업이 다른 계정에서 우선 순위가 더 낮은 다른 작업보다 먼저 예약되는 것은 아닙니다.

다른 풀의 예약 작업은 서로 별개입니다. 여러 다른 풀이 있을 때 연결된 풀에 유휴 TVM이 부족한 경우 우선 순위가 높은 작업이 먼저 예약된다고 보장할 수 없습니다. 동일한 풀에서는 우선 순위가 같은 작업이 예약될 기회가 동일합니다.

## <a name="environment"></a>태스크에 대한 환경 설정

태스크 컨텍스트에서 사용할 수 있는 환경 설정을 지정할 수 있습니다. 시작 태스크 및 하나의 작업에서 실행되는 태스크에 대한 환경 설정은 태스크 추가 또는 태스크 업데이트 작업의 요청 본문에 XML 섹션을 추가하여 정의합니다.

다음 예제는 환경 설정의 정의를 보여 줍니다.

배치 서비스는 작업에서 예약 된 모든 태스크에 대해 특정 환경 변수 집합을 설정합니다. 다음 표에는 배치 서비스가 모든 태스크에 대해 설정하는 환경 변수가 나와 있습니다.

<table>
  <tr>
   <th>환경 변수 이름
   </th>
   <th>
   설명
   </th>
  </tr>
 <tr>
  <td>
  WATASK_ ACCOUNT_NAME
  </td>
  <td>
  태스크가 속한 계정의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_WORKITEM_NAME
  </td>
  <td >태스크가 속한 작업 항목의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_JOB_NAME
  </td>
  <td >태스크가 속한 작업의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TASK_NAME
  </td>
  <td >현재 태스크의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_POOL_NAME
  </td>
  <td >태스크가 실행되는 풀의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TVM_NAME
  </td>
  <td >태스크가 실행되는 TVM의 이름
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TVM_ROOT_DIR
  </td>
  <td >TVM의 루트 디렉터리 전체 경로
  </td>
 </tr>
 <tr>
  <td>
  WATASK_PORTRANGE_LOW
  WATASK_PORTRANGE_HIGH
</td>
<td>
  내부 풀 통신을 사용되도록 설정된 경우 태스크가 통신에 사용할 수 있는 포트 범위(경계값 포함)입니다.
</td>
</table>


**참고** 

이러한 시스템 정의 변수는 덮어쓸 수 없습니다.

태스크 가져오기 작업을 사용하여 환경 설정 값을 검색할 수 있습니다.

<!--HONumber=46--> 
