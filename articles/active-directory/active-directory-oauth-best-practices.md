<properties
	pageTitle="Azure AD의 OAuth 2.0 모범 사례 | Microsoft Azure"
	description="이 문서에서는 Azure Active Directory에서 OAuth 2.0을 사용하는 응용 프로그램을 개발하기 위한 모범 사례를 설명합니다."
	services="active-directory"
	documentationCenter=".net"
	authors="priyamohanram"
	manager="mbaldwin"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="01/21/2016"
	ms.author="priyamo"/>


# Azure Active Directory의 OAuth 2.0 모범 사례

[AZURE.INCLUDE [active-directory-protocols](../../includes/active-directory-protocols.md)]

## State 매개 변수 사용

`state` 매개 변수는 무작위로 생성되고 다시 사용이 불가능한 값(일반적으로 GUID)이며 클라이언트가 요청에서 이 매개 변수를 보냅니다. 선택적 매개 변수이지만 요청에서 인증 코드에 사용하면 가장 좋습니다. 응답도 동일한 `state` 값을 포함하며 응용 프로그램은 응답을 사용하기 전에 상태 값이 동일한지 확인해야 합니다.

`state` 매개 변수는 클라이언트에 대한 교차 사이트 요청 위조(CSRF) 공격을 감지하는 데 도움이 됩니다. CSRF 공격에 대한 자세한 내용은 OAuth 2.0 권한 부여 프레임워크의 [교차 사이트 요청 위조](https://tools.ietf.org/html/rfc6749#section-10.12)를 참조하세요.

## 액세스 토큰 캐시

클라이언트 응용 프로그램에서의 네트워크 호출 및 그와 연결된 대기 시간을 최소화하려면 클라이언트 응용 프로그램이 OAuth 2.0 응답에 지정된 토큰 수명에 대한 액세스 토큰을 캐시해야 합니다. 토큰 수명을 결정하려면 `expires_in` 또는 `expires_on` 매개 변수 값을 사용합니다.

웹 API 리소스가 `invalid_token` 오류 코드를 반환하는 경우, 이는 리소스가 토큰이 만료되었다고 결정했음을 나타낼 수 있습니다. 클라이언트 및 리소스 시계 시간이 서로 다른 경우("시간차"라 함) 리소스는 토큰을 클라이언트 캐시에서 지우기 전에 토큰이 만료된 것으로 인식할 수 있습니다. 이 문제가 발생하면 계산된 토큰 수명이 아직 남아 있더라도 토큰을 캐시에서 지웁니다.

## 새로 고침 토큰 처리

새로 고침 토큰에는 지정된 수명이 없습니다. 일반적으로 새로 고침 토큰의 수명은 비교적 깁니다. 그러나 새로 고침 토큰이 만료되거나 해지되거나 원하는 작업을 위한 충분한 권한이 없는 경우가 있습니다. 클라이언트 응용 프로그램은 토큰 발급 끝점에서 반환하는 오류를 예상하고 정확히 처리해야 합니다.

새로 고침 토큰 오류가 포함된 응답을 받으면 현재 새로 고침 토큰을 삭제하고 새 인증 코드 또는 액세스 토큰을 요청합니다. 특히 인증 코드 부여 흐름에 새로 고침 토큰을 사용하는 경우 `interaction_required` 또는 `invalid_grant` 오류 코드가 포함된 응답을 받으면 새로 고침 토큰을 삭제하고 새 인증 코드를 요청합니다.

## 리소스 ID 매개 변수 확인

클라이언트 응용 프로그램은 응답에서 `resource_id` 매개 변수의 값을 확인해야 합니다. 그렇지 않으면 악성 서비스가 권한 상승 공격을 유도할 수 있습니다.

 공격을 방지하기 위해 권장되는 전략은 resource\_id가 액세스 중인 웹 API URL의 기본과 일치하는지 확인하는 것입니다. 예를 들어 https://service.contoso.com/data에 액세스하는 경우 `resource_id`는 https://service.contoso.com/일 수 있습니다. 클라이언트 응용 프로그램은 ID를 확인하는 신뢰할 수 있는 대체 방법이 있지 않은 한 기본 URL로 시작하지 않는 `resource_id`를 거부해야 합니다.

## 토큰 발급 및 다시 시도 지침

Azure AD는 클라이언트가 쿼리할 수 있는 여러 토큰 발급 끝점을 지원합니다. 예기치 않은 네트워크 또는 서버 오류를 처리하기 위해 이러한 끝점에 대한 다시 시도 논리를 구현할 때 다음 지침을 따르십시오.

일반적으로 다시 시도에 응답하는 데 실패하면 Azure AD 끝점 요청에 대해 HTTP 500 계열 오류 코드가 반환됩니다. 일부 시나리오에서 클라이언트는 Azure AD에 대해 자동화된 요청을 실행하는 응용 프로그램 또는 서비스입니다. WS-Federation 프로토콜을 사용하는 웹 기반 페더레이션 등의 다른 시나리오에서는 클라이언트가 웹 브라우저이며 최종 사용자가 직접 다시 시도해야 합니다.

### HTTP 500 계열 오류 응답을 기반으로 다시 시도 논리 구현

다시 시도 논리는 Active Directory 액세스 제어 서비스(ACS)가 HTTP 500 계열 오류를 반환하는 경우에 가장 좋습니다. 다음 내용이 포함됩니다.

- HTTP 오류 500 - 내부 서버 오류
- HTTP 오류 502 - 잘못된 게이트웨이
- HTTP 오류 503 - 서비스를 사용할 수 없음
- HTTP 오류 504 - 게이트웨이 시간 초과

개별 HTTP 코드가 다시 시도 논리에 명시적으로 나열될 수 있지만 HTTP 500 계열 오류가 반환되는 경우 다시 시도 논리를 호출하면 충분합니다.

일반적으로 HTTP 400 계열 오류 코드가 반환되는 경우에는 다시 시도 논리를 사용하지 않는 것이 좋습니다. ACS에서 400 계열 HTTP 오류 응답 코드가 반환되면 요청이 잘못되어 수정해야 한다는 것을 의미합니다.

다시 시도 논리는 HTTP 504(외부 서버 시간 초과) 또는 HTTP 500 오류 코드 계열과 같은 HTTP 오류 코드에 의해 트리거해야 하며 ACS90005와 같은 오류 코드에 의해 트리거하지 않아야 합니다. ACS 오류 코드는 참고용이며 변경될 수 있습니다.

### 다시 시도는 최적의 흐름 제어를 위해 백오프 타이머를 사용해야 함

클라이언트가 HTTP 500 계열 오류를 수신하면 요청을 다시 시도하기 전에 기다려야 합니다. 최상의 결과를 얻으려면 이후에 다시 시도할 때마다 이 시간 기간이 증가하는 것이 좋습니다. 이 방법을 통해 일시적인 오류를 빨리 해결할 뿐만 아니라 해결하는 데 오래 걸리는 일시적인 네트워크 또는 서버 문제에 대한 요청 비율을 최적화할 수 있습니다.

예를 들어 다시 시도 1: 1초, 다시 시도 2: 2초, 다시 시도 3: 4초 등과 같이 다시 시도 전의 지연 시간이 각 인스턴스마다 지수적으로 증가하는 지수 백오프 타이머를 사용합니다.

사용자 환경 요구사항을 기반으로 다시 시도 횟수 및 각 다시 시도 간의 시간을 조정합니다. 단, 5 분의 기간 동안 다시 시도 5회가 좋습니다. 시간 초과에 의해 발생한 실패는 해결하는 데 오래 걸립니다.

## 다음 단계

[Active Directory 인증 라이브러리(ADAL)](active-directory-authentication-libraries.md)

<!---HONumber=AcomDC_0601_2016-->