---
title: Azure VM 백업 정보
description: Azure VM 백업에 대해 알아보고 몇 가지 모범 사례를 확인합니다.
services: backup
author: rayne-wiselman
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 02/17/2019
ms.author: raynew
ms.openlocfilehash: c38c457bbf428d7252cf57168685201a2ca227ba
ms.sourcegitcommit: 6cab3c44aaccbcc86ed5a2011761fa52aa5ee5fa
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/20/2019
ms.locfileid: "56446803"
---
# <a name="about-azure-vm-backup"></a>Azure VM 백업 정보

이 문서에서는 [Azure Backup 서비스](backup-introduction-to-azure-backup.md)가 Azure VM을 백업하는 방법을 설명합니다.

## <a name="backup-process"></a>백업 프로세스

Azure Backup에서 Azure VM의 백업을 완료하는 방법은 다음과 같습니다.

1. 백업용으로 선택된 Azure VM의 경우 Azure Backup 서비스는 사용자가 지정한 백업 일정에 따라 백업 작업을 시작합니다.
2. 첫 번째 백업 중에 VM이 실행 중인 경우 백업 확장이 VM에 설치됩니다.
    - Windows VM의 경우 _VMSnapshot_ 확장이 설치됩니다.
    - Linux VM의 경우 _VMSnapshotLinux_ 확장이 설치됩니다.
3. 실행 중인 Windows VM의 경우 Backup이 VSS와 조정되어 VM의 앱 일관성이 있는 스냅숏을 만듭니다.
    - 기본적으로 Backup은 전체 VSS 백업을 만듭니다.
    - Backup 기능은 앱 일치 스냅숏을 만들 수 없는 경우 기본 스토리지의 파일 일치 스냅숏을 만듭니다(VM이 중지된 동안에는 애플리케이션 쓰기가 발생하지 않기 때문).
4. Linux VM의 경우 Backup에서 파일 일관성이 있는 백업을 수행합니다. 앱 일관성이 있는 스냅숏의 경우 수동으로 사전/사후 스크립트를 사용자 지정해야 합니다.
5. 스냅숏을 만든 후에는 데이터가 자격 증명 모음으로 전송됩니다. 
    - 각 VM 디스크를 병렬로 백업하여 백업이 최적화됩니다.
    - 백업 중인 각 디스크에 대해 Azure Backup은 디스크의 블록을 읽고, 이전 백업 이후에 변경된 데이터 블록만 식별하고 전송합니다(델타).
    - 스냅숏을 만든 후에는 데이터가 자격 증명 모음으로 전송됩니다.
    - 스냅숏 데이터가 자격 증명 모음에 즉시 복사되지 않을 수 있습니다. 사용량이 많은 시간에는 몇 시간이 걸릴 수 있습니다. VM에 대한 총 백업 시간은 일별 백업 정책의 경우 24시간 미만입니다.

6. 데이터 전송이 완료되면 스냅숏이 제거되고 복구 지점이 생성됩니다.

![Azure 가상 머신 백업 아키텍처](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

## <a name="encrypting-azure-vm-backups"></a>Azure VM 백업 암호화

Azure Backup을 사용하여 Azure VM을 백업하면 미사용 상태의 VM이 SSE(스토리지 서비스 암호화)를 사용하여 암호화됩니다. 또한 Azure Backup은 ADE(Azure Disk Encryption)를 사용하여 암호화된 Azure VM을 백업할 수 있습니다.


**암호화** | **세부 정보** | **지원**
--- | --- | ---
**ADE** | ADE는 Azure VM의 OS 및 데이터 디스크를 둘 다 암호화합니다.<br/><br/> ADE는 Key Vault에서 비밀로 보호되는 BEK(BitLocker 암호화 키) 또는 Azure Key Vault KEK(키 암호화 키)와 통합됩니다. | Azure Backup은 BEK만으로 또는 BEK와 KEK를 둘 다 사용해서 암호화된 관리형 및 비관리형 Azure VM의 백업을 지원합니다.<br/><br/> 두 BEK 모두 백업되고 암호화됩니다.<br/><br/> BEK 및 KEK가 백업된 이후에, 사용 권한이 있는 원하는 사용자는 키 및 비밀을 Key Vault로 복원하고 암호화된 VM을 복구할 수 있습니다.<br/><br/> 암호화된 키와 비밀을 권한 없는 사용자 또는 Azure에서 읽을 수 없습니다.
**SSE** | SSE를 사용하여 Azure Storage는 데이터를 저장하기 전에 자동으로 암호화하고, 검색하기 전에 암호를 해독하여 미사용 상태의 암호화를 제공합니다. | Azure Backup은 Azure VM의 미사용 상태의 암호화를 위해 SSE를 사용합니다.

- 관리형 Azure VM과 비관리형 Azure VM에는 BEK(BitLocker Encryption Key)만 사용하여 암호화되는 VM 및 BEK와 KEK(Key Encryption Key)를 사용하여 암호화되는 VM의 백업이 지원됩니다.
- 백업한 BEK(비밀) 및 KEK(키)가 암호화됩니다. 이러한 항목은 권한 있는 사용자가 Key Vault로 다시 복원할 때만 읽고 사용할 수 있습니다. 권한 없는 사용자나 Azure에서는 백업한 키나 비밀을 읽거나 사용할 수 없습니다.
- BEK도 백업되므로 BEK가 손실된 경우 권한이 부여된 사용자가 BEK를 KeyVault로 복원하고 암호화된 VM을 복구할 수 있습니다. 
- 올바른 수준의 권한이 있는 사용자만 암호화된 VM과 키 및 비밀을 백업하고 복원할 수 있습니다.



## <a name="taking-snapshots"></a>스냅숏 생성

백업 일정에 따른 Azure Backup 스냅숏 

- **Windows VM**: Windows VM의 경우 Backup 서비스는 VSS(볼륨 섀도 복사본 서비스)와 조정되어 VM 디스크의 앱 일치 스냅숏을 생성합니다.
    - 기본적으로 Azure Backup은 전체 VSS 백업을 만듭니다. [자세히 알아보기](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx).
    - Azure Backup에서 VSS 복사본 백업을 만들도록 설정을 변경하려는 경우 명령 프롬프트에서 다음 레지스트리 키를 설정합니다. **REG ADD "HKLM\SOFTWARE\Microsoft\BcdrAgent" /v USEVSSCOPYBACKUP /t REG_SZ /d TRUE /f**.
- **Linux VM**: Linux VM의 앱 일치 스냅숏을 생성하려는 경우 Linux 사전/사후 스크립트 프레임워크를 사용하여 고유한 사용자 지정 스크립트를 작성함으로써 일관성을 유지합니다.
    -  Azure Backup은 사용자가 작성한 사전/사후 스크립트만 호출합니다.
    - Azure Backup은 사전 스크립트 및 사후 스크립트가 성공적으로 실행되는 경우 애플리케이션 일관성이 있게 복구 지점을 표시합니다. 그러나 사용자 지정 스크립트를 사용하는 경우 애플리케이션 일관성에 대한 궁극적인 책임은 사용자에게 있습니다.
    - 스크립트 구성에 대해 [자세히 알아봅니다](backup-azure-linux-app-consistent.md).


### <a name="snapshot-consistency"></a>스냅숏 일관성

다음 표에서는 여러 유형의 일관성에 대해 설명합니다.

**스냅숏** | **세부 정보** | **복구** | **고려 사항**
--- | --- | --- | ---
**애플리케이션 일관성** | 앱 일관성이 있는 백업은 메모리 콘텐츠 및 보류 중인 I/O 작업을 캡처합니다. 앱 일관성이 있는 스냅숏은 백업이 발생하기 전에 앱 데이터의 일관성을 보장하는 VSS 기록기(Linux용 사전/사후 스크립트)를 사용합니다. | 앱 일관성이 있는 스냅숏으로 복구하는 경우 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱이 일관성 있는 상태로 시작됩니다. | Windows: 모든 VSS 기록기가 성공함<br/><br/> Linux: 사전/사후 스크립트가 구성 및 성공함
**파일 시스템 일관성** | 파일 일관성이 있는 백업은 동시에 모든 파일의 스냅숏을 만들어 디스크 파일의 일관성 있는 백업을 제공합니다.<br/><br/> | 일관성 있는 파일 스냅숏으로 복구하는 경우 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱은 자체 “수정” 메커니즘을 구현하여 복원된 데이터가 일관성 있는지 확인해야 합니다. | Windows: 일부 VSS 기록기가 실패함 <br/><br/> Linux: 기본값(사전/사후 스크립트가 구성되지 않거나 실패하는 경우)
**크래시 일관성** | 백업 시 Azure VM이 종료될 때 대개 크래시 일관성이 발생합니다.  백업 시 디스크에 이미 존재하는 데이터만 캡처 및 백업됩니다.<br/><br/> 크래시 일관성이 있는 복구 지점은 운영 체제 또는 앱의 데이터 일관성을 보장하지 않습니다. | 항상 그렇지는 않지만 대개 VM이 부팅된 다음에 디스크 검사가 수행되어 손상 오류를 수정합니다. 디스크에 전송되지 않은 메모리 내 데이터 또는 쓰기는 모두 손실됩니다. 앱이 고유한 데이터 확인을 구현합니다. 예를 들어 데이터베이스 앱의 경우 데이터베이스에 없는 항목이 트랜잭션 로그에 있는 경우 데이터베이스 소프트웨어는 데이터가 일관성이 있을 때까지 롤됩니다. | VM이 종료 상태


## <a name="restore-considerations"></a>복원 고려 사항 



**고려 사항** | **세부 정보**
--- | ---
**디스크** | VM 디스크의 백업은 병렬로 진행됩니다. 예를 들어 VM에 4개의 디스크가 있는 경우 이 서비스는 4개의 디스크를 모두 병렬로 백업하려고 합니다. 백업은 증분 방식입니다(변경된 데이터만 백업).
**일정 계획** |  백업 트래픽을 줄이려면 여러 VM이 겹치지 않게 하루 중 서로 다른 시간대에 백업되도록 하는 것입니다. VM을 동시에 백업하면 트래픽 정체가 발생합니다.
**백업 준비** | 백업 확장의 설치 및 업데이트, 백업 일정에 따른 스냅숏 트리거를 포함하는 백업 준비 시간을 고려합니다.
**데이터 전송** | 백업 서비스가 이전 백업에서 증분 변경 내용을 계산하는 데 필요한 시간입니다.<br/><br/> 증분 백업에서 서비스가 블록의 체크섬을 계산하는 변경 내용을 확인합니다. 블록이 변경되면 자격 증명 모음으로 전송하기 위해 식별됩니다. 서비스는 식별된 블록을 드릴하여 전송할 데이터를 좀 더 최소화하려고 합니다. 변경된 모든 블록을 평가한 후에는 변경 내용이 자격 증명 모음으로 전송됩니다.<br/><br/> 스냅숏을 생성하는 시간과 자격 증명 모음으로 복사하는 시간 사이에 지연이 있을 수 있습니다.<br/><br/> 사용량이 많은 시간에 백업이 진행되는 데는 최대 8시간이 걸릴 수 있습니다. VM에 대한 백업 시간은 일별 백업의 경우 24시간 미만입니다.
**초기 백업**: | 24시간 미만이라는 총 백업 시간이 증분 백업에는 유효하지만 첫 번째 백업에는 유효하지 않을 수 있습니다. 필요한 시간은 데이터 크기와 백업을 수행하는 시기에 따라 달라집니다.
**복원 큐** | Azure Backup이 동시에 여러 스토리지 계정의 복원을 처리하므로 복원 요청이 큐에 배치됩니다.
**복원 복사** | 복원 프로세스 동안 데이터가 자격 증명 모음에서 스토리지 계정으로 복사됩니다.<br/><br/> 복원 시간은 스토리지 계정의 IOPS 및 처리량에 따라 달라집니다.<br/><br/> 복사 시간을 단축하려면 다른 애플리케이션 쓰기 및 읽기로 로드되지 않은 저장소 계정을 선택합니다.


### <a name="backup-performance"></a>Backup 성능

다음과 같은 일반적인 시나리오는 백업 시간에 영향을 줄 수 있습니다.

- 보호된 Azure VM에 새 디스크 추가: VM에서 증분 백업이 진행 중이며 새 디스크가 추가되면 기존 디스크의 델타 복제와 함께 새 디스크의 초기 복제로 인해 백업이 24시간 넘게 지속될 수 있습니다.
- 조각화된 디스크: 백업 작업은 디스크 변경 내용이 함께 배치될 때 더 빨라집니다. 변경 내용이 디스크 전체에 분산되고 조각화되면 백업이 더 느려집니다. 
- 디스크 변동: 증분 백업 중인 보호된 디스크에 200GB가 넘는 일일 변동이 있는 경우 백업을 완료하는 데 시간이 오래(8시간 초과) 걸릴 수 있습니다. 
- Backup 버전: 최신 버전의 Backup(즉시 복원 버전이라고 함)을 사용하는 경우 변경 내용 비교를 위해 체크섬 비교보다 좀 더 최적화된 프로세스가 진행됩니다. 최신 버전을 사용하며 백업 스냅숏을 삭제한 경우 체크섬 비교를 사용하도록 전환되며, 백업 작업은 24시간을 초과하거나 실패합니다.

## <a name="best-practices"></a>모범 사례 
VM 백업을 구성하는 동안 다음 사례를 따르는 것이 좋습니다.

- 정책에 설정된 기본 일정 시간을 수정하는 것이 좋습니다. 예를 들어, 정책의 기본 시간이 오전 12시인 경우 리소스가 최적으로 사용되도록 분단위로 증분하는 것이 좋습니다.
- 인스턴트가 아닌 RP 기능의 프리미엄 VM 백업의 경우, 총 스토리지 계정 공간의 ~ 50 %를 할당합니다. Backup 서비스는 스냅숏을 동일한 스토리지 계정으로 복사하여 자격 증명 모음으로 전송하기 위해 이 공간이 필요합니다.
- 단일 자격 증명 모음에서 VM을 복원하는 경우에는 다른 [v2 스토리지 계정](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade)을 사용하여 대상 스토리지 계정이 제한되지 않도록 하는 것이 좋습니다. 예를 들어 각 VM마다 다른 스토리지 계정이 있어야 합니다. (VM이 10개 복원되는 경우 10개의 다른 스토리지 계정을 사용하는 것이 좋습니다.)
- 계층 1 스토리지 레이어(스냅숏)에서 복원은(동일한 스토리지 계정이기 때문에) 몇 분 내에 완료되지만 계층 2 스토리지 레이어(자격 증명 모음)는 몇 시간이 걸릴 수 있습니다. 계층 1에서 데이터를 사용할 수 있는 경우에는 더욱 신속한 복원을 위해 [즉시 복원](backup-instant-restore-capability.md) 기능을 사용하는 것이 좋습니다. 자격 증명 모음에서 데이터를 복원해야 하는 경우에는 시간이 걸립니다.
- 스토리지 계정당 디스크 수에 대한 제한은 IaaS VM에서 실행 중인 애플리케이션이 액세스하는 디스크가 얼마나 많은지에 비례합니다. 여러 디스크가 단일 스토리지 계정에서 호스팅되는지 확인합니다. 일반적으로 단일 스토리지 계정에 디스크가 5~10개 이상 있으면 일부 디스크를 별도의 스토리지 계정으로 이동하여 부하를 분산합니다.

## <a name="backup-costs"></a>백업 비용

Azure Backup으로 백업된 Azure VM에는 [Azure Backup 가격 책정](https://azure.microsoft.com/pricing/details/backup/)이 적용됩니다.

- 요금 청구는 첫 번째 백업이 성공적으로 완료되기 전까지 시작되지 않습니다. 이때 스토리지와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다.
- VM의 백업 데이터가 자격 증명 모음에 저장되어 있는 한, 요금이 계속 청구됩니다. VM에 대한 보호를 중지하지만, 자격 증명 모음에 VM에 대한 백업 데이터가 있는 경우 요금은 계속 청구됩니다.
- 지정된 VM에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다.
- 보호가 중지되고 활성 백업 작업이 없으면 마지막으로 성공한 VM 백업이 월별 청구에 사용되는 보호된 인스턴스 크기가 됩니다.
- 보호된 인스턴스 계산은 VM의 ‘실제’ 크기를 기반으로 하며, 임시 스토리지를 제외한 VM의 모든 데이터 합계입니다.
- 데이터 디스크에 저장된 실제 데이터에 따라 청구됩니다.
- VM 백업에 대한 가격 책정은 VM에 연결된 각 데이터 디스크의 최대 지원 크기에 따라 결정되는 것이 아니라,
- 마찬가지로, 백업 저장소 요금은 Azure Backup을 사용하여 저장된 데이터 양(각 복구 지점의 실제 데이터 합계)을 기준으로 청구됩니다.

최대 크기가 각각 4TB인 두 개의 추가 데이터 디스크가 있는 A2 표준 크기 VM을 예로 들 수 있습니다. 다음 표는 각 디스크에 저장된 실제 데이터를 제공합니다.

**디스크** | **최대 크기** | **표시되는 실제 데이터**
--- | --- | ---
OS 디스크 | 4,095GB | 17GB 
로컬/임시 디스크 | 135GB | 5GB(백업에 포함되지 않음) 
데이터 디스크 1 | 4,095GB | 30GB 
데이터 디스크 2 | 4,095GB | 0GB 

- 이 경우 VM의 실제 크기는 17GB+30GB+0GB=47GB입니다.
- 이 보호된 인스턴스 크기(47GB)는 월별 청구서의 근거가 됩니다.
- VM의 데이터 양이 증가하면 요금 청구에 사용되는 보호된 인스턴스 크기도 그에 따라 변경됩니다.


## <a name="next-steps"></a>다음 단계

이제 Azure VM 백업을 [준비](backup-azure-arm-vms-prepare.md)합니다.
