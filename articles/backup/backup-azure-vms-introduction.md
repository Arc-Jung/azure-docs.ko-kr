---
title: Azure VM 백업 정보
description: 이 문서에서는 Azure Backup 서비스가 Azure 가상 컴퓨터를 백업하는 방법과 모범 사례를 따르는 방법을 알아봅니다.
ms.topic: conceptual
ms.date: 09/13/2019
ms.openlocfilehash: f4b36f57362607a13c09896cd7109596aba0a852
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "79415976"
---
# <a name="an-overview-of-azure-vm-backup"></a>Azure VM 백업 개요

이 문서에서는 [Azure Backup 서비스가](backup-introduction-to-azure-backup.md) VM(Azure 가상 시스템)을 백업하는 방법을 설명합니다.

Azure Backup은 VM에서 의도하지 않은 데이터 소멸을 방지할 수 있는 독립적이고 격리된 백업을 제공합니다. 백업은 복구 지점에 대한 기본 제공 관리를 사용하여 Recovery Services 자격 증명 모음에 저장됩니다. 구성 및 크기 조정은 간단하고 백업이 최적화되어 있으며 필요에 따라 쉽게 복원할 수 있습니다.

백업 프로세스의 일부로 [스냅숏이 생성되고](#snapshot-creation)데이터가 프로덕션 워크로드에 영향을 미치지 않고 복구 서비스 자격 증명 모음으로 전송됩니다. 스냅숏은 [여기에](#snapshot-consistency)설명된 대로 서로 다른 수준의 일관성을 제공합니다.

또한 Azure Backup에는 [워크로드를](backup-azure-sql-database.md) 인식하고 15분 RPO(복구 지점 목표)를 제공하고 개별 데이터베이스를 백업하고 복원할 수 있는 SQL Server 및 [SAP HANA와](sap-hana-db-about.md) 같은 데이터베이스 워크로드에 대한 특수 제품이 있습니다.

## <a name="backup-process"></a>백업 프로세스

Azure 백업이 Azure VM에 대한 백업을 완료하는 방법은 다음과 같습니다.

1. 백업을 위해 선택된 Azure VM의 경우 Azure Backup은 지정한 백업 일정에 따라 백업 작업을 시작합니다.
1. 첫 번째 백업 중에 VM이 실행 중인 경우 VM에 백업 확장이 설치됩니다.
    - Windows VM의 경우 [VMSnapshot 확장이](https://docs.microsoft.com/azure/virtual-machines/extensions/vmsnapshot-windows) 설치됩니다.
    - 리눅스 VM의 경우 [VMSnapshotLinux 확장이](https://docs.microsoft.com/azure/virtual-machines/extensions/vmsnapshot-linux) 설치됩니다.
1. 실행 중인 Windows VM의 경우 백업은 VSS(Windows 볼륨 섀도 복사본 서비스)와 좌표하여 VM의 앱 일관된 스냅숏을 가져옵니다.
    - 기본적으로 백업은 전체 VSS 백업을 수행합니다.
    - Backup이 앱 일관된 스냅숏을 만들 수 없는 경우 VM이 중지되는 동안 응용 프로그램 쓰기가 발생하지 않기 때문에 기본 저장소의 파일 일관된 스냅숏을 가져옵니다.
1. Linux VM의 경우 백업은 파일 일관된 백업을 수행합니다. 앱일관된 스냅샷의 경우 사전/사후 스크립트를 수동으로 사용자 지정해야 합니다.
1. Backup이 스냅숏을 수행한 후 데이터를 볼트로 전송합니다.
    - 백업은 각 VM 디스크를 병렬로 백업하여 최적화됩니다.
    - 백업되는 각 디스크에 대해 Azure Backup은 디스크의 블록을 읽고 이전 백업 이후 변경된 데이터 블록(델타)만 식별하고 전송합니다.
    - 스냅샷 데이터가 자격 증명 모음에 즉시 복사되지 않을 수 있습니다. 사용량이 많은 시간에는 몇 시간이 걸릴 수 있습니다. VM의 총 백업 시간은 일일 백업 정책의 경우 24시간 미만입니다.
1. Azure 백업을 사용하도록 설정한 후 Windows VM에 대한 변경 사항은 다음과 같습니다.
    - 마이크로소프트 비주얼 C ++ 2013 재배포 가능 (x64) - 12.0.40660 VM에 설치 됩니다.
    - VSS 볼륨 섀도 복사본 서비스의 시작 유형이 수동에서 자동으로 변경되었습니다.
    - IaaSVm공급자 윈도우 서비스가 추가됩니다.

1. 데이터 전송이 완료되면 스냅숏이 제거되고 복구 지점이 만들어집니다.

![Azure 가상 머신 백업 아키텍처](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

## <a name="encryption-of-azure-vm-backups"></a>Azure VM 백업 암호화

Azure Backup을 사용하여 Azure VM을 백업하면 미사용 상태의 VM이 SSE(스토리지 서비스 암호화)를 사용하여 암호화됩니다. Azure Backup은 Azure 디스크 암호화를 사용하여 암호화된 Azure VM을 백업할 수도 있습니다.

**암호화** | **세부 정보** | **지원**
--- | --- | ---
**Azure 디스크 암호화** | Azure 디스크 암호화는 Azure VM에 대한 OS 및 데이터 디스크를 모두 암호화합니다.<br/><br/> Azure 디스크 암호화는 키 자격 증명 모음에서 비밀로 보호되는 BitLocker 암호화 키(BEK)와 통합됩니다. Azure 디스크 암호화는 KEK(Azure Key Vault 키 암호화 키)와도 통합됩니다. | Azure Backup은 BEK로만 암호화되거나 KEK와 함께 BEK를 통해 암호화된 관리되고 관리되지 않는 Azure VM의 백업을 지원합니다.<br/><br/> BEK와 KEK는 모두 백업되고 암호화됩니다.<br/><br/> KEK와 BEK가 백업되므로 필요한 권한이 있는 사용자는 필요한 경우 키 및 비밀을 키 자격 증명 모음으로 다시 복원할 수 있습니다. 이러한 사용자는 암호화된 VM을 복구할 수도 있습니다.<br/><br/> 암호화된 키와 비밀은 권한이 없는 사용자 나 Azure에서 읽을 수 없습니다.
**SSE** | SSE를 사용하면 Azure Storage는 데이터를 저장하기 전에 데이터를 자동으로 암호화하여 미사용 암호화를 제공합니다. 또한 Azure Storage는 데이터를 검색하기 전에 해독합니다. | Azure 백업은 Azure VM의 미사용 암호화에 SSE를 사용합니다.

관리및관리되지않는AzureVM의 경우 Backup은 BEK만으로 암호화된 VM또는 KEK와 함께 BEK로 암호화된 VM을 모두 지원합니다.

백업된 BEK(비밀)와 KEK(키)는 암호화됩니다. 권한이 있는 사용자가 키 자격 증명 모음으로 다시 복원한 경우에만 읽고 사용할 수 있습니다. 권한이 없는 사용자나 Azure는 백업된 키 나 비밀을 읽거나 사용할 수 없습니다.

BEK도 백업됩니다. 따라서 BEK가 손실되면 권한이 있는 사용자는 BEK를 키 자격 증명 모음으로 복원하고 암호화된 VM을 복구할 수 있습니다. 필요한 수준의 사용 권한을 가진 사용자만 암호화된 VM 또는 키 및 비밀을 백업하고 복원할 수 있습니다.

## <a name="snapshot-creation"></a>스냅샷 만들기

Azure Backup은 백업 일정에 따라 스냅숏을 생성합니다.

- **윈도우 VM:** Windows VM의 경우 백업 서비스는 VSS와 조정하여 VM 디스크의 앱 일관된 스냅숏을 가져옵니다.  기본적으로 Azure Backup은 전체 VSS 백업을 사용합니다(백업 시 SQL Server와 같은 응용 프로그램의 로그를 트렁크로 만들어 응용 프로그램 수준의 일관된 백업을 가져옵니다).  Azure VM 백업에서 SQL Server 데이터베이스를 사용하는 경우 로그를 보존하기 위해 VSS 복사 백업을 수행하도록 설정을 수정할 수 있습니다. 자세한 내용은 [이 문서를](https://docs.microsoft.com/azure/backup/backup-azure-vms-troubleshoot#troubleshoot-vm-snapshot-issues)참조하십시오.

- **리눅스 VM:** Linux VM의 앱 일관된 스냅샷을 찍려면 Linux 사전 스크립트 및 스크립트 후 프레임워크를 사용하여 일관성을 보장하기 위해 사용자 지정 스크립트를 작성합니다.

  - Azure Backup은 작성한 사전/사후 스크립트만 호출합니다.
  - 사전 스크립트와 사후 스크립트가 성공적으로 실행되면 Azure Backup은 복구 지점을 응용 프로그램 일관성으로 표시합니다. 그러나 사용자 지정 스크립트를 사용하는 경우 궁극적으로 응용 프로그램 일관성에 대한 책임이 있습니다.
  - 스크립트를 구성하는 방법에 대해 [자세히 알아보세요.](backup-azure-linux-app-consistent.md)

## <a name="snapshot-consistency"></a>스냅샷 일관성

다음 표는 다양한 유형의 스냅숏 일관성에 대해 설명합니다.

**스냅숏** | **세부 정보** | **복구** | **고려 사항**
--- | --- | --- | ---
**애플리케이션 일관성** | 앱 일관성이 있는 백업은 메모리 콘텐츠 및 보류 중인 I/O 작업을 캡처합니다. 앱 일관된 스냅샷은 VSS 기록기(또는 Linux용 사전/포스트 스크립트)를 사용하여 백업이 발생하기 전에 앱 데이터의 일관성을 보장합니다. | 앱 일관된 스냅숏으로 VM을 복구할 때 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱이 일관성 있는 상태로 시작됩니다. | 윈도우 : 모든 VSS 작가가 성공<br/><br/> 리눅스: 사전/사후 스크립트가 구성되고 성공
**일관된 파일 시스템** | 파일 시스템 일관된 백업은 모든 파일의 스냅샷을 동시에 만들어 일관성을 제공합니다.<br/><br/> | 파일 시스템 일관된 스냅숏으로 VM을 복구할 때 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱은 자체 “수정” 메커니즘을 구현하여 복원된 데이터가 일관성 있는지 확인해야 합니다. | 창: 일부 VSS 기록기가 실패했습니다. <br/><br/> Linux: 기본값(사전/사후 스크립트가 구성되지 않았거나 실패한 경우)
**크래시 일관성** | 충돌 일관된 스냅숏은 일반적으로 백업 시 Azure VM이 종료되는 경우에 발생합니다. 백업 시 디스크에 이미 존재하는 데이터만 캡처 및 백업됩니다. | VM 부팅 프로세스로 시작한 다음 디스크 검사를 통해 손상 오류를 수정합니다. 충돌이 손실되기 전에 디스크로 전송되지 않은 메모리 내 데이터 또는 쓰기 작업입니다. 앱이 고유한 데이터 확인을 구현합니다. 예를 들어 데이터베이스 앱은 확인을 위해 트랜잭션 로그를 사용할 수 있습니다. 트랜잭션 로그에 데이터베이스에 없는 항목이 있는 경우 데이터베이스 소프트웨어는 데이터가 일관되어올 때까지 트랜잭션을 롤백합니다. | VM이 종료(중지/할당 할당) 상태입니다.

## <a name="backup-and-restore-considerations"></a>백업 및 복원 고려 사항

**고려 사항** | **세부 정보**
--- | ---
**디스크** | VM 디스크의 백업은 병렬입니다. 예를 들어 VM에 4개의 디스크가 있는 경우 Backup 서비스는 4개의 디스크를 모두 병렬로 백업하려고 시도합니다. 백업은 증분 방식입니다(변경된 데이터만 백업).
**일정** |  백업 트래픽을 줄이려면 하루 중 다른 시간에 다른 VM을 백업하고 시간이 겹치지 않도록 합니다. VM을 동시에 백업하면 트래픽 정체가 발생합니다.
**백업 준비** | 백업을 준비하는 데 필요한 시간을 염두에 두십시오. 준비 시간에는 백업 확장프로그램을 설치 또는 업데이트하고 백업 일정에 따라 스냅샷을 트리거하는 것이 포함됩니다.
**데이터 전송** | Azure Backup이 이전 백업의 증분 변경 내용을 식별하는 데 필요한 시간을 고려합니다.<br/><br/> 증분 백업에서 Azure Backup은 블록의 체크섬을 계산하여 변경 사항을 결정합니다. 블록이 변경되면 볼트로 전송할 수 있도록 표시됩니다. 이 서비스는 식별된 블록을 분석하여 전송할 데이터의 양을 더욱 최소화하려고 시도합니다. 변경된 모든 블록을 평가한 후 Azure Backup은 변경 내용을 볼트로 전송합니다.<br/><br/> 스냅샷을 생성하는 시간과 자격 증명 모음으로 복사하는 시간 사이에 지연이 있을 수 있습니다.<br/><br/> 사용량이 가장 많은 시간에는 백업을 처리하는 데 최대 8시간이 걸릴 수 있습니다. VM에 대한 백업 시간은 일별 백업의 경우 24시간 미만입니다.
**초기 백업** | 증분 백업의 총 백업 시간은 24시간 미만이지만 첫 번째 백업의 경우는 그렇지 않을 수 있습니다. 초기 백업에 필요한 시간은 데이터 크기와 백업이 처리되는 시기에 따라 달라집니다.
**복원 큐** | Azure Backup 프로세스는 여러 저장소 계정에서 동시에 작업을 복원하고 복원 요청을 큐에 넣습니다.
**복원 복사** | 복원 프로세스 동안 데이터가 자격 증명 모음에서 스토리지 계정으로 복사됩니다.<br/><br/> 총 복원 시간은 초당 I/O 작업(IOPS)과 저장소 계정의 처리량에 따라 달라집니다.<br/><br/> 복사 시간을 단축하려면 다른 애플리케이션 쓰기 및 읽기로 로드되지 않은 스토리지 계정을 선택합니다.

### <a name="backup-performance"></a>Backup 성능

이러한 일반적인 시나리오는 총 백업 시간에 영향을 줄 수 있습니다.

- **보호된 Azure VM에 새 디스크 추가:** VM이 증분 백업을 받고 새 디스크가 추가되면 백업 시간이 늘어난다. 새 디스크의 초기 복제와 기존 디스크의 델타 복제로 인해 총 백업 시간이 24시간 이상 지속될 수 있습니다.
- **조각난 디스크:** 디스크 변경이 연속되면 백업 작업이 더 빠릅니다. 변경 내용이 디스크 전체에 분산되고 조각화되면 백업이 더 느려집니다.
- **디스크 이탈:** 증분 백업을 받고 있는 보호된 디스크의 일일 변동이 200GB 이상인 경우 백업을 완료하는 데 시간이 오래 걸릴 수 있습니다(8시간 이상).
- **백업 버전:** 최신 버전의 백업(인스턴트 복원 버전이라고 함)은 변경 사항을 식별하기 위한 체크섬 비교보다 더 최적화된 프로세스를 사용합니다. 그러나 인스턴트 복원을 사용하고 백업 스냅샷을 삭제한 경우 백업이 체크섬 비교로 전환됩니다. 이 경우 백업 작업이 24시간(또는 실패)을 초과합니다.

## <a name="best-practices"></a>모범 사례

VM 백업을 구성할 때는 다음 방법을 따르는 것이 좋습니다.

- 정책에 설정된 기본 일정 시간을 수정합니다. 예를 들어 정책의 기본 시간이 오전 12:00인 경우 리소스가 최적으로 사용되도록 타이밍을 몇 분씩 증분합니다.
- 단일 볼트에서 VM을 복원하는 경우 다른 [범용 v2 저장소 계정을](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade) 사용하여 대상 저장소 계정이 제한되지 않도록 하는 것이 좋습니다. 예를 들어 각 VM에는 다른 저장소 계정이 있어야 합니다. 예를 들어 10개의 VM이 복원된 경우 10개의 다른 저장소 계정을 사용합니다.
- 프리미엄 저장소를 사용하는 VM을 즉시 복원하여 백업하려면 첫 번째 **백업에만** 필요한 총 할당된 저장소 공간의 *50%* 여유 공간을 할당하는 것이 좋습니다. 첫 번째 백업이 완료된 후 50% 여유 공간이 백업에 대한 요구 사항은 아닙니다.
- 저장소 계정당 디스크 수 제한은 서비스(IaaS) VM으로 인프라에서 실행되는 응용 프로그램에서 디스크에 액세스하는 정도와 관련이 있습니다. 일반적으로 단일 저장소 계정에 5~10개 이상의 디스크가 있는 경우 일부 디스크를 별도의 저장소 계정으로 이동하여 부하의 균형을 조정합니다.

## <a name="backup-costs"></a>백업 비용

Azure Backup으로 백업된 Azure VM에는 [Azure Backup 가격 책정](https://azure.microsoft.com/pricing/details/backup/)이 적용됩니다.

첫 번째 성공적인 백업이 완료될 때까지 청구가 시작되지 않습니다. 이때 스토리지와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다. VM에 대한 백업 데이터가 볼트에 저장되는 한 청구가 계속됩니다. VM에 대한 보호를 중지하지만, 자격 증명 모음에 VM에 대한 백업 데이터가 있는 경우 요금은 계속 청구됩니다.

지정된 VM에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다. 보호가 중지되고 활성 백업 작업이 없으면 마지막으로 성공한 VM 백업이 월별 청구에 사용되는 보호된 인스턴스 크기가 됩니다.

보호된 인스턴스 크기 계산은 VM의 *실제* 크기를 기반으로 합니다. VM의 크기는 임시 저장소를 제외한 VM의 모든 데이터의 합계입니다. 가격은 VM에 연결된 각 데이터 디스크에 대해 지원되는 최대 크기가 아니라 데이터 디스크에 저장된 실제 데이터를 기반으로 합니다.

마찬가지로 백업 저장소 청구서는 Azure Backup에 저장된 데이터의 양을 기반으로 하며, 이는 각 복구 지점의 실제 데이터의 합계입니다.

예를 들어, 최대 크기가 각각 32TB인 두 개의 추가 데이터 디스크가 있는 A2 표준 크기의 VM을 예로 들어 보겠습니다. 다음 표에서는 이러한 각 디스크에 저장된 실제 데이터를 보여 주십습니다.

**디스크** | **최대 크기** | **표시되는 실제 데이터**
--- | --- | ---
OS 디스크 | 32 TB | 17GB
로컬/임시 디스크 | 135GB | 5GB(백업에 포함되지 않음)
데이터 디스크 1 | 32 TB| 30GB
데이터 디스크 2 | 32 TB | 0GB

이 경우 VM의 실제 크기는 17GB+30GB+0GB=47GB입니다. 이 보호된 인스턴스 크기(47GB)는 월별 청구서의 기초가 됩니다. VM의 데이터 양이 증가함에 따라 청구에 사용되는 보호된 인스턴스 크기가 일치하도록 변경됩니다.

## <a name="next-steps"></a>다음 단계

이제 [Azure VM 백업을 준비합니다.](backup-azure-arm-vms-prepare.md)
