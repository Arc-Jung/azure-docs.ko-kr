<properties
	pageTitle="Azure에서 VM 백업 인프라 계획 | Microsoft Azure"
	description="Azure에서 VM 백업 인프라를 계획할 경우의 중요 고려 사항"
	services="backup"
	documentationCenter=""
	authors="Jim-Parker"
	manager="jwhit"
	editor=""/>

<tags
	ms.service="backup"
	ms.workload="storage-backup-recovery"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="01/19/2016"
	ms.author="trinadhk; jimpark; markgal;"/>

# Azure에서 VM 백업 인프라 계획
이 문서에서는 가상 컴퓨터(VM) 백업 인프라를 계획할 때 염두에 두어야 하는 주요 고려 사항을 알아봅니다. [환경을 준비](backup-azure-vms-prepare.md)한 경우 이 단계는 [VM 백업](backup-azure-vms.md)을 시작하기 전의 다음 단계입니다. Azure 가상 컴퓨터에 대한 자세한 내용은 [가상 컴퓨터 설명서](https://azure.microsoft.com/documentation/services/virtual-machines/)를 참조하세요.

## Azure에서 가상 컴퓨터를 백업하는 방법
Azure 백업 서비스는 예약된 시간에 백업 작업을 시작할 때 시점 스냅숏을 만드는 백업 확장을 트리거합니다. 이 스냅숏은 가상 컴퓨터를 종료하지 않고도 가상 컴퓨터의 디스크에 대한 일관된 스냅숏을 가져오도록 VSS(볼륨 섀도 복사본 서비스)와 조정되어 생성됩니다.

스냅숏이 생성된 후 Azure 백업 서비스가 백업 자격 증명 모음으로 데이터를 전송합니다. 백업 프로세스의 효율성을 높이기 위해 Azure 백업 서비스는 마지막 백업 이후에 변경된 데이터 블록만 식별하여 전송합니다.

![Azure 가상 컴퓨터 백업 아키텍처](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

데이터 전송이 완료되면 스냅숏이 제거되고 복구 지점이 생성됩니다.

### 데이터 일관성
업무에 중요한 데이터는 데이터를 생성하는 응용 프로그램이 실행되는 동안 백업해야 하므로 백업 및 복원이 복잡합니다. 이를 해결하기 위해 Azure 백업에서는 데이터가 저장소에 올바르게 기록되도록 VSS를 사용하여 Microsoft 워크로드에 대해 응용 프로그램 일치 백업을 제공합니다.

>[AZURE.NOTE]Linux 가상 컴퓨터의 경우 VSS에 해당하는 플랫폼이 Linux에 없기 때문에 파일 일치 백업만 가능합니다.

Windows VM에서 Azure 백업은 VSS 전체 백업을 사용합니다([VSS 전체 백업](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)에 대해 자세히 알아보기). VSS 복사본 백업을 사용하도록 설정하려면 VM에서 아래의 레지스트리 키를 설정해야 합니다.

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```


다음 표에서는 Azure VM 백업 및 복원 절차 중에 발생하는 조건 및 일관성 유형을 설명합니다.

| 일관성 | VSS 기반 | 설명 및 세부 정보 |
|-------------|-----------|---------|
| 응용 프로그램 일관성 | 예 | 다음을 보장하므로 Microsoft 워크로드에 이상적인 일관성 유형입니다.<ol><li> VM이 부팅됩니다. <li>손상이 없습니다. <li>데이터 손실이 없습니다.<li> 데이터는 백업 시 VSS를 사용하는 응용 프로그램을 포함하여 데이터를 사용하는 응용 프로그램과 일치됩니다.</ol> 대부분의 Microsoft 워크로드에는 데이터 일관성과 관련된 워크로드 관련 동작을 수행하는 VSS 작성자가 있습니다. 예를 들어 Microsoft SQL Server에는 트랜잭션 로그 파일에 대한 쓰기를 확인하고 데이터베이스가 제대로 수행되었는지 확인하는 VSS 작성자가 있습니다.<br><br> Azure VM 백업의 경우, 응용 프로그램에 일관된 복구 지점이 있다는 것은 백업 확장이 VSS 워크플로를 적용하고 VM 스냅숏을 촬영하기 전에 제대로 완료할 수 있었음을 의미합니다. 기본적으로 Azure VM에서 모든 응용 프로그램의 VSS 작성자도 적용되었음을 의미합니다.<br><br>[어떻게 동작하는지](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)에 대해 자세히 다루어 [VSS의 기본 사항](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx)에 대해 알아봅니다. |
| 파일 시스템 일관성 | 예 - Windows 기반 컴퓨터 | 파일 시스템이 일관될 수 있는 복구 지점이 있는 두 가지 시나리오가 있습니다.<ul><li>Azure에서 Linux VM 백업, Linux에는 VSS에 해당하는 플랫폼이 없기 때문.<li>Azure에서 Windows VM 백업 중에 VSS 오류.</li></ul> 두 경우 모두 최선의 방법은 다음을 보장하는 것입니다.<ol><li> VM이 부팅됩니다. <li>손상이 없습니다.<li>데이터 손실이 없습니다.</ol> 응용 프로그램은 복원된 데이터에 대해 고유한 "수정" 메커니즘을 구현해야 합니다.|
| 충돌 일관성 | 아니요 | 이 상황은 "충돌"이 발생하는 가상 컴퓨터와 같습니다(소프트 또는 하드 재설정을 통해). 이 문제는 일반적으로 Azure 가상 컴퓨터가 백업 시 종료 될 때 발생 합니다. Azure 가상 컴퓨터 백업의 경우, 일관된 복구 지점에 충돌이 있다는 것은 Azure 백업이 저장소의 데이터 일관성을 보장해 주지 않는다는 뜻입니다(운영 체제 관점 또는 응용 프로그램의 관점에서). 백업 시 디스크에 이미 존재 하는 데이터만이 캡처 및 백업된 내용입니다. <br/> <br/> 보장은 없지만, 대부분의 경우 운영 체제가 부팅됩니다. 이는 일반적으로 손상 오류를 수정하기 위한 chkdsk와 같은 디스크 검사 과정 이후에 발생합니다. 메모리 내 데이터 또는 디스크에 완전히 플러시되지 않은 쓰기는 손실됩니다. 일반적으로 응용 프로그램은 데이터 롤백 작업을 수행해야 하는 경우에 고유한 확인 매커니즘을 수행합니다. <br><br>예를 들어 트랜잭션 로그에 데이터베이스에 없는 항목이 있는 경우 데이터베이스 소프트웨어는 데이터가 일관성을 찾을 때가지 롤백합니다. 여러 가상 디스크(예: 스팬 볼륨)에 분산된 데이터의 경우 충돌-일관성 복구 지점은 데이터 정확성을 보장하지 않습니다.|


## 성능 및 리소스 사용률
온-프레미스로 배포되는 백업 소프트웨어와 마찬가지로 Azure의 VM의 백업도 용량 및 리소스 사용률에 대한 계획을 세워야 합니다. [Azure 저장소 제한](azure-subscription-service-limits.md#storage-limits)은 워크로드 실행에 대한 영향을 최소화하면서 최대의 성능을 얻기 위한 VM 배포 구성 방법을 정의합니다.

백업 성능에 영향을 미치는 두 가지 주요 Azure 저장소 제한이 있습니다.

- 저장소 계정당 최대 송신
- 저장소 계정당 총 요청 속도

### 저장소 계정 제한
백업 데이터가 고객 저장소 계정으로부터 복사되면, 저장소 계정의 초당 입력/출력 작업(IOPS) 및 송신(저장소 처리량) 메트릭을 향해 계산됩니다. 이와 동시에 가상 컴퓨터가 실행되고 IOPS와 처리량을 사용합니다. 목표는 총 트래픽(백업 및 가상 컴퓨터)이 저장소 계정 제한을 초과하지 않도록 하는 것입니다.

### 디스크 수
백업 프로세스는 많은 메모리를 소모하며 최대한 빨리 백업을 완료하기 위해 가능한 한 많은 리소스를 사용하려고 합니다. 그러나 모든 I/O 작업은 초당 60MB의 제한이 있는 단일 Blob의 목표 처리량에 의해 제한됩니다. 백업 프로세스의 속도를 높이기 위해, VM의 각 디스크 백업을 병렬로 시도합니다. 따라서 VM에 4개의 디스크가 있는 경우, Azure 백업은 4개의 디스크를 모두 병렬로 백업하게 됩니다. 그렇기 때문에 고객 저장소 계정으로부터 백업 트래픽이 있는지 판단하는 가장 중요한 단일 요소는 저장소 계정으로부터 백업되고 있는 **디스크 수**입니다.

### 백업 일정
성능에 영향을 주는 추가 요소는 **백업 일정**입니다. 동시에 모든 VM을 백업하도록 구성하는 경우, Azure 백업은 가능한 한 많은 디스크를 백업하려 하므로 병렬로 백업되는 디스크 수가 증가합니다. 저장소 계정의 백업 트래픽을 줄일 수는 한 가지 방법은 다른 VM이 겹치지 않게 하루의 서로 다른 시간대에 백업되는지 확인하는 것입니다.

## 용량 계획
이러한 모든 요소를 한데 모으는 것은 저장소 계정 사용을 적절하게 계획해야 함을 의미합니다. [VM 백업 용량 계획 Excel 스프레드시트](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33)를 다운로드하여 디스크 및 백업 일정 선택의 영향을 확인합니다.

### 백업 처리량
백업 중인 각 디스크에 대해 Azure 백업은 디스크의 블록을 읽고 변경 된 데이터(증분 백업)만 저장합니다. 다음 표에서는 Azure 백업에서 예상할 수 있는 평균 처리량 값을 보여 줍니다. 이를 사용하여 지정된 크기의 디스크 백업에 소요되는 시간을 예상할 수 있습니다.

| 백업 작업 | 최상의 처리량 |
| ---------------- | ---------- |
| 초기 백업 | 160Mbps |
| 증분 백업(DR) | 640Mbps <br><br> 백업해야 하는 디스크에 분산된 변동이 많은 경우 이 처리량이 훨씬 감소할 수 있습니다. |

### 총 VM 백업 시간
대부분의 백업 시간은 데이터를 읽고 쓰는 데 사용되지만, VM을 백업하는 데 필요한 총 시간에는 다음과 같은 기타 작업도 포함됩니다.

- [백업 확장 설치 또는 업데이트](backup-azure-vms.md#offline-vms)하는 데 필요한 시간
- 스냅숏 시간 - 스냅숏을 트리거하는 데 걸리는 시간입니다. 스냅숏은 예약된 백업 시간에 가깝게 트리거됩니다.
- 큐 대기 시간입니다. 백업 서비스는 여러 고객의 백업을 처리하기 때문에 스냅숏의 백업 데이터를 Azure 백업 자격 증명 모음에 복사하는 작업이 즉시 시작되지 않을 수도 있습니다. 사용량이 많은 시간에는 처리되는 백업 수로 인해 대기 시간이 최대 8시간까지 연장될 수 있습니다. 그러나 일별 백업 정책의 경우 총 VM 백업 시간은 24시간 미만입니다.

## 데이터 암호화.

Azure 백업은 백업 프로세스의 일부로 데이터를 암호화하지 않습니다. 그러나 VM 내에서 원활하게 데이터를 암호화하고 보호되는 데이터를 백업할 수 있습니다([암호화된 데이터 백업](backup-azure-vms-encryption.md)에 대해 자세히 알아보기).


## 보호된 인스턴스를 계산하는 방법
Azure 백업을 통해 백업된 Azure 가상 컴퓨터에는 [Azure 백업 가격](http://azure.microsoft.com/pricing/details/backup/)이 적용됩니다. 보호된 인스턴스 계산은 가상 컴퓨터의 실제 크기를 기반으로 하며, "리소스 디스크"를 제외한 가상 컴퓨터의 모든 데이터 합계입니다.

가상 컴퓨터에 연결된 각 데이터 디스크에 대해 지원되는 최대 크기가 아니라 데이터 디스크에 저장된 실제 데이터를 기준으로 요금이 청구됩니다. 마찬가지로, 백업 저장소 요금은 Azure 백업을 사용하여 저장된 데이터 양(각 복구 지점의 실제 데이터 합계)을 기준으로 청구됩니다.

최대 크기가 각각 1TB인 두 개의 추가 데이터 디스크가 있는 A2 표준 크기 가상 컴퓨터를 예로 들 수 있습니다. 아래 표는 각 디스크에 저장된 실제 데이터를 제공합니다.

|디스크 유형|최대 크기|실제 데이터 표시|
|---------|--------|------|
| 운영 체제 디스크 | 1023GB | 17GB |
| 로컬 디스크/리소스 디스크 | 135GB | 5GB(백업에 포함되지 않음) |
| 데이터 디스크 1 |	1023GB | 30GB |
| 데이터 디스크 2 | 1023GB | 0GB |

이 경우 가상 컴퓨터의 실제 크기는 17GB + 30GB + 0GB = 47GB입니다. 이 값이 월별 청구 요금의 기준이 되는 보호된 인스턴스 크기가 됩니다. 가상 컴퓨터의 데이터 양이 증가하면 요금 청구에 사용되는 보호된 인스턴스 크기도 그에 따라 변경됩니다.

요금 청구는 첫 번째 백업이 성공적으로 완료되기 전까지 시작되지 않습니다. 이때 저장소와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다. Azure 백업을 사용하여 저장된 가상 컴퓨터의 백업 데이터가 있는 한 요금 청구가 계속됩니다. 백업 데이터가 보존된 경우 보호 중지 작업을 수행해도 요금 청구는 중지되지 않습니다.

지정된 가상 컴퓨터에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다. 활성 백업 작업이 없는 경우(보호가 중지된 경우), 마지막으로 성공한 백업 당시의 가상 컴퓨터 크기가 월별 요금 청구의 기준이 되는 보호된 인스턴스 크기가 됩니다.

## 질문이 있으십니까?
질문이 있거나 포함되었으면 하는 기능이 있는 경우 [의견을 보내 주세요](http://aka.ms/azurebackup_feedback).

## 다음 단계

- [가상 컴퓨터 설정](backup-azure-vms.md)
- [가상 컴퓨터 백업 관리](backup-azure-manage-vms.md)
- [가상 컴퓨터 복원](backup-azure-restore-vms.md)
- [VM 백업 문제 해결](backup-azure-vms-troubleshoot.md)

<!---HONumber=AcomDC_0121_2016-->