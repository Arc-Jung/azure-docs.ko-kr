---
title: Azure VM 백업 정보
description: Azure VM 백업에 대해 알아보고 몇 가지 모범 사례를 확인합니다.
services: backup
author: rayne-wiselman
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 01/08/2019
ms.author: raynew
ms.openlocfilehash: 09464342bd39e57f6e637ce90adc7190d08340a9
ms.sourcegitcommit: c61777f4aa47b91fb4df0c07614fdcf8ab6dcf32
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 01/14/2019
ms.locfileid: "54265416"
---
# <a name="about-azure-vm-backup"></a>Azure VM 백업 정보

이 문서에서는 [Azure Backup 서비스](backup-introduction-to-azure-backup.md)가 Azure VM을 백업하는 방법을 설명합니다.

## <a name="backup-process"></a>백업 프로세스

Azure Backup에서 Azure VM의 백업을 완료하는 방법은 다음과 같습니다.

1. 백업용으로 선택된 Azure VM의 경우 Azure Backup 서비스는 사용자가 지정한 백업 일정에 따라 백업 작업을 시작합니다.
2. 서비스가 백업 확장을 트리거합니다.
    - Windows VM은 _VMSnapshot_ 확장을 사용합니다.
    - Linux VM은 _VMSnapshotLinux_ 확장을 사용합니다.
    - 확장은 첫 번째 VM 백업 중에 설치됩니다.
    - 확장을 설치하려면 VM이 실행 중이어야 합니다.
    - VM이 실행되고 있지 않을 경우 Backup 서비스가 기본 스토리지의 스냅숏을 생성합니다(VM이 중지되었을 때는 애플리케이션 쓰기가 수행되지 않음).
4. 백업 확장은 스토리지 수준의 충돌 일관성/파일 일관성이 있는 스냅숏을 만듭니다.
5. 스냅숏을 만든 후에는 데이터가 자격 증명 모음으로 전송됩니다. 효율성을 극대화하기 위해 이 서비스는 이전 백업 이후에 변경된 데이터 블록(델타)만 식별하여 전송합니다.
5. 데이터 전송이 완료되면 스냅숏이 제거되고 복구 지점이 생성됩니다.

![Azure 가상 머신 백업 아키텍처](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

## <a name="data-encryption"></a>데이터 암호화.

Azure Backup은 백업 프로세스의 일부로 데이터를 암호화하지 않습니다. Azure Backup은 Azure Disk Encryption을 사용하여 암호화된 Azure VM의 백업을 지원합니다.

- 관리형 Azure VM과 비관리형 Azure VM에는 BEK(Bitlocker Encryption Key)만 사용하여 암호화되는 VM 및 BEK와 KEK(Key Encryption Key)를 사용하여 암호화되는 VM의 백업이 지원됩니다.
- 백업된 BEK(비밀) 및 KEK(키)는 암호화되므로 인증된 사용자가 키 자격 증명 모음으로 복원하는 경우에만 읽고 사용할 수 있습니다.
- BEK도 백업되므로 BEK가 손실된 시나리오에서는 권한이 부여된 사용자가 BEK를 KeyVault로 복원하고 암호화된 VM을 복구할 수 있습니다. 암호화된 VM의 키와 비밀은 암호화된 형태로 백업되므로 인증되지 않은 사용자 및 Azure는 백업된 키와 비밀을 읽거나 사용할 수 없습니다. 올바른 수준의 권한이 있는 사용자만 암호화된 VM과 키 및 비밀을 백업하고 복원할 수 있습니다.

## <a name="snapshot-consistency"></a>스냅숏 일관성

앱이 실행되는 동안 스냅숏을 만들기 위해 Azure Backup은 앱 일관성이 있는 스냅숏을 만듭니다.

- **Windows VM**: Windows VM의 경우 Backup 서비스는 VSS(볼륨 섀도 복사본 서비스)와 조정되어 VM 디스크의 일관성 있는 스냅숏을 가져옵니다.
    - 기본적으로 Azure Backup은 전체 VSS 백업을 만듭니다. [자세히 알아보기](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx).
    - Azure Backup에서 VSS 복사본 백업을 만들도록 설정을 변경하려는 경우 다음 레지스트리 키를 설정합니다.
        ```
        [HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
        ""USEVSSCOPYBACKUP"="TRUE"
        ```
        - 관리자 권한 명령 프롬프트에서 아래 명령을 실행하여 위의 레지스트리 키를 설정합니다.
          ```
          REG ADD "HKLM\SOFTWARE\Microsoft\BcdrAgent" /v USEVSSCOPYBACKUP /t REG_SZ /d TRUE /f
          ```
- **Linux VM**: Azure Backup이 스냅숏을 만들 때 Linux VM에 앱 일관성이 있는지 확인하려면 Linux 사전 스크립트 및 사후 스크립트 프레임워크를 사용할 수 있습니다. VM 스냅숏을 만들 때 일관성을 유지하기 위해 직접 사용자 지정 스크립트를 작성할 수 있습니다.
    -  Azure Backup은 사용자가 작성한 사전 및 사후 스크립트만 호출합니다.
    - Azure Backup은 사전 스크립트 및 사후 스크립트가 성공적으로 실행되는 경우 애플리케이션 일관성이 있게 복구 지점을 표시합니다. 그러나 사용자 지정 스크립트를 사용하는 경우 애플리케이션 일관성에 대한 궁극적인 책임은 사용자에게 있습니다.
    - 스크립트 구성에 대해 [자세히 알아봅니다](backup-azure-linux-app-consistent.md).


#### <a name="consistency-types"></a>일관성 유형

다음 표에서는 여러 유형의 일관성에 대해 설명합니다.

**스냅숏** | **VSS 기반** | **세부 정보** | **복구**
--- | --- | --- | ---
**애플리케이션 일관성** | 예(Windows만 해당) | 앱 일관성이 있는 백업은 메모리 콘텐츠 및 보류 중인 I/O 작업을 캡처합니다. 앱 일관성이 있는 스냅숏은 백업이 발생하기 전에 앱 데이터의 일관성을 보장하는 VSS 기록기(Linux용 사전/사후 스크립트)를 사용합니다. | 앱 일관성이 있는 스냅숏으로 복구하는 경우 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱이 일관성 있는 상태로 시작됩니다.
**파일 시스템 일관성** | 예(Windows만 해당) |  파일 일관성이 있는 백업은 동시에 모든 파일의 스냅숏을 만들어 디스크 파일의 일관성 있는 백업을 제공합니다.<br/><br/> Azure Backup 복구 지점에 파일 일관성이 있는 백업:<br/><br/> - 사전/사후 스크립트가 없거나 실패한 스크립트가 있는 Linux VM 백업<br/><br/> - VSS가 실패한 Windows VM 백업 | 일관성 있는 파일 스냅숏으로 복구하는 경우 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱은 자체 “수정” 메커니즘을 구현하여 복원된 데이터가 일관성 있는지 확인해야 합니다.
**크래시 일관성** | 아니요 | 백업 시 Azure VM이 종료될 때 대개 크래시 일관성이 발생합니다.  백업 시 디스크에 이미 존재하는 데이터만 캡처 및 백업됩니다.<br/><br/> 크래시 일관성이 있는 복구 지점은 운영 체제 또는 앱의 데이터 일관성을 보장하지 않습니다. | 항상 그렇지는 않지만 대개 VM이 부팅된 다음에 디스크 검사가 수행되어 손상 오류를 수정합니다. 디스크에 전송되지 않은 메모리 내 데이터 또는 쓰기는 모두 손실됩니다. 앱이 고유한 데이터 확인을 구현합니다. 예를 들어 데이터베이스 앱의 경우 데이터베이스에 없는 항목이 트랜잭션 로그에 있는 경우 데이터베이스 소프트웨어는 데이터가 일관성이 있을 때까지 롤됩니다.


## <a name="service-and-subscription-limits"></a>서비스 및 구독 제한

Azure Backup에는 구독 및 자격 증명 모음에 대한 많은 제한 사항이 있습니다.

[!INCLUDE [azure-backup-limits](../../includes/azure-backup-limits.md)]


## <a name="backup-performance"></a>Backup 성능

### <a name="disk-considerations"></a>디스크 고려 사항

Backup 작업은 각 VM의 디스크를 병렬로 백업하여 최적화합니다. 예를 들어 VM에 4개의 디스크가 있는 경우 이 서비스는 4개의 디스크를 모두 병렬로 백업하려고 합니다. 백업 중인 각 디스크에 대해 Azure Backup은 디스크의 블록을 읽고 변경 된 데이터(증분 백업)만 저장합니다.


### <a name="scheduling-considerations"></a>일정 고려 사항

백업 일정은 성능에 영향을 줍니다.

- 모든 VM이 동시에 백업되도록 정책을 구성하는 경우, 백업 프로세스가 모든 디스크를 병렬로 백업하려고 하므로 정체가 발생합니다.
- 백업 트래픽을 줄이려면 여러 VM이 겹치지 않게 하루 중 서로 다른 시간대에 백업되도록 하는 것입니다.


### <a name="time-considerations"></a>시간 고려 사항

대부분의 백업 시간은 데이터를 읽고 쓰는 데 사용되지만, VM을 백업하는 데 필요한 총 시간에는 다른 작업이 추가됩니다.

- **백업 확장 설치**: 백업 확장을 설치 또는 업데이트하는 데 필요한 시간
- **스냅숏 트리거**: 스냅숏을 트리거하는 데 걸린 시간 스냅숏은 예약된 백업 시간에 가깝게 트리거됩니다.
- **큐 대기 시간**: Backup 서비스는 여러 고객 스토리지 계정의 작업을 동시에 처리하므로 스냅숏 데이터가 Recovery Services 자격 증명 모음에 즉시 복사되지 않을 수 있습니다. 최대 부하 시간에 백업이 처리되기까지 최대 8시간이 걸릴 수 있습니다. 그러나 일별 백업 정책의 경우 총 VM 백업 시간은 24시간 미만입니다.
- **초기 백업**: 24시간 미만이라는 총 백업 시간이 증분 백업에는 유효하지만 첫 번째 백업에는 유효하지 않을 수 있습니다. 필요한 시간은 데이터 크기와 백업을 수행하는 시기에 따라 달라집니다.
- **데이터 전송 시간**: 이전 백업에서 증분 변경 내용을 계산하고 해당 변경 내용을 자격 증명 모음 스토리지에 전송하는 백업 서비스에 필요한 시간입니다.

### <a name="factors-affecting-backup-time"></a>백업 시간에 영향을 주는 요인

Backup은 스냅숏 만들기 및 자격 증명 모음에 스냅숏 전송의 두 단계로 구성됩니다. Backup 서비스는 저장소에 최적화됩니다.

- 스냅숏 데이터를 자격 증명 모음으로 이전할 경우 서비스는 이전 스냅숏에서 증분 변경 사항만 이전합니다.
- 증분 변경을 확인하기 위해 컴퓨터는 블록의 체크섬을 계산합니다.
    - 블록이 변경되면 해당 블록은 자격 증명 모음으로 전송될 블록으로 식별됩니다.
    - 서비스는 식별된 각 블록을 더 분석하여 전송할 데이터를 최소화할 기회를 찾습니다.
    - 모든 변경된 블록을 평가한 후 서비스는 변경 사항을 취합하여 자격 증명 모음으로 보냅니다.

백업 시간에 영향을 줄 수 있는 상황에는 다음이 포함됩니다.

- **이미 보호된 VM에 대한 새로 추가된 디스크의 초기 백업**: VM에 증분 백업을 수행 중일 때 새 디스크가 이 VM에 추가되면 새로 추가된 디스크가 기존 디스크의 델타 복제와 함께 초기 복제를 수행해야 하기 때문에 백업 소요 시간이 24시간을 초과할 수 있습니다.
- **조각화**: Backup 제품은 두 백업 작업 간의 증분 변경 사항을 검색합니다. 변경 사항이 디스크에 전체에 분산되어 있는 경우보다 디스크의 변경 사항이 모여 있을 때 Backup 작업이 더 빠릅니다. 
- **변동**: 디스크당 일일 변동(증분 복제용)이 200GB를 초과하면 작업을 완료하는 데 ~8시간 넘게 걸릴 수 있습니다. VM에 둘 이상의 디스크가 있고 디스크 중 하나를 백업하는 데 시간이 오래 걸리는 경우에는 전체 백업 작업에 영향을 줄 수 있습니다(또는 오류가 발생할 수 있음). 
- **CC(Checksum Comparison) 모드**: CC 모드는 인스턴트 RP에 사용되는 최적화 모드에 비해 느립니다. 인스턴트 RP를 이미 사용 중이며 계층 1 스냅숏을 삭제한 경우에는 Backup이 CC 모드로 전환되어 백업 작업이 24시간을 초과하거나 실패하게 됩니다.

## <a name="restore-considerations"></a>복원 고려 사항

복원 작업은 자격 증명 모음에서 선택한 스토리지 계정으로 데이터 복사 및 가상 머신 만들기의 두 가지 기본 작업으로 구성됩니다. 자격 증명 모음에서 데이터를 복사하는 데 필요한 시간은 백업이 Azure에 저장되는 위치와 스토리지 계정 위치에 따라 달라집니다. 데이터를 복사하는 데 걸리는 시간은 다음에 따라 다릅니다.

- **큐 대기 시간**: 서비스가 동시에 여러 스토리지 계정의 복원을 처리하므로 복원 요청이 큐에 배치됩니다.
- **데이터 복사 시간**: 데이터가 자격 증명 모음에서 스토리지 계정으로 복사됩니다. 복원 시간은 Azure Backup 서비스가 사용하는 선택된 스토리지 계정의 IOPS 및 처리량에 따라 달라집니다. 복원 과정 중 복사 시간을 단축하려면 다른 애플리케이션 쓰기 및 읽기로 로드되지 않은 저장소 계정을 선택하세요.

## <a name="best-practices"></a>모범 사례

VM 백업을 구성하는 동안 다음 사례를 따르는 것이 좋습니다.

- 리소스가 최적으로 사용되도록 데이터 스냅숏을 작성하는 경우에는 기본 제공된 정책 시간을 수정하는 것이 좋습니다. (예: 기본 정책 시간이 오전 12시인 경우에는 분 단위로 증가시키는 것이 좋습니다.)
- 인스턴트가 아닌 RP 기능의 프리미엄 VM 백업의 경우, 총 스토리지 계정 공간의 ~ 50 %를 할당합니다. Backup 서비스는 스냅숏을 동일한 스토리지 계정으로 복사하여 자격 증명 모음으로 전송하기 위해 이 공간이 필요합니다.
- 단일 자격 증명 모음에서 VM을 복원하는 경우에는 다른  [v2 스토리지 계정](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade) 을 사용하여 대상 스토리지 계정이 제한되지 않도록 하는 것이 좋습니다. 예를 들어 각 VM마다 다른 스토리지 계정이 있어야 합니다. (VM이 10개 복원되는 경우 10개의 다른 스토리지 계정을 사용하는 것이 좋습니다.)
- 계층 1 스토리지 레이어(스냅숏)에서 복원은(동일한 스토리지 계정이기 때문에) 몇 분 내에 완료되지만 계층 2 스토리지 레이어(자격 증명 모음)는 몇 시간이 걸릴 수 있습니다. 계층 1에서 데이터를 사용할 수 있는 경우에는 더욱 신속한 복원을 위해 [즉시 복원](backup-instant-restore-capability.md) 기능을 사용하는 것이 좋습니다. 자격 증명 모음에서 데이터를 복원해야 하는 경우에는 시간이 걸립니다.
- 스토리지 계정당 디스크 수에 대한 제한은 IaaS VM에서 실행 중인 애플리케이션이 액세스하는 디스크가 얼마나 많은지에 비례합니다. 여러 디스크가 단일 스토리지 계정에서 호스팅되는지 확인합니다. 일반적으로 단일 스토리지 계정에 디스크가 5~10개 이상 있으면 일부 디스크를 별도의 스토리지 계정으로 이동하여 부하를 분산합니다.

## <a name="backup-costs"></a>백업 비용

Azure Backup으로 백업된 Azure VM에는 [Azure Backup 가격 책정](https://azure.microsoft.com/pricing/details/backup/)이 적용됩니다.

- 요금 청구는 첫 번째 백업이 성공적으로 완료되기 전까지 시작되지 않습니다. 이때 저장소와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다.
- 가상 머신의 백업 데이터가 자격 증명 모음에 저장되어 있는 한 요금이 계속 청구됩니다. 가상 머신의 보호를 중지하더라도 자격 증명 모음에 가상 머신 백업 데이터가 있으면 요금이 계속 청구됩니다.
- 지정된 VM에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다.
- 보호가 중지되고 활성 백업 작업이 없으면 마지막으로 성공한 VM 백업이 월별 청구에 사용되는 보호된 인스턴스 크기가 됩니다.
- 보호된 인스턴스 계산은 가상 머신의 ‘실제’ 크기를 기반으로 하며, 임시 스토리지를 제외한 가상 머신의 모든 데이터 합계입니다.
- 데이터 디스크에 저장된 실제 데이터에 따라 청구됩니다.
- VM 백업에 대한 가격 책정은 가상 머신에 연결된 각 데이터 디스크의 최대 지원 크기에 따라 결정되는 것이 아니라,
- 마찬가지로, 백업 저장소 요금은 Azure Backup을 사용하여 저장된 데이터 양(각 복구 지점의 실제 데이터 합계)을 기준으로 청구됩니다.

최대 크기가 각각 4TB인 두 개의 추가 데이터 디스크가 있는 A2 표준 크기 가상 머신을 예로 들 수 있습니다. 다음 표는 각 디스크에 저장된 실제 데이터를 제공합니다.

| 디스크 유형 | 최대 크기 | 실제 데이터 표시 |
| --------- | -------- | ----------- |
| 운영 체제 디스크 |4,095GB |17GB |
| 로컬 디스크/임시 디스크 |135GB |5GB(백업에 포함되지 않음) |
| 데이터 디스크 1 |4,095GB |30GB |
| 데이터 디스크 2 |4,095GB |0GB |

- 이 경우 VM 가상 머신의 실제 크기는 17GB+30GB+0GB=47GB입니다.
- 이 보호된 인스턴스 크기(47GB)는 월별 청구서의 근거가 됩니다.
- 가상 머신의 데이터 양이 증가하면 요금 청구에 사용되는 보호된 인스턴스 크기도 그에 따라 변경됩니다.


## <a name="next-steps"></a>다음 단계

백업 프로세스 및 성능 고려 사항을 검토한 후 다음을 수행합니다.

- Azure Storage를 사용하여 최적 성능을 위해 앱을 튜닝하는 방법을 [알아봅니다](../virtual-machines/windows/premium-storage-performance.md). 이 문서에서는 Premium Storage에 중점을 두지만 표준 스토리지 디스크에도 적용할 수 있습니다.
- VM 지원 및 제한 사항을 검토하고, 자격 증명 모음을 만들고, VM을 백업할 준비를 수행하여 백업을 [시작합니다](backup-azure-arm-vms-prepare.md).
