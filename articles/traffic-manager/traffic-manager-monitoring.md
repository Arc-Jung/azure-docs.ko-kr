<properties
   pageTitle="트래픽 관리자 끝점 모니터링 및 장애 조치(failover) | Microsoft Azure"
   description="이 문서는 트래픽 관리자가 끝점 모니터링 및 자동 끝점 장애 조치를 사용하여 Azure 고객이 고가용성 응용 프로그램을 어떻게 배포할 수 있도록 하는지 이해하는 데 도움이 됩니다."
   services="traffic-manager"
   documentationCenter=""
   authors="sdwheeler"
   manager="carmonm"
   editor="tysonn" />
<tags
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="07/01/2016"
   ms.author="sewhee" />

# 트래픽 관리자 끝점 모니터링 및 장애 조치(failover)

Azure 트래픽 관리자에는 기본 제공된 끝점 모니터링 및 자동 끝점 장애 조치가 포함됩니다. 이 기능을 통해 Azure 지역 장애를 포함하여 끝점 장애에 대해 복원력 있는 고가용성 응용 프로그램을 제공할 수 있습니다.

트래픽 관리자는 각 끝점에 대해 일반 요청을 하고 응답을 확인합니다. 끝점이 유효한 응답을 제공하지 못하면 트래픽 관리자는 해당 상태를 Degraded로 표시합니다. 이 끝점은 더 이상 DNS 응답에 포함되지 않으며 사용 가능한 대체 끝점이 반환됩니다. 따라서 사용자 트래픽은 실패한 끝점에서 사용 가능한 끝점으로 전달됩니다.

성능 저하 끝점에 대한 끝점 상태 검사는 계속 진행되므로 복구된 후 정상 상태가 되면 자동으로 사용될 수 있습니다.

## 끝점 모니터링 구성

끝점 모니터링을 구성하려면 트래픽 관리자 프로필에서 다음 설정을 지정해야 합니다.

- **프로토콜**. HTTP 또는 HTTPS를 선택합니다. HTTPS 모니터링은 SSL 인증서가 유효한 지 여부를 확인하지 않으며 인증서가 존재한다는 것만 확인합니다.
- **포트**. 요청에 사용될 포트를 선택합니다. 표준 HTTP 및 HTTPS 포트 중에서 선택할 수 있습니다.
- **경로**. 모니터링 상태 검사에서 액세스를 시도할 웹 페이지 또는 파일의 상대 경로와 이름입니다. 슬래시(/)는 상대 경로에 유효한 입력이며 파일이 루트 디렉터리(기본값)에 있음을 나타냅니다.

각 끝점의 상태를 검사하기 위해 트래픽 관리자는 지정된 프로토콜, 포트 및 상대 경로를 사용하여 끝점에 대해 GET 요청을 합니다.

일반적인 방법은 응용 프로그램 내에서 사용자 지정 페이지를 구현하는 것입니다(예: /health.aspx). 이 페이지를 트래픽 관리자 끝점 모니터링 경로가 되도록 구성합니다. 해당 페이지 내에서 HTTP 200(서비스가 정상인 경우) 또는 다른 상태 코드를 반환하기 전에 데이터베이스의 가용성 검사 등 필요한 응용 프로그램 관련 검사를 수행할 수 있습니다.

끝점 모니터링 설정은 끝점 단위가 아니라 트래픽 관리자 프로필 수준에서 구성됩니다. 따라서 모든 끝점의 상태를 검사하는 데 동일한 설정을 사용합니다. 서로 다른 끝점에 대해 다양한 모니터링 설정을 사용해야 하는 경우 [중첩된 트래픽 관리자 프로필](traffic-manager-nested-profiles.md#example-5-per-endpoint-monitoring-settings)을 사용하여 수행할 수 있습니다.

## 끝점 및 프로필 상태

트래픽 관리자 프로필 및 끝점을 사용하거나 사용하지 않도록 설정할 수 있습니다. 그러나 트래픽 관리자의 자동 설정 및 프로세스에 따라 끝점 상태가 변경될 수도 있습니다. 다음 매개 변수는 해당 과정을 설명합니다.

### 끝점 상태

끝점 상태는 사용자 제어 설정이므로, 사용자가 특정 끝점을 쉽게 사용하거나 사용하지 않도록 설정할 수 있습니다. 기본 서비스의 상태에는 영향을 주지 않습니다(계속 실행됨). 대신 트래픽 관리자 관점에서 특정 끝점의 가용성을 제어합니다. 끝점 상태가 Disabled이면 트래픽 관리자는 해당 상태를 확인하지 않으며 끝점은 DNS 응답에 포함되지 않습니다.

### 프로필 상태

프로필 상태는 사용자 제어 설정입니다. 따라서 이러한 설정을 사용하여 프로필을 사용하거나 사용하지 않도록 쉽게 설정할 수 있습니다. 끝점 상태가 단일 끝점에 영향을 주지만 프로필 상태는 모든 끝점을 포함한 전체 프로필에 영향을 줍니다. 사용 안 함 상태의 프로필에 있는 끝점은 상태가 확인되지 않으며 DNS 응답에 끝점이 포함되지 않습니다(NXDOMAIN 응답이 반환됨).

### 끝점 모니터 상태

끝점 모니터 상태는 끝점의 현재 상태를 보여 주는 트래픽 관리자 생성 설정입니다. 이 설정은 수동으로 변경할 수 없습니다. 끝점 모니터 상태는 끝점 상태 등의 기타 정보 외에도 지속적인 끝점 모니터링 결과에 반영됩니다. 끝점 모니터 상태의 가능한 값은 다음 표에 나와 있습니다. 중첩된 끝점의 끝점 모니터 상태가 계산되는 방식에 대한 자세한 내용은 [중첩 트래픽 관리자 프로필](traffic-manager-nested-profiles.md)을 참조하세요.

|프로필 상태|끝점 상태|끝점 모니터 상태(API 및 포털)|참고 사항|
|---|---|---|---|
|사용 안 함|사용|비활성|사용자가 프로필을 사용하지 않도록 설정했습니다. 끝점 상태는 여전히 Enabled일 수 있지만 프로필 상태(Disabled)가 우선적으로 적용됩니다. Disabled 상태의 프로필에 포함된 끝점은 모니터링되지 않으며 DNS 응답에 포함되지 않습니다(NXDOMAIN 응답이 반환됨).|
|&lt;일부&gt;|사용 안 함|사용 안 함|사용자가 끝점을 사용하지 않도록 설정했습니다. Disabled 상태의 끝점은 모니터링되지 않습니다. DNS 응답에 포함될 수 없으므로 트래픽을 수신하지도 않습니다.|
|사용|사용|온라인|끝점은 모니터링되며 정상 상태입니다. DNS 응답에 포함될 수 있으므로 트래픽을 수신할 수 있습니다.|
|사용|사용|성능 저하됨|끝점 모니터링 상태 검사에 실패했습니다. 끝점이 DNS 응답에 포함될 수 없으므로 트래픽을 수신하지도 않습니다.|
|사용|사용|CheckingEndpoint|끝점이 모니터링되지만 첫 번째 검사 결과가 아직 수신되지 않았습니다. 새 끝점을 프로필에 방금 추가했거나 끝점이나 프로필을 방금 사용 가능하도록 설정한 경우 일반적으로 발생하는 임시 상태입니다. 이 상태의 끝점은 DNS 응답에 포함될 수 있으므로 트래픽을 수신할 수 있습니다.|
|사용|사용|중지됨|끝점이 가리키는 클라우드 서비스 또는 웹앱이 실행되지 않습니다. 클라우드 서비스 또는 웹앱 설정을 확인합니다. Stopped 상태의 끝점은 모니터링되지 않습니다. DNS 응답에 포함될 수 없으므로 트래픽을 수신하지도 않습니다.|

### 프로필 모니터 상태

프로필 모니터 상태는 프로필에 있는 모든 끝점에 대한 끝점 모니터 상태 값과 구성된 프로필 상태를 조합한 것입니다. 가능한 값은 다음 표에 설명되어 있습니다.

|프로필 상태(구성된 대로)|끝점 모니터 상태|프로필 모니터 상태(API 및 포털)|참고 사항|
|---|---|---|---|
|사용 안 함|&lt;일부&gt; 또는 정의된 끝점이 없는 프로필|사용 안 함|사용자가 프로필을 사용하지 않도록 설정했습니다.|
|사용|하나 이상의 끝점 상태가 Degraded입니다.|성능 저하됨|이것은 고객 작업이 필요하다는 플래그입니다. 끝점에 주의가 필요한지 확인하려면 개별 끝점 상태 값을 검토합니다.|
|사용|하나 이상의 끝점 상태가 Online입니다. Degraded 상태의 끝점이 없습니다.|온라인|서비스가 트래픽을 받아들여 고객 작업이 필요하지 않습니다.|
|사용|하나 이상의 끝점 상태가 “CheckingEndpoint”입니다. Online 또는 Degraded 상태인 끝점이 없습니다.|CheckingEndpoints|전환 상태입니다. 일반적으로 프로필을 방금 만들거나 사용 가능하도록 설정하고 끝점 상태를 처음으로 검사 중인 경우에 발생합니다.|
|사용|프로필에 정의된 모든 끝점의 상태는 Disabled 또는 Stopped이거나 프로필에 정의된 끝점이 없습니다.|비활성|끝점이 활성 상태가 아니지만 프로필은 여전히 Enabled입니다.|

## 끝점 장애 조치 및 장애 복구

이전에 정상 상태이던 끝점이 실패하는 시나리오를 살펴보겠습니다. 트래픽 관리자가 오류를 감지하면 끝점이 순환을 벗어납니다. 나중에 끝점이 복구됩니다. 트래픽 관리자가 이 복구를 감지하고 끝점이 다시 순환에 포함됩니다.

>[AZURE.NOTE] 트래픽 관리자는 반환된 메시지가 200 OK인 경우에만 끝점이 온라인이라고 간주합니다. 다음 중 하나가 발생할 경우 트래픽 관리자는 끝점 상태 검사가 실패한 것으로 간주합니다.

>- 200이 아닌 응답을 수신함(다양한 2xx 코드 또는 301/302 리디렉션)
>- 클라이언트 인증 요청
>- 시간 제한(시간 제한 임계값은 10초)
>- 연결할 수 없음

>실패한 검사의 문제 해결에 대한 자세한 내용은 [Azure 트래픽 관리자의 Degraded 상태 문제 해결](traffic-manager-troubleshooting-degraded.md)을 참조하세요.

다음 타임라인에서는 발생하는 일련의 단계에 대해 자세히 설명합니다.

![트래픽 관리자 끝점 장애 조치 및 장애 복구 순서](./media/traffic-manager-monitoring/timeline.png)

1. **GET**. 트래픽 관리자 모니터링 시스템이 모니터링 설정에서 지정된 파일과 경로에서 GET 요청을 수행합니다. 이 각 끝점에 대해 반복됩니다.
2. **200 OK**. 모니터링 시스템에서 10초 내에 HTTP 200 OK 메시지가 반환됩니다. 이 응답을 수신하면 서비스를 사용할 수 있는 것으로 인식합니다.
3. **확인 간격 30초**. 끝점 상태 검사가 30초마다 반복됩니다.
4. **서비스를 사용할 수 없음**. 서비스를 사용할 수 없게 됩니다. 트래픽 관리자는 다음 상태 검사까지 알지 못합니다.
5. **모니터링 파일 액세스 시도(4회)**. 모니터링 시스템은 GET 요청을 수행하지만 10초의 기간 내에 응답을 수신하지 않습니다(또는 200 이외의 응답을 수신할 수 있음). 30초 간격으로 3회 더 시도합니다. 그 중 한 번의 시도가 성공하면 시도 횟수가 다시 설정됩니다.
6. **상태가 Degraded로 설정**. 네 번째 연속 실패 후 모니터링 시스템은 사용할 수 없는 끝점을 Degraded로 표시합니다.
7. **트래픽이 다른 끝점으로 우회됨**. 트래픽 관리자 DNS 이름 서버가 업데이트되고 트래픽 관리자에 의해 DNS 쿼리에 대한 응답으로 끝점이 더 이상 반환되지 않습니다. 새 연결은 사용 가능한 다른 끝점으로 전달됩니다. 그러나 이 끝점을 포함하는 이전 DNS 응답은 재귀 DNS 서버 및 DNS 클라이언트에 의해 계속 캐시될 수 있으므로 일부 클라이언트가 이 끝점에 대한 연결을 시도합니다. 이러한 캐시가 만료되면 클라이언트는 새 DNS 쿼리를 만들고 다른 끝점으로 전달됩니다. 캐시 기간은 트래픽 관리자 프로필의 TTL 설정에 의해 제어됩니다(예: 30초).
8. **계속 상태 검사**. 트래픽 관리자는 Degraded 상태에 있는 끝점의 상태를 계속해서 검사합니다. 끝점에서 상태를 반환할 때 감지할 수 있도록 합니다.
9. **서비스가 다시 온라인 상태가 됩니다**. 서비스를 사용할 수 있습니다. 모니터링 시스템에서 다음 상태 검사를 수행할 때까지 끝점은 트래픽 관리자에서 Degraded 상태로 유지됩니다.
10. **서비스에 대한 트래픽 다시 시작**. 트래픽 관리자는 GET 요청을 전송하고 200 OK 상태 응답을 수신합니다. 이것은 서비스가 정상 상태로 돌아왔음을 나타냅니다. 트래픽 관리자 이름 서버는 업데이트되고 DNS 응답에서 서비스의 DNS 이름을 전달하기 시작합니다. 다른 끝점으로 반환되는 캐시된 DNS 응답이 만료되고 다른 끝점에 대한 기존 연결이 종료됨에 따라 트래픽이 또 다시 끝점으로 반환됩니다.

>[AZURE.NOTE] 트래픽 관리자는 DNS 수준에서 작동하므로 모든 끝점에 대한 기존 연결에 영향을 미칠 수 없습니다. 끝점 간에 트래픽을 전달할 때는(프로필 설정을 변경하거나 장애 조치 또는 장애 복구 중) 트래픽 관리자가 사용 가능한 끝점에 새 연결을 전달합니다. 그러나 다른 끝점은 해당 세션이 종료될 때까지 기존 연결을 통해 트래픽을 계속 수신할 수 있습니다. 트래픽이 기존 연결에서 비워지도록 하기 위해 응용 프로그램은 각 끝점에 사용된 세션 기간을 제한해야 합니다.

## 성능이 저하된 끝점

끝점이 Degraded 상태이면 더 이상 DNS 쿼리에 대한 응답을 통해 반환되지 않습니다(이 규칙에 대한 예외는 이 섹션 끝에 나오는 참고 참조). 대신 대체 끝점이 선택되어 반환됩니다. 대체 끝점의 선택은 구성된 트래픽 라우팅 방법에 따라 달라집니다.

- **우선 순위**. 끝점은 우선 순위가 정해진 목록을 구성합니다. 목록에 사용 가능한 첫 번째 끝점은 항상 반환됩니다. 끝점 상태가 Degraded면 사용 가능한 다음 끝점이 반환됩니다.
- **가중치 적용**. 사용 가능한 모든 끝점을 반환할 수 있으며 할당된 가중치 및 다른 사용 가능한 끝점의 가중치를 기반으로 임의로 선택할 수 있습니다. 끝점 상태가 Degraded면 사용 가능한 끝점에 대한 나머지 풀에서 끝점이 선택됩니다.
- **성능**. 최종 사용자에게 가장 가까운 끝점이 반환됩니다(Disabled 또는 Stopped 상태의 끝점 제외). 해당 끝점을 사용할 수 없는 경우 반환되는 끝점은 나머지 사용 가능한 모든 끝점에서 임의로 선택됩니다. 이는 가장 가까운 다음 끝점이 오버로드되는 경우 발생할 수 있는 연속 오류를 방지하는 데 도움이 됩니다. [중첩 트래픽 관리자 프로필](traffic-manager-nested-profiles.md#example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region)을 사용하여 성능 트래픽 라우팅에 대한 대체 장애 조치 계획을 구성할 수 있습니다.

자세한 내용은 [트래픽 관리자 트래픽 라우팅 방법](traffic-manager-routing-methods.md)을 참조하세요.

>[AZURE.NOTE] 모든 트래픽 관리자 끝점(Disabled 또는 Stopped 상태의 끝점 제외)에서 상태 검사에 실패하고 Degraded 상태를 표시되는 경우 어떻게 되나요?

>이러한 현상은 서비스 구성에 오류(ACL(액세스 제어 목록)에서 트래픽 관리자 상태 검사 차단)가 있거나 트래픽 관리자 프로필의 구성에 오류(잘못된 모니터링 경로)가 있는 경우 주로 발생합니다.

>이 경우 트래픽 관리자는 “최선”을 다하고 *모든 Degraded 상태 끝점이 실제로 Online 상태인 것처럼 응답*합니다. 이것은 DNS 응답에 어떠한 끝점도 반환하지 않는 것보다 바람직한 방법입니다.

>이러한 동작은 트래픽 관리자 상태 검사가 제대로 구성되지 않는 경우 발생하며 트래픽 라우팅에서 트래픽 관리자가 제대로 *작동하는* 것처럼 보일 수 있습니다. 하지만 이 경우에 끝점이 실패하면 끝점 장애 조치가 발생하지 않으며 전체 응용 프로그램 가용성에 영향을 미칩니다. 이러한 문제가 발생하지 않도록 하기 위해 프로필에 Degraded 상태 대신 Online 상태가 표시되는지 확인하는 것이 중요합니다. Online 상태는 트래픽 관리자 상태 검사가 예상대로 작동 중임을 보여 줍니다.

실패한 상태 검사의 문제 해결에 대한 자세한 내용은 [Azure 트래픽 관리자의 Degraded 상태 문제 해결](traffic-manager-troubleshooting-degraded.md)을 참조하세요.

## FAQ

### 트래픽 관리자 자체는 Azure 지역 장애에 복원력이 있나요?

트래픽 관리자는 기본 제공된 상태 검사와 지역 간 자동 장애 조치(failover)를 제공하는 핵심 구성 요소로, 지역 전체의 Azure 중단에 대해 복원력 있는 응용 프로그램을 비롯하여 Azure에서 고가용성 응용 프로그램을 제공합니다.

따라서 트래픽 관리자 자체는 지역별 장애에 대한 복원력을 비롯하여 매우 높은 수준의 가용성을 제공해야 합니다.

Azure에서 일부 트래픽 관리자 부분이 실행되는 경우 이러한 구성 요소는 지역 간에 분산되고 모든 Azure 지역의 전체 오류에 복원력이 있도록 설계되었습니다. 이러한 복원력은 DNS 이름 서버, API, 저장소 계층 및 끝점 모니터링 서비스 등 모든 트래픽 관리자 구성 요소에 해당됩니다.

따라서 전체 Azure 지역의 전면적인 중단이 발생할 가능성이 낮더라도 트래픽 관리자는 계속 정상적으로 작동하며 여러 Azure 지역에 배포된 응용 프로그램이 있는 고객은 트래픽 관리자가 사용 가능한 응용 프로그램 인스턴스로 트래픽을 전달한다는 사실에 안심할 수 있습니다.

### 리소스 그룹의 위치 선택은 트래픽 관리자에 어떤 영향을 주나요?

트래픽 관리자는 단일 전역 서비스입니다. 지역에 영향을 받지 않습니다. 리소스 그룹의 위치 선택은 해당 리소스 그룹에 배포된 트래픽 관리자 프로필에 어떤 영향도 주지 않습니다.

Azure Resource Manager에서는 모든 리소스 그룹에서 '위치'를 지정해야 하며 이를 통해 해당 리소스 그룹에 배포된 리소스의 기본 위치가 결정됩니다. Azure 포털을 통해 트래픽 관리자 프로필을 만들 때 새 리소스 그룹을 만들면 이 위치를 묻는 메시지가 표시됩니다.

모든 트래픽 관리자 프로필은 위치로 **전역**을 사용합니다. 이 값이 허용되는 유일한 값이기 때문에 Azure 포털, PowerShell 또는 Azure CLI에서는 이 설정에 액세스할 수 없습니다. 이는 리소스 그룹 기본값을 재정의합니다.

### 각 끝점의 현재 상태를 확인하려면 어떻게 해야 하나요?

각 끝점의 현재 상태 모니터링 상태 및 전체 프로필은 Azure 포털에 표시됩니다. 이 정보는 트래픽 모니터 [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx), [PowerShell cmdlet](https://msdn.microsoft.com/library/mt125941.aspx), [크로스 플랫폼 Azure CLI](../xplat-cli-install.md)를 통해서도 사용할 수 있습니다.

과거의 끝점 상태에 대한 기록 정보를 볼 수 없으며 끝점 상태 변경에 대한 경고도 구성할 수 없습니다.

### HTTPS 끝점을 모니터링할 수 있나요?

예. 트래픽 관리자는 HTTPS를 통한 검색을 지원합니다. 모니터링 구성에서 프로토콜로 **HTTPS**를 간단히 구성합니다. 다음 사항에 유의하세요.

- 서버 쪽 인증서 유효성이 검사되지 않습니다.
- SNI 서버 쪽 인증서가 지원되지 않습니다.
- 클라이언트 인증서는 지원되지 않습니다.

### 끝점 상태 검사에 어떤 호스트 헤더가 사용되나요?

HTTP 및 HTTPS 상태 검사에 사용되는 호스트 헤더는 각 끝점과 연결된 DNS 이름입니다. Azure 포털, [PowerShell cmdlet](https://msdn.microsoft.com/library/mt125941.aspx), [크로스 플랫폼Azure CLI](../xplat-cli-install.md), [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx)에서 끝점 target으로 노출됩니다.

이 값은 끝점 구성의 일부입니다. 호스트 헤더에 사용된 값은 target 속성과 별도로 지정할 수 없습니다.


## 다음 단계

[트래픽 관리자 작동 방식](traffic-manager-how-traffic-manager-works.md)에 대해 알아봅니다.

트래픽 관리자가 지원하는 [트래픽 라우팅 방법](traffic-manager-routing-methods.md)에 대해 자세히 알아봅니다.

[트래픽 관리자 프로필을 만드는](traffic-manager-manage-profiles.md) 방법을 알아봅니다.

트래픽 관리자 끝점에서 [Degraded 상태 문제를 해결](traffic-manager-troubleshooting-degraded.md)합니다.

<!---HONumber=AcomDC_0824_2016-->