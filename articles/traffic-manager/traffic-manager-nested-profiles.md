<properties 
   pageTitle="중첩 트래픽 관리자 프로필 | Microsoft Azure"
   description="이 문서에서는 Azure 트래픽 관리자의 ‘중첩 프로필’ 기능에 대해 설명합니다."
   services="traffic-manager"
   documentationCenter=""
   authors="jtuliani"
   manager="carmonm"
   editor="tysonn" />
<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="05/25/2016"
   ms.author="jtuliani" />

# 중첩 트래픽 관리자 프로필

트래픽 관리자에는 트래픽 관리자가 각 최종 사용자의 트래픽을 수신할 끝점을 선택하는 방법을 제어할 수 있는 다양한 트래픽 라우팅 방법이 포함되어 있습니다. 이러한 방법은 [트래픽 관리자 트래픽 라우팅 방법](traffic-manager-routing-methods.md)에 설명되어 있으며 트래픽 관리자가 가장 일반적인 트래픽 라우팅 요구 사항을 충족할 수 있도록 합니다.

각 트래픽 관리자 프로필은 단일 트래픽 라우팅 방법을 지정합니다. 그러나 좀 더 복잡한 응용 프로그램이 단일 트래픽 관리자 프로필에서 제공할 수 있는 것보다 더 정교한 트래픽 라우팅을 요구하는 경우가 있을 수 있습니다.

이러한 복잡한 응용 프로그램을 지원하기 위해 트래픽 관리자는 트래픽 관리자 프로필이 통합 또는 *중첩*될 수 있도록 하여 단일 응용 프로그램이 둘 이상의 트래픽 라우팅 방법의 이점을 활용할 수 있도록 합니다. 중첩 프로필을 사용하면 더 유연하고 강력한 트래픽 라우팅 체계를 만들어 더 크고 복잡한 배포에 대한 요구 사항을 지원할 수 있습니다.

또한 중첩 프로필을 사용하면 지역 내의 트래픽 라우팅 또는 성능 트래픽 라우팅을 사용하는 경우 장애 조치(Failover) 기간과 같은 특정 경우에 기본 트래픽 관리자 동작을 재정의할 수 있습니다.

이 페이지의 나머지 부분에서는 중첩 트래픽 관리자 프로필을 다양한 시나리오에서 사용할 수 있는 방법을 예제 시퀀스를 통해 설명합니다. 마지막으로 중첩 프로필에 대한 몇 가지 질문과 대답을 제시합니다.

## 예제 1: '성능' 및 '가중' 트래픽 라우팅 결합

응용 프로그램이 미국 서부, 유럽 서부 및 동아시아 등의 여러 Azure 지역에 배포되었다고 가정합니다. 트래픽 관리자의 '성능' 트래픽 라우팅 방법을 사용하여 사용자에게 가장 가까운 지역으로 트래픽을 분산합니다.

![단일 트래픽 관리자 프로필][1]

이제 광범위하게 롤아웃하기 전에 소수의 사용자를 대상으로 서비스 업데이트를 시도한다고 가정합니다. 이를 위해 트래픽 일부만 평가판 배포로 보낼 수 있는 '가중' 트래픽 라우팅 방법을 사용하려고 합니다. 단일 프로필을 사용하는 경우 ‘가중' 및 '성능’ 트래픽 라우팅을 결합할 수 없습니다. 중첩 프로필을 사용하는 경우에는 둘 다 사용할 수 있습니다.

방법: 유럽 서부에서 새로운 배포를 시도하려 한다고 가정하겠습니다. 기존 프로덕션 배포와 함께 평가 배포를 설정하고, 이러한 두 끝점과 ‘가중’ 트래픽 라우팅 방법을 사용하여 트래픽 관리자 프로필을 만듭니다. 그런 후 이 ‘자식’ 프로필을 ‘부모’ 프로필에 끝점으로 추가합니다. 이 경우 성능 트래픽 라우팅 방법이 계속 사용되고, 다른 글로벌 배포가 끝점으로 포함됩니다.

아래 다이어그램은 이 예제를 보여 줍니다.

![중첩 트래픽 관리자 프로필][2]

이 구성에서 부모 프로필을 통해 전달된 트래픽은 여러 지역 간에 정상적으로 분산됩니다. 유럽 서부 내에서는 할당된 가중치에 따라 프로덕션 배포 및 평가용 배포 간에 트래픽이 전달됩니다.

부모 프로필이 '성능' 트래픽 라우팅 방법을 사용하는 경우 각 끝점의 위치를 알고 있어야 합니다. 중첩 끝점의 경우 외부 끝점과 마찬가지로 이 위치를 끝점 구성의 일부로 지정해야 합니다. 배포에 가장 가까운 Azure 지역을 선택합니다. 사용 가능한 옵션은 인터넷 대기 시간 테이블에서 지원되는 위치인 Azure 지역입니다. 자세한 내용은 [트래픽 관리자 '성능' 트래픽 라우팅 방법](traffic-manager-routing-methods.md#performance-traffic-routing-method)을 참조하세요.

## 예제 2: 중첩 프로필의 끝점 모니터링

트래픽 관리자는 적극적으로 각 서비스 끝점의 상태를 모니터링합니다. 끝점이 비정상 상태로 확인되는 경우 트래픽 관리자는 사용자를 대체 끝점으로 보내므로 서비스의 전반적인 가용성이 유지됩니다. 이 끝점 모니터링 및 장애 조치(Failover) 동작은 모든 트래픽 라우팅 방법에 적용됩니다. 자세한 내용은 [트래픽 관리자 끝점 모니터링](traffic-manager-monitoring.md)을 참조하세요.

중첩 프로필의 경우 몇 가지 특수한 끝점 모니터링 규칙이 적용됩니다. 부모 프로필의 중첩 끝점으로 자식 프로필이 구성된 경우 부모는 자식에 대해 직접 상태 검사를 수행하지 않습니다. 대신 자식 프로필 끝점의 상태가 자식 프로필의 전반적인 상태를 계산하는 데 사용되며, 이 정보는 부모 프로필 내에 중첩된 끝점의 상태를 결정하기 위해 중첩 프로필 계층 구조 위로 전파됩니다. 이에 따라 부모 프로필이 자식으로 트래픽을 전달할지 여부가 결정됩니다. 부모 프로필의 중첩 끝점 상태가 자식 프로필의 상태에서 계산되는 방식의 전체 세부 정보는 [아래](#faq)에 제시되어 있습니다.

다시 예제 1로 돌아가, 유럽 서부의 프로덕션 배포가 실패하는 경우를 가정해보겠습니다. 기본적으로 '자식' 프로필은 평가판 배포로 모든 트래픽을 전달합니다. 이러한 전달이 실패하면 부모 프로필은 모든 자식 끝점이 비정상 상태이므로 자식 프로필이 트래픽을 받지 않아야 한다고 결정하고 모든 유럽 서부 트래픽을 다른 지역으로 장애 조치(Failover)합니다.

![중첩 프로필 장애 조치(기본 동작)][3]

이 구성에 만족할 수도 있지만, 평가판 배포가 모든 유럽 서부 트래픽에 대한 장애 조치(Failover)로 사용되어서는 안 된다고 우려할 수도 있을 것입니다. 오히려 유럽 서부의 프로덕션 배포에 문제가 있을 경우 평가판 배포의 상태에 *상관없이* 다른 지역으로 장애 조치(Failover)되는 것을 원할 수 있습니다. 이러한 방식도 가능할 수 있습니다. 자식 프로필을 부모 프로필의 끝점으로 구성할 때 자식 프로필에서 사용할 수 있어야 하는 끝점의 최소 개수를 결정하는 'MinChildEndpoints' 매개 변수를 지정할 수 있습니다. 이 임계값(기본값 1)보다 낮을 경우 부모 프로필은 전체 자식 프로필을 사용할 수 없는 것으로 간주하고, 대신 다른 부모 프로필 끝점에 트래픽을 전달합니다.

아래 예제에 이 내용이 나와 있습니다. MinChildEndpoints를 2로 설정한 상태에서 유럽 서부의 배포가 실패하는 경우 부모 프로필은 자식 프로필이 트래픽을 받지 않아야 한다고 결정하고 사용자를 다른 지역으로 보내기로 결정합니다.

!['MinChildEndpoints' = 2인 중첩 프로필 장애 조치][4]

자식 프로필이 '우선 순위' 트래픽 라우팅 방법을 사용하면 해당 자식으로 이동되는 모든 트래픽이 단일 끝점에서 수신됩니다. 따라서 이 경우 MinChildEndpoints 설정에 '1'이 아닌 작은 값이 지정됩니다.

## 예제 3: '성능' 트래픽 라우팅에서 우선 순위가 지정된 장애 조치(Failover) 지역

'성능' 트래픽 라우팅을 사용하는 단일 프로필에서, 끝점 하나(예: 유럽 서부)에 장애가 발생하면 해당 끝점에 전달되었던 모든 트래픽이 모든 지역의 다른 끝점으로 분산됩니다. 이것은 가장 가까운 다음 끝점이 오버로드되면서 연속 장애가 발생하는 경우를 방지하도록 디자인된 '성능' 트래픽 라우팅 방법의 기본 동작입니다.

![기본 장애 조치를 사용하는 '성능' 트래픽 라우팅][5]

그러나 유럽 서부 트래픽을 미국 서부로 장애 조치(Failover)하고 해당 끝점을 둘 다 사용할 수 없게 되는 경우에만 다른 지역으로 전달하고 싶은 경우에는 표시된 것처럼 '우선 순위' 트래픽 라우팅 방법을 사용하는 자식 프로필을 만들면 됩니다.

![기본 설정 장애 조치를 사용하는 '성능' 트래픽 라우팅][6]

유럽 서부 끝점은 미국 서부 끝점보다 우선 순위가 높으므로 둘 다 온라인 상태인 경우 모든 트래픽은 유럽 서부 끝점으로 전송됩니다. 유럽 서부에 장애가 발생하면 해당 트래픽은 미국 서부로 전달됩니다. 미국 서부에 장애가 발생하는 경우에만 유럽 서부 트래픽이 동아시아로 전달됩니다.

부모 프로필의 모든 끝점 3개를 자식 프로필 3개로 바꾸고 각각에 장애 조치(Failover) 시퀀스를 지정하여 모든 지역에 대해 이 패턴을 반복할 수 있습니다.

## 예제 4: 동일한 지역의 여러 끝점 간에 '성능' 트래픽 라우팅 제어

미국 서부를 예로 들어, 특정 지역에 둘 이상의 끝점이 있는 프로필에서 '성능' 트래픽 라우팅 방법을 사용한다고 가정해보겠습니다. 기본적으로 해당 지역으로 전달된 트래픽은 해당 지역에서 사용 가능한 모든 끝점에서 균등하게 배포됩니다.

![지역 내 트래픽 분산의'성능' 트래픽 라우팅(기본 동작)][7]

이러한 기본 방식을 중첩 트래픽 관리자 프로필을 사용하여 변경할 수 있습니다. 미국 서부에 끝점을 여러 개 추가하는 대신, 해당 끝점을 별도의 자식 프로필에 포함시키고, 해당 자식 프로필을 미국 서부의 유일한 끝점으로 부모 프로필에 추가할 수 있습니다. 그런 후 자식 프로필에 대한 설정을 미국 서부의 트래픽 배포를 제어하는 데 사용하여 해당 지역 내에서 우선 순위 기반 또는 가중 트래픽 라우팅 등을 사용하도록 설정할 수 있습니다.

![사용자 지정 지역 내 트래픽 분산을 사용하는 '성능' 트래픽 라우팅][8]

## 예제 5: 끝점 기준 모니터링 설정

트래픽 관리자를 사용하여 기존 온-프레미스 웹 사이트와 Azure에서 호스트되는 새로운 클라우드 기반 버전 사이에서 원활하게 트래픽을 마이그레이션하고 있다고 가정하겠습니다. 기존 사이트의 경우 홈페이지(경로 '/')를 사용하여 사이트 상태를 모니터링하려고 하지만, 새로운 클라우드 기반 버전의 경우에는 추가 검사를 포함하는 사용자 지정 모니터링 페이지(경로 ‘/monitor.aspx’)를 구현합니다.

![트래픽 관리자 끝점 모니터링(기본 동작)][9]

트래픽 관리자 프로필의 모니터링 설정이 프로필 내의 모든 끝점에 적용됩니다. 즉, 이전에는 두 사이트에서 동일한 경로를 사용해야 했습니다. 이제 중첩 트래픽 관리자 프로필을 사용하여 사이트 기준 자식 프로필을 통해 사이트별로 다른 모니터링 설정을 정의할 수 있습니다.

![끝점 기준 설정을 사용하는 트래픽 관리자 끝점 모니터링][10]

## FAQ

### 중첩 프로필을 구성하려면 어떻게 해야 하나요?

중첩 트래픽 관리자 프로필은 ARM(Azure Resource Manager), ASM(Azure 서비스 관리) REST API, PowerShell cmdlet, 플랫폼 간 Azure CLI 명령을 사용하여 구성할 수 있습니다. Azure 포털을 통해서도 지원되지만 '클래식' 포털에서는 지원되지 않습니다.

### 트래픽 관리자가 지원하는 중첩 계층 수는 얼마나 되나요?
프로필을 10개 수준 깊이까지 중첩할 수 있습니다. '루프'는 허용되지 않습니다.

### 동일한 트래픽 관리자 프로필에서 중첩 자식 프로필과 다른 끝점 유형을 혼합할 수 있나요?

예. 프로필 내에서 서로 다른 유형의 끝점을 결합하는 방법에는 제한이 없습니다.

### 중첩 프로필에는 요금 청구 모델이 어떻게 적용되나요?

중첩 프로필을 사용한다고 해서 가격이 더 부과되지는 않습니다.

트래픽 관리자 요금 청구는 끝점 상태 검사 및 수백만 개의 DNS 쿼리로 구성됩니다. 자세한 내용은 [가격 책정 페이지](https://azure.microsoft.com/pricing/details/traffic-manager/)를 참조하세요. 이러한 요금 청구 구성 요소가 중첩 프로필에 적용되는 방식은 다음과 같습니다.

- 끝점 상태 검사: 부모 프로필에서 끝점으로 구성된 자식 프로필에 대해서는 요금이 부과되지 않습니다. 기본 서비스를 모니터링하는 자식 프로필의 끝점의 경우 요금이 일반적인 방식으로 청구됩니다.

- DNS 쿼리: 각 쿼리는 한 번만 계산됩니다. 자식 프로필의 끝점을 반환하는 부모 프로필에 대한 쿼리는 부모 프로필에 대해서만 요금이 청구됩니다.

### 중첩 프로필이 성능에 영향을 미치나요?

아니요. 중첩 프로필을 사용해도 성능에 미치는 영향은 없습니다.

트래픽 관리자 이름 서버는 각 DNS 쿼리를 처리할 때 프로필 계층 구조를 내부적으로 통과하므로 부모 프로필에 대한 DNS 쿼리는 자식 프로필의 끝점을 포함하는 DNS 응답을 받을 수 있습니다.

따라서 단일 트래픽 관리자 프로필을 사용할 때처럼 단일 CNAME 레코드만 사용됩니다. 계층의 각 프로필에 대해 하나씩 CNAME 레코드를 포함하는 체인이 필요하지는 **않으므로** 성능 저하가 발생하지 않습니다.

### 어떻게 트래픽 관리자는 자식 프로필의 상태에 따라 부모 프로필의 중첩 끝점 상태를 계산하나요?

부모 프로필의 중첩 끝점으로 자식 프로필이 구성된 경우 부모는 자식에 대해 직접 상태 검사를 수행하지 않습니다. 대신 자식 프로필 끝점의 상태가 자식 프로필의 전반적인 상태를 계산하는 데 사용되며, 이 정보는 부모 프로필 내에 중첩된 끝점의 상태를 결정하기 위해 중첩 프로필 계층 구조 위로 전파됩니다. 이에 따라 부모 프로필이 자식으로 트래픽을 전달할지 여부가 결정됩니다.

다음 표에서는 자식 프로필을 가리키는 부모 프로필의 중첩 끝점에 대한 트래픽 관리자의 상태 검사 동작에 대해 설명합니다.

|자식 프로필 모니터 상태|부모 끝점 모니터 상태|참고 사항|
|---|---|---|
|Disabled. 사용자가 자식 프로필을 사용하지 않도록 설정했습니다.|중지됨|부모 끝점 상태는 Stopped이며 Disabled가 아닙니다. Disabled 상태는 부모 프로필에서 끝점을 사용할 수 없도록 설정했음을 표시하도록 예약되어 있습니다.|
|Degraded. 하나 이상의 자식 프로필 끝점이 Degraded 상태입니다.|Online: 자식 프로필의 Online 끝점 수가 MinChildEndpoints 값 이상입니다. CheckingEndpoint: 자식 프로필의 Online 및 CheckingEndpoint 끝점 수 합계가 MinChildEndpoints 값 이상입니다. Degraded: 그렇지 않은 경우|트래픽이 CheckingEndpoint 상태의 끝점으로 라우팅됩니다. MinChildEndpoints를 너무 높게 설정하는 경우 끝점의 성능이 항상 저하됩니다.|
|Online. 하나 이상의 자식 프로필 끝점이 Online 상태이며 Degraded 상태는 없습니다.|위 내용을 참조하세요.||
|CheckingEndpoints. 하나 이상의 자식 프로필 끝점이 ‘CheckingEndpoint’이며 ‘Online’ 또는 ‘Degraded’는 없습니다.|위와 동일합니다.||
|Inactive. 모든 자식 프로필 끝점이 Disabled 또는 Stopped이거나 끝점이 없는 프로필입니다.|중지됨||


## 다음 단계

[트래픽 관리자 작동 방식](traffic-manager-how-traffic-manager-works.md)에 대한 자세한 정보

[트래픽 관리자 프로필을 만드는](traffic-manager-manage-profiles.md) 방법 알아보기

<!--Image references-->
[1]: ./media/traffic-manager-nested-profiles/figure-1.png
[2]: ./media/traffic-manager-nested-profiles/figure-2.png
[3]: ./media/traffic-manager-nested-profiles/figure-3.png
[4]: ./media/traffic-manager-nested-profiles/figure-4.png
[5]: ./media/traffic-manager-nested-profiles/figure-5.png
[6]: ./media/traffic-manager-nested-profiles/figure-6.png
[7]: ./media/traffic-manager-nested-profiles/figure-7.png
[8]: ./media/traffic-manager-nested-profiles/figure-8.png
[9]: ./media/traffic-manager-nested-profiles/figure-9.png
[10]: ./media/traffic-manager-nested-profiles/figure-10.png

<!---HONumber=AcomDC_0601_2016-->